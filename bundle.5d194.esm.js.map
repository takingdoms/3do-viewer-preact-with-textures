{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./components/options/OptionsUser.tsx","webpack:///../node_modules/@takingdoms/lib-3do/dist/index.js","webpack:///../node_modules/@takingdoms/lib-3do/dist/src/parse-3do.js","webpack:///../node_modules/@takingdoms/lib-3do/dist/src/byte-utils.js","webpack:///./components/ui/ColorControl.tsx","webpack:///./components/options/Options.tsx","webpack:///./lib/types/view.ts","webpack:///./components/options/OptionsControls.tsx","webpack:///../node_modules/preact-cli/src/lib/entry.js","webpack:///../node_modules/preact/hooks/src/index.js","webpack:///./components/ui/SliderControl.tsx","webpack:///./components/options/view-modes/WireframeOptions.tsx","webpack:///../node_modules/@takingdoms/lib-3do/dist/src/object-3do.js","webpack:///../node_modules/preact/src/util.js","webpack:///../node_modules/preact/src/create-element.js","webpack:///../node_modules/preact/src/component.js","webpack:///../node_modules/preact/src/diff/children.js","webpack:///../node_modules/preact/src/diff/props.js","webpack:///../node_modules/preact/src/diff/index.js","webpack:///../node_modules/preact/src/render.js","webpack:///../node_modules/preact/src/clone-element.js","webpack:///../node_modules/preact/src/create-context.js","webpack:///../node_modules/preact/src/options.js","webpack:///../node_modules/preact/src/constants.js","webpack:///../node_modules/preact/src/diff/catch-error.js","webpack:///./components/options/view-modes/RegularOptions.tsx","webpack:///../node_modules/gl-matrix/esm/common.js","webpack:///../node_modules/gl-matrix/esm/mat4.js","webpack:///../node_modules/gl-matrix/esm/vec3.js","webpack:///./lib/engines/gl/gl-texture.ts","webpack:///./lib/engines/gl/gl-model-helpers.ts","webpack:///./lib/engines/gl/gl-from-3do.ts","webpack:///./components/loader/Loader.tsx","webpack:///./lib/types/user-settings.ts","webpack:///./lib/services/user-service.ts","webpack:///./lib/types/model-controls.ts","webpack:///./components/ui/Spoiler.tsx","webpack:///./components/loader/FileChooser.tsx","webpack:///./lib/logo-colors.ts","webpack:///./lib/utils.ts","webpack:///./lib/engines/engine.ts","webpack:///./lib/engines/ui-debug-engine.ts","webpack:///./lib/engines/gl/webgl-helper.ts","webpack:///./lib/engines/gl/gl-context.ts","webpack:///./lib/engines/gl/gl-custom-context.ts","webpack:///./lib/engines/gl/gl-entity.ts","webpack:///./lib/engines/gl/buffer/gl-buffer.ts","webpack:///./lib/engines/gl/buffer/gl-index-buffer.ts","webpack:///./lib/engines/gl/buffer/gl-array-buffer.ts","webpack:///./lib/engines/gl/buffer/gl-normal-buffer.ts","webpack:///./lib/engines/gl/buffer/gl-position-buffer.ts","webpack:///./lib/engines/gl/buffer/gl-texture-coord-buffer.ts","webpack:///./lib/engines/gl/gl-model.ts","webpack:///./lib/engines/webgl-sub-renderers/webgl-sub-renderer.ts","webpack:///./lib/engines/webgl-sub-renderers/regular-renderer.ts","webpack:///./lib/engines/webgl-sub-renderers/solid-color-renderer.ts","webpack:///./lib/engines/webgl-sub-renderers/wireframe-renderer.ts","webpack:///./lib/engines/webgl-engine.ts","webpack:///./components/canvas/CanvasWrapper.tsx","webpack:///./components/object-list/ObjectListTree.module.css","webpack:///./components/object-list/ObjectSideControls.tsx","webpack:///./components/object-list/ObjectListTree.tsx","webpack:///./components/object-list/PrimitivesTable.tsx","webpack:///./components/object-list/ObjectList.tsx","webpack:///./components/textures/TextureList.tsx","webpack:///./components/textures/TextureManager.tsx","webpack:///./components/Main.tsx","webpack:///./index.ts","webpack:///./components/App.tsx","webpack:///./components/options/view-modes/SolidColorOptions.tsx","webpack:///./components/options/OptionsMisc.tsx","webpack:///./lib/io-utils.ts","webpack:///../node_modules/@takingdoms/lib-3do/dist/src/structs.js"],"names":["__webpack_require__","moduleId","installedModules","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","OptionsUser","userSettings","setUserSettings","class","for","id","sidebarPosition","onChange","ev","currentTarget","__createBinding","this","k","k2","undefined","desc","getOwnPropertyDescriptor","writable","configurable","__exportStar","require","parseObjects","data","offset","result","nextSibling","struct","ByteUtils","makeStruct","structs_1","OBJECT_STRUCT","parseName","vertices","parseVertices","primitives","parsePrimitives","children","push","xOffset","yOffset","zOffset","size","getUint8","slice","Uint8Array","buffer","textDecoder","decode","count","VERTEX_STRUCT_SIZE","VERTEX_STRUCT","x","y","z","PRIMITIVE_STRUCT_SIZE","PRIMITIVE_STRUCT","vertexIndices","v","nextVertexIndex","getUint16","textureName","__setModuleDefault","__importStar","mod","Parse3do","TextDecoder","fromBuffer","rootNodes","readInteger","pos","type","endianness","getInt8","getInt16","getInt32","ENDIANNESSES","INTEGER_TYPES","structDef","ColorControl","color","setColor","isCustom","setIsCustom","useState","currentOption","custom","useMemo","label","min","max","Math","floor","setValue","option","Options","modelControls","setModelControls","logoDefs","canvasRef","controls","user","viewModeOptions","viewMode","sub","enableSaveImageButton","preserveDrawingBuffer","VIEW_MODES","OptionsControls","SliderControl","zoom","rotationX","rotationY","rotationZ","translationX","translationY","find","vm","h","render","hydrate","Preact","interopDefault","default","normalizeURL","url","length","navigator","serviceWorker","register","__webpack_public_path__","root","document","getElementById","body","firstElementChild","init","app","preRenderData","inlineDataElement","querySelector","JSON","parse","decodeURI","innerHTML","CLI_DATA","currentURL","location","pathname","getHookState","index","options","__h","currentComponent","currentHook","hooks","__H","__","__V","EMPTY","initialState","reducer","hookState","currentIndex","_reducer","__c","invokeOrReturn","currentValue","__N","nextValue","action","setState","_hasScuFromHooks","prevScu","shouldComponentUpdate","stateHooks","filter","every","shouldUpdate","forEach","hookItem","props","useReducer","useEffect","callback","args","state","__s","argsChanged","_pendingArgs","useRef","initialValue","current","factory","useCallback","flushAfterPaintEffects","component","afterPaintEffects","shift","invokeCleanup","invokeEffect","e","__e","afterNextFrame","raf","done","clearTimeout","timeout","HAS_RAF","cancelAnimationFrame","setTimeout","requestAnimationFrame","hook","comp","cleanup","oldArgs","newArgs","some","arg","f","previousComponent","prevRaf","oldBeforeDiff","oldBeforeRender","oldAfterDiff","diffed","oldCommit","oldBeforeUnmount","unmount","vnode","commitQueue","cb","__v","hasErrored","style","width","WireframeOptions","wireframeColor","assign","obj","removeNode","node","parentNode","removeChild","createElement","ref","normalizedProps","arguments","defaultProps","createVNode","original","__k","__b","__d","constructor","vnodeId","createRef","Fragment","Component","context","getDomSibling","childIndex","indexOf","sibling","updateParentDomPointers","child","base","enqueueRender","rerenderQueue","process","prevDebounce","debounceRendering","queue","__r","sort","a","b","oldVNode","oldDom","parentDom","__P","diff","ownerSVGElement","commitRoot","diffChildren","renderResult","newParentVNode","oldParentVNode","globalContext","isSvg","excessDomChildren","isHydrating","j","childVNode","newDom","firstChildDom","refs","oldChildren","EMPTY_ARR","oldChildrenLength","Array","isArray","EMPTY_OBJ","reorderChildren","placeChild","applyRef","tmp","toChildArray","out","nextDom","sibDom","outer","appendChild","insertBefore","setStyle","setProperty","IS_NON_DIMENSIONAL","test","dom","oldValue","useCapture","cssText","replace","toLowerCase","addEventListener","eventProxyCapture","eventProxy","removeEventListener","removeAttribute","setAttribute","event","newVNode","isNew","oldProps","oldState","snapshot","clearProcessingException","newProps","provider","componentContext","renderHook","newType","contextType","__E","doRender","getDerivedStateFromProps","componentWillMount","componentDidMount","componentWillReceiveProps","_sb","componentWillUpdate","componentDidUpdate","getChildContext","getSnapshotBeforeUpdate","diffElementNodes","oldHtml","newHtml","nodeType","localName","createTextNode","createElementNS","is","childNodes","dangerouslySetInnerHTML","attributes","__html","diffProps","checked","parentVNode","skipRemove","componentWillUnmount","replaceNode","firstChild","cloneElement","createContext","defaultValue","contextId","Consumer","contextValue","Provider","subs","ctx","_props","old","splice","isValidElement","error","errorInfo","ctor","handled","getDerivedStateFromError","componentDidCatch","update","forceUpdate","LogoButton","htmlColor","isSelected","onSelect","borderColor","onClick","backgroundColor","RegularOptions","idxList","map","idx","idxToHtmlColor","logoColorIdx","textureFilterMin","textureFilterMag","enableLightingRegular","setMatrixArrayType","ARRAY_TYPE","toRadian","degree","equals","abs","EPSILON","glMatrix","Float32Array","clone","copy","fromValues","m00","m01","m02","m03","m10","m11","m12","m13","m20","m21","m22","m23","m30","m31","m32","m33","set","identity","transpose","a01","a02","a03","a12","a13","a23","invert","a00","a10","a11","a20","a21","a22","a30","a31","a32","a33","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","adjoint","determinant","multiply","b0","b1","b2","b3","translate","scale","rotate","rad","axis","b12","b20","b21","b22","len","hypot","sin","cos","rotateX","rotateY","rotateZ","fromTranslation","fromScaling","fromRotation","fromXRotation","fromYRotation","fromZRotation","fromRotationTranslation","q","w","x2","y2","z2","xx","xy","xz","yy","yz","zz","wx","wy","wz","fromQuat2","translation","bx","by","bz","bw","ax","ay","az","aw","magnitude","getTranslation","mat","getScaling","getRotation","scaling","is1","is2","is3","sm11","sm12","sm13","sm21","sm22","sm23","sm31","sm32","sm33","trace","S","sqrt","fromRotationTranslationScale","sx","sy","sz","fromRotationTranslationScaleOrigin","ox","oy","oz","out0","out1","out2","out4","out5","out6","out8","out9","out10","fromQuat","yx","zx","zy","frustum","left","right","bottom","top","near","far","rl","tb","nf","perspectiveNO","fovy","aspect","tan","Infinity","perspectiveZO","perspectiveFromFieldOfView","fov","upTan","upDegrees","PI","downTan","downDegrees","leftTan","leftDegrees","rightTan","rightDegrees","xScale","yScale","orthoNO","lr","bt","orthoZO","lookAt","eye","center","up","x0","x1","y0","y1","z0","z1","eyex","eyey","eyez","upx","upy","upz","centerx","centery","centerz","targetTo","target","str","frob","add","subtract","multiplyScalar","multiplyScalarAndAdd","exactEquals","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a14","a15","b4","b5","b6","b7","b8","b9","b13","b14","b15","divide","ceil","round","scaleAndAdd","distance","squaredDistance","squaredLength","negate","inverse","normalize","dot","cross","lerp","hermite","factorTimes2","factor1","factor2","factor3","factor4","bezier","inverseFactor","inverseFactorTimesTwo","random","zScale","transformMat4","transformMat3","transformQuat","qx","qy","qz","uvx","uvy","uvz","uuvx","uuvy","uuvz","w2","angle","mag","cosine","acos","zero","isPowerOf2","createModelFromIndexedVertices","computeNormals","positionData","flatMap","vertex","position","GlPositionBuffer","getGl","getProgramInfo","attribLocations","vertexPosition","bufferData","createBufferSourceFromPositions","indicesData","indices","GlIndexBuffer","normals","texCoords","createBufferSourceFromIndices","normalList","vec3","indexA","indexB","indexC","posA","posB","posC","edgeAB","edgeAC","areaWeightedNormal","GlNormalBuffer","vertexNormal","GlTextureCoordBuffer","textureCoord","createBufferSourceFromCoords","GlModel","addGlEntityFrom3do","parent","inputObjectEntityMap","triangulateQuads","useTextures","wrapper","GlEntity","SCALE","modelParts","primitive","model","glModelFrom3do","Utils","validateTextureName","setTextureKey","objectEntity","addChild","subChild","preOrderedVertices","nextVertex","GlModelHelpers","createStateMap","object3doTree","Map","next","highlight","hide","rootChild","getDefaultViewMode","textures","values","getDefaultLogoColor","dataSource","fileName","startsWith","DEFAULT_USER_SETTINGS","sidebarWidth","defaultTextureFilterMin","defaultTextureFilterMag","localStorageUserService","save","stringify","localStorage","setItem","load","getItem","Error","DEFAULT_MODEL_CONTROLS","viewColor","canvasBackground","canvasBackgroundSize","canvasBackgroundRepeat","enableLightingSolidColor","solidColor","Spoiler","title","showByDefault","show","setShow","content","showHide","SAMPLES","path","ISSUES_URL","submitButtonCss","FileChooser","onSubmit","defaultUserSettings","setDefaultUserSettings","controlsInfo","miscInfo","href","option1","preventDefault","file","FormData","className","option2","sample","toString","trim","advanced","maxWidth","minWidth","defaultLogoColorsDefinitions","defaultIdx","from","_","idxCount","idxToName","htmlColors","textureKeyUsesLogo","textureKey","includes","idxToTextureKey","idxToTextureFilename","compareObjectsShallow","obj1","obj2","entries1","entries","entries2","keys","key1","value1","createUpdatedMap","newMap","Engine","config","setupEvents","listener","canvas","mouseAction","mouseStartX","mouseStartY","controlStartX","controlStartY","didChange","onMouseDown","button","clientX","clientY","onMouseMove","deltaX","deltaY","newRotation","onMouseUp","onModelControlsChanged","onVisibilityChange","visibilityState","onWheel","window","cleanupEvents","onResized","canvasParent","parentElement","newWidth","clientWidth","newHeight","clientHeight","didResize","height","resizeObserver","ResizeObserver","alert","observe","setTextureMapping","textureMapping","setObjectStateMap","objStateMap","destroy","disconnect","UiDebugEngine","super","getContext","console","log","renderCount","startTime","performance","now","viewWidth","viewHeight","fillStyle","fillRect","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","textLines","textAlign","textBaseline","font","totalWidth","measureText","reduce","l1","l2","totalHeight","lineHeight","textSize","fillText","endTime","WebGlHelper","compileShader","gl","shaderSource","shaderType","shader","createShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","createProgram","vertexShader","fragmentShader","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","resizeCanvasToDisplaySize","displayWidth","displayHeight","needResize","RANDOM","vec","perspective","ortho","mul","div","dist","sqrDist","sqrLen","stride","fn","GlTexture","handle","createTexture","use","sampler","minFilter","maxFilter","deleted","ok","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1i","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","loadDataFromPixels","internalFormat","RGBA","srcFormat","srcType","UNSIGNED_BYTE","texImage2D","loadDataFromImage","image","complete","naturalWidth","fallbackPixel","onload","generateMipmap","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","delete","deleteTexture","GlContext","programInfo","currentLogoIdx","textureMinFilter","NEAREST","textureMagFilter","getBaseEntityColor","baseEntityColor","setBaseEntityColor","setUniformMatrix4","uniform","matrix","uniformLocations","uniformMatrix4fv","setUniformFloat4","uniform4fv","setUniformBool","bool","setTextureMinFilter","setTextureMagFilter","drawElements","TRIANGLES","UNSIGNED_SHORT","useTexture","texture","actualTextureKey","fromDb","textureDatabase","lastTexture","changeTextureMapping","existing","setupTexture","setCurrentLogoIdx","loadableTexture","GlCustomContext","LINE_LOOP","HIGHLIGHT","modelViewMatrix","mat4","relativeModelViewMatrix","stateOptions","visibile","highlighted","recalculateMatrices","renderChild","parentViewMatrix","nextColor","subModel","renderModel","findChild","recursive","usesNormals","normalMatrix","draw","resetTransformations","getStateOptions","setStateOptions","GlBuffer","createBuffer","_handle","doBufferData","doUse","deleteBuffer","getLength","byteLength","bindBuffer","ELEMENT_ARRAY_BUFFER","STATIC_DRAW","static","Uint16Array","GlArrayBuffer","attribLocation","ARRAY_BUFFER","FLOAT","vertexAttribPointer","enableVertexAttribArray","positions","coords","positionBuffer","indexBuffer","normalBuffer","textureCoordsBuffer","getTextureKey","createModelFromSmartVertices","uniqueData","uniqueDataIndices","item","v1","v2","makeCube","rootModel","DEFAULT_BASE_COLOR","WebglSubRenderer","shaderSources","initProgram","initContext","rootEntity","initRootEntity","getViewMode","object3do","objEntityMap","changeModelControls","changeObjectStateMap","entity","inBeforeTheRootRender","delta","drawingBufferWidth","drawingBufferHeight","clearColor","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","fieldOfView","projectionMatrix","useProgram","RegularRenderer","vsSource","fsSource","regular","vsShader","VERTEX_SHADER","fsShader","FRAGMENT_SHADER","shaderProgram","getAttribLocation","getUniformLocation","baseColor","entityColor","useLights","magFilter","LINEAR","SolidColorRenderer","solid","WireframeRenderer","wireframe","WebglEngine","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","subRenderers","solid_color","subRenderer","then","deltaTime","viewport","CanvasWrapper","ObjectSideControls","INDENT","ROW_HEIGHT","SPACING_Y","ObjectListTree","nodes","onChangeNodeStack","nodeStack","setObjStateMap","showChildren","setShowChildren","hasChildren","objState","Styles","newObjState","subNode","marginLeft","paddingTop","cellCss","thCss","tdCss","PrimitivesTable","join","ObjectList","setNodeStack","currentParent","currentChildren","currentObjState","pathing","sep","selCss","unselCss","currentParentInfo","currentParentPositions","currentParentPrimitives","TextureList","isOk","msg","marginBottom","src","rel","validFormats","TextureManager","regularTextures","customTextures","setCustomTextures","isLoading","setIsLoading","loadFiles","async","newMapping","files","updateMapping","fileBasename","IoUtils","loadDataUrl","createImageFromDataUrl","catch","fileInput","multiple","accept","disabled","finally","setTextures","SIDEBAR_TABS","Main","engineName","shaders","defaultObjStateMap","userService","defaultModelControls","expandContent","setExpandContent","sidebarTab","setSidebarTab","engine","setEngine","_setUserSettings","newUserSettings","engineConfig","actualLogoDefs","background","backgroundSize","backgroundRepeat","backgroundPosition","canvasWrapper","canvasPanel","optionsPanel","objectsPanel","texturesPanel","sidebar","tab","arr","seletedCss","borderCss","overflowX","contentBorderCss","flexDirCss","sidebarBorderCss","Loader","setResult","setShaders","setError","fetch","res","text","loadShaders","response","arrayBuffer","view","DataView","loadModel","tree","basePath","fileExtension","textureNames","Set","loadNext","rootNode","Promise","all","resolve","reject","textureFilePath","Image","onerror","nextIdx","resolveInner","logoTextureName","loadTextures","message","App","setDataSource","setDefaultModelControls","err","SolidColorOptions","OptionsMisc","canvasBg","setCanvasBg","getInitialBg","onChangeCanvasBg","customBgFile","dataUrl","imageUrl","selectBgSize","selectBgRepeat","saveCanvasImage","dataURL","toDataURL","downloadLink","timestamp","Date","getTime","download","click","saveImageButton","fileReader","FileReader","loadDataUrlPromise","readAsDataURL","OBJECT_STRUCT_SIZE"],"mappings":"aAIE,SAASA,EAAoBC,GAG5B,GAAGC,EAAiBD,GACnB,OAAOC,EAAiBD,GAAUE,QAGnC,IAAIC,EAASF,EAAiBD,GAAY,CACzCI,EAAGJ,EACHK,GAAG,EACHH,QAAS,CAAC,GAUX,OANAI,EAAQN,GAAUO,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASH,GAG/DI,EAAOE,GAAI,EAGJF,EAAOD,OACf,CAxBA,IAAID,EAAmB,CAAC,EA4BxBF,EAAoBS,EAAIF,EAGxBP,EAAoBU,EAAIR,EAGxBF,EAAoBW,EAAI,SAASR,EAASS,EAAMC,GAC3Cb,EAAoBc,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,GAEhE,EAGAb,EAAoBmB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,GACvD,EAOAtB,EAAoBuB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQtB,EAAoBsB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA3B,EAAoBmB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOtB,EAAoBW,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,EAAM,EAAEC,KAAK,KAAMD,IAC9I,OAAOF,CACR,EAGA1B,EAAoB8B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,OAAG,EAClD,WAA8B,OAAOA,CAAQ,EAE9C,OADAJ,EAAoBW,EAAEE,EAAQ,IAAKA,GAC5BA,CACR,EAGAb,EAAoBc,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,EAAW,EAGpHhC,EAAoBmC,EAAI,gEAIjBnC,EAAoBA,EAAoBoC,EAAI,O,8jCCpDtCC,IAxBV,EACHC,eACAC,qBAGE,mBAAKC,MAAM,aACT,mBAAKA,MAAM,+BACT,qBAAOC,IAAI,mBAAkB,oBAC7B,sBACEC,GAAG,kBACHpB,MAAOgB,EAAaK,gBACpBC,SAAWC,IACT,MAAMF,EAA6C,SAA3BE,EAAGC,cAAcxB,MAAmB,OAAS,QACrEiB,EAAgB,EAAD,KAAMD,GAAY,IAAEK,oBAAkB,GAGvD,sBAAQrB,MAAM,QAAO,QACrB,sBAAQA,MAAM,SAAQ,W,sCCtBhC,IAAIyB,EAAmBC,MAAQA,KAAKD,kBAAqBhC,OAAOY,OAAU,SAASb,EAAGL,EAAGwC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3B,IAAIG,EAAOrC,OAAOsC,yBAAyB5C,EAAGwC,GACzCG,KAAS,QAASA,GAAQ3C,EAAEgB,WAAa2B,EAAKE,UAAYF,EAAKG,gBAClEH,EAAO,CAAEnC,YAAY,EAAMC,IAAK,WAAa,OAAOT,EAAEwC,EAAI,IAE5DlC,OAAOC,eAAeF,EAAGoC,EAAIE,EACjC,EAAM,SAAStC,EAAGL,EAAGwC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BnC,EAAEoC,GAAMzC,EAAEwC,EACd,GACIO,EAAgBR,MAAQA,KAAKQ,cAAiB,SAAS/C,EAAGN,GAC1D,IAAK,IAAIgC,KAAK1B,EAAa,YAAN0B,GAAoBpB,OAAOkB,UAAUC,eAAe1B,KAAKL,EAASgC,IAAIY,EAAgB5C,EAASM,EAAG0B,EAC3H,EACApB,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDkC,EAAaC,EAAQ,QAAqBtD,GAC1CqD,EAAaC,EAAQ,QAAqBtD,GAC1CqD,EAAaC,EAAQ,QAAoBtD,E,sCCezC,SAASuD,EAAaC,EAAMC,GACxB,MAAMC,EAAS,GACf,IAAIC,EAAcF,EAClB,EAAG,CACC,MAAMG,EAASC,EAAUC,WAAWN,EAAMG,EAAaI,EAAUC,eAE3DvD,EAAOwD,EAAUT,EAAMI,EAA2B,oBAClDM,EAAWC,EAAcX,EAAMI,EAA4B,oBAAGA,EAAyB,kBACvFQ,EAAaC,EAAgBb,EAAMI,EAA+B,uBAAGA,EAA2B,oBAChGU,EAA6C,IAAlCV,EAA4B,oBACvCL,EAAaC,EAAMI,EAA4B,qBAC/C,GAUNF,EAAOa,KATQ,CACX9D,OACAyD,WACAE,aACAE,WACAE,QAASZ,EAAoB,YAC7Ba,QAASb,EAAoB,YAC7Bc,QAASd,EAAoB,cAGjCD,EAAcC,EAA8B,qBAChD,OAAyB,IAAhBD,GACT,OAAOD,CACX,CAGA,SAASO,EAAUT,EAAMC,GACrB,IAAIkB,EAAO,EACX,IAAK,IAAIzE,EAAI,EAAGA,EAHD,IAGiBA,IAAK,CACjCyE,EAAOzE,EAEP,GAAiB,IADAsD,EAAKoB,SAASnB,EAASvD,GAEpC,KACR,CAIA,MAAM2E,EAAQ,IAAIC,WAAWtB,EAAKuB,OAAQtB,EAAQkB,GAClD,OAAOK,EAAYC,OAAOJ,EAC9B,CACA,SAASV,EAAcX,EAAMC,EAAQyB,GACjC,MAAMxB,EAAS,GACf,IAAK,IAAIxD,EAAI,EAAGA,EAAIgF,EAAOhF,IAAK,CAC5B,MAAM0D,EAASC,EAAUC,WAAWN,EAAMC,EAAUvD,EAAI6D,EAAUoB,mBAAqBpB,EAAUqB,eACjG1B,EAAOa,KAAK,CACRc,EAAGzB,EAAOyB,EACVC,EAAG1B,EAAO0B,EACVC,EAAG3B,EAAO2B,GAElB,CACA,OAAO7B,CACX,CACA,SAASW,EAAgBb,EAAMC,EAAQyB,GACnC,MAAMxB,EAAS,GACf,IAAK,IAAIxD,EAAI,EAAGA,EAAIgF,EAAOhF,IAAK,CAC5B,MAAM0D,EAASC,EAAUC,WAAWN,EAAMC,EAAUvD,EAAI6D,EAAUyB,sBAAwBzB,EAAU0B,kBAC9FC,EAAgB,GACtB,IAAK,IAAIC,EAAI,EAAGA,EAAI/B,EAA8B,sBAAG+B,IAAK,CAEtD,MAAMC,EAAkBpC,EAAKqC,UAAUjC,EAAiC,yBAAS,EAAJ+B,GAAQ,GACrFD,EAAcnB,KAAKqB,EACvB,CACA,MAAME,EAAc7B,EAAUT,EAAMI,EAA4B,qBAChEF,EAAOa,KAAK,CACRmB,gBACAI,eAER,CACA,OAAOpC,CACX,CAvGA,IAAId,EAAmBC,MAAQA,KAAKD,kBAAqBhC,OAAOY,OAAU,SAASb,EAAGL,EAAGwC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3B,IAAIG,EAAOrC,OAAOsC,yBAAyB5C,EAAGwC,GACzCG,KAAS,QAASA,GAAQ3C,EAAEgB,WAAa2B,EAAKE,UAAYF,EAAKG,gBAClEH,EAAO,CAAEnC,YAAY,EAAMC,IAAK,WAAa,OAAOT,EAAEwC,EAAI,IAE5DlC,OAAOC,eAAeF,EAAGoC,EAAIE,EACjC,EAAM,SAAStC,EAAGL,EAAGwC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BnC,EAAEoC,GAAMzC,EAAEwC,EACd,GACIiD,EAAsBlD,MAAQA,KAAKkD,qBAAwBnF,OAAOY,OAAU,SAASb,EAAGgF,GACxF/E,OAAOC,eAAeF,EAAG,UAAW,CAAEG,YAAY,EAAMK,MAAOwE,GACnE,EAAK,SAAShF,EAAGgF,GACbhF,EAAW,QAAIgF,CACnB,GACIK,EAAgBnD,MAAQA,KAAKmD,cAAiB,SAAUC,GACxD,GAAIA,GAAOA,EAAI3E,WAAY,OAAO2E,EAClC,IAAIvC,EAAS,CAAC,EACd,GAAW,MAAPuC,EAAa,IAAK,IAAInD,KAAKmD,EAAe,YAANnD,GAAmBlC,OAAOkB,UAAUC,eAAe1B,KAAK4F,EAAKnD,IAAIF,EAAgBc,EAAQuC,EAAKnD,GAEtI,OADAiD,EAAmBrC,EAAQuC,GACpBvC,CACX,EACA9C,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDnB,EAAQkG,cAAW,EACnB,MAAMrC,EAAYmC,EAAa1C,EAAQ,SACjCS,EAAYT,EAAQ,QAgCpB0B,EAAc,IAAImB,YAAY,SAqDpCnG,EAAQkG,SAAW,CACfE,WArFJ,SAAoB5C,GAChB,MAAO,CACH6C,UAAW9C,EAAaC,EAAM,GAEtC,E,kCC3BA,SAAS8C,EAAY9C,EAAM+C,EAAKC,EAAMC,EAAa,MAC/C,MAAa,OAATD,EACOhD,EAAKkD,QAAQH,GAEX,OAATC,EACOhD,EAAKoB,SAAS2B,GAEZ,QAATC,EACOhD,EAAKmD,SAASJ,EAAoB,OAAfE,GAEjB,QAATD,EACOhD,EAAKqC,UAAUU,EAAoB,OAAfE,GAExBjD,EAAKoD,SAASL,EAAoB,OAAfE,EAC9B,CAlBA7F,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDnB,EAAQ8D,WAAa9D,EAAQsG,YAActG,EAAQ6G,aAAe7G,EAAQ8G,mBAAgB,EAC1F9G,EAAQ8G,cAAgB,CAAC,KAAM,KAAM,MAAO,MAAO,MAAO,OAC1D9G,EAAQ6G,aAAe,CAAC,KAAM,MAgB9B7G,EAAQsG,YAAcA,EAiBtBtG,EAAQ8D,WAhBR,SAAoBN,EAAMC,EAAQsD,EAAWN,EAAa,MACtD,IAAI/C,EAAS,CAAC,EACd,IAAK,MAAOjD,EAAM+F,KAASO,EACvBrD,EAAOjD,GAAQ6F,EAAY9C,EAAMC,EAAQ+C,EAAMC,GAClC,OAATD,GAA0B,OAATA,EACjB/C,GAAU,EAEI,QAAT+C,GAA2B,QAATA,EACvB/C,GAAU,EAEI,QAAT+C,GAA2B,QAATA,IACvB/C,GAAU,GAGlB,OAAOC,CACX,C,oCCnCA,wCA0GesD,IAnGV,EAAGC,QAAOC,eACb,MAAOC,EAAUC,GAAeC,aAAS,GAEzC,IAAIC,EAAgB,SAEfH,IACc,IAAbF,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,GAC9DK,EAAgB,QAEI,IAAbL,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,GACnEK,EAAgB,MAEI,IAAbL,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,GACnEK,EAAgB,QAEI,IAAbL,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,IAAyB,IAAbA,EAAM,KACnEK,EAAgB,SAIpB,MAAMC,EAASC,aAAQ,IAChBL,EAKH,mBAAK9E,MAAM,aACT,YAAC,IAAa,CACZE,GAAG,MACHkF,MAAM,MACNC,IAAK,EACLC,IAAK,IACLxG,MAAOyG,KAAKC,MAAiB,IAAXZ,EAAM,IACxBa,SAAW3G,IAET+F,EAAS,CADQ/F,EAAQ,IACL8F,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAAI,IAGtD,YAAC,IAAa,CACZ1E,GAAG,QACHkF,MAAM,QACNC,IAAK,EACLC,IAAK,IACLxG,MAAOyG,KAAKC,MAAiB,IAAXZ,EAAM,IACxBa,SAAW3G,IAET+F,EAAS,CAACD,EAAM,GADC9F,EAAQ,IACK8F,EAAM,GAAIA,EAAM,IAAI,IAGtD,YAAC,IAAa,CACZ1E,GAAG,OACHkF,MAAM,OACNC,IAAK,EACLC,IAAK,IACLxG,MAAOyG,KAAKC,MAAiB,IAAXZ,EAAM,IACxBa,SAAW3G,IAET+F,EAAS,CAACD,EAAM,GAAIA,EAAM,GADT9F,EAAQ,IACe8F,EAAM,IAAI,KAnCjD,MAwCR,CAACE,EAAUF,EAAOC,IAErB,OACE,mBAAK7E,MAAM,IACT,sBACElB,MAAOmG,EACP7E,SAAWC,IACT,MAAMqF,EAASrF,EAAGC,cAAcxB,MAEhC,GAAe,WAAX4G,EAEF,YADAX,GAAY,GAIdA,GAAY,GAQZF,EALe,QAAXa,EAAmB,CAAC,EAAG,EAAG,EAAG,GAClB,UAAXA,EAAqB,CAAC,EAAG,EAAG,EAAG,GACpB,SAAXA,EAAoB,CAAC,EAAG,EAAG,EAAG,GAC9B,CAAC,EAAG,EAAG,EAAG,GAEC,GAGjB,sBAAQ5G,MAAM,UAAS,YACvB,sBAAQA,MAAM,SAAQ,SACtB,sBAAQA,MAAM,OAAM,OACpB,sBAAQA,MAAM,SAAQ,SACtB,sBAAQA,MAAM,QAAO,SAGtBoG,EACG,C,qCCvGV,gHA4EeS,IAvDkC,EAC/CC,gBACAC,mBACA/F,eACAC,kBACA+F,WACAC,gBAEA,MAAMC,EAAWb,aAAQ,IACvB,YAAC,IAAe,CAACS,cAAeA,EAAeC,iBAAkBA,KAChE,CAACD,EAAeC,IAEbI,EAAOd,aAAQ,IACnB,YAAC,IAAW,CAACrF,aAAcA,EAAcC,gBAAiBA,KACzD,CAACD,EAAcC,IAEZmG,EAAkBf,aAAQ,KAC9B,MAAMgB,EAAWP,EAAcO,SAEzBC,EACW,YAAbD,EACE,YAAC,IAAc,CAACP,cAAeA,EAAeC,iBAAkBA,EAAkBC,SAAUA,IACjF,gBAAbK,EACE,YAAC,IAAiB,CAACP,cAAeA,EAAeC,iBAAkBA,IACxD,cAAbM,EACE,YAAC,IAAgB,CAACP,cAAeA,EAAeC,iBAAkBA,IACpE,KAEJ,OAAQ,mBACN,mBAAK7F,MAAM,iEAAgE,sBAC1EoG,EACA,GACF,CAACR,EAAeC,IAEnB,OACE,mBAAK7F,MAAM,iCACT,mBAAKA,MAAM,4DAA2D,YACrEgG,EAEAE,EAED,mBAAKlG,MAAM,iEAAgE,iBAC1EiG,EAED,mBAAKjG,MAAM,iEAAgE,SAC3E,YAAC,IAAW,CACV4F,cAAeA,EACfC,iBAAkBA,EAClBE,UAAWA,EACXM,sBAAuBvG,EAAawG,wBAElC,C,2lCCrEH,MAAMC,EAAyB,CAAC,UAAW,cAAe,a,gBC2ElDC,IAtEV,EACHZ,gBACAC,sBAGE,mBAAK7F,MAAM,aACT,YAACyG,EAAA,EAAa,CACZvG,GAAG,OACHkF,MAAM,OACNE,IAAK,IACLxG,MAAO8G,EAAcc,KACrBjB,SAAWiB,GAASb,EAAiB,EAAD,KAAMD,GAAa,IAAEc,YAE3D,YAACD,EAAA,EAAa,CACZvG,GAAG,YACHkF,MAAM,aACNC,KAAM,IACNC,IAAK,IACLxG,MAAO8G,EAAce,UACrBlB,SAAWkB,GAAed,EAAiB,EAAD,KAAMD,GAAa,IAAEe,iBAEjE,YAACF,EAAA,EAAa,CACZvG,GAAG,YACHkF,MAAM,aACNC,KAAM,IACNC,IAAK,IACLxG,MAAO8G,EAAcgB,UACrBnB,SAAWmB,GAAcf,EAAiB,EAAD,KAAMD,GAAa,IAAEgB,iBAEhE,YAACH,EAAA,EAAa,CACZvG,GAAG,YACHkF,MAAM,aACNC,KAAM,IACNC,IAAK,IACLxG,MAAO8G,EAAciB,UACrBpB,SAAWoB,GAAchB,EAAiB,EAAD,KAAMD,GAAa,IAAEiB,iBAEhE,YAACJ,EAAA,EAAa,CACZvG,GAAG,OACHkF,MAAM,QACNtG,MAAO8G,EAAckB,aACrBrB,SAAWqB,GAAiBjB,EAAiB,EAAD,KAAMD,GAAa,IAAEkB,oBAEnE,YAACL,EAAA,EAAa,CACZvG,GAAG,OACHkF,MAAM,QACNtG,MAAO8G,EAAcmB,aACrBtB,SAAWsB,GAAiBlB,EAAiB,EAAD,KAAMD,GAAa,IAAEmB,oBAEnE,mBAAK/G,MAAM,+BACT,qBAAOC,IAAI,YAAW,aACtB,sBACEC,GAAG,WACHpB,MAAO8G,EAAcO,SACrB/F,SAAWC,IACT,MAAM8F,EAAWI,EAAWS,MAAMC,GAAOA,IAAO5G,EAAGC,cAAcxB,QAC7DqH,GACFN,EAAiB,EAAD,KAAMD,GAAa,IAAEO,aACvC,GAGF,sBAAQrH,MAAM,WAAU,WACxB,sBAAQA,MAAM,eAAc,eAC5B,sBAAQA,MAAM,aAAY,e,sCCvEpC,uBAGA,MAAM,EAAEoI,EAAC,OAAEC,EAAM,QAAEC,GAAYC,EAEzBC,EAAiBrJ,GAAMA,GAAKA,EAAEsJ,QAAUtJ,EAAEsJ,QAAUtJ,EAEpDuJ,EAAeC,GAAgC,MAAxBA,EAAIA,EAAIC,OAAS,GAAaD,EAAMA,EAAM,IA0BvE,GATiC,kBAAmBE,WACnDA,UAAUC,cAAcC,SACvBL,EAAaM,KACY,aAMR,mBAFTR,EAAerG,EAAQ,SAEF,CAC9B,IAAI8G,EACHC,SAASC,eAAe,gBAAkBD,SAASE,KAAKC,kBAErDC,EAAO,KACV,IAAIC,EAAMf,EAAerG,EAAQ,SAC7BqH,EAAgB,CAAC,EACrB,MAAMC,EAAoBP,SAASQ,cAClC,gCAEGD,IACHD,EACCG,KAAKC,MAAMC,UAAUJ,EAAkBK,YAAYN,eACnDA,GAMF,MAAMO,EAAW,CAAEP,iBACbQ,EAAaR,EAAcb,IAAMD,EAAac,EAAcb,KAAO,IAIxEL,GACA0B,IAAetB,EAAauB,SAASC,UACR5B,EAAUD,GAC/BD,EAAEmB,EAAK,CAAEQ,aAAab,SAASE,KAAMH,EAAK,EAGhDnK,EAEJwK,GACD,C,oCCyDA,SAASa,EAAaC,EAAO/E,GACxBgF,UAAeC,KAClBD,UAAOC,IAAOC,EAAkBH,EAAOI,GAAenF,GAEvDmF,EAAc,EAOd,IAAMC,EACLF,QACCA,EAAgBG,IAAW,CAC3BC,GAAO,GACPL,IAAiB,KAMnB,OAHIF,GAASK,KAAY7B,QACxB6B,EAAKE,GAAOvH,KAAK,CAAEwH,IAAeC,IAE5BJ,KAAYL,EACnB,CAKM,SAASlE,EAAS4E,GAExB,OADAN,EAAc,EAUR,SAAoBO,EAASD,EAAcxB,GAEjD,IAAM0B,EAAYb,EAAac,IAAgB,GAE/C,GADAD,EAAUE,EAAWH,GAChBC,EAALG,MACCH,KAAmB,CACjB1B,EAAiDA,EAAKwB,GAA/CM,SAA0BN,GAElC,YACC,IAAMO,EAAeL,EAASM,IAC3BN,MAAqB,GACrBA,EAASL,GAAQ,GACdY,EAAYP,EAAUE,EAASG,EAAcG,GAE/CH,IAAiBE,IACpBP,EAASM,IAAc,CAACC,EAAWP,KAAiB,IACpDA,MAAqBS,SAAS,CAA9B,GAED,GAGFT,MAAuBT,GAElBA,EAAiBmB,GAAkB,CACvCnB,EAAiBmB,KACjB,IAAMC,EAAUpB,EAAiBqB,sBAQjCrB,EAAiBqB,sBAAwB,SAAS/K,EAAGC,EAAG1B,GACvD,IAAK4L,EAALG,QAAmC,OAAO,EAE1C,IAAMU,EAAab,aAAmCc,QACrD,YAAA5H,OAAKA,EADaiH,GAAA,IAMnB,GAHsBU,EAAWE,OAAM,YAAC,OAAK7H,EAALoH,GAAA,IAIvC,OAAOK,GAAUA,EAAQzM,KAAKwC,KAAMb,EAAGC,EAAG1B,GAM3C,IAAI4M,KAUJ,OATAH,EAAWI,SAAQ,YAClB,GAAIC,EAAJZ,IAAyB,CACxB,IAAMD,EAAea,EAAQvB,GAAQ,GACrCuB,KAAkBA,EAClBA,iBACIb,IAAiBa,EAAQvB,GAAQ,KAAIqB,KACzC,CACD,OAEMA,GAAgBhB,EAASG,IAAYgB,QAAUtL,MACnD8K,GACCA,EAAQzM,KAAKwC,KAAMb,EAAGC,EAAG1B,GAG7B,CACD,CAGF,OAAO4L,EAASM,KAAeN,EAC/BL,EAAA,CA9EOyB,CAAWhB,EAAgBN,EAClC,CAmFeuB,WAAUC,EAAUC,GAEnC,IAAMC,EAAQrC,EAAac,IAAgB,IACtCZ,UAADoC,KAAyBC,EAAYF,EAAaD,SACrDC,KAAeF,EACfE,EAAMG,EAAeJ,EAErBhC,EAAgBG,IAAyBtH,SAAKoJ,GAE/C,CAiBM,SAASI,EAAOC,GAEtB,OADArC,EAAc,EACPnE,GAAQ,WAAO,OAAEyG,QAASD,EAAlB,GAAmC,GAClD,CA2BexG,WAAQ0G,EAASR,GAEhC,IAAMC,EAAQrC,EAAac,IAAgB,GAC3C,OAAIyB,EAAYF,EAAaD,QAC5BC,EAAK5B,IAAiBmC,IACtBP,EAAMG,EAAeJ,EACrBC,EAAKlC,IAAYyC,EACVP,EAAP5B,KAGM4B,IACP,CAMeQ,WAAYV,EAAUC,GAErC,OADA/B,EAAc,EACPnE,GAAQ,kBAAMiG,CAAN,GAAgBC,EAC/B,CA4ED,SAASU,IAER,IADA,IAAIC,EACIA,EAAYC,EAAkBC,SACrC,GAAKF,OAAyBA,EAA9BxC,IACA,IACCwC,EAASxC,IAAyBuB,YAAQoB,GAC1CH,EAASxC,IAAyBuB,YAAQqB,GAC1CJ,EAASxC,IAA2BJ,MAIpC,CAHC,MAAOiD,GACRL,EAASxC,IAA2BJ,OACpCD,UAAOmD,IAAaD,EAAGL,MACvB,CAEF,CAcD,SAASO,EAAenB,GACvB,IAOIoB,EAPEC,EAAO,WACZC,aAAaC,GACTC,GAASC,qBAAqBL,GAClCM,WAAW1B,EACX,EACKuB,EAAUG,WAAWL,EA5YR,KA+YfG,IACHJ,EAAMO,sBAAsBN,GAE7B,CAmBD,SAASN,EAAca,GAGtB,IAAMC,EAAO5D,EACT6D,EAAUF,EAAd/C,IACsB,mBAAXiD,IACVF,aACAE,KAGD7D,EAAmB4D,CACnB,CAMD,SAASb,EAAaY,GAGrB,IAAMC,EAAO5D,EACb2D,EAAI/C,IAAY+C,OAChB3D,EAAmB4D,CACnB,CAMD,SAASzB,EAAY2B,EAASC,GAC7B,OACED,GACDA,EAAQzF,SAAW0F,EAAQ1F,QAC3B0F,EAAQC,MAAK,SAACC,EAAKpE,GAAUoE,WAAQH,EAAQjE,EAAhC,GAEd,CAED,SAASgB,EAAeoD,EAAKC,GAC5B,MAAmB,mBAALA,EAAkBA,EAAED,GAAOC,CACzC,C,8KAleGxD,EAGAV,EAGAmE,EAiBAC,E,YAdAnE,EAAc,EAGd2C,EAAoB,GAEpBtC,EAAQ,GAER+D,EAAgBvE,cAChBwE,EAAkBxE,cAClByE,EAAezE,UAAQ0E,OACvBC,EAAY3E,UAAhBc,IACI8D,EAAmB5E,UAAQ6E,QAK/B7E,cAAgB,YACfE,EAAmB,KACfqE,GAAeA,EAAcO,EACjC,EAED9E,cAAkB,YACbwE,GAAiBA,EAAgBM,GAGrClE,EAAe,EAEf,IAAMR,GAHNF,EAAmB4E,EAAnBhE,SAIIV,IACCiE,IAAsBnE,GACzBE,EAAKH,IAAmB,GACxBC,EAAgBD,IAAoB,GACpCG,EAAKE,GAAOsB,SAAQ,YACfC,EAAqBZ,MACxBY,KAAkBA,EAAlBZ,KAEDY,MAAyBrB,EACzBqB,MAAsBA,EAASS,QAC/B,MAEDlC,EAAKH,IAAiB2B,QAAQoB,GAC9B5C,EAAKH,IAAiB2B,QAAQqB,GAC9B7C,EAAKH,IAAmB,KAG1BoE,EAAoBnE,CACpB,EAEDF,UAAQ0E,OAAS,YACZD,GAAcA,EAAaK,GAE/B,IAAM/P,EAAI+P,EAAVhE,IACI/L,GAAKA,QACJA,UAA0BwJ,SAoXR,IApX2BuE,EAAkB/J,KAAKhE,IAoX7CuP,IAAYtE,UAAQ4D,yBAC/CU,EAAUtE,UAAQ4D,wBACNR,GAAgBR,IArX5B7N,EAACsL,OAAeuB,SAAQ,YACnBC,EAASS,IACZT,MAAiBA,EAASS,GAEvBT,QAA2BrB,IAC9BqB,KAAkBA,EAClBtB,KACDsB,EAASS,SACTT,MAAyBrB,CACzB,KAEF6D,EAAoBnE,EAAmB,IACvC,EAEDF,cAAkB,SAAC8E,EAAOC,GACzBA,EAAYb,MAAK,YAChB,IACCrB,MAA2BjB,QAAQoB,GACnCH,MAA6BA,EAAS5C,IAAkBwB,QAAO,YAC9DuD,aAAY/B,EAAa+B,EADuC,GASjE,CANC,MAAO9B,GACR6B,EAAYb,MAAK,YACZnP,EAAoBA,YAAqB,GAC7C,IACDgQ,EAAc,GACd/E,cAAoBkD,EAAGL,EACvBoC,IAAA,CACD,IAEGN,GAAWA,EAAUG,EAAOC,EAChC,EAED/E,UAAQ6E,QAAU,YACbD,GAAkBA,EAAiBE,GAEvC,IAEKI,EAFCnQ,EAAI+P,EAAHhE,IACH/L,GAAKA,EAATsL,MAECtL,EAACsL,OAAeuB,SAAQ,YACvB,IACCoB,EAAcvM,EAGd,CAFC,MAAOyM,GACRgC,EAAahC,CACb,CACD,IACDnO,aACImQ,GAAYlF,UAAOmD,IAAa+B,EAAYnQ,OAEjD,EAgSD,IAAI0O,EAA0C,mBAAzBG,qB,oCCnZrB,gBA0CetG,IAjCV,EAAGvG,KAAIkF,QAAOC,MAAKC,MAAKxG,QAAO2G,cAIhC,uBACE,uBACE,qBAAOxF,IAAKC,GAAKkF,IAEnB,mBAAKpF,MAAM,+BACT,qBACEmE,KAAK,SACLmK,MAAO,CAAEC,MAAO,QAChBzP,MAAOA,EACPsB,SAAWC,IACToF,GAAUpF,EAAGC,cAAcxB,MAAM,IAGrC,qBACEkB,MAAM,OACNmE,KAAK,QACLkB,IAAKA,EACLC,IAAKA,EACLgJ,MAAO,CAAEC,MAAO,SAChBzP,MAAOA,EACPsB,SAAWC,IACToF,GAAUpF,EAAGC,cAAcxB,OAAS,EAAE,K,ukCCPnC0P,IApBV,EACH5I,gBACAC,sBAGE,mBAAK7F,MAAM,aACT,uBACE,mBAAKA,MAAM,IAAG,mBAId,YAAC,IAAY,CACX4E,MAAOgB,EAAc6I,eACrB5J,SAAW4J,GAAmB5I,EAAiB,EAAD,KAAMD,GAAa,IAAE6I,uB,kCCnB7ElQ,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,G,oCCQtC4P,WAAOC,EAAK1D,GAE3B,IAAK,IAAIpN,KAAKoN,EAAO0D,EAAI9Q,GAAKoN,EAAMpN,GACpC,OAA6B8Q,CAC7B,CAQM,SAASC,EAAWC,GAC1B,IAAIC,EAAaD,EAAKC,WAClBA,GAAYA,EAAWC,YAAYF,EACvC,CCXM,SAASG,EAAc7K,EAAM8G,EAAOhJ,GAC1C,IACC7C,EACA6P,EACApR,EAHGqR,EAAkB,CAAC,EAIvB,IAAKrR,KAAKoN,EACA,OAALpN,EAAYuB,EAAM6L,EAAMpN,GACd,OAALA,EAAYoR,EAAMhE,EAAMpN,GAC5BqR,EAAgBrR,GAAKoN,EAAMpN,GAUjC,GAPIsR,UAAUzH,OAAS,IACtBwH,EAAgBjN,SACfkN,UAAUzH,OAAS,EAAIlF,EAAMxE,KAAKmR,UAAW,GAAKlN,GAKjC,mBAARkC,GAA2C,MAArBA,EAAKiL,aACrC,IAAKvR,KAAKsG,EAAKiL,kBAAcA,IACxBF,EAAgBrR,KACnBqR,EAAgBrR,GAAKsG,EAAKiL,aAAavR,IAK1C,OAAOwR,EAAYlL,EAAM+K,EAAiB9P,EAAK6P,EAAK,KACpD,UAceI,EAAYlL,EAAM8G,EAAO7L,EAAK6P,EAAKK,GAGlD,IAAMrB,EAAQ,CACb9J,OACA8G,QACA7L,MACA6P,MACAM,IAAW,KACX9F,GAAS,KACT+F,IAAQ,EACRlD,IAAM,KAKNmD,WACAxF,IAAY,KACZb,IAAY,KACZsG,iBAAaA,EACbtB,IAAuB,MAAZkB,IAAqBK,EAAUL,GAM3C,OAFgB,MAAZA,GAAqC,MAAjBnG,EAAQ8E,OAAe9E,EAAQ8E,MAAMA,GAEtDA,CACP,CAEM,SAAS2B,IACf,MAAO,CAAEhE,QAAS,KAClB,CAEM,SAASiE,EAAS5E,GACxB,OAAOA,EAAMhJ,QACb,UC7Ee6N,EAAU7E,EAAO8E,GAChCvP,KAAKyK,MAAQA,EACbzK,KAAKuP,QAAUA,CACf,UA0EeC,EAAc/B,EAAOgC,GACpC,GAAkB,MAAdA,EAEH,OAAOhC,EAAKxE,GACTuG,EAAc/B,EAADxE,GAAgBwE,SAAwBiC,QAAQjC,GAAS,GACtE,KAIJ,IADA,IAAIkC,EACGF,EAAahC,MAAgBvG,OAAQuI,IAG3C,GAAe,OAFfE,EAAUlC,EAAKsB,IAAWU,KAEa,MAAhBE,MAItB,OAAOA,EACP7D,IAQF,MAA4B,mBAAd2B,EAAM9J,KAAqB6L,EAAc/B,GAAS,IAChE,CAsCD,SAASmC,EAAwBnC,GAAjC,IAGWpQ,EACJwS,EAHN,GAA+B,OAA1BpC,EAAQA,EAAHxE,KAAiD,MAApBwE,EAAKhE,IAAqB,CAEhE,IADAgE,MAAaA,MAAiBqC,KAAO,KAC5BzS,EAAI,EAAGA,EAAIoQ,MAAgBvG,OAAQ7J,IAE3C,GAAa,OADTwS,EAAQpC,MAAgBpQ,KACO,MAAdwS,EAAK/D,IAAe,CACxC2B,MAAaA,EAAKhE,IAAYqG,KAAOD,EAAxB/D,IACb,KACA,CAGF,OAAO8D,EAAwBnC,EAC/B,CACD,CAuBM,SAASsC,EAAcrS,KAE1BA,QACAA,EAACuR,SACFe,EAActO,KAAKhE,KAClBuS,SACFC,IAAiBvH,EAAQwH,sBAEzBD,EAAevH,EAAQwH,oBACN7D,YAAY2D,EAE9B,CAGD,SAASA,IAER,IADA,IAAIG,EACIH,EAAOI,IAAkBL,EAAc9I,QAC9CkJ,EAAQJ,EAAcM,MAAK,SAACC,EAAGC,GAAJ,OAAUD,UAAkBC,EAA5B5C,OAAA,IAC3BoC,EAAgB,GAGhBI,EAAMvD,MAAK,YAzFb,IAAyBrB,EAMnBkC,EACE+C,EANHhD,EACHiD,EACAC,EAuFKjT,EAAJuR,MAxFDyB,GADGjD,GADoBjC,EA0FQ9N,GAzFhCkQ,UAEC+C,EAAYnF,EAFboF,OAKKlD,EAAc,IACZ+C,EAAWvC,EAAO,CAAC,EAAGT,IAC5BG,IAAqBH,EAAKG,IAAa,EAEvCiD,EACCF,EACAlD,EACAgD,EACAjF,eACAmF,EAAUG,gBACU,MAApBrD,EAAK7E,IAAsB,CAAC8H,GAAU,KACtChD,EACU,MAAVgD,EAAiBlB,EAAc/B,GAASiD,EACxCjD,EATD7E,KAWAmI,EAAWrD,EAAaD,GAEpBA,EAAK3B,KAAS4E,GACjBd,EAAwBnC,IAmExB,GAEF,UC7LeuD,EACfL,EACAM,EACAC,EACAC,EACAC,EACAC,EACAC,EACA5D,EACAgD,EACAa,OAEIlU,EAAGmU,EAAGf,EAAUgB,EAAYC,EAAQC,EAAeC,EAInDC,EAAeV,GAAkBA,EAAJpC,KAAiC+C,EAE9DC,EAAoBF,EAAY3K,OAGpC,IADAgK,MAA2B,GACtB7T,EAAI,EAAGA,EAAI4T,EAAa/J,OAAQ7J,IAgDpC,GAAkB,OA5CjBoU,EAAaP,EAAcnC,IAAW1R,GADrB,OAFlBoU,EAAaR,EAAa5T,KAEqB,kBAAdoU,EACW,KAMtB,iBAAdA,GACc,iBAAdA,GAEc,iBAAdA,EAEoC5C,EAC1C,KACA4C,EACA,KACA,KACAA,GAESO,MAAMC,QAAQR,GACmB5C,EAC1CQ,EACA,CAAE5N,SAAUgQ,GACZ,KACA,KACA,MAESA,MAAoB,EAKa5C,EAC1C4C,EAAW9N,KACX8N,EAAWhH,MACXgH,EAAW7S,IACX6S,EAAWhD,IAAMgD,EAAWhD,IAAM,KAClCgD,EAED7D,KAC2C6D,GAK5C,CAaA,GATAA,KAAqBP,EACrBO,EAAUzC,IAAUkC,MAAwB,EAS9B,QAHdT,EAAWoB,EAAYxU,KAIrBoT,GACAgB,EAAW7S,KAAO6R,EAAS7R,KAC3B6S,EAAW9N,OAAS8M,EAAS9M,KAE9BkO,EAAYxU,eAIZ,IAAKmU,EAAI,EAAGA,EAAIO,EAAmBP,IAAK,CAIvC,IAHAf,EAAWoB,EAAYL,KAKtBC,EAAW7S,KAAO6R,EAAS7R,KAC3B6S,EAAW9N,OAAS8M,EAAS9M,KAC5B,CACDkO,EAAYL,UACZ,KACA,CACDf,EAAW,IACX,CAMFI,EACCF,EACAc,EALDhB,EAAWA,GAAYyB,EAOtBd,EACAC,EACAC,EACA5D,EACAgD,EACAa,GAGDG,EAASD,EAAT3F,KAEK0F,EAAIC,EAAWhD,MAAQgC,EAAShC,KAAO+C,IACtCI,IAAMA,EAAO,IACdnB,EAAShC,KAAKmD,EAAKlQ,KAAK+O,EAAShC,IAAK,KAAMgD,GAChDG,EAAKlQ,KAAK8P,EAAGC,OAAyBC,EAAQD,IAGjC,MAAVC,GACkB,MAAjBC,IACHA,EAAgBD,GAIU,mBAAnBD,EAAW9N,MAClB8N,QAAyBhB,EAAzB1B,IAEA0C,EAAUxC,IAAYyB,EAASyB,EAC9BV,EACAf,EACAC,GAGDD,EAAS0B,EACRzB,EACAc,EACAhB,EACAoB,EACAH,EACAhB,GAIgC,mBAAvBQ,EAAevN,OAQzBuN,MAA0BR,IAG3BA,GACAD,EAAQ3E,KAAS4E,GACjBA,EAAOpC,YAAcqC,IAIrBD,EAASlB,EAAciB,GAtGvB,CA6GF,IAHAS,MAAsBS,EAGjBtU,EAAI0U,EAAmB1U,KACL,MAAlBwU,EAAYxU,IACfmQ,EAAQqE,EAAYxU,GAAIwU,EAAYxU,IAKtC,GAAIuU,EACH,IAAKvU,EAAI,EAAGA,EAAIuU,EAAK1K,OAAQ7J,IAC5BgV,EAAST,EAAKvU,GAAIuU,IAAOvU,GAAIuU,IAAOvU,GAGtC,CAED,SAAS8U,EAAgBV,EAAYf,EAAQC,GAI5C,IAJD,IAKMlD,EAHD/P,EAAI+T,EAAH1C,IACDuD,EAAM,EACH5U,GAAK4U,EAAM5U,EAAEwJ,OAAQoL,KACvB7E,EAAQ/P,EAAE4U,MAMb7E,KAAgBgE,EAGff,EADwB,mBAAdjD,EAAM9J,KACPwO,EAAgB1E,EAAOiD,EAAQC,GAE/ByB,EAAWzB,EAAWlD,EAAOA,EAAO/P,EAAG+P,EAAYiD,QAK/D,OAAOA,CACP,CAQe6B,WAAa9Q,EAAU+Q,GAUtC,OATAA,EAAMA,GAAO,GACG,MAAZ/Q,GAAuC,kBAAZA,IACpBuQ,MAAMC,QAAQxQ,GACxBA,EAASoL,MAAK,YACb0F,EAAa1C,EAAO2C,EACpB,IAEDA,EAAI9Q,KAAKD,IAEH+Q,CACP,CAED,SAASJ,EACRzB,EACAc,EACAhB,EACAoB,EACAH,EACAhB,GAND,IAQK+B,EAuBGC,EAAiBlB,EAtBxB,QAAI,IAAAC,EAAUxC,IAIbwD,EAAUhB,EAAHxC,IAMPwC,kBAEAhB,GAAY,MAAZA,GACAiB,GAAUhB,GACW,MAArBgB,EAAOpD,WAEPqE,EAAO,GAAc,MAAVjC,GAAkBA,EAAOpC,aAAeqC,EAClDA,EAAUiC,YAAYlB,GACtBe,EAAU,SACJ,CAEN,IACKC,EAAShC,EAAQc,EAAI,GACxBkB,EAASA,EAAO5R,cAAgB0Q,EAAIK,EAAY3K,OACjDsK,GAAK,EAEL,GAAIkB,GAAUhB,EACb,MAAMiB,EAGRhC,EAAUkC,aAAanB,EAAQhB,GAC/B+B,EAAU/B,CACV,CAYF,YAAO,IANH+B,EACMA,EAEAf,EAAO5Q,WAIjB,CCzRD,SAASgS,EAAShF,EAAOlP,EAAKN,GACd,MAAXM,EAAI,GACPkP,EAAMiF,YAAYnU,EAAKN,GAEvBwP,EAAMlP,GADa,MAATN,EACG,GACa,iBAATA,GAAqB0U,EAAmBC,KAAKrU,GACjDN,EAEAA,EAAQ,IAEtB,UAUeyU,EAAYG,EAAKtV,EAAMU,EAAO6U,EAAU9B,OACnD+B,EAEJtV,EAAG,GAAa,UAATF,EACN,GAAoB,iBAATU,EACV4U,EAAIpF,MAAMuF,QAAU/U,MACd,CAKN,GAJuB,iBAAZ6U,IACVD,EAAIpF,MAAMuF,QAAUF,EAAW,IAG5BA,EACH,IAAKvV,KAAQuV,EACN7U,GAASV,KAAQU,GACtBwU,EAASI,EAAIpF,MAAOlQ,EAAM,IAK7B,GAAIU,EACH,IAAKV,KAAQU,EACP6U,GAAY7U,EAAMV,KAAUuV,EAASvV,IACzCkV,EAASI,EAAIpF,MAAOlQ,EAAMU,EAAMV,GAInC,MAGOA,GAAY,MAAZA,EAAK,IAA0B,MAAZA,EAAK,GAChCwV,EAAaxV,KAAUA,EAAOA,EAAK0V,QAAQ,WAAY,KAGxB1V,EAA3BA,EAAK2V,gBAAiBL,EAAYtV,EAAK2V,cAAcvR,MAAM,GACnDpE,EAAKoE,MAAM,GAElBkR,EAAL5V,IAAqB4V,IAAiB,CAAC,GACvCA,IAAetV,EAAOwV,GAAc9U,EAEhCA,EACE6U,GAEJD,EAAIM,iBAAiB5V,EADLwV,EAAaK,EAAoBC,EACbN,GAIrCF,EAAIS,oBAAoB/V,EADRwV,EAAaK,EAAoBC,EACVN,WAErB,4BAATxV,EAAoC,CAC9C,GAAIyT,EAIHzT,EAAOA,EAAK0V,QAAQ,cAAe,KAAKA,QAAQ,SAAU,UACpD,GACG,SAAT1V,GACS,SAATA,GACS,SAATA,GAGS,aAATA,GACS,aAATA,GACAA,KAAQsV,EAER,IACCA,EAAItV,GAAiB,MAATU,EAAgB,GAAKA,EAEjC,MAAMR,CACE+N,CAAP,MAAOA,IAUW,mBAAVvN,IAES,MAATA,QAAkBA,IAAyC,GAAtBV,EAAK8R,QAAQ,KAG5DwD,EAAIU,gBAAgBhW,GAFpBsV,EAAIW,aAAajW,EAAMU,GAIxB,CACD,CAOD,SAASoV,EAAW7H,GACnB7L,KAAKA,EAAW6L,EAAElI,MAAOA,GAAOgF,EAAQmL,MAAQnL,EAAQmL,MAAMjI,GAAKA,EACnE,CAED,SAAS4H,EAAkB5H,GAC1B7L,KAAKA,EAAW6L,EAAElI,MAAOA,GAAMgF,EAAQmL,MAAQnL,EAAQmL,MAAMjI,GAAKA,EAClE,CClIegF,WACfF,EACAoD,EACAtD,EACAW,EACAC,EACAC,EACA5D,EACAgD,EACAa,GATeV,IAWXyB,EAoBE5U,EAAGsW,EAAOC,EAAUC,EAAUC,EAAUC,EACxCC,EAKAC,EACAC,EA6FOlX,EA4BPmX,EACHnS,EASShF,EA6BN4T,EA1LLwD,EAAUV,EAASpQ,KAIpB,QAAI,IAAAoQ,EAAS7E,YAA2B,OAAO,KAGpB,MAAvBuB,QACHc,EAAcd,EAAH7H,IACX8H,EAASqD,MAAgBtD,EAAhB3E,IAETiI,MAAsB,KACtBzC,EAAoB,CAACZ,KAGjB4B,EAAM3J,QAAgB2J,EAAIyB,GAE/B,IACCpB,EAAO,GAAsB,mBAAX8B,EAAuB,CA4DxC,GA1DIJ,EAAWN,EAAStJ,MAKpB6J,GADJhC,EAAMmC,EAAQC,cACQtD,EAAckB,EAApC7I,KACI8K,EAAmBjC,EACpBgC,EACCA,EAAS7J,MAAMnM,MACfgU,EAHsBrJ,GAIvBmI,EAGCX,EAAqBhH,IAExB2K,GADA1W,EAAIqW,EAAQtK,IAAcgH,EAA1BhH,KAC4BR,GAAwBvL,EACpDiX,KAEI,cAAeF,GAAWA,EAAQxV,UAAU0H,OAE/CoN,EAAQtK,IAAc/L,EAAI,IAAI+W,EAAQJ,EAAUE,IAGhDR,MAAsBrW,EAAI,IAAI4R,EAAU+E,EAAUE,GAClD7W,EAAEwR,YAAcuF,EAChB/W,EAAEiJ,OAASiO,GAERN,GAAUA,EAAS1O,IAAIlI,GAE3BA,EAAE+M,MAAQ4J,EACL3W,EAAEoN,QAAOpN,EAAEoN,MAAQ,CAAV,GACdpN,EAAE6R,QAAUgF,EACZ7W,MAAmB0T,EACnB4C,EAAQtW,SACRA,EAACkL,IAAoB,GACrBlL,MAAoB,IAID,MAAhBA,QACHA,MAAeA,EAAEoN,OAGsB,MAApC2J,EAAQI,2BACPnX,OAAgBA,EAAEoN,QACrBpN,MAAewQ,EAAO,CAAD,EAAKxQ,EAALqN,MAGtBmD,EACCxQ,EADKqN,IAEL0J,EAAQI,yBAAyBR,EAAU3W,EAA3CqN,OAIFkJ,EAAWvW,EAAE+M,MACbyJ,EAAWxW,EAAEoN,MAGTkJ,EAEkC,MAApCS,EAAQI,0BACgB,MAAxBnX,EAAEoX,oBAEFpX,EAAEoX,qBAGwB,MAAvBpX,EAAEqX,mBACLrX,EAACkL,IAAkBlH,KAAKhE,EAAEqX,uBAErB,CASN,GAPqC,MAApCN,EAAQI,0BACRR,IAAaJ,GACkB,MAA/BvW,EAAEsX,2BAEFtX,EAAEsX,0BAA0BX,EAAUE,IAIpC7W,EACDA,KAA2B,MAA3BA,EAAEwM,4BACFxM,EAAEwM,sBACDmK,EACA3W,EACA6W,QAEFR,QAAuBtD,EAAvB7C,IACC,CAYD,IAXAlQ,EAAE+M,MAAQ4J,EACV3W,EAAEoN,MAAQpN,EAEVqN,IAAIgJ,EAAQnG,MAAe6C,EAA3B7C,MAA+ClQ,EAACuR,QAChDvR,MAAWqW,EACXA,EAAQjI,IAAQ2E,EAAhB3E,IACAiI,EAAQhF,IAAa0B,EACrBsD,UAAmBxJ,SAAQ,YACtBkD,IAAOA,KAAgBsG,EAC3B,IAEQ1W,EAAI,EAAGA,EAAIK,MAAkBwJ,OAAQ7J,IAC7CK,EAACkL,IAAkBlH,KAAKhE,MAAkBL,IAE3CK,EAACuX,IAAmB,GAEhBvX,EAACkL,IAAkB1B,QACtBwG,EAAYhM,KAAKhE,GAGlB,MAAMiV,CACN,CAE4B,MAAzBjV,EAAEwX,qBACLxX,EAAEwX,oBAAoBb,EAAU3W,MAAc6W,GAGnB,MAAxB7W,EAAEyX,oBACLzX,MAAmBgE,MAAK,WACvBhE,EAAEyX,mBAAmBlB,EAAUC,EAAUC,EACzC,GAEF,CASD,GAPAzW,EAAE6R,QAAUgF,EACZ7W,EAAE+M,MAAQ4J,EACV3W,MAAWqW,EACXrW,EAACkT,IAAcD,EAEX6D,EAAa7L,EAAjB0H,IACChO,EAAQ,EACL,cAAeoS,GAAWA,EAAQxV,UAAU0H,OAAQ,CAQvD,IAPAjJ,EAAEoN,MAAQpN,EACVA,aAEI8W,GAAYA,EAAWT,GAE3BzB,EAAM5U,EAAEiJ,OAAOjJ,EAAE+M,MAAO/M,EAAEoN,MAAOpN,EAAE6R,SAE1BlS,EAAI,EAAGA,EAAIK,MAAkBwJ,OAAQ7J,IAC7CK,EAACkL,IAAkBlH,KAAKhE,MAAkBL,IAE3CK,EAACuX,IAAmB,EACpB,MACA,GACCvX,SACI8W,GAAYA,EAAWT,GAE3BzB,EAAM5U,EAAEiJ,OAAOjJ,EAAE+M,MAAO/M,EAAEoN,MAAOpN,EAAE6R,SAGnC7R,EAAEoN,MAAQpN,EACVqN,UAAQrN,SAAc2E,EAAQ,IAIhC3E,EAAEoN,MAAQpN,EAAVqN,IAEyB,MAArBrN,EAAE0X,kBACLhE,EAAgBlD,EAAOA,EAAO,CAAD,EAAKkD,GAAgB1T,EAAE0X,oBAGhDpB,GAAsC,MAA7BtW,EAAE2X,0BACflB,EAAWzW,EAAE2X,wBAAwBpB,EAAUC,IAK5CjD,EADI,MAAPqB,GAAeA,EAAI3O,OAAS0L,GAAuB,MAAXiD,EAAI1T,IACL0T,EAAI7H,MAAMhJ,SAAW6Q,EAE7DtB,EACCL,EACAqB,MAAMC,QAAQhB,GAAgBA,EAAe,CAACA,GAC9C8C,EACAtD,EACAW,EACAC,EACAC,EACA5D,EACAgD,EACAa,GAGD7T,EAAEoS,KAAOiE,EAGTA,UAAsB,KAElBrW,MAAmBwJ,QACtBwG,EAAYhM,KAAKhE,GAGd0W,IACH1W,EAACiX,IAAiBjX,KAAyB,MAG5CA,EAACoO,MACD,MACqB,MAArBwF,GACAyC,QAAuBtD,EAFjB7C,KAINmG,MAAqBtD,EAArB1B,IACAgF,EAAQjI,IAAQ2E,EAChB3E,KACAiI,EAAQjI,IAAQwJ,EACf7E,EACAsD,MACAtD,EACAW,EACAC,EACAC,EACA5D,EACA6D,IAIGe,EAAM3J,EAAQ0E,SAASiF,EAAIyB,EAYhC,CAXC,MAAOlI,GACRkI,MAAqB,MAEjBxC,GAAoC,MAArBD,KAClByC,MAAgBrD,EAChBqD,EAAQnL,MAAgB2I,EACxBD,EAAkBA,EAAkB5B,QAAQgB,IAAW,MAIxD/H,MAAoBkD,EAAGkI,EAAUtD,EACjC,CACD,CAOM,SAASM,EAAWrD,EAAanG,GACnCoB,EAAiBA,WAAgBpB,EAAMmG,GAE3CA,EAAYb,MAAK,YAChB,IAECa,EAAchQ,EAAdkL,IACAlL,EAACkL,IAAoB,GACrB8E,EAAYb,MAAK,YAEhBc,EAAGnQ,KAAKE,EACR,GAGD,CAFC,MAAOmO,GACRlD,MAAoBkD,EAAGnO,EAAvBkQ,IACA,CACD,GACD,CAgBD,SAAS0H,EACRpC,EACAa,EACAtD,EACAW,EACAC,EACAC,EACA5D,EACA6D,GARD,IAoBS1B,EAsDH0F,EACAC,EAjEDvB,EAAWxD,EAAShG,MACpB4J,EAAWN,EAAStJ,MACpBgL,EAAW1B,EAASpQ,KACpBtG,EAAI,EAKR,GAFiB,QAAboY,IAAoBpE,MAEC,MAArBC,EACH,KAAOjU,EAAIiU,EAAkBpK,OAAQ7J,IAMpC,IALMwS,EAAQyB,EAAkBjU,KAO/B,iBAAkBwS,KAAY4F,IAC7BA,EAAW5F,EAAM6F,YAAcD,EAA8B,IAAnB5F,EAAM4F,UAChD,CACDvC,EAAMrD,EACNyB,EAAkBjU,GAAK,KACvB,KACA,CAIH,GAAW,MAAP6V,EAAa,CAChB,GAAiB,OAAbuC,EAEH,OAAOjO,SAASmO,eAAetB,GAI/BnB,EADG7B,EACG7J,SAASoO,gBACd,6BAEAH,GAGKjO,SAASgH,cAEdiH,EACApB,EAASwB,IAAMxB,GAKjB/C,EAAoB,KAEpBC,IACA,CAED,GAAiB,OAAbkE,EAECxB,IAAaI,GAAc9C,GAAe2B,EAAIvS,OAAS0T,IAC1DnB,EAAIvS,KAAO0T,OAEN,CAWN,GATA/C,EAAoBA,GAAqBtP,EAAMxE,KAAK0V,EAAI4C,YAIpDP,GAFJtB,EAAWxD,EAAShG,OAASyH,GAEN6D,wBACnBP,EAAUnB,EAAS0B,yBAIlBxE,EAAa,CAGjB,GAAyB,MAArBD,EAEH,IADA2C,EAAW,CAAC,EACP5W,EAAI,EAAGA,EAAI6V,EAAI8C,WAAW9O,OAAQ7J,IACtC4W,EAASf,EAAI8C,WAAW3Y,GAAGO,MAAQsV,EAAI8C,WAAW3Y,GAAGiB,OAInDkX,GAAWD,KAGZC,IACED,GAAWC,EAAOS,QAAWV,EAAlBU,QACbT,WAAmBtC,EAAI9K,aAExB8K,EAAI9K,UAAaoN,GAAWA,EAAZS,QAA+B,IAGjD,CAKD,GD9ZcC,SAAUhD,EAAKmB,EAAUJ,EAAU5C,EAAOzK,GACzD,IAAIvJ,EAEJ,IAAKA,KAAK4W,EACC,aAAN5W,GAA0B,QAANA,GAAiBA,KAAKgX,GAC7CtB,EAAYG,EAAK7V,EAAG,KAAM4W,EAAS5W,GAAIgU,GAIzC,IAAKhU,KAAKgX,EAENzN,GAAiC,mBAAfyN,EAAShX,IACvB,aAANA,GACM,QAANA,GACM,UAANA,GACM,YAANA,GACA4W,EAAS5W,KAAOgX,EAAShX,IAEzB0V,EAAYG,EAAK7V,EAAGgX,EAAShX,GAAI4W,EAAS5W,GAAIgU,EAGhD,CCsYC6E,CAAUhD,EAAKmB,EAAUJ,EAAU5C,EAAOE,GAGtCiE,EACHzB,EAAQhF,IAAa,QAmBrB,GAjBA1R,EAAI0W,EAAStJ,MAAMhJ,SACnBuP,EACCkC,EACAlB,MAAMC,QAAQ5U,GAAKA,EAAI,CAACA,GACxB0W,EACAtD,EACAW,EACAC,GAAsB,kBAAboE,EACTnE,EACA5D,EACA4D,EACGA,EAAkB,GAClBb,OAAsBjB,EAAciB,EAAU,GACjDc,GAIwB,MAArBD,EACH,IAAKjU,EAAIiU,EAAkBpK,OAAQ7J,KACN,MAAxBiU,EAAkBjU,IAAY+Q,EAAWkD,EAAkBjU,IAM7DkU,IAEH,UAAW8C,aACVhX,EAAIgX,EAAS/V,SAKbjB,IAAM6V,EAAI5U,OACI,aAAbmX,IAA4BpY,GAIf,WAAboY,GAAyBpY,IAAM4W,EAAS3V,QAE1CyU,EAAYG,EAAK,QAAS7V,EAAG4W,EAAS3V,OAAOA,GAG7C,YAAa+V,aACZhX,EAAIgX,EAAS8B,UACd9Y,IAAM6V,EAAIiD,SAEVpD,EAAYG,EAAK,UAAW7V,EAAG4W,EAASkC,SAASA,GAGnD,CAED,OAAOjD,CACP,CAQeb,WAAS5D,EAAKnQ,EAAOmP,GACpC,IACmB,mBAAPgB,EAAmBA,EAAInQ,GAC7BmQ,EAAIrD,QAAU9M,CAGnB,CAFC,MAAOuN,GACRlD,MAAoBkD,EAAG4B,EACvB,CACD,CAUM,SAASD,EAAQC,EAAO2I,EAAaC,GAArC,IACFlY,EAuBMd,EAdV,GARIsL,EAAQ6E,SAAS7E,EAAQ6E,QAAQC,IAEhCtP,EAAIsP,EAAMgB,OACTtQ,EAAEiN,SAAWjN,EAAEiN,UAAYqC,EAAd3B,KACjBuG,EAASlU,EAAG,KAAMiY,IAIU,OAAzBjY,EAAIsP,EAAHhE,KAA8B,CACnC,GAAItL,EAAEmY,qBACL,IACCnY,EAAEmY,sBAGF,CAFC,MAAOzK,GACRlD,EAAOmD,IAAaD,EAAGuK,EACvB,CAGFjY,EAAE2R,KAAO3R,MAAe,KACxBsP,EAAKhE,UACL,CAED,GAAKtL,EAAIsP,EAAHsB,IACL,IAAS1R,EAAI,EAAGA,EAAIc,EAAE+I,OAAQ7J,IACzBc,EAAEd,IACLmQ,EACCrP,EAAEd,GACF+Y,EACAC,GAAoC,mBAAf5I,EAAM9J,MAM1B0S,GAA4B,MAAd5I,EAAK3B,KACvBsC,EAAWX,EAAD3B,KAKX2B,KAAgBA,EAAK3B,IAAQ2B,YAC7B,CAGD,SAASmH,EAASnK,EAAOK,EAAOyE,GAC/B,OAAYL,iBAAYzE,EAAO8E,EAC/B,CC5hBM,SAAS5I,EAAO8G,EAAOkD,EAAW4F,GAAlC,IAMFhF,EAOAd,EAUA/C,EAtBA/E,EAAeA,SAAc8E,EAAOkD,GAYpCF,GAPAc,EAAqC,mBAAhBgF,GAQtB,KACCA,GAAeA,OAA0B5F,MAQzCjD,EAAc,GAClBmD,EACCF,EARDlD,IACG8D,GAAegF,GACjB5F,GAFO5B,IAGMP,EAAca,EAAU,KAAM,CAAC5B,IAS5CgD,GAAYyB,EACZA,WACAvB,EAAUG,iBACTS,GAAegF,EACb,CAACA,GACD9F,EACA,KACAE,EAAU6F,WACVxU,EAAMxE,KAAKmT,EAAUmF,YACrB,KACHpI,GACC6D,GAAegF,EACbA,EACA9F,EACAA,EACAE,MAAU6F,WACbjF,GAIDR,EAAWrD,EAAaD,EACxB,CAQe7G,WAAQ6G,EAAOkD,GAC9BhK,EAAO8G,EAAOkD,EAAW/J,EACzB,UChEe6P,EAAahJ,EAAOhD,EAAOhJ,GAC1C,IACC7C,EACA6P,EACApR,EAHGqR,EAAkBR,EAAO,CAAC,EAAGT,EAAMhD,OAIvC,IAAKpN,KAAKoN,EACA,OAALpN,EAAYuB,EAAM6L,EAAMpN,GACd,OAALA,EAAYoR,EAAMhE,EAAMpN,GAC5BqR,EAAgBrR,GAAKoN,EAAMpN,GAQjC,OALIsR,UAAUzH,OAAS,IACtBwH,EAAgBjN,SACfkN,UAAUzH,OAAS,EAAIlF,EAAMxE,KAAKmR,UAAW,GAAKlN,GAG7CoN,EACNpB,EAAM9J,KACN+K,EACA9P,GAAO6O,EAAM7O,IACb6P,GAAOhB,EAAMgB,IACb,KAED,CC7BM,SAASiI,EAAcC,EAAcC,GAG3C,IAAMrH,EAAU,CACf9F,IAHDmN,EAAY,OAASvZ,IAIpB4L,GAAe0N,EAEfE,SAJe,SAINpM,EAAOqM,GAIf,OAAOrM,EAAMhJ,SAASqV,EACtB,EAEDC,kBAAStM,OAEHuM,EACAC,EAmCL,OArCKjX,KAAKoV,kBACL4B,EAAO,IACPC,EAAM,CAAV,GACIL,GAAa5W,KAEjBA,KAAKoV,gBAAkB,kBAAM6B,CAAN,EAEvBjX,KAAKkK,sBAAwB,SAASgN,GACjClX,KAAKyK,MAAMnM,QAAU4Y,EAAO5Y,OAe/B0Y,EAAKnK,KAAKkD,EAEX,EAED/P,KAAK4F,IAAM,YACVoR,EAAKtV,KAAKhE,GACV,IAAIyZ,EAAMzZ,EAAE4Y,qBACZ5Y,EAAE4Y,qBAAuB,WACxBU,EAAKI,OAAOJ,EAAKtH,QAAQhS,GAAI,GACzByZ,GAAKA,EAAI3Z,KAAKE,EAClB,CACD,GAGK+M,EAAMhJ,QACb,GASF,OAAQ8N,EAAQwH,SAAuBxH,KAAQsH,SAASnC,YAAcnF,CACtE,C,sgBRzCYvN,ESfP2G,ERRFwG,EA6FSkI,EC4ETrH,EAWAE,EMrLO7S,EEFE6U,EAAY,CAAlB,EACMJ,EAAY,GACZkB,EAAqB,oEVwBrBhR,EAAQ8P,EAAU9P,MSfzB2G,EAAU,CACfmD,IEHM,SAAqBwL,EAAO7J,EAAOgD,EAAU8G,GAInD,IAFA,IAAI/L,EAAWgM,EAAMC,EAEbhK,EAAQA,EAAhBxE,IACC,IAAKuC,EAAYiC,EAAHhE,OAAyB+B,EAADvC,GACrC,IAcC,IAbAuO,EAAOhM,EAAU0D,cAE4B,MAAjCsI,EAAKE,2BAChBlM,EAAUzB,SAASyN,EAAKE,yBAAyBJ,IACjDG,EAAUjM,EAAHyD,KAG2B,MAA/BzD,EAAUmM,oBACbnM,EAAUmM,kBAAkBL,EAAOC,GAAa,CAAhD,GACAE,EAAUjM,EACVyD,KAGGwI,EACH,OAAQjM,EAASmJ,IAAiBnJ,CAInC,CAFC,MAAOK,GACRyL,EAAQzL,CACR,CAIH,MAAMyL,CACN,GVpCGnI,EAAU,EA6FDkI,EAAiB,YAAA5J,OACpB,MAATA,YAAiBA,EAAMyB,WADW,ECtEnCI,EAAUrQ,UAAU8K,SAAW,SAAS6N,EAAQhN,GAE/C,IAAIxL,EAEHA,EADsB,MAAnBY,KAAKA,KAAsBA,KAAKA,MAAeA,KAAK8K,MACnD9K,KACJ+K,IACI/K,KAAKA,IAAakO,EAAO,CAAD,EAAKlO,KAAK8K,OAGlB,mBAAV8M,IAGVA,EAASA,EAAO1J,EAAO,CAAC,EAAG9O,GAAIY,KAAKyK,QAGjCmN,GACH1J,EAAO9O,EAAGwY,GAIG,MAAVA,GAEA5X,KAAa4N,MACZhD,GACH5K,KAAKA,IAAgB0B,KAAKkJ,GAE3BmF,EAAc/P,MAEf,EAQDsP,EAAUrQ,UAAU4Y,YAAc,SAASjN,GACtC5K,KAAKA,MAIRA,KAAKA,KAALA,EACI4K,GAAU5K,KAAsB0B,SAAKkJ,GACzCmF,EAAc/P,MAEf,EAYDsP,EAAUrQ,UAAU0H,OAAS0I,EAyFzBW,EAAgB,GA4CpBC,EAAOI,IAAkB,EMtNdhT,EAAI,C,6jCIEf,MAgFMya,EAID,EAAGC,YAAWC,aAAYC,cAE3B,sBACEzY,MAAM,4EACNsO,MAAO,CAAEoK,YAAaH,GACtBI,QAAS,KACFH,GACHC,GAAU,GAGd,oBACEzY,MAAM,0CACNsO,MAAO,CAAEsK,gBAAiBJ,EAAaD,EAAY,OAM5CM,IAlGV,EACHjT,gBACAC,mBACAC,cAGE,mBAAK9F,MAAM,aAET,uBACE,uBAAK,cACL,mBACEA,MAAM,2BAGL8F,EAASgT,QAAQC,KAAKC,GACrB,mBAAK5Z,IAAK4Z,EAAKhZ,MAAM,OACnB,YAACsY,EAAU,CACTC,UAAWzS,EAASmT,eAAeD,GACnCR,WAAY5S,EAAcsT,eAAiBF,EAC3CP,SAAU,IAAM5S,EAAiB,EAAD,KAAMD,GAAa,IAAEsT,aAAcF,YAO7E,mBAAKhZ,MAAM,aACT,uBACE,uBAAK,yBACL,sBACElB,MAAO8G,EAAcuT,iBACrB/Y,SAAWC,IACT,MAAMvB,EAAQuB,EAAGC,cAAcxB,MAC/B+G,EAAiB,EAAD,KAAMD,GAAa,IAAEuT,iBAAkBra,IAAQ,GAGjE,sBAAQA,MAAM,WAAU,WACxB,sBAAQA,MAAM,UAAS,YAI3B,uBACE,uBAAK,yBACL,sBACEA,MAAO8G,EAAcwT,iBACrBhZ,SAAWC,IACT,MAAMvB,EAAQuB,EAAGC,cAAcxB,MAC/B+G,EAAiB,EAAD,KAAMD,GAAa,IAAEwT,iBAAkBta,IAAQ,GAGjE,sBAAQA,MAAM,WAAU,WACxB,sBAAQA,MAAM,UAAS,aAK7B,uBACE,qBAAOkB,MAAM,qBACX,qBACEmE,KAAK,WACLwS,QAAS/Q,EAAcyT,sBACvBjZ,SAAWC,IACTwF,EAAiB,EAAD,KACXD,GAAa,IAChByT,sBAAuBhZ,EAAGC,cAAcqW,UACxC,IAGN,oBAAM3W,MAAM,QAAO,qB,0/EC9DtB,SAASsZ,EAAmBnV,GACjCoV,GAAapV,CACf,CAQO,SAASqV,EAASzI,GACvB,OAAOA,EAAI0I,EACb,CAWO,SAASC,EAAO3I,EAAGC,GACxB,OAAOzL,KAAKoU,IAAI5I,EAAIC,IAAM4I,GAAUrU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI5I,GAAIxL,KAAKoU,IAAI3I,GAC1E,CC3BO,SAAS7R,IACd,IAAI6T,EAAM,IAAI6G,GAAoB,IAqBlC,OAnBIA,IAAuBC,eACzB9G,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,GAGZA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAQO,SAAS+G,EAAMhJ,GACpB,IAAIiC,EAAM,IAAI6G,GAAoB,IAiBlC,OAhBA7G,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACLiC,CACT,CASO,SAASgH,EAAKhH,EAAKjC,GAiBxB,OAhBAiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACLiC,CACT,CAuBO,SAASiH,EAAWC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,GACpG,IAAIjI,EAAM,IAAI6G,GAAoB,IAiBlC,OAhBA7G,EAAI,GAAKkH,EACTlH,EAAI,GAAKmH,EACTnH,EAAI,GAAKoH,EACTpH,EAAI,GAAKqH,EACTrH,EAAI,GAAKsH,EACTtH,EAAI,GAAKuH,EACTvH,EAAI,GAAKwH,EACTxH,EAAI,GAAKyH,EACTzH,EAAI,GAAK0H,EACT1H,EAAI,GAAK2H,EACT3H,EAAI,IAAM4H,EACV5H,EAAI,IAAM6H,EACV7H,EAAI,IAAM8H,EACV9H,EAAI,IAAM+H,EACV/H,EAAI,IAAMgI,EACVhI,EAAI,IAAMiI,EACHjI,CACT,CAwBO,SAASkI,EAAIlI,EAAKkH,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,GAiBlG,OAhBAjI,EAAI,GAAKkH,EACTlH,EAAI,GAAKmH,EACTnH,EAAI,GAAKoH,EACTpH,EAAI,GAAKqH,EACTrH,EAAI,GAAKsH,EACTtH,EAAI,GAAKuH,EACTvH,EAAI,GAAKwH,EACTxH,EAAI,GAAKyH,EACTzH,EAAI,GAAK0H,EACT1H,EAAI,GAAK2H,EACT3H,EAAI,IAAM4H,EACV5H,EAAI,IAAM6H,EACV7H,EAAI,IAAM8H,EACV9H,EAAI,IAAM+H,EACV/H,EAAI,IAAMgI,EACVhI,EAAI,IAAMiI,EACHjI,CACT,CAQO,SAASmI,EAASnI,GAiBvB,OAhBAA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CASO,SAASoI,EAAUpI,EAAKjC,GAE7B,GAAIiC,IAAQjC,EAAG,CACb,IAAIsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACR2K,EAAM3K,EAAE,IACZiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,IACXiC,EAAI,GAAKqI,EACTrI,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,IACXiC,EAAI,GAAKsI,EACTtI,EAAI,GAAKwI,EACTxI,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMuI,EACVvI,EAAI,IAAMyI,EACVzI,EAAI,IAAM0I,CACZ,MACE1I,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,IACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,IACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,GACZiC,EAAI,IAAMjC,EAAE,GACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IAGd,OAAOiC,CACT,CASO,SAAS2I,EAAO3I,EAAKjC,GAC1B,IAAI6K,EAAM7K,EAAE,GACRsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACR8K,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IACRmL,EAAMnL,EAAE,IACRoL,EAAMpL,EAAE,IACRqL,EAAMrL,EAAE,IACRsL,EAAMtL,EAAE,IACRuL,EAAMV,EAAME,EAAMT,EAAMQ,EACxBU,EAAMX,EAAMJ,EAAMF,EAAMO,EACxBW,EAAMZ,EAAMH,EAAMF,EAAMM,EACxBY,EAAMpB,EAAMG,EAAMF,EAAMQ,EACxBY,EAAMrB,EAAMI,EAAMF,EAAMO,EACxBa,EAAMrB,EAAMG,EAAMF,EAAMC,EACxBoB,EAAMb,EAAMI,EAAMH,EAAME,EACxBW,EAAMd,EAAMK,EAAMH,EAAMC,EACxBY,EAAMf,EAAMM,EAAMX,EAAMQ,EACxBa,EAAMf,EAAMI,EAAMH,EAAME,EACxBa,EAAMhB,EAAMK,EAAMX,EAAMS,EACxBc,EAAMhB,EAAMI,EAAMX,EAAMU,EAExBc,EAAMZ,EAAMW,EAAMV,EAAMS,EAAMR,EAAMO,EAAMN,EAAMK,EAAMJ,EAAMG,EAAMF,EAAMC,EAE5E,OAAKM,GAKLlK,EAAI,IAAM8I,EAAMmB,EAAMzB,EAAMwB,EAAMvB,EAAMsB,IADxCG,EAAM,EAAMA,GAEZlK,EAAI,IAAMsI,EAAM0B,EAAM3B,EAAM4B,EAAM1B,EAAMwB,GAAOG,EAC/ClK,EAAI,IAAMmJ,EAAMQ,EAAMP,EAAMM,EAAML,EAAMI,GAAOS,EAC/ClK,EAAI,IAAMiJ,EAAMS,EAAMV,EAAMW,EAAMjB,EAAMe,GAAOS,EAC/ClK,EAAI,IAAMwI,EAAMsB,EAAMjB,EAAMoB,EAAMxB,EAAMoB,GAAOK,EAC/ClK,EAAI,IAAM4I,EAAMqB,EAAM3B,EAAMwB,EAAMvB,EAAMsB,GAAOK,EAC/ClK,EAAI,IAAMoJ,EAAMI,EAAMN,EAAMS,EAAMN,EAAME,GAAOW,EAC/ClK,EAAI,IAAM+I,EAAMY,EAAMV,EAAMO,EAAMd,EAAMa,GAAOW,EAC/ClK,EAAI,IAAM6I,EAAMmB,EAAMlB,EAAMgB,EAAMrB,EAAMmB,GAAOM,EAC/ClK,EAAI,IAAMqI,EAAMyB,EAAMlB,EAAMoB,EAAMzB,EAAMqB,GAAOM,EAC/ClK,EAAI,KAAOkJ,EAAMQ,EAAMP,EAAMK,EAAMH,EAAMC,GAAOY,EAChDlK,EAAI,KAAOgJ,EAAMQ,EAAMT,EAAMW,EAAMhB,EAAMY,GAAOY,EAChDlK,EAAI,KAAO8I,EAAMe,EAAMhB,EAAMkB,EAAMvB,EAAMoB,GAAOM,EAChDlK,EAAI,KAAO4I,EAAMmB,EAAM1B,EAAMwB,EAAMvB,EAAMsB,GAAOM,EAChDlK,EAAI,KAAOmJ,EAAMI,EAAML,EAAMO,EAAML,EAAME,GAAOY,EAChDlK,EAAI,KAAO+I,EAAMU,EAAMT,EAAMO,EAAMN,EAAMK,GAAOY,EACzClK,GApBE,IAqBX,CASO,SAASmK,EAAQnK,EAAKjC,GAC3B,IAAI6K,EAAM7K,EAAE,GACRsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACR8K,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IACRmL,EAAMnL,EAAE,IACRoL,EAAMpL,EAAE,IACRqL,EAAMrL,EAAE,IACRsL,EAAMtL,EAAE,IAiBZ,OAhBAiC,EAAI,GAAK8I,GAAOG,EAAMI,EAAMX,EAAMU,GAAOJ,GAAOR,EAAMa,EAAMZ,EAAMW,GAAOD,GAAOX,EAAME,EAAMD,EAAMQ,GAClGjJ,EAAI,KAAOqI,GAAOY,EAAMI,EAAMX,EAAMU,GAAOJ,GAAOV,EAAMe,EAAMd,EAAMa,GAAOD,GAAOb,EAAMI,EAAMH,EAAMU,IACpGjJ,EAAI,GAAKqI,GAAOG,EAAMa,EAAMZ,EAAMW,GAAON,GAAOR,EAAMe,EAAMd,EAAMa,GAAOD,GAAOb,EAAMG,EAAMF,EAAMC,GAClGxI,EAAI,KAAOqI,GAAOG,EAAME,EAAMD,EAAMQ,GAAOH,GAAOR,EAAMI,EAAMH,EAAMU,GAAOD,GAAOV,EAAMG,EAAMF,EAAMC,IACpGxI,EAAI,KAAO6I,GAAOI,EAAMI,EAAMX,EAAMU,GAAOL,GAAOP,EAAMa,EAAMZ,EAAMW,GAAOF,GAAOV,EAAME,EAAMD,EAAMQ,IACpGjJ,EAAI,GAAK4I,GAAOK,EAAMI,EAAMX,EAAMU,GAAOL,GAAOT,EAAMe,EAAMd,EAAMa,GAAOF,GAAOZ,EAAMI,EAAMH,EAAMU,GAClGjJ,EAAI,KAAO4I,GAAOJ,EAAMa,EAAMZ,EAAMW,GAAOP,GAAOP,EAAMe,EAAMd,EAAMa,GAAOF,GAAOZ,EAAMG,EAAMF,EAAMC,IACpGxI,EAAI,GAAK4I,GAAOJ,EAAME,EAAMD,EAAMQ,GAAOJ,GAAOP,EAAMI,EAAMH,EAAMU,GAAOF,GAAOT,EAAMG,EAAMF,EAAMC,GAClGxI,EAAI,GAAK6I,GAAOG,EAAMK,EAAMX,EAAMS,GAAOJ,GAAOD,EAAMO,EAAMZ,EAAMU,GAAOD,GAAOJ,EAAMJ,EAAMD,EAAMO,GAClGhJ,EAAI,KAAO4I,GAAOI,EAAMK,EAAMX,EAAMS,GAAOJ,GAAOV,EAAMgB,EAAMd,EAAMY,GAAOD,GAAOb,EAAMK,EAAMH,EAAMS,IACpGhJ,EAAI,IAAM4I,GAAOE,EAAMO,EAAMZ,EAAMU,GAAON,GAAOR,EAAMgB,EAAMd,EAAMY,GAAOD,GAAOb,EAAMI,EAAMF,EAAMO,GACnG9I,EAAI,MAAQ4I,GAAOE,EAAMJ,EAAMD,EAAMO,GAAOH,GAAOR,EAAMK,EAAMH,EAAMS,GAAOD,GAAOV,EAAMI,EAAMF,EAAMO,IACrG9I,EAAI,MAAQ6I,GAAOG,EAAMI,EAAMH,EAAME,GAAOJ,GAAOD,EAAMM,EAAMZ,EAAMW,GAAOD,GAAOJ,EAAMG,EAAMT,EAAMQ,IACrGhJ,EAAI,IAAM4I,GAAOI,EAAMI,EAAMH,EAAME,GAAOJ,GAAOV,EAAMe,EAAMd,EAAMa,GAAOD,GAAOb,EAAMY,EAAMX,EAAMU,GACnGhJ,EAAI,MAAQ4I,GAAOE,EAAMM,EAAMZ,EAAMW,GAAON,GAAOR,EAAMe,EAAMd,EAAMa,GAAOD,GAAOb,EAAMG,EAAMF,EAAMQ,IACrG9I,EAAI,IAAM4I,GAAOE,EAAMG,EAAMT,EAAMQ,GAAOH,GAAOR,EAAMY,EAAMX,EAAMU,GAAOD,GAAOV,EAAMG,EAAMF,EAAMQ,GAC5F9I,CACT,CAQO,SAASoK,EAAYrM,GAC1B,IAAI6K,EAAM7K,EAAE,GACRsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACR8K,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IACRmL,EAAMnL,EAAE,IACRoL,EAAMpL,EAAE,IACRqL,EAAMrL,EAAE,IACRsL,EAAMtL,EAAE,IAcZ,OAbU6K,EAAME,EAAMT,EAAMQ,IAWlBI,EAAMI,EAAMX,EAAMU,IAVlBR,EAAMJ,EAAMF,EAAMO,IASlBG,EAAMK,EAAMX,EAAMS,IARlBP,EAAMH,EAAMF,EAAMM,IAOlBG,EAAMI,EAAMH,EAAME,IANlBd,EAAMG,EAAMF,EAAMQ,IAKlBC,EAAMM,EAAMX,EAAMQ,IAJlBb,EAAMI,EAAMF,EAAMO,IAGlBC,EAAMK,EAAMH,EAAMC,IAFlBZ,EAAMG,EAAMF,EAAMC,IAClBO,EAAMI,EAAMH,EAAME,EAQ9B,CAUO,SAASmB,EAASrK,EAAKjC,EAAGC,GAC/B,IAAI4K,EAAM7K,EAAE,GACRsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACR8K,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IACRmL,EAAMnL,EAAE,IACRoL,EAAMpL,EAAE,IACRqL,EAAMrL,EAAE,IACRsL,EAAMtL,EAAE,IAERuM,EAAKtM,EAAE,GACPuM,EAAKvM,EAAE,GACPwM,EAAKxM,EAAE,GACPyM,EAAKzM,EAAE,GA6BX,OA5BAgC,EAAI,GAAKsK,EAAK1B,EAAM2B,EAAK1B,EAAM2B,EAAKzB,EAAM0B,EAAKvB,EAC/ClJ,EAAI,GAAKsK,EAAKjC,EAAMkC,EAAKzB,EAAM0B,EAAKxB,EAAMyB,EAAKtB,EAC/CnJ,EAAI,GAAKsK,EAAKhC,EAAMiC,EAAK/B,EAAMgC,EAAKvB,EAAMwB,EAAKrB,EAC/CpJ,EAAI,GAAKsK,EAAK/B,EAAMgC,EAAK9B,EAAM+B,EAAK9B,EAAM+B,EAAKpB,EAK/CrJ,EAAI,IAJJsK,EAAKtM,EAAE,IAIO4K,GAHd2B,EAAKvM,EAAE,IAGkB6K,GAFzB2B,EAAKxM,EAAE,IAE6B+K,GADpC0B,EAAKzM,EAAE,IACwCkL,EAC/ClJ,EAAI,GAAKsK,EAAKjC,EAAMkC,EAAKzB,EAAM0B,EAAKxB,EAAMyB,EAAKtB,EAC/CnJ,EAAI,GAAKsK,EAAKhC,EAAMiC,EAAK/B,EAAMgC,EAAKvB,EAAMwB,EAAKrB,EAC/CpJ,EAAI,GAAKsK,EAAK/B,EAAMgC,EAAK9B,EAAM+B,EAAK9B,EAAM+B,EAAKpB,EAK/CrJ,EAAI,IAJJsK,EAAKtM,EAAE,IAIO4K,GAHd2B,EAAKvM,EAAE,IAGkB6K,GAFzB2B,EAAKxM,EAAE,KAE6B+K,GADpC0B,EAAKzM,EAAE,KACwCkL,EAC/ClJ,EAAI,GAAKsK,EAAKjC,EAAMkC,EAAKzB,EAAM0B,EAAKxB,EAAMyB,EAAKtB,EAC/CnJ,EAAI,IAAMsK,EAAKhC,EAAMiC,EAAK/B,EAAMgC,EAAKvB,EAAMwB,EAAKrB,EAChDpJ,EAAI,IAAMsK,EAAK/B,EAAMgC,EAAK9B,EAAM+B,EAAK9B,EAAM+B,EAAKpB,EAKhDrJ,EAAI,KAJJsK,EAAKtM,EAAE,KAIQ4K,GAHf2B,EAAKvM,EAAE,KAGmB6K,GAF1B2B,EAAKxM,EAAE,KAE8B+K,GADrC0B,EAAKzM,EAAE,KACyCkL,EAChDlJ,EAAI,IAAMsK,EAAKjC,EAAMkC,EAAKzB,EAAM0B,EAAKxB,EAAMyB,EAAKtB,EAChDnJ,EAAI,IAAMsK,EAAKhC,EAAMiC,EAAK/B,EAAMgC,EAAKvB,EAAMwB,EAAKrB,EAChDpJ,EAAI,IAAMsK,EAAK/B,EAAMgC,EAAK9B,EAAM+B,EAAK9B,EAAM+B,EAAKpB,EACzCrJ,CACT,CAUO,SAAS0K,EAAU1K,EAAKjC,EAAGzN,GAChC,IAGIsY,EAAKP,EAAKC,EAAKC,EACfM,EAAKC,EAAKN,EAAKC,EACfM,EAAKC,EAAKC,EAAKP,EALf1Y,EAAIM,EAAE,GACNL,EAAIK,EAAE,GACNJ,EAAII,EAAE,GAyCV,OApCIyN,IAAMiC,GACRA,EAAI,IAAMjC,EAAE,GAAK/N,EAAI+N,EAAE,GAAK9N,EAAI8N,EAAE,GAAK7N,EAAI6N,EAAE,IAC7CiC,EAAI,IAAMjC,EAAE,GAAK/N,EAAI+N,EAAE,GAAK9N,EAAI8N,EAAE,GAAK7N,EAAI6N,EAAE,IAC7CiC,EAAI,IAAMjC,EAAE,GAAK/N,EAAI+N,EAAE,GAAK9N,EAAI8N,EAAE,IAAM7N,EAAI6N,EAAE,IAC9CiC,EAAI,IAAMjC,EAAE,GAAK/N,EAAI+N,EAAE,GAAK9N,EAAI8N,EAAE,IAAM7N,EAAI6N,EAAE,MAG9CsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACR8K,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IACRiC,EAAI,GAZJ4I,EAAM7K,EAAE,GAaRiC,EAAI,GAAKqI,EACTrI,EAAI,GAAKsI,EACTtI,EAAI,GAAKuI,EACTvI,EAAI,GAAK6I,EACT7I,EAAI,GAAK8I,EACT9I,EAAI,GAAKwI,EACTxI,EAAI,GAAKyI,EACTzI,EAAI,GAAK+I,EACT/I,EAAI,GAAKgJ,EACThJ,EAAI,IAAMiJ,EACVjJ,EAAI,IAAM0I,EACV1I,EAAI,IAAM4I,EAAM5Y,EAAI6Y,EAAM5Y,EAAI8Y,EAAM7Y,EAAI6N,EAAE,IAC1CiC,EAAI,IAAMqI,EAAMrY,EAAI8Y,EAAM7Y,EAAI+Y,EAAM9Y,EAAI6N,EAAE,IAC1CiC,EAAI,IAAMsI,EAAMtY,EAAIwY,EAAMvY,EAAIgZ,EAAM/Y,EAAI6N,EAAE,IAC1CiC,EAAI,IAAMuI,EAAMvY,EAAIyY,EAAMxY,EAAIyY,EAAMxY,EAAI6N,EAAE,KAGrCiC,CACT,CAUO,SAAS2K,EAAM3K,EAAKjC,EAAGzN,GAC5B,IAAIN,EAAIM,EAAE,GACNL,EAAIK,EAAE,GACNJ,EAAII,EAAE,GAiBV,OAhBA0P,EAAI,GAAKjC,EAAE,GAAK/N,EAChBgQ,EAAI,GAAKjC,EAAE,GAAK/N,EAChBgQ,EAAI,GAAKjC,EAAE,GAAK/N,EAChBgQ,EAAI,GAAKjC,EAAE,GAAK/N,EAChBgQ,EAAI,GAAKjC,EAAE,GAAK9N,EAChB+P,EAAI,GAAKjC,EAAE,GAAK9N,EAChB+P,EAAI,GAAKjC,EAAE,GAAK9N,EAChB+P,EAAI,GAAKjC,EAAE,GAAK9N,EAChB+P,EAAI,GAAKjC,EAAE,GAAK7N,EAChB8P,EAAI,GAAKjC,EAAE,GAAK7N,EAChB8P,EAAI,IAAMjC,EAAE,IAAM7N,EAClB8P,EAAI,IAAMjC,EAAE,IAAM7N,EAClB8P,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACLiC,CACT,CAWO,SAAS4K,EAAO5K,EAAKjC,EAAG8M,EAAKC,GAClC,IAIIle,EAAG1B,EAAGa,EACN6c,EAAKP,EAAKC,EAAKC,EACfM,EAAKC,EAAKN,EAAKC,EACfM,EAAKC,EAAKC,EAAKP,EACfY,EAAKC,EAAKC,EACVQ,EAAKC,EAAKc,EACVC,EAAKC,EAAKC,EAVVlb,EAAI8a,EAAK,GACT7a,EAAI6a,EAAK,GACT5a,EAAI4a,EAAK,GACTK,EAAM5Y,KAAK6Y,MAAMpb,EAAGC,EAAGC,GAS3B,OAAIib,EAAMtE,GACD,MAIT7W,GADAmb,EAAM,EAAIA,EAEVlb,GAAKkb,EACLjb,GAAKib,EACLve,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GAGbxC,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GAER+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GAERiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IAKRiM,EAAMha,EAAIC,GAjBVlE,EAAI,EAAIb,GAiBUgF,EAAItD,EACtBqd,EAAMha,EAAIA,EAAIlE,EAAIb,EAClB6f,EAAM7a,EAAID,EAAIlE,EAAIiE,EAAIpD,EACtBoe,EAAMhb,EAAIE,EAAInE,EAAIkE,EAAIrD,EACtBqe,EAAMhb,EAAIC,EAAInE,EAAIiE,EAAIpD,EACtBse,EAAMhb,EAAIA,EAAInE,EAAIb,EAElB8U,EAAI,IAvBJ4I,EAAM7K,EAAE,KAaRuL,EAAMtZ,EAAIA,EAAIjE,EAAIb,IATlB2d,EAAM9K,EAAE,KAURwL,EAAMtZ,EAAID,EAAIjE,EAAImE,EAAItD,IANtBmc,EAAMhL,EAAE,KAORyL,EAAMtZ,EAAIF,EAAIjE,EAAIkE,EAAIrD,GAStBoT,EAAI,GAAKqI,EAAMiB,EAAMR,EAAMS,EAAMP,EAAMQ,EACvCxJ,EAAI,GAAKsI,EAAMgB,EAAMd,EAAMe,EAAMN,EAAMO,EACvCxJ,EAAI,GAAKuI,EAAMe,EAAMb,EAAMc,EAAMb,EAAMc,EACvCxJ,EAAI,GAAK4I,EAAMoB,EAAMnB,EAAMoB,EAAMlB,EAAMgC,EACvC/K,EAAI,GAAKqI,EAAM2B,EAAMlB,EAAMmB,EAAMjB,EAAM+B,EACvC/K,EAAI,GAAKsI,EAAM0B,EAAMxB,EAAMyB,EAAMhB,EAAM8B,EACvC/K,EAAI,GAAKuI,EAAMyB,EAAMvB,EAAMwB,EAAMvB,EAAMqC,EACvC/K,EAAI,GAAK4I,EAAMoC,EAAMnC,EAAMoC,EAAMlC,EAAMmC,EACvClL,EAAI,GAAKqI,EAAM2C,EAAMlC,EAAMmC,EAAMjC,EAAMkC,EACvClL,EAAI,IAAMsI,EAAM0C,EAAMxC,EAAMyC,EAAMhC,EAAMiC,EACxClL,EAAI,IAAMuI,EAAMyC,EAAMvC,EAAMwC,EAAMvC,EAAMwC,EAEpCnN,IAAMiC,IAERA,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,KAGPiC,EACT,CAUO,SAASuL,EAAQvL,EAAKjC,EAAG8M,GAC9B,IAAIje,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GACbhC,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IAuBZ,OArBIA,IAAMiC,IAERA,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,KAIdiC,EAAI,GAAK6I,EAAM3d,EAAI6d,EAAMnc,EACzBoT,EAAI,GAAK8I,EAAM5d,EAAI8d,EAAMpc,EACzBoT,EAAI,GAAKwI,EAAMtd,EAAI+d,EAAMrc,EACzBoT,EAAI,GAAKyI,EAAMvd,EAAIwd,EAAM9b,EACzBoT,EAAI,GAAK+I,EAAM7d,EAAI2d,EAAMjc,EACzBoT,EAAI,GAAKgJ,EAAM9d,EAAI4d,EAAMlc,EACzBoT,EAAI,IAAMiJ,EAAM/d,EAAIsd,EAAM5b,EAC1BoT,EAAI,IAAM0I,EAAMxd,EAAIud,EAAM7b,EACnBoT,CACT,CAUO,SAASwL,EAAQxL,EAAKjC,EAAG8M,GAC9B,IAAIje,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GACbjC,EAAM7K,EAAE,GACRsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACRgL,EAAMhL,EAAE,GACRiL,EAAMjL,EAAE,GACRkL,EAAMlL,EAAE,IACR2K,EAAM3K,EAAE,IAuBZ,OArBIA,IAAMiC,IAERA,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,KAIdiC,EAAI,GAAK4I,EAAM1d,EAAI6d,EAAMnc,EACzBoT,EAAI,GAAKqI,EAAMnd,EAAI8d,EAAMpc,EACzBoT,EAAI,GAAKsI,EAAMpd,EAAI+d,EAAMrc,EACzBoT,EAAI,GAAKuI,EAAMrd,EAAIwd,EAAM9b,EACzBoT,EAAI,GAAK4I,EAAMhc,EAAImc,EAAM7d,EACzB8U,EAAI,GAAKqI,EAAMzb,EAAIoc,EAAM9d,EACzB8U,EAAI,IAAMsI,EAAM1b,EAAIqc,EAAM/d,EAC1B8U,EAAI,IAAMuI,EAAM3b,EAAI8b,EAAMxd,EACnB8U,CACT,CAUO,SAASyL,EAAQzL,EAAKjC,EAAG8M,GAC9B,IAAIje,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GACbjC,EAAM7K,EAAE,GACRsK,EAAMtK,EAAE,GACRuK,EAAMvK,EAAE,GACRwK,EAAMxK,EAAE,GACR8K,EAAM9K,EAAE,GACR+K,EAAM/K,EAAE,GACRyK,EAAMzK,EAAE,GACR0K,EAAM1K,EAAE,GAuBZ,OArBIA,IAAMiC,IAERA,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,IACZiC,EAAI,IAAMjC,EAAE,KAIdiC,EAAI,GAAK4I,EAAM1d,EAAI2d,EAAMjc,EACzBoT,EAAI,GAAKqI,EAAMnd,EAAI4d,EAAMlc,EACzBoT,EAAI,GAAKsI,EAAMpd,EAAIsd,EAAM5b,EACzBoT,EAAI,GAAKuI,EAAMrd,EAAIud,EAAM7b,EACzBoT,EAAI,GAAK6I,EAAM3d,EAAI0d,EAAMhc,EACzBoT,EAAI,GAAK8I,EAAM5d,EAAImd,EAAMzb,EACzBoT,EAAI,GAAKwI,EAAMtd,EAAIod,EAAM1b,EACzBoT,EAAI,GAAKyI,EAAMvd,EAAIqd,EAAM3b,EAClBoT,CACT,CAaO,SAAS0L,EAAgB1L,EAAK1P,GAiBnC,OAhBA0P,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM,EACHA,CACT,CAaO,SAAS2L,EAAY3L,EAAK1P,GAiB/B,OAhBA0P,EAAI,GAAK1P,EAAE,GACX0P,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK1P,EAAE,GACX0P,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAcO,SAAS4L,EAAa5L,EAAK6K,EAAKC,GACrC,IAIIle,EAAG1B,EAAGa,EAJNiE,EAAI8a,EAAK,GACT7a,EAAI6a,EAAK,GACT5a,EAAI4a,EAAK,GACTK,EAAM5Y,KAAK6Y,MAAMpb,EAAGC,EAAGC,GAG3B,OAAIib,EAAMtE,GACD,MAIT7W,GADAmb,EAAM,EAAIA,EAEVlb,GAAKkb,EACLjb,GAAKib,EACLve,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GAGb7K,EAAI,GAAKhQ,EAAIA,GAFbjE,EAAI,EAAIb,GAEaA,EACrB8U,EAAI,GAAK/P,EAAID,EAAIjE,EAAImE,EAAItD,EACzBoT,EAAI,GAAK9P,EAAIF,EAAIjE,EAAIkE,EAAIrD,EACzBoT,EAAI,GAAK,EACTA,EAAI,GAAKhQ,EAAIC,EAAIlE,EAAImE,EAAItD,EACzBoT,EAAI,GAAK/P,EAAIA,EAAIlE,EAAIb,EACrB8U,EAAI,GAAK9P,EAAID,EAAIlE,EAAIiE,EAAIpD,EACzBoT,EAAI,GAAK,EACTA,EAAI,GAAKhQ,EAAIE,EAAInE,EAAIkE,EAAIrD,EACzBoT,EAAI,GAAK/P,EAAIC,EAAInE,EAAIiE,EAAIpD,EACzBoT,EAAI,IAAM9P,EAAIA,EAAInE,EAAIb,EACtB8U,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,EACT,CAaO,SAAS6L,EAAc7L,EAAK6K,GACjC,IAAIje,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GAkBjB,OAhBA7K,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK9U,EACT8U,EAAI,GAAKpT,EACToT,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAMpT,EACVoT,EAAI,IAAM9U,EACV8U,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAaO,SAAS8L,EAAc9L,EAAK6K,GACjC,IAAIje,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GAkBjB,OAhBA7K,EAAI,GAAK9U,EACT8U,EAAI,GAAK,EACTA,EAAI,IAAMpT,EACVoT,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAKpT,EACToT,EAAI,GAAK,EACTA,EAAI,IAAM9U,EACV8U,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAaO,SAAS+L,EAAc/L,EAAK6K,GACjC,IAAIje,EAAI2F,KAAK8Y,IAAIR,GACb3f,EAAIqH,KAAK+Y,IAAIT,GAkBjB,OAhBA7K,EAAI,GAAK9U,EACT8U,EAAI,GAAKpT,EACToT,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAMpT,EACVoT,EAAI,GAAK9U,EACT8U,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAiBO,SAASgM,EAAwBhM,EAAKiM,EAAG3b,GAE9C,IAAIN,EAAIic,EAAE,GACNhc,EAAIgc,EAAE,GACN/b,EAAI+b,EAAE,GACNC,EAAID,EAAE,GACNE,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKtc,EAAImc,EACTI,EAAKvc,EAAIoc,EACTI,EAAKxc,EAAIqc,EACTI,EAAKxc,EAAImc,EACTM,EAAKzc,EAAIoc,EACTM,EAAKzc,EAAImc,EACTO,EAAKV,EAAIC,EACTU,EAAKX,EAAIE,EACTU,EAAKZ,EAAIG,EAiBb,OAhBArM,EAAI,GAAK,GAAKyM,EAAKE,GACnB3M,EAAI,GAAKuM,EAAKO,EACd9M,EAAI,GAAKwM,EAAKK,EACd7M,EAAI,GAAK,EACTA,EAAI,GAAKuM,EAAKO,EACd9M,EAAI,GAAK,GAAKsM,EAAKK,GACnB3M,EAAI,GAAK0M,EAAKE,EACd5M,EAAI,GAAK,EACTA,EAAI,GAAKwM,EAAKK,EACd7M,EAAI,GAAK0M,EAAKE,EACd5M,EAAI,IAAM,GAAKsM,EAAKG,GACpBzM,EAAI,IAAM,EACVA,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM,EACHA,CACT,CASO,SAAS+M,EAAU/M,EAAKjC,GAC7B,IAAIiP,EAAc,IAAInG,GAAoB,GACtCoG,GAAMlP,EAAE,GACRmP,GAAMnP,EAAE,GACRoP,GAAMpP,EAAE,GACRqP,EAAKrP,EAAE,GACPsP,EAAKtP,EAAE,GACPuP,EAAKvP,EAAE,GACPwP,EAAKxP,EAAE,GACPyP,EAAKzP,EAAE,GACP0P,EAAYR,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,EAanD,OAXIK,EAAY,GACdT,EAAY,GAA+C,GAAzCK,EAAKD,EAAKI,EAAKP,EAAKK,EAAKH,EAAKI,EAAKL,GAAUO,EAC/DT,EAAY,GAA+C,GAAzCM,EAAKF,EAAKI,EAAKN,EAAKK,EAAKN,EAAKI,EAAKF,GAAUM,EAC/DT,EAAY,GAA+C,GAAzCO,EAAKH,EAAKI,EAAKL,EAAKE,EAAKH,EAAKI,EAAKL,GAAUQ,IAE/DT,EAAY,GAA+C,GAAzCK,EAAKD,EAAKI,EAAKP,EAAKK,EAAKH,EAAKI,EAAKL,GACrDF,EAAY,GAA+C,GAAzCM,EAAKF,EAAKI,EAAKN,EAAKK,EAAKN,EAAKI,EAAKF,GACrDH,EAAY,GAA+C,GAAzCO,EAAKH,EAAKI,EAAKL,EAAKE,EAAKH,EAAKI,EAAKL,IAGvDjB,EAAwBhM,EAAKjC,EAAGiP,GACzBhN,CACT,CAWO,SAAS0N,EAAe1N,EAAK2N,GAIlC,OAHA3N,EAAI,GAAK2N,EAAI,IACb3N,EAAI,GAAK2N,EAAI,IACb3N,EAAI,GAAK2N,EAAI,IACN3N,CACT,CAYO,SAAS4N,EAAW5N,EAAK2N,GAC9B,IAGIhG,EAAMgG,EAAI,GACV/F,EAAM+F,EAAI,GACV9F,EAAM8F,EAAI,GACV5F,EAAM4F,EAAI,GACV3F,EAAM2F,EAAI,GACV1F,EAAM0F,EAAI,IAId,OAHA3N,EAAI,GAAKzN,KAAK6Y,MATJuC,EAAI,GACJA,EAAI,GACJA,EAAI,IAQd3N,EAAI,GAAKzN,KAAK6Y,MAAMzD,EAAKC,EAAKC,GAC9B7H,EAAI,GAAKzN,KAAK6Y,MAAMrD,EAAKC,EAAKC,GACvBjI,CACT,CAWO,SAAS6N,EAAY7N,EAAK2N,GAC/B,IAAIG,EAAU,IAAIjH,GAAoB,GACtC+G,EAAWE,EAASH,GACpB,IAAII,EAAM,EAAID,EAAQ,GAClBE,EAAM,EAAIF,EAAQ,GAClBG,EAAM,EAAIH,EAAQ,GAClBI,EAAOP,EAAI,GAAKI,EAChBI,EAAOR,EAAI,GAAKK,EAChBI,EAAOT,EAAI,GAAKM,EAChBI,EAAOV,EAAI,GAAKI,EAChBO,EAAOX,EAAI,GAAKK,EAChBO,EAAOZ,EAAI,GAAKM,EAChBO,EAAOb,EAAI,GAAKI,EAChBU,EAAOd,EAAI,GAAKK,EAChBU,EAAOf,EAAI,IAAMM,EACjBU,EAAQT,EAAOI,EAAOI,EACtBE,EAAI,EA4BR,OA1BID,EAAQ,GACVC,EAA6B,EAAzBrc,KAAKsc,KAAKF,EAAQ,GACtB3O,EAAI,GAAK,IAAO4O,EAChB5O,EAAI,IAAMuO,EAAOE,GAAQG,EACzB5O,EAAI,IAAMwO,EAAOJ,GAAQQ,EACzB5O,EAAI,IAAMmO,EAAOE,GAAQO,GAChBV,EAAOI,GAAQJ,EAAOQ,GAC/BE,EAA0C,EAAtCrc,KAAKsc,KAAK,EAAMX,EAAOI,EAAOI,GAClC1O,EAAI,IAAMuO,EAAOE,GAAQG,EACzB5O,EAAI,GAAK,IAAO4O,EAChB5O,EAAI,IAAMmO,EAAOE,GAAQO,EACzB5O,EAAI,IAAMwO,EAAOJ,GAAQQ,GAChBN,EAAOI,GAChBE,EAA0C,EAAtCrc,KAAKsc,KAAK,EAAMP,EAAOJ,EAAOQ,GAClC1O,EAAI,IAAMwO,EAAOJ,GAAQQ,EACzB5O,EAAI,IAAMmO,EAAOE,GAAQO,EACzB5O,EAAI,GAAK,IAAO4O,EAChB5O,EAAI,IAAMuO,EAAOE,GAAQG,IAEzBA,EAA0C,EAAtCrc,KAAKsc,KAAK,EAAMH,EAAOR,EAAOI,GAClCtO,EAAI,IAAMmO,EAAOE,GAAQO,EACzB5O,EAAI,IAAMwO,EAAOJ,GAAQQ,EACzB5O,EAAI,IAAMuO,EAAOE,GAAQG,EACzB5O,EAAI,GAAK,IAAO4O,GAGX5O,CACT,CAmBO,SAAS8O,EAA6B9O,EAAKiM,EAAG3b,EAAG1D,GAEtD,IAAIoD,EAAIic,EAAE,GACNhc,EAAIgc,EAAE,GACN/b,EAAI+b,EAAE,GACNC,EAAID,EAAE,GACNE,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKtc,EAAImc,EACTI,EAAKvc,EAAIoc,EACTI,EAAKxc,EAAIqc,EACTI,EAAKxc,EAAImc,EACTM,EAAKzc,EAAIoc,EACTM,EAAKzc,EAAImc,EACTO,EAAKV,EAAIC,EACTU,EAAKX,EAAIE,EACTU,EAAKZ,EAAIG,EACT0C,EAAKniB,EAAE,GACPoiB,EAAKpiB,EAAE,GACPqiB,EAAKriB,EAAE,GAiBX,OAhBAoT,EAAI,IAAM,GAAKyM,EAAKE,IAAOoC,EAC3B/O,EAAI,IAAMuM,EAAKO,GAAMiC,EACrB/O,EAAI,IAAMwM,EAAKK,GAAMkC,EACrB/O,EAAI,GAAK,EACTA,EAAI,IAAMuM,EAAKO,GAAMkC,EACrBhP,EAAI,IAAM,GAAKsM,EAAKK,IAAOqC,EAC3BhP,EAAI,IAAM0M,EAAKE,GAAMoC,EACrBhP,EAAI,GAAK,EACTA,EAAI,IAAMwM,EAAKK,GAAMoC,EACrBjP,EAAI,IAAM0M,EAAKE,GAAMqC,EACrBjP,EAAI,KAAO,GAAKsM,EAAKG,IAAOwC,EAC5BjP,EAAI,IAAM,EACVA,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM1P,EAAE,GACZ0P,EAAI,IAAM,EACHA,CACT,CAsBO,SAASkP,EAAmClP,EAAKiM,EAAG3b,EAAG1D,EAAGtB,GAE/D,IAAI0E,EAAIic,EAAE,GACNhc,EAAIgc,EAAE,GACN/b,EAAI+b,EAAE,GACNC,EAAID,EAAE,GACNE,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKtc,EAAImc,EACTI,EAAKvc,EAAIoc,EACTI,EAAKxc,EAAIqc,EACTI,EAAKxc,EAAImc,EACTM,EAAKzc,EAAIoc,EACTM,EAAKzc,EAAImc,EACTO,EAAKV,EAAIC,EACTU,EAAKX,EAAIE,EACTU,EAAKZ,EAAIG,EACT0C,EAAKniB,EAAE,GACPoiB,EAAKpiB,EAAE,GACPqiB,EAAKriB,EAAE,GACPuiB,EAAK7jB,EAAE,GACP8jB,EAAK9jB,EAAE,GACP+jB,EAAK/jB,EAAE,GACPgkB,GAAQ,GAAK7C,EAAKE,IAAOoC,EACzBQ,GAAQhD,EAAKO,GAAMiC,EACnBS,GAAQhD,EAAKK,GAAMkC,EACnBU,GAAQlD,EAAKO,GAAMkC,EACnBU,GAAQ,GAAKpD,EAAKK,IAAOqC,EACzBW,GAAQjD,EAAKE,GAAMoC,EACnBY,GAAQpD,EAAKK,GAAMoC,EACnBY,GAAQnD,EAAKE,GAAMqC,EACnBa,GAAS,GAAKxD,EAAKG,IAAOwC,EAiB9B,OAhBAjP,EAAI,GAAKsP,EACTtP,EAAI,GAAKuP,EACTvP,EAAI,GAAKwP,EACTxP,EAAI,GAAK,EACTA,EAAI,GAAKyP,EACTzP,EAAI,GAAK0P,EACT1P,EAAI,GAAK2P,EACT3P,EAAI,GAAK,EACTA,EAAI,GAAK4P,EACT5P,EAAI,GAAK6P,EACT7P,EAAI,IAAM8P,EACV9P,EAAI,IAAM,EACVA,EAAI,IAAM1P,EAAE,GAAK6e,GAAMG,EAAOH,EAAKM,EAAOL,EAAKQ,EAAOP,GACtDrP,EAAI,IAAM1P,EAAE,GAAK8e,GAAMG,EAAOJ,EAAKO,EAAON,EAAKS,EAAOR,GACtDrP,EAAI,IAAM1P,EAAE,GAAK+e,GAAMG,EAAOL,EAAKQ,EAAOP,EAAKU,EAAQT,GACvDrP,EAAI,IAAM,EACHA,CACT,CAUO,SAAS+P,EAAS/P,EAAKiM,GAC5B,IAAIjc,EAAIic,EAAE,GACNhc,EAAIgc,EAAE,GACN/b,EAAI+b,EAAE,GACNC,EAAID,EAAE,GACNE,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKnc,EAAIA,EACToc,EAAKtc,EAAImc,EACT6D,EAAK/f,EAAIkc,EACTM,EAAKxc,EAAImc,EACT6D,EAAK/f,EAAIic,EACT+D,EAAKhgB,EAAIkc,EACTO,EAAKzc,EAAImc,EACTO,EAAKV,EAAIC,EACTU,EAAKX,EAAIE,EACTU,EAAKZ,EAAIG,EAiBb,OAhBArM,EAAI,GAAK,EAAIyM,EAAKE,EAClB3M,EAAI,GAAKgQ,EAAKlD,EACd9M,EAAI,GAAKiQ,EAAKpD,EACd7M,EAAI,GAAK,EACTA,EAAI,GAAKgQ,EAAKlD,EACd9M,EAAI,GAAK,EAAIsM,EAAKK,EAClB3M,EAAI,GAAKkQ,EAAKtD,EACd5M,EAAI,GAAK,EACTA,EAAI,GAAKiQ,EAAKpD,EACd7M,EAAI,GAAKkQ,EAAKtD,EACd5M,EAAI,IAAM,EAAIsM,EAAKG,EACnBzM,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EACHA,CACT,CAcO,SAASmQ,EAAQnQ,EAAKoQ,EAAMC,EAAOC,EAAQC,EAAKC,EAAMC,GAC3D,IAAIC,EAAK,GAAKL,EAAQD,GAClBO,EAAK,GAAKJ,EAAMD,GAChBM,EAAK,GAAKJ,EAAOC,GAiBrB,OAhBAzQ,EAAI,GAAY,EAAPwQ,EAAWE,EACpB1Q,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAY,EAAPwQ,EAAWG,EACpB3Q,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAMqQ,EAAQD,GAAQM,EAC1B1Q,EAAI,IAAMuQ,EAAMD,GAAUK,EAC1B3Q,EAAI,KAAOyQ,EAAMD,GAAQI,EACzB5Q,EAAI,KAAO,EACXA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAMyQ,EAAMD,EAAO,EAAII,EAC3B5Q,EAAI,IAAM,EACHA,CACT,CAeO,SAAS6Q,EAAc7Q,EAAK8Q,EAAMC,EAAQP,EAAMC,GACrD,IACIG,EADArW,EAAI,EAAMhI,KAAKye,IAAIF,EAAO,GA0B9B,OAxBA9Q,EAAI,GAAKzF,EAAIwW,EACb/Q,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAKzF,EACTyF,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,KAAO,EACXA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EAEC,MAAPyQ,GAAeA,IAAQQ,KAEzBjR,EAAI,KAAOyQ,EAAMD,IADjBI,EAAK,GAAKJ,EAAOC,IAEjBzQ,EAAI,IAAM,EAAIyQ,EAAMD,EAAOI,IAE3B5Q,EAAI,KAAO,EACXA,EAAI,KAAO,EAAIwQ,GAGVxQ,CACT,CAqBO,SAASkR,EAAclR,EAAK8Q,EAAMC,EAAQP,EAAMC,GACrD,IACIG,EADArW,EAAI,EAAMhI,KAAKye,IAAIF,EAAO,GA0B9B,OAxBA9Q,EAAI,GAAKzF,EAAIwW,EACb/Q,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAKzF,EACTyF,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,KAAO,EACXA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAM,EAEC,MAAPyQ,GAAeA,IAAQQ,KAEzBjR,EAAI,IAAMyQ,GADVG,EAAK,GAAKJ,EAAOC,IAEjBzQ,EAAI,IAAMyQ,EAAMD,EAAOI,IAEvB5Q,EAAI,KAAO,EACXA,EAAI,KAAOwQ,GAGNxQ,CACT,CAaO,SAASmR,EAA2BnR,EAAKoR,EAAKZ,EAAMC,GACzD,IAAIY,EAAQ9e,KAAKye,IAAII,EAAIE,UAAY/e,KAAKgf,GAAK,KAC3CC,EAAUjf,KAAKye,IAAII,EAAIK,YAAclf,KAAKgf,GAAK,KAC/CG,EAAUnf,KAAKye,IAAII,EAAIO,YAAcpf,KAAKgf,GAAK,KAC/CK,EAAWrf,KAAKye,IAAII,EAAIS,aAAetf,KAAKgf,GAAK,KACjDO,EAAS,GAAOJ,EAAUE,GAC1BG,EAAS,GAAOV,EAAQG,GAiB5B,OAhBAxR,EAAI,GAAK8R,EACT9R,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK+R,EACT/R,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,KAAQ0R,EAAUE,GAAYE,EAAS,GAC3C9R,EAAI,IAAMqR,EAAQG,GAAWO,EAAS,GACtC/R,EAAI,IAAMyQ,GAAOD,EAAOC,GACxBzQ,EAAI,KAAO,EACXA,EAAI,IAAM,EACVA,EAAI,IAAM,EACVA,EAAI,IAAMyQ,EAAMD,GAAQA,EAAOC,GAC/BzQ,EAAI,IAAM,EACHA,CACT,CAgBO,SAASgS,EAAQhS,EAAKoQ,EAAMC,EAAOC,EAAQC,EAAKC,EAAMC,GAC3D,IAAIwB,EAAK,GAAK7B,EAAOC,GACjB6B,EAAK,GAAK5B,EAASC,GACnBK,EAAK,GAAKJ,EAAOC,GAiBrB,OAhBAzQ,EAAI,IAAM,EAAIiS,EACdjS,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EAAIkS,EACdlS,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EAAI4Q,EACd5Q,EAAI,IAAM,EACVA,EAAI,KAAOoQ,EAAOC,GAAS4B,EAC3BjS,EAAI,KAAOuQ,EAAMD,GAAU4B,EAC3BlS,EAAI,KAAOyQ,EAAMD,GAAQI,EACzB5Q,EAAI,IAAM,EACHA,CACT,CAsBO,SAASmS,EAAQnS,EAAKoQ,EAAMC,EAAOC,EAAQC,EAAKC,EAAMC,GAC3D,IAAIwB,EAAK,GAAK7B,EAAOC,GACjB6B,EAAK,GAAK5B,EAASC,GACnBK,EAAK,GAAKJ,EAAOC,GAiBrB,OAhBAzQ,EAAI,IAAM,EAAIiS,EACdjS,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM,EAAIkS,EACdlS,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,IAAM4Q,EACV5Q,EAAI,IAAM,EACVA,EAAI,KAAOoQ,EAAOC,GAAS4B,EAC3BjS,EAAI,KAAOuQ,EAAMD,GAAU4B,EAC3BlS,EAAI,IAAMwQ,EAAOI,EACjB5Q,EAAI,IAAM,EACHA,CACT,CAYO,SAASoS,EAAOpS,EAAKqS,EAAKC,EAAQC,GACvC,IAAIC,EAAIC,EAAItG,EAAIuG,EAAIC,EAAIvG,EAAIwG,EAAIC,EAAIxG,EAAIlB,EACpC2H,EAAOT,EAAI,GACXU,EAAOV,EAAI,GACXW,EAAOX,EAAI,GACXY,EAAMV,EAAG,GACTW,EAAMX,EAAG,GACTY,EAAMZ,EAAG,GACTa,EAAUd,EAAO,GACjBe,EAAUf,EAAO,GACjBgB,EAAUhB,EAAO,GAErB,OAAI/f,KAAKoU,IAAImM,EAAOM,GAAWvM,IAAoBtU,KAAKoU,IAAIoM,EAAOM,GAAWxM,IAAoBtU,KAAKoU,IAAIqM,EAAOM,GAAWzM,GACpHsB,EAASnI,IAGlB4S,EAAKE,EAAOM,EACZP,EAAKE,EAAOM,EACZhH,EAAK2G,EAAOM,EAKZd,EAAKU,GADL7G,GAHAlB,EAAM,EAAI5Y,KAAK6Y,MAAMwH,EAAIC,EAAIxG,IAIb8G,GAFhBN,GAAM1H,GAGNsH,EAAKU,GAJLP,GAAMzH,GAIU8H,EAAM5G,EACtBF,EAAK8G,EAAMJ,EAAKK,EAAMN,GACtBzH,EAAM5Y,KAAK6Y,MAAMoH,EAAIC,EAAItG,KAQvBqG,GADArH,EAAM,EAAIA,EAEVsH,GAAMtH,EACNgB,GAAMhB,IAPNqH,EAAK,EACLC,EAAK,EACLtG,EAAK,GAQPuG,EAAKG,EAAK1G,EAAKE,EAAKoG,EACpBE,EAAKtG,EAAKmG,EAAKI,EAAKzG,EACpBC,EAAKwG,EAAKH,EAAKI,EAAKL,GACpBrH,EAAM5Y,KAAK6Y,MAAMsH,EAAIC,EAAIvG,KAQvBsG,GADAvH,EAAM,EAAIA,EAEVwH,GAAMxH,EACNiB,GAAMjB,IAPNuH,EAAK,EACLC,EAAK,EACLvG,EAAK,GAQPpM,EAAI,GAAKwS,EACTxS,EAAI,GAAK0S,EACT1S,EAAI,GAAK4S,EACT5S,EAAI,GAAK,EACTA,EAAI,GAAKyS,EACTzS,EAAI,GAAK2S,EACT3S,EAAI,GAAK6S,EACT7S,EAAI,GAAK,EACTA,EAAI,GAAKmM,EACTnM,EAAI,GAAKoM,EACTpM,EAAI,IAAMqM,EACVrM,EAAI,IAAM,EACVA,EAAI,MAAQwS,EAAKM,EAAOL,EAAKM,EAAO5G,EAAK6G,GACzChT,EAAI,MAAQ0S,EAAKI,EAAOH,EAAKI,EAAO3G,EAAK4G,GACzChT,EAAI,MAAQ4S,EAAKE,EAAOD,EAAKE,EAAO1G,EAAK2G,GACzChT,EAAI,IAAM,EACHA,EACT,CAWO,SAASuT,EAASvT,EAAKqS,EAAKmB,EAAQjB,GACzC,IAAIO,EAAOT,EAAI,GACXU,EAAOV,EAAI,GACXW,EAAOX,EAAI,GACXY,EAAMV,EAAG,GACTW,EAAMX,EAAG,GACTY,EAAMZ,EAAG,GACTK,EAAKE,EAAOU,EAAO,GACnBX,EAAKE,EAAOS,EAAO,GACnBnH,EAAK2G,EAAOQ,EAAO,GACnBrI,EAAMyH,EAAKA,EAAKC,EAAKA,EAAKxG,EAAKA,EAE/BlB,EAAM,IAERyH,GADAzH,EAAM,EAAI5Y,KAAKsc,KAAK1D,GAEpB0H,GAAM1H,EACNkB,GAAMlB,GAGR,IAAIqH,EAAKU,EAAM7G,EAAK8G,EAAMN,EACtBJ,EAAKU,EAAMP,EAAKK,EAAM5G,EACtBF,EAAK8G,EAAMJ,EAAKK,EAAMN,EA0B1B,OAzBAzH,EAAMqH,EAAKA,EAAKC,EAAKA,EAAKtG,EAAKA,GAErB,IAERqG,GADArH,EAAM,EAAI5Y,KAAKsc,KAAK1D,GAEpBsH,GAAMtH,EACNgB,GAAMhB,GAGRnL,EAAI,GAAKwS,EACTxS,EAAI,GAAKyS,EACTzS,EAAI,GAAKmM,EACTnM,EAAI,GAAK,EACTA,EAAI,GAAK6S,EAAK1G,EAAKE,EAAKoG,EACxBzS,EAAI,GAAKqM,EAAKmG,EAAKI,EAAKzG,EACxBnM,EAAI,GAAK4S,EAAKH,EAAKI,EAAKL,EACxBxS,EAAI,GAAK,EACTA,EAAI,GAAK4S,EACT5S,EAAI,GAAK6S,EACT7S,EAAI,IAAMqM,EACVrM,EAAI,IAAM,EACVA,EAAI,IAAM8S,EACV9S,EAAI,IAAM+S,EACV/S,EAAI,IAAMgT,EACVhT,EAAI,IAAM,EACHA,CACT,CAQO,SAASyT,EAAI1V,GAClB,MAAO,QAAUA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,IAAM,KAAOA,EAAE,IAAM,KAAOA,EAAE,IAAM,KAAOA,EAAE,IAAM,KAAOA,EAAE,IAAM,KAAOA,EAAE,IAAM,GAClP,CAQO,SAAS2V,EAAK3V,GACnB,OAAOxL,KAAK6Y,MAAMrN,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IACrH,CAUO,SAAS4V,GAAI3T,EAAKjC,EAAGC,GAiB1B,OAhBAgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACbgC,CACT,CAUO,SAAS4T,GAAS5T,EAAKjC,EAAGC,GAiB/B,OAhBAgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACpBgC,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IACbgC,CACT,CAUO,SAAS6T,GAAe7T,EAAKjC,EAAGC,GAiBrC,OAhBAgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,IAAMjC,EAAE,IAAMC,EAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EAClBgC,EAAI,IAAMjC,EAAE,IAAMC,EACXgC,CACT,CAWO,SAAS8T,GAAqB9T,EAAKjC,EAAGC,EAAG2M,GAiB9C,OAhBA3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IAAM2M,EAC1B3K,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IAAM2M,EAC1B3K,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IAAM2M,EAC1B3K,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IAAM2M,EAC1B3K,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IAAM2M,EAC1B3K,EAAI,IAAMjC,EAAE,IAAMC,EAAE,IAAM2M,EACnB3K,CACT,CASO,SAAS+T,GAAYhW,EAAGC,GAC7B,OAAOD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,MAAQC,EAAE,KAAOD,EAAE,MAAQC,EAAE,KAAOD,EAAE,MAAQC,EAAE,KAAOD,EAAE,MAAQC,EAAE,KAAOD,EAAE,MAAQC,EAAE,KAAOD,EAAE,MAAQC,EAAE,GAC9R,CASO,SAAS0I,GAAO3I,EAAGC,GACxB,IAAIgW,EAAKjW,EAAE,GACPkW,EAAKlW,EAAE,GACPmW,EAAKnW,EAAE,GACPoW,EAAKpW,EAAE,GACPqW,EAAKrW,EAAE,GACPsW,EAAKtW,EAAE,GACPuW,EAAKvW,EAAE,GACPwW,EAAKxW,EAAE,GACPyW,EAAKzW,EAAE,GACP0W,EAAK1W,EAAE,GACP8K,EAAM9K,EAAE,IACR+K,EAAM/K,EAAE,IACRyK,EAAMzK,EAAE,IACR0K,EAAM1K,EAAE,IACR2W,EAAM3W,EAAE,IACR4W,EAAM5W,EAAE,IACRuM,EAAKtM,EAAE,GACPuM,EAAKvM,EAAE,GACPwM,EAAKxM,EAAE,GACPyM,EAAKzM,EAAE,GACP4W,EAAK5W,EAAE,GACP6W,EAAK7W,EAAE,GACP8W,EAAK9W,EAAE,GACP+W,EAAK/W,EAAE,GACPgX,EAAKhX,EAAE,GACPiX,EAAKjX,EAAE,GACPgM,EAAMhM,EAAE,IACRiM,EAAMjM,EAAE,IACR+M,EAAM/M,EAAE,IACRkX,EAAMlX,EAAE,IACRmX,EAAMnX,EAAE,IACRoX,EAAMpX,EAAE,IACZ,OAAOzL,KAAKoU,IAAIqN,EAAK1J,IAAOzD,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIqN,GAAKzhB,KAAKoU,IAAI2D,KAAQ/X,KAAKoU,IAAIsN,EAAK1J,IAAO1D,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIsN,GAAK1hB,KAAKoU,IAAI4D,KAAQhY,KAAKoU,IAAIuN,EAAK1J,IAAO3D,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIuN,GAAK3hB,KAAKoU,IAAI6D,KAAQjY,KAAKoU,IAAIwN,EAAK1J,IAAO5D,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIwN,GAAK5hB,KAAKoU,IAAI8D,KAAQlY,KAAKoU,IAAIyN,EAAKQ,IAAO/N,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIyN,GAAK7hB,KAAKoU,IAAIiO,KAAQriB,KAAKoU,IAAI0N,EAAKQ,IAAOhO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI0N,GAAK9hB,KAAKoU,IAAIkO,KAAQtiB,KAAKoU,IAAI2N,EAAKQ,IAAOjO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI2N,GAAK/hB,KAAKoU,IAAImO,KAAQviB,KAAKoU,IAAI4N,EAAKQ,IAAOlO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI4N,GAAKhiB,KAAKoU,IAAIoO,KAAQxiB,KAAKoU,IAAI6N,EAAKQ,IAAOnO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI6N,GAAKjiB,KAAKoU,IAAIqO,KAAQziB,KAAKoU,IAAI8N,EAAKQ,IAAOpO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI8N,GAAKliB,KAAKoU,IAAIsO,KAAQ1iB,KAAKoU,IAAIkC,EAAMmB,IAAQnD,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIkC,GAAMtW,KAAKoU,IAAIqD,KAASzX,KAAKoU,IAAImC,EAAMmB,IAAQpD,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAImC,GAAMvW,KAAKoU,IAAIsD,KAAS1X,KAAKoU,IAAI6B,EAAMuC,IAAQlE,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI6B,GAAMjW,KAAKoU,IAAIoE,KAASxY,KAAKoU,IAAI8B,EAAMyM,IAAQrO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI8B,GAAMlW,KAAKoU,IAAIuO,KAAS3iB,KAAKoU,IAAI+N,EAAMS,IAAQtO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAI+N,GAAMniB,KAAKoU,IAAIwO,KAAS5iB,KAAKoU,IAAIgO,EAAMS,IAAQvO,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIgO,GAAMpiB,KAAKoU,IAAIyO,GACx2C,CC71DO,SAASjpB,KACd,IAAI6T,EAAM,IAAI6G,GAAoB,GAQlC,OANIA,IAAuBC,eACzB9G,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,GAGJA,CACT,CAQO,SAAS+G,GAAMhJ,GACpB,IAAIiC,EAAM,IAAI6G,GAAoB,GAIlC,OAHA7G,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACJiC,CACT,CAQO,SAAStL,GAAOqJ,GAIrB,OAAOxL,KAAK6Y,MAHJrN,EAAE,GACFA,EAAE,GACFA,EAAE,GAEZ,CAUO,SAASkJ,GAAWjX,EAAGC,EAAGC,GAC/B,IAAI8P,EAAM,IAAI6G,GAAoB,GAIlC,OAHA7G,EAAI,GAAKhQ,EACTgQ,EAAI,GAAK/P,EACT+P,EAAI,GAAK9P,EACF8P,CACT,CASO,SAASgH,GAAKhH,EAAKjC,GAIxB,OAHAiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACXiC,EAAI,GAAKjC,EAAE,GACJiC,CACT,CAWO,SAASkI,GAAIlI,EAAKhQ,EAAGC,EAAGC,GAI7B,OAHA8P,EAAI,GAAKhQ,EACTgQ,EAAI,GAAK/P,EACT+P,EAAI,GAAK9P,EACF8P,CACT,CAUO,SAAS2T,GAAI3T,EAAKjC,EAAGC,GAI1B,OAHAgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GACXgC,CACT,CAUO,SAAS4T,GAAS5T,EAAKjC,EAAGC,GAI/B,OAHAgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GACXgC,CACT,CAUO,SAASqK,GAASrK,EAAKjC,EAAGC,GAI/B,OAHAgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GACXgC,CACT,CAUO,SAASqV,GAAOrV,EAAKjC,EAAGC,GAI7B,OAHAgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAClBgC,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GACXgC,CACT,CASO,SAASsV,GAAKtV,EAAKjC,GAIxB,OAHAiC,EAAI,GAAKzN,KAAK+iB,KAAKvX,EAAE,IACrBiC,EAAI,GAAKzN,KAAK+iB,KAAKvX,EAAE,IACrBiC,EAAI,GAAKzN,KAAK+iB,KAAKvX,EAAE,IACdiC,CACT,CASO,SAASxN,GAAMwN,EAAKjC,GAIzB,OAHAiC,EAAI,GAAKzN,KAAKC,MAAMuL,EAAE,IACtBiC,EAAI,GAAKzN,KAAKC,MAAMuL,EAAE,IACtBiC,EAAI,GAAKzN,KAAKC,MAAMuL,EAAE,IACfiC,CACT,CAUO,SAAS3N,GAAI2N,EAAKjC,EAAGC,GAI1B,OAHAgC,EAAI,GAAKzN,KAAKF,IAAI0L,EAAE,GAAIC,EAAE,IAC1BgC,EAAI,GAAKzN,KAAKF,IAAI0L,EAAE,GAAIC,EAAE,IAC1BgC,EAAI,GAAKzN,KAAKF,IAAI0L,EAAE,GAAIC,EAAE,IACnBgC,CACT,CAUO,SAAS1N,GAAI0N,EAAKjC,EAAGC,GAI1B,OAHAgC,EAAI,GAAKzN,KAAKD,IAAIyL,EAAE,GAAIC,EAAE,IAC1BgC,EAAI,GAAKzN,KAAKD,IAAIyL,EAAE,GAAIC,EAAE,IAC1BgC,EAAI,GAAKzN,KAAKD,IAAIyL,EAAE,GAAIC,EAAE,IACnBgC,CACT,CASO,SAASuV,GAAMvV,EAAKjC,GAIzB,OAHAiC,EAAI,GAAKzN,KAAKgjB,MAAMxX,EAAE,IACtBiC,EAAI,GAAKzN,KAAKgjB,MAAMxX,EAAE,IACtBiC,EAAI,GAAKzN,KAAKgjB,MAAMxX,EAAE,IACfiC,CACT,CAUO,SAAS2K,GAAM3K,EAAKjC,EAAGC,GAI5B,OAHAgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EAChBgC,EAAI,GAAKjC,EAAE,GAAKC,EACTgC,CACT,CAWO,SAASwV,GAAYxV,EAAKjC,EAAGC,EAAG2M,GAIrC,OAHA3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EACvB3K,EAAI,GAAKjC,EAAE,GAAKC,EAAE,GAAK2M,EAChB3K,CACT,CASO,SAASyV,GAAS1X,EAAGC,GAI1B,OAAOzL,KAAK6Y,MAHJpN,EAAE,GAAKD,EAAE,GACTC,EAAE,GAAKD,EAAE,GACTC,EAAE,GAAKD,EAAE,GAEnB,CASO,SAAS2X,GAAgB3X,EAAGC,GACjC,IAAIhO,EAAIgO,EAAE,GAAKD,EAAE,GACb9N,EAAI+N,EAAE,GAAKD,EAAE,GACb7N,EAAI8N,EAAE,GAAKD,EAAE,GACjB,OAAO/N,EAAIA,EAAIC,EAAIA,EAAIC,EAAIA,CAC7B,CAQO,SAASylB,GAAc5X,GAC5B,IAAI/N,EAAI+N,EAAE,GACN9N,EAAI8N,EAAE,GACN7N,EAAI6N,EAAE,GACV,OAAO/N,EAAIA,EAAIC,EAAIA,EAAIC,EAAIA,CAC7B,CASO,SAAS0lB,GAAO5V,EAAKjC,GAI1B,OAHAiC,EAAI,IAAMjC,EAAE,GACZiC,EAAI,IAAMjC,EAAE,GACZiC,EAAI,IAAMjC,EAAE,GACLiC,CACT,CASO,SAAS6V,GAAQ7V,EAAKjC,GAI3B,OAHAiC,EAAI,GAAK,EAAMjC,EAAE,GACjBiC,EAAI,GAAK,EAAMjC,EAAE,GACjBiC,EAAI,GAAK,EAAMjC,EAAE,GACViC,CACT,CASO,SAAS8V,GAAU9V,EAAKjC,GAC7B,IAAI/N,EAAI+N,EAAE,GACN9N,EAAI8N,EAAE,GACN7N,EAAI6N,EAAE,GACNoN,EAAMnb,EAAIA,EAAIC,EAAIA,EAAIC,EAAIA,EAU9B,OARIib,EAAM,IAERA,EAAM,EAAI5Y,KAAKsc,KAAK1D,IAGtBnL,EAAI,GAAKjC,EAAE,GAAKoN,EAChBnL,EAAI,GAAKjC,EAAE,GAAKoN,EAChBnL,EAAI,GAAKjC,EAAE,GAAKoN,EACTnL,CACT,CASO,SAAS+V,GAAIhY,EAAGC,GACrB,OAAOD,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,EAC9C,CAUO,SAASgY,GAAMhW,EAAKjC,EAAGC,GAC5B,IAAIqP,EAAKtP,EAAE,GACPuP,EAAKvP,EAAE,GACPwP,EAAKxP,EAAE,GACPkP,EAAKjP,EAAE,GACPkP,EAAKlP,EAAE,GACPmP,EAAKnP,EAAE,GAIX,OAHAgC,EAAI,GAAKsN,EAAKH,EAAKI,EAAKL,EACxBlN,EAAI,GAAKuN,EAAKN,EAAKI,EAAKF,EACxBnN,EAAI,GAAKqN,EAAKH,EAAKI,EAAKL,EACjBjN,CACT,CAWO,SAASiW,GAAKjW,EAAKjC,EAAGC,EAAGjS,GAC9B,IAAIshB,EAAKtP,EAAE,GACPuP,EAAKvP,EAAE,GACPwP,EAAKxP,EAAE,GAIX,OAHAiC,EAAI,GAAKqN,EAAKthB,GAAKiS,EAAE,GAAKqP,GAC1BrN,EAAI,GAAKsN,EAAKvhB,GAAKiS,EAAE,GAAKsP,GAC1BtN,EAAI,GAAKuN,EAAKxhB,GAAKiS,EAAE,GAAKuP,GACnBvN,CACT,CAaO,SAASkW,GAAQlW,EAAKjC,EAAGC,EAAG9S,EAAGC,EAAGY,GACvC,IAAIoqB,EAAepqB,EAAIA,EACnBqqB,EAAUD,GAAgB,EAAIpqB,EAAI,GAAK,EACvCsqB,EAAUF,GAAgBpqB,EAAI,GAAKA,EACnCuqB,EAAUH,GAAgBpqB,EAAI,GAC9BwqB,EAAUJ,GAAgB,EAAI,EAAIpqB,GAItC,OAHAiU,EAAI,GAAKjC,EAAE,GAAKqY,EAAUpY,EAAE,GAAKqY,EAAUnrB,EAAE,GAAKorB,EAAUnrB,EAAE,GAAKorB,EACnEvW,EAAI,GAAKjC,EAAE,GAAKqY,EAAUpY,EAAE,GAAKqY,EAAUnrB,EAAE,GAAKorB,EAAUnrB,EAAE,GAAKorB,EACnEvW,EAAI,GAAKjC,EAAE,GAAKqY,EAAUpY,EAAE,GAAKqY,EAAUnrB,EAAE,GAAKorB,EAAUnrB,EAAE,GAAKorB,EAC5DvW,CACT,CAaO,SAASwW,GAAOxW,EAAKjC,EAAGC,EAAG9S,EAAGC,EAAGY,GACtC,IAAI0qB,EAAgB,EAAI1qB,EACpB2qB,EAAwBD,EAAgBA,EACxCN,EAAepqB,EAAIA,EACnBqqB,EAAUM,EAAwBD,EAClCJ,EAAU,EAAItqB,EAAI2qB,EAClBJ,EAAU,EAAIH,EAAeM,EAC7BF,EAAUJ,EAAepqB,EAI7B,OAHAiU,EAAI,GAAKjC,EAAE,GAAKqY,EAAUpY,EAAE,GAAKqY,EAAUnrB,EAAE,GAAKorB,EAAUnrB,EAAE,GAAKorB,EACnEvW,EAAI,GAAKjC,EAAE,GAAKqY,EAAUpY,EAAE,GAAKqY,EAAUnrB,EAAE,GAAKorB,EAAUnrB,EAAE,GAAKorB,EACnEvW,EAAI,GAAKjC,EAAE,GAAKqY,EAAUpY,EAAE,GAAKqY,EAAUnrB,EAAE,GAAKorB,EAAUnrB,EAAE,GAAKorB,EAC5DvW,CACT,CASO,SAAS2W,GAAO3W,EAAK2K,GAC1BA,EAAQA,GAAS,EACjB,IAAIhf,EAAwB,EAApBkb,KAA0BtU,KAAKgf,GACnCrhB,EAAwB,EAApB2W,KAA0B,EAC9B+P,EAASrkB,KAAKsc,KAAK,EAAM3e,EAAIA,GAAKya,EAItC,OAHA3K,EAAI,GAAKzN,KAAK+Y,IAAI3f,GAAKirB,EACvB5W,EAAI,GAAKzN,KAAK8Y,IAAI1f,GAAKirB,EACvB5W,EAAI,GAAK9P,EAAIya,EACN3K,CACT,CAWO,SAAS6W,GAAc7W,EAAKjC,EAAG9S,GACpC,IAAI+E,EAAI+N,EAAE,GACN9N,EAAI8N,EAAE,GACN7N,EAAI6N,EAAE,GACNmO,EAAIjhB,EAAE,GAAK+E,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,IAAMiF,EAAIjF,EAAE,IAK5C,OAHA+U,EAAI,IAAM/U,EAAE,GAAK+E,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,GAAKiF,EAAIjF,EAAE,MAD7CihB,EAAIA,GAAK,GAETlM,EAAI,IAAM/U,EAAE,GAAK+E,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,GAAKiF,EAAIjF,EAAE,KAAOihB,EACpDlM,EAAI,IAAM/U,EAAE,GAAK+E,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,IAAMiF,EAAIjF,EAAE,KAAOihB,EAC9ClM,CACT,CAUO,SAAS8W,GAAc9W,EAAKjC,EAAG9S,GACpC,IAAI+E,EAAI+N,EAAE,GACN9N,EAAI8N,EAAE,GACN7N,EAAI6N,EAAE,GAIV,OAHAiC,EAAI,GAAKhQ,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,GAAKiF,EAAIjF,EAAE,GACrC+U,EAAI,GAAKhQ,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,GAAKiF,EAAIjF,EAAE,GACrC+U,EAAI,GAAKhQ,EAAI/E,EAAE,GAAKgF,EAAIhF,EAAE,GAAKiF,EAAIjF,EAAE,GAC9B+U,CACT,CAWO,SAAS+W,GAAc/W,EAAKjC,EAAGkO,GAEpC,IAAI+K,EAAK/K,EAAE,GACPgL,EAAKhL,EAAE,GACPiL,EAAKjL,EAAE,GAEPjc,EAAI+N,EAAE,GACN9N,EAAI8N,EAAE,GACN7N,EAAI6N,EAAE,GAGNoZ,EAAMF,EAAK/mB,EAAIgnB,EAAKjnB,EACpBmnB,EAAMF,EAAKlnB,EAAIgnB,EAAK9mB,EACpBmnB,EAAML,EAAK/mB,EAAIgnB,EAAKjnB,EAEpBsnB,EAAOL,EAAKI,EAAMH,EAAKE,EACvBG,EAAOL,EAAKC,EAAMH,EAAKK,EACvBG,EAAOR,EAAKI,EAAMH,EAAKE,EAEvBM,EAAU,EAdLxL,EAAE,GA0BX,OAVAmL,GAAOK,EACPJ,GAAOI,EAGPF,GAAQ,EACRC,GAAQ,EAERxX,EAAI,GAAKhQ,GARTmnB,GAAOM,IAIPH,GAAQ,GAKRtX,EAAI,GAAK/P,EAAImnB,EAAMG,EACnBvX,EAAI,GAAK9P,EAAImnB,EAAMG,EACZxX,CACT,CAUO,SAASuL,GAAQvL,EAAKjC,EAAGC,EAAG6M,GACjC,IAAIle,EAAI,GACJhB,EAAI,GAaR,OAXAgB,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAChBrR,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAChBrR,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAEhBrS,EAAE,GAAKgB,EAAE,GACThB,EAAE,GAAKgB,EAAE,GAAK4F,KAAK+Y,IAAIT,GAAOle,EAAE,GAAK4F,KAAK8Y,IAAIR,GAC9Clf,EAAE,GAAKgB,EAAE,GAAK4F,KAAK8Y,IAAIR,GAAOle,EAAE,GAAK4F,KAAK+Y,IAAIT,GAE9C7K,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GAClBgC,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GAClBgC,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GACXgC,CACT,CAUO,SAASwL,GAAQxL,EAAKjC,EAAGC,EAAG6M,GACjC,IAAIle,EAAI,GACJhB,EAAI,GAaR,OAXAgB,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAChBrR,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAChBrR,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAEhBrS,EAAE,GAAKgB,EAAE,GAAK4F,KAAK8Y,IAAIR,GAAOle,EAAE,GAAK4F,KAAK+Y,IAAIT,GAC9Clf,EAAE,GAAKgB,EAAE,GACThB,EAAE,GAAKgB,EAAE,GAAK4F,KAAK+Y,IAAIT,GAAOle,EAAE,GAAK4F,KAAK8Y,IAAIR,GAE9C7K,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GAClBgC,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GAClBgC,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GACXgC,CACT,CAUO,SAASyL,GAAQzL,EAAKjC,EAAGC,EAAG6M,GACjC,IAAIle,EAAI,GACJhB,EAAI,GAaR,OAXAgB,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAChBrR,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAChBrR,EAAE,GAAKoR,EAAE,GAAKC,EAAE,GAEhBrS,EAAE,GAAKgB,EAAE,GAAK4F,KAAK+Y,IAAIT,GAAOle,EAAE,GAAK4F,KAAK8Y,IAAIR,GAC9Clf,EAAE,GAAKgB,EAAE,GAAK4F,KAAK8Y,IAAIR,GAAOle,EAAE,GAAK4F,KAAK+Y,IAAIT,GAC9Clf,EAAE,GAAKgB,EAAE,GAETqT,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GAClBgC,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GAClBgC,EAAI,GAAKrU,EAAE,GAAKqS,EAAE,GACXgC,CACT,CAQO,SAAS0X,GAAM3Z,EAAGC,GACvB,IAAIqP,EAAKtP,EAAE,GACPuP,EAAKvP,EAAE,GACPwP,EAAKxP,EAAE,GACPkP,EAAKjP,EAAE,GACPkP,EAAKlP,EAAE,GACPmP,EAAKnP,EAAE,GAGP2Z,EAFOplB,KAAKsc,KAAKxB,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,GACnChb,KAAKsc,KAAK5B,EAAKA,EAAKC,EAAKA,EAAKC,EAAKA,GAE1CyK,EAASD,GAAO5B,GAAIhY,EAAGC,GAAK2Z,EAChC,OAAOplB,KAAKslB,KAAKtlB,KAAKF,IAAIE,KAAKD,IAAIslB,GAAS,GAAI,GAClD,CAQO,SAASE,GAAK9X,GAInB,OAHAA,EAAI,GAAK,EACTA,EAAI,GAAK,EACTA,EAAI,GAAK,EACFA,CACT,CAQO,SAASyT,GAAI1V,GAClB,MAAO,QAAUA,EAAE,GAAK,KAAOA,EAAE,GAAK,KAAOA,EAAE,GAAK,GACtD,CASO,SAASgW,GAAYhW,EAAGC,GAC7B,OAAOD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,IAAMD,EAAE,KAAOC,EAAE,EACtD,CASO,SAAS0I,GAAO3I,EAAGC,GACxB,IAAIgW,EAAKjW,EAAE,GACPkW,EAAKlW,EAAE,GACPmW,EAAKnW,EAAE,GACPuM,EAAKtM,EAAE,GACPuM,EAAKvM,EAAE,GACPwM,EAAKxM,EAAE,GACX,OAAOzL,KAAKoU,IAAIqN,EAAK1J,IAAOzD,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIqN,GAAKzhB,KAAKoU,IAAI2D,KAAQ/X,KAAKoU,IAAIsN,EAAK1J,IAAO1D,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIsN,GAAK1hB,KAAKoU,IAAI4D,KAAQhY,KAAKoU,IAAIuN,EAAK1J,IAAO3D,GAAmBtU,KAAKD,IAAI,EAAKC,KAAKoU,IAAIuN,GAAK3hB,KAAKoU,IAAI6D,GAChQ,C,ycCzkBA,SAASuN,GAAWjsB,GAClB,OAAiC,IAAzBA,EAASA,EAAQ,EAC3B,C,+nGCnGA,SAASksB,GACPvT,EACAtW,EACA8pB,GAEA,MAAMC,EAAe/pB,EAAKU,SAASspB,SAASC,GACnCA,IAGHC,EAAW,IAAIC,GAAiB7T,EAAI8T,QAAS9T,EAAI+T,iBAAiBC,gBAAgBC,gBACxFL,EAASM,WAAWL,GAAiBM,gCAAgCV,IAErE,MAAMW,EAAc1qB,EAAK2qB,QAAQ/S,KAAK7P,IACpC,GAAIA,EAAQ,GAAKA,EAAQ/H,EAAKU,SAAS6F,OAAS,EAC9C,KAAO,wBAAuBwB,IAEhC,OAAOA,CAAK,IAGR4iB,EAAU,IAAIC,GAActU,EAAI8T,SAGtC,IAAIS,EAsCAC,EApCJ,GAJAH,EAAQH,WAAWI,GAAcG,8BAA8BL,IAI3DZ,EAAgB,CAClB,MAAMkB,EAAqB,GAE3B,IAAK,IAAItuB,EAAI,EAAGA,EAAIsD,EAAKU,SAAS6F,OAAQ7J,IACxCsuB,EAAWtuB,GAAKuuB,GAAKjtB,SAGvB,IAAK,IAAItB,EAAI,EAAGA,EAAIguB,EAAYnkB,OAAQ7J,GAAK,EAAG,CAC9C,MAAMwuB,EAASR,EAAYhuB,EAAI,GACzByuB,EAAST,EAAYhuB,EAAI,GACzB0uB,EAASV,EAAYhuB,EAAI,GAEzB2uB,EAAOJ,GAAKnS,cAAc9Y,EAAKU,SAASwqB,IACxCI,EAAOL,GAAKnS,cAAc9Y,EAAKU,SAASyqB,IACxCI,EAAON,GAAKnS,cAAc9Y,EAAKU,SAAS0qB,IAExCI,EAASP,GAAKhmB,IAAIgmB,GAAKjtB,SAAUstB,EAAMD,GACvCI,EAASR,GAAKhmB,IAAIgmB,GAAKjtB,SAAUutB,EAAMF,GAEvCK,EAAqBT,GAAKpD,MAAMoD,GAAKjtB,SAAUwtB,EAAQC,GAE7DR,GAAKzF,IAAIwF,EAAWE,GAAUF,EAAWE,GAAUQ,GACnDT,GAAKzF,IAAIwF,EAAWG,GAAUH,EAAWG,GAAUO,GACnDT,GAAKzF,IAAIwF,EAAWI,GAAUJ,EAAWI,GAAUM,EACrD,CAEA,IAAK,IAAIhvB,EAAI,EAAGA,EAAIsD,EAAKU,SAAS6F,OAAQ7J,IACxCuuB,GAAKtD,UAAUqD,EAAWtuB,GAAKsuB,EAAWtuB,IAG5CmuB,EAAU,IAAIc,GAAerV,EAAI8T,QAAS9T,EAAI+T,iBAAiBC,gBAAgBsB,cAC/Ef,EAAQL,WAAWmB,GAAelB,gCAChCO,EAAWhB,SAASa,GAAY,CAACA,EAAQ,GAAIA,EAAQ,GAAIA,EAAQ,OAErE,CASA,OALI7qB,EAAK8qB,YACPA,EAAY,IAAIe,GAAqBvV,EAAI8T,QAAS9T,EAAI+T,iBAAiBC,gBAAgBwB,cACvFhB,EAAUN,WAAWqB,GAAqBE,6BAA6B/rB,EAAK8qB,aAGvE,IAAIkB,GAAQ9B,EAAUS,EAASE,EAASC,EACjD,CC1EO,SAASmB,GACd3V,EACApH,EACAgd,EACAC,EACAC,EACAtC,EACAuC,GAMA,MAAMC,EAAU,IAAIC,GAAS,KAAM,WAAard,EAAMjS,MACtDqvB,EAAQ/P,UAAUrN,EAAMlO,QAAUwrB,GAAOtd,EAAMjO,QAAUurB,GAAOtd,EAAMhO,QAAUsrB,IAEhF,MAAMC,EAAwB,GAE9B,IAAK,MAAMC,KAAaxd,EAAMtO,WAAY,CACxC,MAAM+rB,EAAQC,GACZtW,EACApH,EAAMxO,SACNgsB,EACAN,EACAtC,EACAuC,GAGY,OAAVM,IAIAN,GAAeQ,GAAMC,oBAAoBJ,EAAUpqB,cACrDqqB,EAAMI,cAAcL,EAAUpqB,aAGhCmqB,EAAW1rB,KAAK4rB,GAClB,CAEA,MAAMK,EAAe,IAAIT,GAASE,EAAYvd,EAAMjS,MACpDqvB,EAAQW,SAASD,GACjBb,EAAqBpS,IAAI7K,EAAO8d,GAEhC,IAAK,MAAME,KAAYhe,EAAMpO,SAC3BmrB,GACE3V,EACA4W,EACAF,EACAb,EACAC,EACAtC,EACAuC,GAIJH,EAAOe,SAASX,EAClB,CAEA,SAASM,GACPtW,EACA5V,EACAgsB,EACAN,EACAtC,EACAuC,GAGA,MAAMc,EAAgCT,EAAUxqB,cAAc0V,KAAK7P,IACjE,MAAMqlB,EAAa1sB,EAASqH,GAC5B,MAAO,CACLqlB,EAAWvrB,EAAI2qB,GACfY,EAAWtrB,EAAI0qB,GACfY,EAAWrrB,EAAIyqB,GAChB,IAGH,GAAuC,IAAnCE,EAAUxqB,cAAcqE,OAAc,CASxC,OAAO8mB,GAAexD,+BAA+BvT,EAAK,CACxD5V,SAAUysB,EACVxC,QAAS,CAAC,EAAG,EAAG,GAChBG,UAXgBuB,EACd,CACA,EAAG,EACH,EAAG,EACH,EAAG,GAEH,MAMDvC,EACL,CAEA,GAAuC,IAAnC4C,EAAUxqB,cAAcqE,OAAc,CAWxC,OAAO8mB,GAAexD,+BAA+BvT,EAAK,CACxD5V,SAAUysB,EACVxC,QAASyB,EACL,CACA,EAAG,EAAG,EACN,EAAG,EAAG,GAEN,CAAC,EAAG,EAAG,EAAG,GACdtB,UAjBgBuB,GAAeD,EAC7B,CACA,EAAG,EACH,EAAG,EACH,EAAG,EACH,EAAG,GAEH,MAWDtC,EACL,CAEA,OAAO,IACT,C,s8JClCA,SAASwD,GAAeC,GACtB,MAAMrtB,EAAyB,IAAIstB,IAE7BC,EAAQ/f,IACZxN,EAAO6Z,IAAIrM,EAAM,CACfggB,WAAW,EACXC,MAAM,IAGR,IAAK,MAAMze,KAASxB,EAAK5M,SACvB2sB,EAAKve,EACP,EAGF,IAAK,MAAM0e,KAAaL,EAAc1qB,UACpC4qB,EAAKG,GAGP,OAAO1tB,CACT,CAyHA,SAAS2tB,GAAmBC,GAE1B,OAD0B1wB,OAAO2wB,OAAOD,GAAUpkB,OAAO/L,GAAoB,OAAVA,IACxC,iBAAc6B,CAC3C,CAEA,SAASwuB,GAAoBC,GAC3B,MAAMC,EAAiC,iBAAfD,EACpBA,EAAWtb,QAAQ,YAAa,IAChCsb,EAAWhxB,KAEf,OAAIixB,EAASC,WAAW,OAAe,EACnCD,EAASC,WAAW,OAAe,EACnCD,EAASC,WAAW,OAAe,EACnCD,EAASC,WAAW,OAAe,EACnCD,EAASC,WAAW,OAAe,OAAvC,CAGF,C,igLClPO,MAAMC,GAAsC,CACjDpvB,gBAAiB,QACjBqvB,aAAc,IACdC,wBAAyB,UACzBC,wBAAyB,UACzBppB,uBAAuB,GCNZqpB,GAAuC,CAClDC,KAAO9vB,IACL,MAAM2mB,EAAMhe,KAAKonB,UAAU/vB,GAC3BgwB,aAAaC,QAAQ,OAAQtJ,EAAI,EAEnCuJ,KAAM,KACJ,MAAMvJ,EAAMqJ,aAAaG,QAAQ,QAEjC,GAAY,OAARxJ,EACF,OAGF,MAAM9X,EAAMlG,KAAKC,MAAM+d,GAEvB,GAAmB,iBAAR9X,EACT,MAAM,IAAIuhB,MAAO,kCAGnB,MAAM/vB,EAAkBwO,EAAqB,gBAE7C,GAAwB,SAApBxO,GAAkD,UAApBA,EAChC,MAAM,IAAI+vB,MAAO,2BAGnB,MAAMV,EAAe7gB,EAAkB,aAEvC,GAA4B,iBAAjB6gB,EACT,MAAM,IAAIU,MAAO,wBAGnB,MAAMT,EAA0B9gB,EAA6B,wBAE7D,GAAgC,YAA5B8gB,GAAqE,WAA5BA,EAC3C,MAAM,IAAIS,MAAO,mCAGnB,MAAMR,EAA0B/gB,EAA6B,wBAE7D,GAAgC,YAA5B+gB,GAAqE,WAA5BA,EAC3C,MAAM,IAAIQ,MAAO,mCAGnB,IAAI5pB,EAAwBqI,EAA2B,sBAMvD,MAJqC,kBAA1BrI,IACTA,EAAwBipB,GAAsBjpB,uBAGzC,CACLnG,kBACAqvB,eACAC,0BACAC,0BACAppB,wBACD,GC9BQ6pB,GAAwC,CACnDxpB,UAAW,GACXC,WAAY,IACZC,UAAW,EACXC,aAAc,EACdC,aAAc,EACdL,KAAM,IACNP,SAAU,UACViqB,UAAW,CAAC,EAAK,EAAK,EAAK,GAC3BC,iBAAkB,QAClBC,qBAAsB,OACtBC,uBAAwB,SAExBlX,uBAAuB,EACvBH,aAAc,EACdC,iBAAkB,SAClBC,iBAAkB,SAElBoX,0BAA0B,EAC1BC,WAAY,CAAC,EAAK,EAAK,EAAK,GAE5BhiB,eAAgB,CAAC,EAAK,EAAK,EAAK,IClBnBiiB,OA3BV,EAAGC,QAAO1uB,WAAU2uB,oBACvB,MAAOC,EAAMC,GAAW9rB,aAAS4rB,YAE3BG,EAAUF,EACd,wBAAM5uB,GACJ,KAEE+uB,EACJ,uBACErY,QAAS,IAAMmY,GAASD,IAEvBA,EAAO,SAAW,UAIvB,OACE,wBACE,oBAAK7wB,MAAM,kCACT,yBAAO2wB,GACNK,GAGFD,EACG,ECxBV,MAAME,GAAiD,CACrD,cACA,cACA,cACA,cACA,cACA,cACA,cACA,cACA,eACA,cACA,eACAlY,KAAK3a,IAAI,CACTA,OACA8yB,KAAM,sBAAwB9yB,MAG1B+yB,GAAa,yDAEbC,GAAkB,iFAiITC,OAxHV,EAAGC,WAAUC,sBAAqBC,6BACrC,MAAMC,EAAetsB,cAAQ,IAC3B,oBAAKnF,MAAM,WACT,mBAAIA,MAAM,uBAAsB,aAChC,sBAAG,sBAAG,sBAAsB,uCAC5B,sBAAG,sBAAG,wBAAwB,qCAC9B,sBAAG,sBAAG,gBAAgB,sBAEvB,IAEG0xB,EAAWvsB,cAAQ,IACvB,oBAAKnF,MAAM,WACT,mBAAIA,MAAM,uBAAsB,UAEhC,sBAAG,sCAAmC,kBAAGA,MApB7B,qFAoB+C2xB,KAAMR,GAAY3K,OAAO,UAAU2K,KAC9F,sBAAG,0CAEJ,IAEGS,EAAUzsB,cAAQ,IACtB,qBACEnF,MAAM,2DACNsxB,SAAWjxB,IACTA,EAAGwxB,iBACH,MACMC,EADW,IAAIC,SAAS1xB,EAAGC,eACX5B,IAAI,QAEtBozB,GAAQA,EAAKxvB,MAAQwvB,EAAK1zB,MAC5BkzB,EAASQ,EACX,GAGF,oBAAK9xB,MAAM,6BAA4B,YACvC,oBAAKA,MAAM,8BAA6B,sBACxC,oBAAKgyB,UAAU,gCACb,sBAAO5zB,KAAK,OAAO+F,KAAK,OAAOnE,MAAM,gCACrC,uBAAQA,MAAOoxB,GAAiBjtB,KAAK,UAAS,SAGjD,CAACmtB,IAEEW,EAAU9sB,cAAQ,IACtB,qBACEnF,MAAM,2DACNsxB,SAAWjxB,IAAO,MAChBA,EAAGwxB,iBACH,MACMK,EAA+B,QAAzB,EADK,IAAIH,SAAS1xB,EAAGC,eACT5B,IAAI,iBAAS,aAAtB,EAAwByzB,WAAWC,OAE9CF,GACFZ,EAASY,EACX,GAGF,oBAAKlyB,MAAM,6BAA4B,YACvC,oBAAKA,MAAM,8BAA6B,sBACxC,oBAAKgyB,UAAU,gCACb,uBAAQ5zB,KAAK,SAAS4B,MAAM,+BAC1B,uBAAQlB,MAAM,KACbmyB,GAAQlY,KAAI,CAACmZ,EAAQlZ,IACpB,uBAAQla,MAAOozB,EAAOhB,KAAM9xB,IAAK4Z,GAAMkZ,EAAO9zB,SAGlD,uBAAQ4B,MAAOoxB,GAAiBjtB,KAAK,UAAS,SAGjD,CAACmtB,IAEEe,EAAWltB,cAAQ,IACvB,aAAC,GAAO,CAACwrB,MAAM,YACb,oBAAK3wB,MAAM,aACT,wBACE,sBAAOA,MAAM,qBACX,sBACEmE,KAAK,WACLwS,QAAS4a,EAAoBjrB,sBAC7BlG,SAAWC,IACTmxB,EAAuB,EAAD,KACjBD,GAAmB,IACtBjrB,sBAAuBjG,EAAGC,cAAcqW,UACxC,IAGN,qBAAM3W,MAAM,kBAAiB,oCAE/B,qBAAMA,MAAM,yBACR,uOAOT,CAACuxB,EAAqBC,IAEzB,OACE,oBAAKxxB,MAAM,mFACT,oBACEsO,MAAO,CAAEgkB,SAAU,KACnBtyB,MAAM,8EAGN,oBAAKA,MAAM,gCACT,oBAAKA,MAAM,aAAasO,MAAO,CAAEikB,SAAU,MAAQd,GACnD,oBAAKzxB,MAAM,aAAasO,MAAO,CAAEikB,SAAU,MAAQb,IAGrD,oBAAK1xB,MAAM,gCACT,oBAAKA,MAAM,cAAc4xB,GACzB,oBAAK5xB,MAAM,cAAciyB,IAG3B,oBAAKjyB,MAAM,oBACRqyB,IAGD,E,aCrIH,MAAMG,GAAmE,CAC9EC,WAAY,EACZ3Z,QAAStG,MAAMkgB,KAAK,CAAEhrB,OAAQ,KAAMqR,KAAI,CAAC4Z,EAAG3Z,IAAQA,IACpD4Z,SAAU,GACVC,UAAY7Z,GAAQA,EAAImZ,WACxBlZ,eAAiBD,GAAQ8Z,GAAW9Z,GACpC+Z,mBAAqBC,GAAeA,EAAWjf,cAAckf,SAAS,QACtEC,gBAAiB,CAACla,EAAKga,IACT,IAARha,EACKga,EAED,GAAEA,WAAoBha,IAEhCma,qBAAsB,CAACna,EAAKqW,IACd,IAARrW,EACKqW,EAGD,GAAEA,KAAYrW,KAIpB8Z,GAA2C,CAC/C,EAAG,YACH,EAAG,MACH,EAAG,QACH,EAAG,QACH,EAAG,WACH,EAAG,SACH,EAAG,SACH,EAAG,QACH,EAAG,SACH,EAAG,SC5BQ9E,GAAQ,CACnBoF,sBAtBF,SAA+BC,EAAWC,GACxC,MAAMC,EAAWh1B,OAAOi1B,QAAQH,GAC1BI,EAAWl1B,OAAOm1B,KAAKJ,GAE7B,OAAOC,EAAS7rB,SAAW+rB,EAAS/rB,QAAU6rB,EAAS1oB,OAAM,EAAE8oB,EAAMC,KAC5DD,KAAQL,GAAQA,EAAKK,KAAUC,GAE1C,EAgBEC,iBAdF,SAAgC9a,EAAgB3Z,EAAQN,GACtD,MAAMg1B,EAAS,IAAInF,IAAI5V,GAEvB,OADA+a,EAAO5Y,IAAI9b,EAAKN,GACTg1B,CACT,EAWE7F,oBATF,SAA6BxqB,GAE3B,MAAO,0FACJgQ,KAAKhQ,EACV,GCEO,MAAeswB,GAKpBrkB,YAAYskB,GAAsB,uFAChCxzB,KAAKwzB,OAASA,CAChB,CAEUC,cACR,MAAM,SAAEC,EAAQ,OAAEC,EAAM,KAAEn1B,GAASwB,KAAKwzB,OAIxC,IAAII,EACAC,EACAC,EACAC,EACAC,EACAC,GAAY,EAEhB,MAAMC,EAAer0B,IACnB,QAAoBM,IAAhByzB,EAAJ,CAKA,GAAkB,IAAd/zB,EAAGs0B,OACLP,EAAc,aAEX,IAAkB,IAAd/zB,EAAGs0B,OAKV,OAJAP,EAAc,KAKhB,CAEAC,EAAch0B,EAAGu0B,QACjBN,EAAcj0B,EAAGw0B,QAEjBN,EAAgC,WAAhBH,EACZ5zB,KAAKwzB,OAAOpuB,cAAce,UAC1BnG,KAAKwzB,OAAOpuB,cAAckB,aAE9B0tB,EAAgC,WAAhBJ,EACZ5zB,KAAKwzB,OAAOpuB,cAAcgB,UAC1BpG,KAAKwzB,OAAOpuB,cAAcmB,YAtB9B,CAsB0C,EAGtC+tB,EAAez0B,IACnB,QAAoBM,IAAhB0zB,QAA6C1zB,IAAhB2zB,QAA+C3zB,IAAlB4zB,QACxC5zB,IAAlB6zB,EAEF,OAGF,MAAMO,EAASxvB,KAAKgjB,MAAmC,KAA5BloB,EAAGu0B,QAAUP,IAClCW,EAASzvB,KAAKgjB,MAAmC,KAA5BloB,EAAGw0B,QAAUP,IAExC,GAAe,IAAXS,GAA2B,IAAXC,EAApB,CAIA,GAAe,IAAXD,EACF,GAAoB,WAAhBX,EAA0B,CAC5B,IAAIa,EAAcT,EAAgBO,EAClC,KAAOE,EAAc,KACnBA,GAAe,IAEjB,KAAOA,GAAe,KACpBA,GAAe,IAGjBz0B,KAAKwzB,OAAOpuB,cAAcgB,UAAYquB,CACxC,MACEz0B,KAAKwzB,OAAOpuB,cAAckB,aAAeytB,EAAgBQ,EAI7D,GAAe,IAAXC,EACF,GAAoB,WAAhBZ,EAA0B,CAC5B,IAAIa,EAAcV,EAAgBS,EAClC,KAAOC,EAAc,KACnBA,GAAe,IAEjB,KAAOA,GAAe,KACpBA,GAAe,IAGjBz0B,KAAKwzB,OAAOpuB,cAAce,UAAYsuB,CACxC,MACEz0B,KAAKwzB,OAAOpuB,cAAcmB,aAAeytB,EAAgBQ,EAI7DP,GAAY,EAEC,WAATz1B,GACFwB,KAAK2G,QArCP,CAsCA,EAGI+tB,EAAY,KAChBd,EAAcC,EAAcC,EAAcC,EAAgBC,OAAgB7zB,EAEtE8zB,IACFP,EAASiB,uBAAuB,KAAK30B,KAAKwzB,OAAOpuB,gBACjD6uB,GAAY,EACd,EAGIW,EAAqB,KACQ,WAA7BptB,SAASqtB,iBACXH,GACF,EAGII,EAAWj1B,IACG,IAAdA,EAAG20B,SAGPx0B,KAAKwzB,OAAOpuB,cAAcc,MAAQrG,EAAG20B,OAEZ,WAArBx0B,KAAKwzB,OAAOh1B,MACdwB,KAAK2G,SAGP+sB,EAASiB,uBAAuB,KAAK30B,KAAKwzB,OAAOpuB,gBAAgB,EAGnEuuB,EAAOngB,iBAAiB,YAAa0gB,GACrCP,EAAOngB,iBAAiB,YAAa8gB,GACrCS,OAAOvhB,iBAAiB,UAAWkhB,GACnCltB,SAASgM,iBAAiB,mBAAoBohB,GAC9CjB,EAAOngB,iBAAiB,QAASshB,GAEjC90B,KAAKg1B,cAAgB,KACnBrB,EAAOhgB,oBAAoB,YAAaugB,GACxCP,EAAOhgB,oBAAoB,YAAa2gB,GACxCS,OAAOphB,oBAAoB,UAAW+gB,GACtCltB,SAASmM,oBAAoB,mBAAoBihB,GACjDjB,EAAOhgB,oBAAoB,QAASmhB,EAAQ,EAK9C,MAAMG,EAAY,KAChB,MAAMC,EAAevB,EAAOwB,cAE5B,IAAKD,EACH,MAAM,IAAIxF,MAAO,0BAGnB,MAAM0F,EAAWF,EAAaG,YACxBC,EAAYJ,EAAaK,aAE/B,IAAIC,GAAY,EAYhB,OAVI7B,EAAO5lB,QAAUqnB,IACnBzB,EAAO5lB,MAAQqnB,EACfI,GAAY,GAGV7B,EAAO8B,SAAWH,IACpB3B,EAAO8B,OAASH,EAChBE,GAAY,KAGVA,IACFx1B,KAAKi1B,aACE,EAGG,EAGdj1B,KAAK01B,eAAiB,IAAIC,eAAeV,GACzC,MAAMC,EAAevB,EAAOwB,cAE5B,IAAKD,EAEH,MADAH,OAAOa,MAAM,2BACP,IAAIlG,MAAO,wDAGnB1vB,KAAK01B,eAAeG,QAAQX,GAGvBD,KACHj1B,KAAKi1B,WAET,CAEA5vB,iBAAiBD,GACfpF,KAAKwzB,OAAOpuB,cAAgBA,EAEH,WAArBpF,KAAKwzB,OAAOh1B,MACdwB,KAAK2G,QAET,CAEAmvB,kBAAkBC,GAChB/1B,KAAKwzB,OAAOuC,eAAiBA,EAEJ,WAArB/1B,KAAKwzB,OAAOh1B,MACdwB,KAAK2G,QAET,CAEAqvB,kBAAkBC,GAChBj2B,KAAKwzB,OAAOyC,YAAcA,EAED,WAArBj2B,KAAKwzB,OAAOh1B,MACdwB,KAAK2G,QAET,CAEAuvB,UAAU,MACJl2B,KAAK01B,gBACP11B,KAAK01B,eAAeS,aAGJ,QAAlB,EAAAn2B,KAAKg1B,qBAAa,OAAlB,OAAAh1B,KAEF,CAOc+N,YACZ,OAAO/N,KAAKwzB,OAAOG,OAAO5lB,KAC5B,CAEc0nB,aACZ,OAAOz1B,KAAKwzB,OAAOG,OAAO8B,MAC5B,EChQK,MAAMW,WAAsB7C,GAIjCrkB,YAAYskB,GACV6C,MAAM7C,GAAQ,0CAHM,GAKpB,MAAMvc,EAAMuc,EAAOG,OAAO2C,WAAW,MAErC,GAAY,OAARrf,EAEF,MADA8d,OAAOa,MAAM,yCACP,IAAIlG,MAAO,4BAGnB1vB,KAAKiX,IAAMA,EACXjX,KAAKyzB,aACP,CAEUwB,YACRj1B,KAAK2G,QACP,CAEUA,SACR,MAAM,cAAEvB,GAAkBpF,KAAKwzB,OAE/B+C,QAAQC,IAAK,wBAAuBx2B,KAAKy2B,gBACzC,MAAMC,EAAYC,YAAYC,MAExBC,EAAY72B,KAAK+N,MACjB+oB,EAAa92B,KAAKy1B,OAIxBz1B,KAAKiX,IAAI8f,UAAa,iBACtB/2B,KAAKiX,IAAI+f,SAAS,EAAG,EAAGH,EAAWC,GAEnC92B,KAAKiX,IAAIggB,YAAe,iBACxBj3B,KAAKiX,IAAIigB,UAAY,EACrBl3B,KAAKiX,IAAIkgB,YACTn3B,KAAKiX,IAAImgB,OAAO,EAAGN,EAAa,GAChC92B,KAAKiX,IAAIogB,OAAOR,EAAWC,EAAa,GACxC92B,KAAKiX,IAAIqgB,SACTt3B,KAAKiX,IAAImgB,OAAOP,EAAY,EAAG,GAC/B72B,KAAKiX,IAAIogB,OAAOR,EAAY,EAAGC,GAC/B92B,KAAKiX,IAAIqgB,SAET,MAAMC,EAAY,CACf,gBAAev3B,KAAKy2B,cACpB,cAAaI,IACb,eAAcC,IACd,SAAQ1xB,EAAcc,OACtB,cAAad,EAAce,YAC3B,cAAaf,EAAcgB,YAC3B,cAAahB,EAAciB,YAC3B,iBAAgBjB,EAAckB,eAC9B,iBAAgBlB,EAAcmB,eAC9B,aAAYnB,EAAcO,YAO7B3F,KAAKiX,IAAIugB,UAAY,OACrBx3B,KAAKiX,IAAIwgB,aAAe,SACxBz3B,KAAKiX,IAAI8f,UAAY,QACrB/2B,KAAKiX,IAAIygB,KAAQ,iBAEjB13B,KAAKiX,IAAIggB,YAAc,MAEvB,MAKMU,EALmB33B,KAAKiX,IAAI2gB,YAEhCL,EAAUM,QAAO,CAACC,EAAIC,IAAOD,EAAG5wB,OAAS6wB,EAAG7wB,OAAS4wB,EAAKC,KAC1DhqB,MAGIiqB,EAjBW,GAiBeT,EAAUrwB,OAhBtB,EAgBiCqwB,EAAUrwB,OAAuB,EAEtF,IAAK,IAAI7J,EAAI,EAAGA,EAAIk6B,EAAUrwB,OAAQ7J,IAAK,CACzC,MAAM46B,EAAaC,GAlBE,MA6BrBl4B,KAAKiX,IAAIkhB,SACPZ,EAAUl6B,GACVw5B,EAAY,EAAIc,EAAa,EAC5Bb,EAAa,EAAMkB,EAAc,GAAM36B,EAAI46B,EAAaA,EAAa,GAE1E,CAEA,MAAMG,EAAUzB,YAAYC,MAE5BL,QAAQC,IAAK,6BADC4B,EAAU1B,OAExB12B,KAAKy2B,aACP,EC7CK,MAAM4B,GAAc,CACzBC,cAzDF,SAAuBC,EAA2BC,EAAsBC,GACtE,MAAMC,EAASH,EAAGI,aAAaF,GAE/B,GAAe,OAAXC,EACF,KAAO,oCAAmCD,KAQ5C,GALAF,EAAGC,aAAaE,EAAQF,GACxBD,EAAGD,cAAcI,IAEDH,EAAGK,mBAAmBF,EAAQH,EAAGM,gBAG/C,KAAO,6BAA4BN,EAAGO,iBAAiBJ,KAGzD,OAAOA,CACT,EAyCEK,cAvCF,SACER,EACAS,EACAC,GAEA,MAAMC,EAAUX,EAAGQ,gBAEnB,GAAgB,OAAZG,EACF,KAAO,2BAQT,GALAX,EAAGY,aAAaD,EAASF,GACzBT,EAAGY,aAAaD,EAASD,GACzBV,EAAGa,YAAYF,IAECX,EAAGc,oBAAoBH,EAASX,EAAGe,aAEjD,KAAO,2BAA0Bf,EAAGgB,kBAAkBL,KAGxD,OAAOA,CACT,EAmBEM,0BAjBF,SAAmC7F,GACjC,MAAM8F,EAAgB9F,EAAO0B,YACvBqE,EAAgB/F,EAAO4B,aAEvBoE,EAAahG,EAAO5lB,QAAU0rB,GAAgB9F,EAAO8B,SAAWiE,EAOtE,OALIC,IACFhG,EAAO5lB,MAAQ0rB,EACf9F,EAAO8B,OAASiE,GAGXC,CACT,GhBnDO,IAAIvgB,GAAU,KACVL,GAAqC,oBAAjBO,aAA+BA,aAAetH,MAClE4nB,GAAS70B,KAAKokB,OAUrBlQ,GAASlU,KAAKgf,GAAK,IAuBlBhf,KAAK6Y,QAAO7Y,KAAK6Y,MAAQ,WAI5B,IAHA,IAAInb,EAAI,EACJpF,EAAIsR,UAAUzH,OAEX7J,KACLoF,GAAKkM,UAAUtR,GAAKsR,UAAUtR,GAGhC,OAAO0H,KAAKsc,KAAK5e,EACnB,GC80CO,IC3oBDo3B,GD2oBKC,GAAczW,EA2Hd0W,GAAQvV,EAqXRwV,GAAMnd,EAMNjX,GAAMwgB,GCprCNxgB,GAAMwgB,GAMN4T,GAAMnd,GAMNod,GAAMpS,GAMNqS,GAAOjS,GAMPkS,GAAUjS,GAMVvK,GAAMzW,GAMNkzB,GAASjS,GAcT5d,IACLsvB,GAAMl7B,KACH,SAAU4R,EAAG8pB,EAAQz5B,EAAQyB,EAAOi4B,EAAIxtB,GAC7C,IAAIzP,EAAGC,EAgBP,IAdK+8B,IACHA,EAAS,GAGNz5B,IACHA,EAAS,GAITtD,EADE+E,EACE0C,KAAKF,IAAIxC,EAAQg4B,EAASz5B,EAAQ2P,EAAErJ,QAEpCqJ,EAAErJ,OAGH7J,EAAIuD,EAAQvD,EAAIC,EAAGD,GAAKg9B,EAC3BR,GAAI,GAAKtpB,EAAElT,GACXw8B,GAAI,GAAKtpB,EAAElT,EAAI,GACfw8B,GAAI,GAAKtpB,EAAElT,EAAI,GACfi9B,EAAGT,GAAKA,GAAK/sB,GACbyD,EAAElT,GAAKw8B,GAAI,GACXtpB,EAAElT,EAAI,GAAKw8B,GAAI,GACftpB,EAAElT,EAAI,GAAKw8B,GAAI,GAGjB,OAAOtpB,CACT,GCjxBK,MAAMgqB,GAMXrrB,YAAYqpB,GAA2B,iEAHrB,GAAK,cACV,GAGXv4B,KAAKu4B,GAAKA,EACV,MAAMiC,EAASjC,EAAGkC,gBAElB,GAAe,OAAXD,EACF,MAAM,IAAI9K,MAAO,6BAGnB1vB,KAAKw6B,OAASA,CAChB,CAEAE,IAAIC,EAA+BC,EAAmBC,GACpD,GAAI76B,KAAK86B,QACP,KAAO,yDAGT,QAAK96B,KAAK+6B,KAIV/6B,KAAKu4B,GAAGyC,cAAch7B,KAAKu4B,GAAG0C,UAC9Bj7B,KAAKu4B,GAAG2C,YAAYl7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKw6B,QAC7Cx6B,KAAKu4B,GAAG6C,UAAUT,EAAS,GAE3B36B,KAAKu4B,GAAG8C,cAAcr7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKu4B,GAAG+C,mBAAoBV,GACtE56B,KAAKu4B,GAAG8C,cAAcr7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKu4B,GAAGgD,mBAAoBV,IAE/D,EACT,CAEAW,mBAAmBztB,EAAe0nB,EAAgB90B,GAChD,GAAIX,KAAK86B,QACP,KAAO,yDAGT,MACMW,EAAiBz7B,KAAKu4B,GAAGmD,KAEzBC,EAAY37B,KAAKu4B,GAAGmD,KACpBE,EAAU57B,KAAKu4B,GAAGsD,cAExB77B,KAAKu4B,GAAG2C,YAAYl7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKw6B,QAC7Cx6B,KAAKu4B,GAAGuD,WACN97B,KAAKu4B,GAAG4C,WARI,EAUZM,EACA1tB,EACA0nB,EAVa,EAYbkG,EACAC,EACAj7B,GAGFX,KAAK+6B,IAAK,CACZ,CAEAgB,kBAAkBC,GAChB,GAAIh8B,KAAK86B,QACP,KAAO,yDAGT,IAAKkB,EAAMC,UAAmC,IAAvBD,EAAME,aAAoB,CAC/C3F,QAAQjf,MAAO,6DAEf,MAAM6kB,EAAgB,IAAIl6B,WAAW,CAAC,IAAK,IAAK,IAAK,MASrD,OARAjC,KAAKw7B,mBAAmB,EAAG,EAAGW,QAE9BH,EAAMI,OAAS,KACTJ,EAAMC,UAAmC,IAAvBD,EAAME,cAC1Bl8B,KAAK+7B,kBAAkBC,EACzB,EAIJ,CAEA,MACMP,EAAiBz7B,KAAKu4B,GAAGmD,KACzBC,EAAY37B,KAAKu4B,GAAGmD,KACpBE,EAAU57B,KAAKu4B,GAAGsD,cAExB77B,KAAKu4B,GAAG2C,YAAYl7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKw6B,QAC7Cx6B,KAAKu4B,GAAGuD,WACN97B,KAAKu4B,GAAG4C,WAPI,EASZM,EACAE,EACAC,EACAI,GAGEzR,GAAWyR,EAAMjuB,QAAUwc,GAAWyR,EAAMvG,SAC9Cz1B,KAAKu4B,GAAG8D,eAAer8B,KAAKu4B,GAAG4C,YAGjCn7B,KAAKu4B,GAAG8C,cAAcr7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKu4B,GAAG+D,eAAgBt8B,KAAKu4B,GAAGgE,eAC1Ev8B,KAAKu4B,GAAG8C,cAAcr7B,KAAKu4B,GAAG4C,WAAYn7B,KAAKu4B,GAAGiE,eAAgBx8B,KAAKu4B,GAAGgE,eAE1Ev8B,KAAK+6B,IAAK,CACZ,CAEA0B,SACEz8B,KAAKu4B,GAAGmE,cAAc18B,KAAKw6B,QAC3Bx6B,KAAK86B,SAAU,CACjB,EczGK,MAAM6B,GAcXztB,YACEqpB,EACAqE,EACAt3B,GACA,yIAZ0D,CAAC,GAAC,wDAGtB,IAAIgU,aAAa,CAAC,EAAK,EAAK,EAAK,KAAK,sEAU5EtZ,KAAKu4B,GAAKA,EACVv4B,KAAK48B,YAAcA,EACnB58B,KAAKsF,SAAWA,EAEhBtF,KAAK68B,eAAiBv3B,EAAS2sB,WAE/BjyB,KAAK88B,iBAAmBvE,EAAGwE,QAC3B/8B,KAAKg9B,iBAAmBzE,EAAGwE,OAC7B,CAGAhS,QACE,OAAO/qB,KAAKu4B,EACd,CAEAvN,iBACE,OAAOhrB,KAAK48B,WACd,CAEAK,qBACE,OAAOj9B,KAAKk9B,eACd,CAEAC,mBAAmB/4B,GACjBpE,KAAKk9B,gBAAkB94B,CACzB,CAEAg5B,kBAAkBC,EAAiBC,GACjC,MAAM/0B,EAAWvI,KAAK48B,YAAYW,iBAAiBF,GAE/C90B,GACFvI,KAAKu4B,GAAGiF,iBAAiBj1B,GAAU,EAAO+0B,EAE9C,CAEAG,iBAAiBJ,EAAiB18B,GAChC,GAAoB,IAAhBA,EAAKuG,OACP,MAAM,IAAIwoB,MAAO,yBAAwB/uB,EAAKuG,UAGhD,MAAMqB,EAAWvI,KAAK48B,YAAYW,iBAAiBF,GAE/C90B,GACFvI,KAAKu4B,GAAGmF,WAAWn1B,EAAU5H,EAEjC,CAEAg9B,eAAeN,EAAiBO,GAC9B,MAAMr1B,EAAWvI,KAAK48B,YAAYW,iBAAiBF,GAE/C90B,GACFvI,KAAKu4B,GAAG6C,UAAU7yB,EAAUq1B,EAAO,EAAI,EAE3C,CAEAC,oBAAoBzzB,GAClBpK,KAAK88B,iBAAmB1yB,CAC1B,CAEA0zB,oBAAoB1zB,GAClBpK,KAAKg9B,iBAAmB5yB,CAC1B,CAEA2zB,aAAa72B,GACXlH,KAAKu4B,GAAGwF,aAAa/9B,KAAKu4B,GAAGyF,UAAW92B,EAAQlH,KAAKu4B,GAAG0F,eAAgB,EAC1E,CAEAC,WAAW1L,GACT,IAAI2L,EAEJ,GAAmB,OAAf3L,EACF2L,EAAU,SAEP,CACH,MAAMC,EAAmBp+B,KAAKsF,SAASitB,mBAAmBC,GACtDxyB,KAAKsF,SAASotB,gBAAgB1yB,KAAK68B,eAAgBrK,GACnDA,EAEE6L,EAASr+B,KAAKs+B,gBAAgBF,QAErBj+B,IAAXk+B,GACF9H,QAAQjf,MAAO,wBAAuB8mB,KACtCD,EAAU,MAGVA,EAAUE,CAEd,CAEA,OAAIr+B,KAAKu+B,cAAgBJ,EAEJ,OAAZA,GAGTn+B,KAAKu+B,YAAcJ,EAEH,OAAZA,IAKJA,EAAQzD,IAAI16B,KAAK48B,YAAYW,iBAA0B,QAAIv9B,KAAK88B,iBAAkB98B,KAAKg9B,mBAChF,GACT,CAEAwB,qBAAqBzI,GACnB,IAAK,MAAOn3B,EAAKN,KAAUP,OAAOi1B,QAAQ+C,GAAiB,CACzD,MAAM0I,EAAWz+B,KAAKs+B,gBAAgB1/B,GACpB6/B,IAAangC,IAM3BmgC,SACFA,EAAShC,SAGXz8B,KAAKs+B,gBAAgB1/B,GAAiB,OAAVN,EACxB,KACA0B,KAAK0+B,aAAapgC,GACxB,CACF,CAEAqgC,kBAAkBnmB,GAChBxY,KAAK68B,eAAiBrkB,CACxB,CAEQkmB,aAAaE,GACnB,MAAMT,EAAU,IAAI5D,GAAUv6B,KAAKu4B,IAEnC,GAA6B,SAAzBqG,EAAgBj7B,KAClBw6B,EAAQpC,kBAAkB6C,EAAgB5C,WAEvC,CACH,MAAM,MAAEjuB,EAAK,OAAE0nB,EAAM,KAAE90B,GAASi+B,EAChCT,EAAQ3C,mBAAmBztB,EAAO0nB,EAAQ90B,EAC5C,CAEA,OAAOw9B,CACT,EChKK,MAAMU,WAAwBlC,GAGnCztB,YACEqpB,EACAqE,EACAt3B,EACAK,GAEA0wB,MAAMkC,EAAIqE,EAAat3B,GAAU,2BACjCtF,KAAK2F,SAAWA,CAClB,CAESo4B,aAAa72B,GAElBlH,KAAKu4B,GAAGwF,aADY,cAAlB/9B,KAAK2F,SACc3F,KAAKu4B,GAAGuG,UAGR9+B,KAAKu4B,GAAGyF,UAHW92B,EAAQlH,KAAKu4B,GAAG0F,eAAgB,EAK5E,CAESC,WAAW1L,GAClB,MAAsB,YAAlBxyB,KAAK2F,UACA0wB,MAAM6H,WAAW1L,EAG5B,EC1BF,MAAMuM,GAAY,IAAIzlB,aAAa,CAAC,EAAK,EAAK,EAAK,IAQ5C,MAAM4T,GAWXhe,YAAYoe,EAAmC1vB,GAAe,8MAC5DoC,KAAKstB,MAAQA,EACbttB,KAAKpC,KAAOA,UAAQ,KAEpBoC,KAAKyB,SAAW,GAChBzB,KAAK6sB,OAAS,KACd7sB,KAAKg/B,gBAAkBC,GAAKtgC,SAC5BqB,KAAKk/B,wBAA0BD,GAAKtgC,SAEpCqB,KAAKm/B,aAAe,CAClBC,UAAU,EACVC,aAAa,EAEjB,CAEAzR,SAAS/d,GACP,GAAqB,OAAjBA,EAAMgd,OACR,MAAM,IAAI6C,MAAO,gDAGnB1vB,KAAKyB,SAASC,KAAKmO,GACnBA,EAAMgd,OAAS7sB,IACjB,CAEA2G,OAAOsQ,GAELjX,KAAKs/B,oBAAoBL,GAAKtgC,UAC9BqB,KAAKu/B,YAAYtoB,EACnB,CAEUqoB,oBAAoBE,GAC5Bx/B,KAAKk/B,wBAA0BD,GAAKjF,IAAIiF,GAAKtgC,SAAU6gC,EAAkBx/B,KAAKg/B,iBAE9E,IAAK,MAAMnvB,KAAS7P,KAAKyB,SACvBoO,EAAMyvB,oBAAoBt/B,KAAKk/B,wBAEnC,CAEUK,YAAYtoB,GAAgB,MACpC,MAAMwoB,EAAsB,QAAb,EAAGz/B,KAAKoE,aAAK,QAAI6S,EAAIgmB,qBAEpC,GAAmB,OAAfj9B,KAAKstB,OAAkBttB,KAAKm/B,aAAaC,SAI3C,GAHAnoB,EAAIwmB,iBAAiB,cAAegC,GACpCxoB,EAAImmB,kBAAkB,kBAAmBp9B,KAAKk/B,yBAE1CltB,MAAMC,QAAQjS,KAAKstB,OACrB,IAAK,MAAMoS,KAAY1/B,KAAKstB,MAC1BttB,KAAK2/B,YAAY1oB,EAAKyoB,QAIxB1/B,KAAK2/B,YAAY1oB,EAAKjX,KAAKstB,OAI/B,IAAK,MAAMzd,KAAS7P,KAAKyB,SACvBoO,EAAM0vB,YAAYtoB,EAEtB,CAEA2oB,UAAUhiC,EAAciiC,GACtB,IAAK,MAAMhwB,KAAS7P,KAAKyB,SAAU,CACjC,GAAIoO,EAAMjS,OAASA,EACjB,OAAOiS,EAGT,GAAIgwB,EAAW,CACb,MAAMh/B,EAASgP,EAAM+vB,UAAUhiC,EAAMiiC,GACrC,QAAe1/B,IAAXU,EACF,OAAOA,CAEX,CACF,CAGF,CAEA8+B,YAAY1oB,EAAgBqW,GAC1B,GAAIA,EAAMwS,cAAe,CACvB,MAAMC,EAAed,GAAKtgC,SAC1BsgC,GAAK9jB,OAAO4kB,EAAc//B,KAAKk/B,yBAC/BD,GAAKrkB,UAAUmlB,EAAcA,GAC7B9oB,EAAImmB,kBAAkB,eAAgB2C,EACxC,CAEAzS,EAAM0S,KAAK/oB,EACb,CAEAiG,UAAU1a,EAAWC,EAAWC,GAC9Bu8B,GAAK/hB,UAAUld,KAAKg/B,gBAAiBh/B,KAAKg/B,gBAAiB,CAACx8B,EAAGC,EAAGC,GACpE,CAEAya,MAAM3a,EAAWC,EAAWC,GAC1Bu8B,GAAK9hB,MAAMnd,KAAKg/B,gBAAiBh/B,KAAKg/B,gBAAiB,CAACx8B,EAAGC,EAAGC,GAChE,CAEA0a,OAAOC,EAAa7a,EAAYC,EAAYC,GAE1Cu8B,GAAK7hB,OAAOpd,KAAKg/B,gBAAiBh/B,KAAKg/B,gBAAiB3hB,EADlC,CAAC7a,EAAI,EAAI,EAAGC,EAAI,EAAI,EAAGC,EAAI,EAAG,GAEtD,CAEAqb,QAAQV,GACN4hB,GAAKlhB,QAAQ/d,KAAKg/B,gBAAiBh/B,KAAKg/B,gBAAiB3hB,EAC3D,CAEAW,QAAQX,GACN4hB,GAAKjhB,QAAQhe,KAAKg/B,gBAAiBh/B,KAAKg/B,gBAAiB3hB,EAC3D,CAEAY,QAAQZ,GACN4hB,GAAKhhB,QAAQje,KAAKg/B,gBAAiBh/B,KAAKg/B,gBAAiB3hB,EAC3D,CAEA4iB,uBACEjgC,KAAKg/B,gBAAkBC,GAAKtgC,QAC9B,CAEYyF,YACV,GAAIpE,KAAKm/B,aAAaE,YACpB,OAAON,EAIX,CAEAmB,kBACE,OAAOlgC,KAAKm/B,YACd,CAEAgB,gBAAgBhB,GACdn/B,KAAKm/B,aAAeA,CACtB,EC1JK,MAAeiB,GAKpBlxB,YAAYqpB,GAA2B,kEAFrB,GAGhBv4B,KAAKu4B,GAAKA,EAEV,MAAMiC,EAASjC,EAAG8H,eAElB,GAAe,OAAX7F,EACF,KAAO,2BAGTx6B,KAAKsgC,QAAU9F,CACjB,CAEcA,aACZ,OAAOx6B,KAAKsgC,OACd,CAEAnV,WAAWxqB,GACT,GAAIX,KAAK86B,QACP,KAAO,wDAGT96B,KAAKugC,aAAa5/B,EACpB,CAIA+5B,MACE,GAAI16B,KAAK86B,QACP,KAAO,wDAGT96B,KAAKwgC,OACP,CAIA/D,SACE,GAAIz8B,KAAK86B,QACP,KAAO,2DAGT96B,KAAKu4B,GAAGkI,aAAazgC,KAAKsgC,SAC1BtgC,KAAK86B,SAAU,CACjB,EChDK,MAAMvP,WAAsB6U,GAAS,+CACzB,EAAC,CAElBM,YACE,OAAO1gC,KAAKkH,MACd,CAEmBq5B,aAAa5/B,GAC9BX,KAAKkH,OAASvG,EAAKggC,WAAa,EAChC3gC,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAGsI,qBAAsB7gC,KAAKw6B,QACtDx6B,KAAKu4B,GAAGpN,WAAWnrB,KAAKu4B,GAAGsI,qBAAsBlgC,EAAMX,KAAKu4B,GAAGuI,YACjE,CAEmBN,QACjBxgC,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAGsI,qBAAsB7gC,KAAKw6B,OACxD,CAEAuG,qCAAqCzV,GACnC,OAAO,IAAI0V,YAAY1V,EACzB,ECnBK,MAAe2V,WAAsBb,GAG1ClxB,YAAYqpB,EAA2B2I,GACrC7K,MAAMkC,GAAI,iCACVv4B,KAAKkhC,eAAiBA,CACxB,ECNK,MAAM5U,WAAuB2U,GACfV,aAAa5/B,GAC9BX,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAG4I,aAAcnhC,KAAKw6B,QAC9Cx6B,KAAKu4B,GAAGpN,WAAWnrB,KAAKu4B,GAAG4I,aAAcxgC,EAAMX,KAAKu4B,GAAGuI,YACzD,CAEmBN,QACjB,MACM78B,EAAO3D,KAAKu4B,GAAG6I,MAKrBphC,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAG4I,aAAcnhC,KAAKw6B,QAE9Cx6B,KAAKu4B,GAAG8I,oBACNrhC,KAAKkhC,eATe,EAWpBv9B,GATgB,EACH,EACA,GAaf3D,KAAKu4B,GAAG+I,wBAAwBthC,KAAKkhC,eACvC,CAEAH,uCAAuCQ,GAErC,OAAO,IAAIjoB,aAAaioB,EAC1B,EC9BK,MAAMzW,WAAyBmW,GACjBV,aAAa5/B,GAC9BX,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAG4I,aAAcnhC,KAAKw6B,QAC9Cx6B,KAAKu4B,GAAGpN,WAAWnrB,KAAKu4B,GAAG4I,aAAcxgC,EAAMX,KAAKu4B,GAAGuI,YACzD,CAEmBN,QACjB,MACM78B,EAAO3D,KAAKu4B,GAAG6I,MAKrBphC,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAG4I,aAAcnhC,KAAKw6B,QAE9Cx6B,KAAKu4B,GAAG8I,oBACNrhC,KAAKkhC,eATe,EAWpBv9B,GATgB,EACH,EACA,GAaf3D,KAAKu4B,GAAG+I,wBAAwBthC,KAAKkhC,eACvC,CAEAH,uCAAuCQ,GACrC,OAAO,IAAIjoB,aAAaioB,EAC1B,EC7BK,MAAM/U,WAA6ByU,GACrBV,aAAa5/B,GAC9BX,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAG4I,aAAcnhC,KAAKw6B,QAC9Cx6B,KAAKu4B,GAAGpN,WAAWnrB,KAAKu4B,GAAG4I,aAAcxgC,EAAMX,KAAKu4B,GAAGuI,YACzD,CAEmBN,QACjB,MACM78B,EAAO3D,KAAKu4B,GAAG6I,MAKrBphC,KAAKu4B,GAAGqI,WAAW5gC,KAAKu4B,GAAG4I,aAAcnhC,KAAKw6B,QAE9Cx6B,KAAKu4B,GAAG8I,oBACNrhC,KAAKkhC,eATK,EAWVv9B,GATgB,EACH,EACA,GAaf3D,KAAKu4B,GAAG+I,wBAAwBthC,KAAKkhC,eACvC,CAEAH,oCAAoCS,GAClC,OAAO,IAAIloB,aAAakoB,EAC1B,ECzBK,MAAM7U,GAOXzd,YACEuyB,EACAC,EACAC,EACAC,GACA,yJAPkC,MAQlC5hC,KAAKyhC,eAAiBA,EACtBzhC,KAAK0hC,YAAcA,EACnB1hC,KAAK2hC,aAAeA,EACpB3hC,KAAK4hC,oBAAsBA,CAC7B,CAEAlU,cAAc8E,GACZxyB,KAAKwyB,WAAaA,CACpB,CAEAqP,gBACE,OAAO7hC,KAAKwyB,UACd,CAEAsN,cACE,YAA6B3/B,IAAtBH,KAAK2hC,YACd,CAEA3B,KAAK/oB,GACeA,EAAIinB,WAAWl+B,KAAKwyB,cAMtCxyB,KAAKyhC,eAAe/G,MACpB16B,KAAK0hC,YAAYhH,WAESv6B,IAAtBH,KAAK2hC,cACP3hC,KAAK2hC,aAAajH,WAGav6B,IAA7BH,KAAK4hC,qBACP5hC,KAAK4hC,oBAAoBlH,MAG3BzjB,EAAI8mB,aAAa/9B,KAAK0hC,YAAYhB,aACpC,EtBsLK,MAAM1S,GAAiB,CAC5BxD,kCACAsX,6BApJF,SACE7qB,EACAtW,EACA8pB,GAEA,MAAMsX,EAAwB,GACxBC,EAA8B,GAEpCrvB,EAAM,IAAK,IAAItV,EAAI,EAAGA,EAAIsD,EAAKuG,OAAQ7J,IAAK,CAC1C,MAAM4kC,EAAOthC,EAAKtD,GAElB,IAAK,IAAImU,EAAI,EAAGA,EAAIuwB,EAAW76B,OAAQsK,IAAK,CAG1C,IAiBiB0wB,EAjBCD,GAkBZ,MADwBE,EAnBbJ,EAAWvwB,IAoBZ,IACb0wB,EAAG,KAAOC,EAAG,IACbD,EAAG,KAAOC,EAAG,GApBmB,CACjCH,EAAkBtgC,KAAK8P,GACvB,SAASmB,CACX,CACF,CAEAovB,EAAWrgC,KAAKugC,GAChBD,EAAkBtgC,KAAKqgC,EAAW76B,OAAS,EAC7C,CASF,IAAuBg7B,EAAaC,EAPlC,OAAO3X,GAA+BvT,EAAK,CACzC5V,SAAU0gC,EACVzW,QAAS0W,EACTvW,UAAW,MACVhB,EACL,EAwHE2X,SAhHF,SAAkB7J,EAA2BqE,GAC3C,MAEM2E,EAAY,IAAIzW,GAAiByN,EAAIqE,EAAY3R,gBAAgBC,gBACrEqW,EAAUpW,WAAWL,GAAiBM,gCAAgC,EAH3D,sLAuBX,MAAME,EAAU,IAAIC,GAAcgN,GAClCjN,EAAQH,WAAWI,GAAcG,8BAA8B,CAC7D,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,MAGF,MAAMF,EAAU,IAAIc,GAAeiM,EAAIqE,EAAY3R,gBAAgBsB,cACnEf,EAAQL,WAAWmB,GAAelB,gCAAgC,CAEhE,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAGvD,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,GAAM,EAG3D,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAGvD,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,EAG3D,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,GAGtD,EAAK,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,GAAM,EAAK,EAAK,KAG7D,MAAMK,EAAY,IAAIe,GAAqB+L,EAAIqE,EAAY3R,gBAAgBwB,cAC3EhB,EAAUN,WAAWqB,GAAqBE,6BAA6B,CAErE,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAEnC,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,EAAK,KAGrC,MAAM2V,EAAY,IAAI1V,GAAQ4U,EAAWjW,EAASE,EAASC,GAK3D,OAJmB,IAAIyB,GAASmV,EAAW,OAK/C,GCnOMlV,GAAQ,KsBSRmV,GAAgC,CAAC,EAAK,EAAK,EAAK,GAM/C,MAAeC,GAOpBrzB,YACqBqpB,EACAiK,EACAtU,EACA5oB,GACnB,KAJmBizB,KAAyB,KACzBiK,gBAAuC,KACvCtU,gBAA4B,KAC5B5oB,WAAkC,wGANb,IAAI6oB,KAQ5CnuB,KAAK48B,YAAc58B,KAAKyiC,cACxBziC,KAAKiX,IAAMjX,KAAK0iC,cAChB1iC,KAAK2iC,WAAa3iC,KAAK4iC,gBACzB,CAMUF,cACR,OAAO,IAAI7D,GAAgB7+B,KAAKu4B,GAAIv4B,KAAK48B,YAAa58B,KAAKsF,SAAUtF,KAAK6iC,cAC5E,CAEUD,iBACR,MAAMj9B,EAAW3F,KAAK6iC,cAChBF,EAAa,IAAIzV,GAAS,MAEhC,IAAK,MAAM4V,KAAa9iC,KAAKkuB,cAAc1qB,UACzCopB,GACE5sB,KAAKiX,IACL6rB,EACAH,EACA3iC,KAAK+iC,aACQ,cAAbp9B,EACa,cAAbA,EACa,YAAbA,GAIJ,OAAOg9B,CACT,CAEAnE,qBAAqBzI,GACnB,CAGFiN,oBAAoB59B,GAClB,CAGF69B,qBAAqBhN,GACnB,IAAK,MAAOl3B,EAAQ+L,KAAUmrB,EAAa,CACzC,MAAMiN,EAASljC,KAAK+iC,aAAa7kC,IAAIa,GAErC,QAAeoB,IAAX+iC,EACF,MAAM,IAAIxT,MAAO,2CAA0C3wB,KAG7DmkC,EAAO/C,gBAAgB,CACrBf,UAAWt0B,EAAMwjB,KACjB+Q,YAAav0B,EAAMujB,WAEvB,CACF,CAEU8U,sBAAsB5K,EAA2BnzB,GACzD,CAGFuB,OAAO4xB,EAA2BnzB,EAA8Bg+B,GAAgB,MAC9E,MAAMvM,EAAY0B,EAAG8K,mBACfvM,EAAayB,EAAG+K,oBAEtB/K,EAAGgL,WAAW,EAAK,EAAK,EAAK,GAC7BhL,EAAGiL,WAAW,GACdjL,EAAGkL,OAAOlL,EAAGmL,YACbnL,EAAGoL,UAAUpL,EAAGqL,QAEhBrL,EAAGsL,MAAMtL,EAAGuL,iBAAmBvL,EAAGwL,kBAElC,MAAMC,EAAe,GAAKj/B,KAAKgf,GAAM,IAC/BR,EAASsT,EAAYC,EAGrBmN,EAAmBhF,GAAKtgC,SAE9B45B,EAAG2L,WAAWlkC,KAAK48B,YAAY1D,SAE/Bl5B,KAAKiX,IAAIwmB,iBAAiB,YAAoC,QAAzB,EAAEr4B,EAAcwqB,iBAAS,QAAI0S,IAElErD,GAAKnF,YAAYmK,EAAkBD,EAAazgB,EARlC,GACD,KAQbvjB,KAAKiX,IAAImmB,kBAAkB,mBAAoB6G,GAE/C,MAAMtiC,EAvGmB,IAuGTyD,EAAckB,aACxB1E,EAxGmB,IAwGTwD,EAAcmB,cAAuC,EAC/D1E,GAAuE,GA3GtD,EACL,IA0GoBuD,EAAcc,MAIpDlG,KAAK2iC,WAAW1C,uBAChBjgC,KAAK2iC,WAAWzlB,UAAUvb,EAASC,EAASC,GAC5C7B,KAAK2iC,WAAW5kB,QAAQ1E,GAASL,SAAS5T,EAAce,YACxDnG,KAAK2iC,WAAW3kB,QAAQ3E,GAASL,SAAS5T,EAAcgB,YACxDpG,KAAK2iC,WAAW1kB,QAAQ5E,GAASL,SAAS5T,EAAciB,YAExDrG,KAAKmjC,sBAAsB5K,EAAInzB,GAE/BpF,KAAK2iC,WAAWh8B,OAAO3G,KAAKiX,IAC9B,CAEAW,OAAOwrB,GACL,EC7HG,MAAMe,WAAwB5B,GAC1B/D,qBAAqBzI,GAC5B/1B,KAAKiX,IAAIunB,qBAAqBzI,EAChC,CAESiN,oBAAoB59B,GAC3BpF,KAAKiX,IAAI0nB,kBAAkBv5B,EAAcsT,cACzC2d,MAAM2M,oBAAoB59B,EAC5B,CAEmBy9B,cACjB,MAAO,SACT,CAEmBJ,cACjB,MAAM,SAAE2B,EAAQ,SAAEC,GAAarkC,KAAKwiC,cAAc8B,QAE5CC,EAAWlM,GAAYC,cAAct4B,KAAKu4B,GAAI6L,EAAUpkC,KAAKu4B,GAAGiM,eAChEC,EAAWpM,GAAYC,cAAct4B,KAAKu4B,GAAI8L,EAAUrkC,KAAKu4B,GAAGmM,iBAChEC,EAAgBtM,GAAYU,cAAc/4B,KAAKu4B,GAAIgM,EAAUE,GAEnE,MAAO,CACLvL,QAASyL,EACT1Z,gBAAiB,CACfC,eAAgBlrB,KAAKu4B,GAAGqM,kBAAkBD,EAAe,mBACzDpY,aAAcvsB,KAAKu4B,GAAGqM,kBAAkBD,EAAe,iBACvDlY,aAAczsB,KAAKu4B,GAAGqM,kBAAkBD,EAAe,kBAEzDpH,iBAAkB,CAChByB,gBAAiBh/B,KAAKu4B,GAAGsM,mBAAmBF,EAAe,oBAC3DV,iBAAkBjkC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,qBAC5DG,UAAW9kC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,aACrDI,YAAa/kC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,eACvD5E,aAAc//B,KAAKu4B,GAAGsM,mBAAmBF,EAAe,iBACxDhK,QAAS36B,KAAKu4B,GAAGsM,mBAAmBF,EAAe,YACnDK,UAAWhlC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,cAG3D,CAEmBxB,sBAAsB5K,EAA2BnzB,GAClEpF,KAAKiX,IAAI0mB,eAAe,YAAav4B,EAAcyT,uBAEnD,MACMosB,EAA+C,WAAnC7/B,EAAcwT,iBAAgC2f,EAAG2M,OAAS3M,EAAGwE,QAE/E/8B,KAAKiX,IAAI4mB,oBAH4C,WAAnCz4B,EAAcuT,iBAAgC4f,EAAG2M,OAAS3M,EAAGwE,SAI/E/8B,KAAKiX,IAAI6mB,oBAAoBmH,EAC/B,EClDK,MAAME,WAA2B5C,GACnBM,cACjB,MAAO,aACT,CAESG,oBAAoB59B,GAC3BpF,KAAKiX,IAAIkmB,mBAAmB/3B,EAAc6qB,WAC5C,CAEmBwS,cACjB,MAAM,SAAE2B,EAAQ,SAAEC,GAAarkC,KAAKwiC,cAAc4C,MAE5Cb,EAAWlM,GAAYC,cAAct4B,KAAKu4B,GAAI6L,EAAUpkC,KAAKu4B,GAAGiM,eAChEC,EAAWpM,GAAYC,cAAct4B,KAAKu4B,GAAI8L,EAAUrkC,KAAKu4B,GAAGmM,iBAChEC,EAAgBtM,GAAYU,cAAc/4B,KAAKu4B,GAAIgM,EAAUE,GAEnE,MAAO,CACLvL,QAASyL,EACT1Z,gBAAiB,CACfC,eAAgBlrB,KAAKu4B,GAAGqM,kBAAkBD,EAAe,mBACzDpY,aAAcvsB,KAAKu4B,GAAGqM,kBAAkBD,EAAe,kBAEzDpH,iBAAkB,CAChByB,gBAAiBh/B,KAAKu4B,GAAGsM,mBAAmBF,EAAe,oBAC3DV,iBAAkBjkC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,qBAC5DG,UAAW9kC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,aACrDI,YAAa/kC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,eACvD5E,aAAc//B,KAAKu4B,GAAGsM,mBAAmBF,EAAe,iBACxDK,UAAWhlC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,cAG3D,CAEmBxB,sBAAsB5K,EAA2BnzB,GAClEpF,KAAKiX,IAAI0mB,eAAe,YAAav4B,EAAc4qB,yBACrD,ECnCK,MAAMqV,WAA0B9C,GAClBM,cACjB,MAAO,WACT,CAESG,oBAAoB59B,GAC3BpF,KAAKiX,IAAIkmB,mBAAmB/3B,EAAc6I,eAC5C,CAEmBw0B,cACjB,MAAM,SAAE2B,EAAQ,SAAEC,GAAarkC,KAAKwiC,cAAc8C,UAE5Cf,EAAWlM,GAAYC,cAAct4B,KAAKu4B,GAAI6L,EAAUpkC,KAAKu4B,GAAGiM,eAChEC,EAAWpM,GAAYC,cAAct4B,KAAKu4B,GAAI8L,EAAUrkC,KAAKu4B,GAAGmM,iBAChEC,EAAgBtM,GAAYU,cAAc/4B,KAAKu4B,GAAIgM,EAAUE,GAEnE,MAAO,CACLvL,QAASyL,EACT1Z,gBAAiB,CACfC,eAAgBlrB,KAAKu4B,GAAGqM,kBAAkBD,EAAe,oBAE3DpH,iBAAkB,CAChByB,gBAAiBh/B,KAAKu4B,GAAGsM,mBAAmBF,EAAe,oBAC3DV,iBAAkBjkC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,qBAC5DG,UAAW9kC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,aACrDI,YAAa/kC,KAAKu4B,GAAGsM,mBAAmBF,EAAe,gBAG7D,EChBK,MAAMY,WAAoBhS,GAI/BrkB,YACEskB,EACAgP,EACAtU,EACA5oB,GAEA+wB,MAAM7C,GAAQ,oDAEd,MAAM+E,EAAK/E,EAAOG,OAAO2C,WAAW,QAAS,CAC3CxwB,sBAAuB0tB,EAAO1tB,wBAGhC,GAAW,OAAPyyB,EACF,KAAO,wCAGTv4B,KAAKu4B,GAAKA,EAEVA,EAAGiN,YAAYjN,EAAGkN,gCAAgC,GAClDlN,EAAGkL,OAAOlL,EAAGmN,OACbnN,EAAGoN,UAAUpN,EAAGqN,UAAWrN,EAAGsN,qBAI9B7lC,KAAK8lC,aAAe,CAClBxB,QAAS,IAAIH,GAAgB5L,EAAIiK,EAAetU,EAAe5oB,GAC/DygC,YAAa,IAAIZ,GAAmB5M,EAAIiK,EAAetU,EAAe5oB,GACtEggC,UAAW,IAAID,GAAkB9M,EAAIiK,EAAetU,EAAe5oB,IAGrE,IAAK,MAAM0gC,KAAejoC,OAAO2wB,OAAO1uB,KAAK8lC,cAC3CE,EAAYxH,qBAAqBhL,EAAOuC,gBAO1C,GAFA/1B,KAAKyzB,cAEe,eAAhBD,EAAOh1B,KAAuB,CAChC,IAAIynC,EAAO,EAEX,MAAMt/B,EAAUiwB,IAEd,MAAMsP,GADNtP,GAAO,MACiBqP,EACxBA,EAAOrP,EAEP52B,KAAK4X,OAAOsuB,GACZlmC,KAAK2G,OAAOu/B,GAEZ35B,sBAAsB5F,EAAO,EAG/B4F,sBAAsB5F,EACxB,CACF,CAEmBsuB,YACjBsB,QAAQC,IAAK,aAAYx2B,KAAK+N,WAAW/N,KAAKy1B,WAC9Cz1B,KAAKu4B,GAAG4N,SAAS,EAAG,EAAGnmC,KAAKu4B,GAAG8K,mBAAoBrjC,KAAKu4B,GAAG+K,qBAClC,WAArBtjC,KAAKwzB,OAAOh1B,MACdwB,KAAK2G,QAET,CAEmBA,OAAOy8B,GAEGpjC,KAAK8lC,aADR9lC,KAAKwzB,OAAOpuB,cAAcO,UAG/BgB,OAAO3G,KAAKu4B,GAAIv4B,KAAKwzB,OAAOpuB,cAAeg+B,EAChE,CAEStN,kBAAkBC,GACzB,IAAK,MAAMiQ,KAAejoC,OAAO2wB,OAAO1uB,KAAK8lC,cAC3CE,EAAYxH,qBAAqBzI,GAGnCM,MAAMP,kBAAkBC,EAC1B,CAES1wB,iBAAiBD,GACxB,IAAK,MAAM4gC,KAAejoC,OAAO2wB,OAAO1uB,KAAK8lC,cAC3CE,EAAYhD,oBAAoB59B,GAGlCixB,MAAMhxB,iBAAiBD,EACzB,CAES4wB,kBAAkBC,GACzB,IAAK,MAAM+P,KAAejoC,OAAO2wB,OAAO1uB,KAAK8lC,cAC3CE,EAAY/C,qBAAqBhN,GAGnCI,MAAML,kBAAkBC,EAC1B,CAEQre,OAAOwrB,GAEcpjC,KAAK8lC,aADR9lC,KAAKwzB,OAAOpuB,cAAcO,UAG/BiS,OAAOwrB,EAC5B,ECvGagD,OAjB8C,EAAG7gC,gBAC9DgxB,QAAQC,IAAI,8BAEZ,MAAM7C,EAEJ,oBAAKn0B,MAAM,oBACT,uBAAQiP,IAAKlJ,KAIjB,OACE,oBAAK/F,MAAM,gDACRm0B,EACG,ECnBK,GAAe,qBAAf,GAAiD,oBAAjD,GAAoF,sBAApF,GAAiH,cCsBjH0S,OAjBV,EAAGv7B,QAAOf,cAEX,oBAAKvK,MAAM,aACT,oBACEA,MAAO,yCACFsL,EAAMujB,UAAY,mBAAqB,IAC5ClW,QAAS,IAAMpO,EAAS,SAAKe,GAAK,IAAEujB,WAAYvjB,EAAMujB,cACvD,KACD,oBACE7uB,MAAO,yCACFsL,EAAMwjB,KAAO,GAAK,oBACvBnW,QAAS,IAAMpO,EAAS,SAAKe,GAAK,IAAEwjB,MAAOxjB,EAAMwjB,SAClD,MCVP,MAAMgY,GAAS,UACTC,GAAa,OACbC,GAAY,UAEZC,GAQD,EACHr7B,UACAs7B,QACAC,oBACAC,YACA3Q,cACA4Q,qBACI,MACJ,MAAOC,EAAcC,GAAmBviC,cAAS,GAE3CwiC,EAAcN,EAAMx/B,OAAS,EAE7B+/B,EAAW77B,GAAW6qB,EAAY/3B,IAAIkN,GAE5C,OACE,oBAAK5L,MAAO0nC,GAAc,mCACX,OAAZ97B,GACC,oBACE0C,MAAO,CAAE2nB,OAAQ8Q,IACjB/mC,MAAO0nC,GAAqB,qCAE5B,oBACE/uB,QAAS6uB,EAAc,IAAMD,GAAiBD,QAAgB3mC,EAC9DX,MAAQ,gCAA8BwnC,EAAc,uCAAyC,cAE5FF,EAAe,IAAM,KAGxB,oBACEtnC,MAAM,sEACN2Y,QAAS,IAAMwuB,EAAkBC,IAEjC,oBAAKpnC,MAAM,gBAAgB2wB,MAAO/kB,EAAQxN,MAC3B,QADgC,EAC5CwN,EAAQxN,YAAI,QAAI,qBAAM4B,MAAM,iBAAiB,kBAIjDynC,GACC,aAAC,GAAkB,CACjBn8B,MAAOm8B,EACPl9B,SAAWo9B,IACT,MAAM7T,EAAS9F,GAAM6F,iBAAiB4C,EAAa7qB,EAAS+7B,GAC5DN,EAAevT,EAAO,KAO/BoT,EAAMx/B,OAAS,GACd,oBAAK1H,MAAOsnC,EAAe,QAAU,UAClCJ,EAAMnuB,KAAI,CAAC6uB,EAAS1+B,IACnB,oBAAK9J,IAAK8J,EAAOlJ,MAAM,QACrB,oBACEA,MAAO0nC,GACPp5B,MAAO,CACLu5B,WAAa,QAAOf,UACpB7Q,OAAQ/sB,IAAUg+B,EAAMx/B,OAAS,EAC5B,QAAOq/B,YAAoBC,MAC5B,UAIR,oBACEhnC,MAAO0nC,GAAsB,cAC7Bp5B,MAAO,CACLC,MAAQ,QAAOu4B,UACf7Q,OAAS,QAAO8Q,YAAoBC,SAIxC,oBACEhnC,MAAM,kCACNsO,MAAO,CAAEw5B,WAAYd,KAErB,aAACC,GAAc,CACbr7B,QAASg8B,EACTV,MAAOU,EAAQ3lC,SACfklC,kBAAmBA,EACnBC,UAAW,IAAIA,EAAWQ,GAC1BnR,YAAaA,EACb4Q,eAAgBA,SAOxB,EAIKJ,UC7Gf,MAAMc,GAAU,kCACVC,GAAS,GAAED,uBACXE,GAAS,GAAEF,eA6BFG,OAzBV,EAAGnmC,gBAEJ,sBAAO/B,MAAM,0BACX,0BACE,uBACE,mBAAIA,MAAOgoC,IAAO,KAClB,mBAAIhoC,MAAOgoC,GAAOrX,MAAM,kBAAiB,aACzC,mBAAI3wB,MAAOgoC,IAAO,aAGtB,0BACGjmC,EAAWgX,KAAI,CAAC8U,EAAW3kB,IAExB,mBAAI9J,IAAK8J,GACP,mBAAIlJ,MAAOioC,IAAQ/+B,GACnB,mBAAIlJ,MAAOioC,IAAO,IAAEpa,EAAUxqB,cAAc8kC,KAAK,MAAM,KACvD,mBAAInoC,MAAQ,GAAEioC,MAAUpa,EAAUpqB,kBCiIjC2kC,OA5IV,EACH1Z,gBACA+H,cACA4Q,qBAEA,MAAOD,EAAWiB,GAAgBrjC,aAAsB,IAElDsjC,EAAuD,IAArBlB,EAAU1/B,OAC9C,KACA0/B,EAAUA,EAAU1/B,OAAS,GAE3B6gC,EAAiD,OAAlBD,EACjC5Z,EAAc1qB,UACdskC,EAAcrmC,SAEZumC,EAAkBF,GAAiB7R,EAAY/3B,IAAI4pC,GAEnDG,EAAUtjC,cAAQ,KACtB,MAAMujC,EAAM,oBAAK1oC,MAAM,sBAAqB,KACtC2oC,EAAS,YACTC,EAAW,gDAEjB,OACE,oBAAK5oC,MAAM,0CACT,oBACEA,MAAyB,OAAlBsoC,EAAyBK,EAASC,EACzCjwB,QAAS,IAAM0vB,EAAa,KAE5B,qBAAMroC,MAAM,UAAS,WAEJ,OAAlBsoC,GAA0BI,EAC1BtB,EAAUruB,KAAI,CAAClK,EAAM3F,IACpB,aAAC,YAAQ,CAAC9J,IAAK8J,GACb,oBACEyP,QAAS,IAAM0vB,EAAajB,EAAU5kC,MAAM,EAAG0G,EAAQ,IACvDlJ,MAAOkJ,IAAUk+B,EAAU1/B,OAAS,EAAIihC,EAASC,GAEhD/5B,EAAKzQ,MAEP8K,EAAQk+B,EAAU1/B,OAAS,GAAKghC,KAGjC,GAEP,CAACtB,EAAWkB,IAETO,EAAoB1jC,cAAQ,kBAChC,oBACEnF,MAAO,0DAEP,oBAAKA,MAAM,0BACU,OAAlBsoC,EACG,qBAAMtoC,MAAM,UAAS,UACF,QADe,EACjCsoC,EAAclqC,YAAI,QAAI,qBAAM4B,MAAM,iBAAiB,iBAGzDwoC,GACC,aAAC,GAAkB,CACjBl9B,MAAOk9B,EACPj+B,SAAWo9B,IACT,MAAM7T,EAAS9F,GAAM6F,iBAAiB4C,EAAa6R,EAAeX,GAClEN,EAAevT,EAAO,IAIxB,GACL,CAACwU,EAAeE,EAAiB/R,EAAa4Q,IAE3CyB,EAAyB3jC,cAAQ,IACf,OAAlBmjC,GAA8D,IAApCA,EAAcvmC,WAAW2F,OAC9C,KAIP,oBAAK1H,MAAM,kFACT,aAAC,GAAO,CAAC2wB,MAAM,YACb,oBAAK3wB,MAAM,8CACT,qBAAMA,MAAM,aAAY,IACpBsoC,EAAczmC,SAASkX,KAAKzV,GAAO,IAAGA,EAAEN,MAAMM,EAAEL,MAAMK,EAAEJ,OAAMilC,KAAK,MAAM,SAMpF,CAACG,IAEES,EAA0B5jC,cAAQ,IAChB,OAAlBmjC,GAA8D,IAApCA,EAAcvmC,WAAW2F,OAC9C,KAIP,oBAAK1H,MAAM,kFACT,aAAC,GAAO,CAAC2wB,MAAM,cACb,oBAAK3wB,MAAM,8CACT,aAAC,GAAe,CAAC+B,WAAYumC,EAAcvmC,iBAKlD,CAACumC,IAEJ,OACE,oBAAKtoC,MAAM,wCACT,oBAAKgyB,UAAU,QACb,oBAAKhyB,MAAM,QACRyoC,GAGH,oBAAKzoC,MAAM,kBAAiB,YAE3B6oC,EACD,oBAAK7oC,MAAM,QACR8oC,EACAC,GAGFR,EAAgB7gC,OAAS,GACxB,oBAAK1H,MAAM,4CACT,yBAAM,aACN,yBAAM,IAAEuoC,EAAgB7gC,OAAO,OAMrC,oBAAK1H,MAAM,2BACT,aAAC,GAAc,CACb4L,QAAS,KACTs7B,MAAOqB,EACPpB,kBAAmBkB,EACnBjB,UAAWA,EACX3Q,YAAaA,EACb4Q,eAAgBA,KAGhB,E,0BCnGK2B,OA3C0C,EACvD/Z,cAIE,oBAAKjvB,MAAM,2BACRzB,OAAOi1B,QAAQvE,GAAUlW,KAAI,EAAE3Z,EAAKN,GAAQoK,KAC3C,IAAI+/B,EAAiB,OAAVnqC,EAEG,OAAVA,GAAiC,SAAfA,EAAMqF,OAC1B8kC,EAAOnqC,EAAM09B,MAAMC,UAAyC,IAA7B39B,EAAM09B,MAAME,cAG7C,MAAMwM,EAAMD,EAAO,KAAO,QAE1B,OACE,oBACE7pC,IAAK8J,EACLlJ,MAAO,2BACFipC,EAAO,uCAAyC,qCAErD,oBAAKjpC,MAAM,aAAaZ,GAExB,oBACEY,MAAM,8GAENsO,MAAO,CAAEikB,SAAU,OAAQ4W,aAAc,QAC1C,KAIgB,UAAhBrqC,aAAK,EAALA,EAAOqF,MACN,kBAAGwtB,KAAM7yB,EAAM09B,MAAM4M,IAAK5iB,OAAO,SAAS6iB,IAAI,cAAcH,GAE5D,wBAAMA,GAEJ,KChChB,MAAMI,GAAe,CAAC,YAAa,YAAa,cAmFjCC,OAjFgD,EAC7DC,kBACAC,iBACAC,wBAEA,MAAOC,EAAWC,GAAgB5kC,cAAS,GAErC6kC,EAAY/9B,cAAYg+B,UAC5B,MAAMC,EAA6B,CAAC,EAEpC,IAAK,MAAMjY,KAAQkY,EAAO,CACxB,IAAKV,GAAarW,SAASnB,EAAK3tB,MAC9B,SAGF,MAAM8lC,EAAiBzN,IACrB,MAAM0N,EAAepY,EAAK1zB,KACvB0V,QAAQ,YAAa,IACrBA,QAAQ,YAAa,IAExBi2B,EAAWG,GAAgB,CAAE/lC,KAAM,OAAQq4B,QAAO,QAG9C2N,KAAQC,YAAYtY,GACvB2U,KAAK0D,KAAQE,wBACb5D,KAAKwD,GACLK,MAAMvT,QAAQjf,MACnB,CAEA4xB,EAAkB,SACbD,GACAM,GACH,GACD,CAACN,EAAgBC,IAEda,EACJ,sBACEpmC,KAAK,OACLqmC,UAAU,EACVC,OAAQnB,GAAanB,KAAK,MAC1BuC,SAAUf,EACVvpC,SAAWC,IACT,GAAIspC,EAEF,YADAtpC,EAAGC,cAAcxB,MAAQ,IAI3B,MAAMkrC,EAAQ3pC,EAAGC,cAAc0pC,MAEjB,OAAVA,IACFJ,GAAa,GAEbC,EAAUG,GAAOW,SAAQ,KACvBf,GAAa,EAAM,KAIvBvpC,EAAGC,cAAcxB,MAAQ,EAAE,IAKjC,OACE,oBAAKkB,MAAM,4CAET,oBAAKA,MAAM,8BAA6B,mBACxC,oBAAKA,MAAM,2BACT,aAAC,GAAW,CAACivB,SAAUwa,EAAgBmB,YAAalB,KAEtD,oBAAK1X,UAAU,aAAauY,GAC5B,oBAAKvqC,MAAM,SAEX,oBAAKA,MAAM,8BAA6B,gBACxC,oBAAKA,MAAM,2BACT,aAAC,GAAW,CAACivB,SAAUua,KAGrB,EC1EV,MAGMqB,GAAe,CAAC,UAAW,UAAW,YAuQ7BC,OAzPV,EACHC,aACAC,UACAtc,gBACA8a,kBACAyB,qBACAnlC,WACAolC,cACA3Z,sBACA4Z,2BAEApU,QAAQC,IAAI,oBAIZ,MAAOoU,EAAeC,GAAoBrmC,cAAS,IAC5CsmC,EAAYC,GAAiBvmC,aAAqB,YAClDY,EAAeC,GAAoBb,aAASmmC,IAC5C1U,EAAa4Q,GAAkBriC,aAAyBimC,IACxDO,EAAQC,GAAazmC,gBAErBlF,EAAc4rC,GAAoB1mC,aAASusB,GAC5CxxB,EAAkB+L,cAAa6/B,IACnCD,EAAiBC,GACjBT,EAAYtb,KAAK+b,EAAgB,GAChC,CAACT,KAEGzB,EAAgBC,GAAqB1kC,aAAyB,CAAC,GAEhEe,EAAY2F,eAIlBP,cAAU,KACR,MAAMgpB,EAASpuB,EAAU6F,QAEzB,IAAKuoB,EACH,OAGFA,EAAO5lB,MAAQ4lB,EAAO0B,YACtB1B,EAAO8B,OAAS9B,EAAO4B,aAEvBgB,QAAQC,IAAI,uBAEZ,MAIM4U,EAA6B,CACjC5sC,KAAM,SACNm1B,OAAQA,EACRvuB,cAAeulC,EACfjX,SARqC,CACrCiB,uBAAwBtvB,GAQxB0wB,eAAgB,MAAKiT,GACrB/S,YAAawU,EACb3kC,sBAAuBirB,EAAoBjrB,uBAGvCulC,EAA2C,SAC5C/lC,GAAQ,IACX2sB,WAAY0Y,EAAqBjyB,eAG7BsyB,EAAwB,UAAfT,EACX,IAAIhF,GAAY6F,EAAcZ,EAAStc,EAAemd,GACtD,IAAIjV,GAAcgV,GAItB,OAFAH,EAAUD,GAEH,KACLA,EAAO9U,UACP+U,OAAU9qC,GACVy1B,MAAO,2EAA0E,CAClF,GAEA,CAACrwB,EAAWilC,EAASC,EAAoBF,EAAYrc,EAAe8a,EAAiB1jC,EACpFqlC,EAAsB5Z,IAE1BpmB,cAAU,KACR,MAAMgpB,EAASpuB,EAAU6F,QAEpBuoB,IAILA,EAAO7lB,MAAMw9B,WAAalmC,EAAcyqB,iBACxC8D,EAAO7lB,MAAMy9B,eAAiBnmC,EAAc0qB,qBAC5C6D,EAAO7lB,MAAM09B,iBAAmBpmC,EAAc2qB,uBAC9C4D,EAAO7lB,MAAM29B,mBAAqB,SAAQ,GACzC,CAAClmC,EAAWH,IAEfuF,cAAU,KACJqgC,GACFA,EAAO3lC,iBAAiBD,EAC1B,GACC,CAAC4lC,EAAQ5lC,IAEZuF,cAAU,KAENvF,EAAcuT,mBAAqBrZ,EAAa2vB,yBAChD7pB,EAAcwT,mBAAqBtZ,EAAa4vB,yBAEhD3vB,EAAgB,SACXD,GAAY,IACf2vB,wBAAyB7pB,EAAcuT,iBACvCuW,wBAAyB9pB,EAAcwT,mBAE3C,GACC,CAACoyB,EAAQ5lC,EAAe9F,EAAcC,IAEzCoL,cAAU,KACJqgC,GACFA,EAAOhV,kBAAkBC,EAC3B,GACC,CAAC+U,EAAQ/U,IAEZtrB,cAAU,KACJqgC,GACFA,EAAOlV,kBAAkB,SAAKkT,GAAoBC,GACpD,GACC,CAAC+B,EAAQhC,EAAiBC,IAI7B,MAAMyC,EAAgB/mC,cAAQ,IAC5B,aAAC,GAAa,CAACY,UAAWA,KACzB,CAACA,IAEEomC,EAAchnC,cAAQ,IAC1B,oBAAKnF,MAAM,wBACT,oBAAKA,MAAM,4CACT,oBAAKA,MAAM,8BAA6B,UAGxC,oBACEA,MAAM,uDACN2Y,QAAS,IAAM0yB,GAAkBD,IAEhCA,EAAgB,QAAU,UAI/B,oBAAKprC,MAAM,YACRksC,KAGJ,CAACA,EAAed,IAEbgB,EAAejnC,cAAQ,IAC3B,aAACQ,GAAA,EAAO,CACNC,cAAeA,EACfC,iBAAkBA,EAClB/F,aAAcA,EACdC,gBAAiBA,EACjB+F,SAAUA,EACVC,UAAWA,KAEZ,CAACH,EAAe9F,EAAcC,EAAiB+F,EAAUC,IAEtDsmC,EAAelnC,cAAQ,IAEzB,aAAC,GAAU,CACTupB,cAAeA,EACf+H,YAAaA,EACb4Q,eAAgBA,KAGnB,CAAC3Y,EAAe+H,IAEb6V,EAAgBnnC,cAAQ,IAE1B,aAAC,GAAc,CACbqkC,gBAAiBA,EACjBC,eAAgBA,EAChBC,kBAAmBA,KAGtB,CAACD,EAAgBD,IAEd+C,EAAUpnC,cAAQ,IAEpB,oBAAKnF,MAAM,wBACT,oBAAKA,MAAM,4CACR6qC,GAAa9xB,KAAI,CAACyzB,EAAKtjC,EAAOujC,KAC7B,MAAMj0B,EAAag0B,IAAQlB,EAErBoB,EAAal0B,EACf,YACA,gDAEEm0B,EAAYzjC,IAAUujC,EAAI/kC,OAAS,EACrC,2BACA,GAEJ,OACE,oBACEtI,IAAK8J,EACLlJ,MAAQ,sCAAqC0sC,KAAcC,IAC3Dh0B,QAAS,KACFH,GACH+yB,EAAciB,EAChB,GAGO,YAARA,EAAoB,UACT,YAARA,EAAoB,UACpB,WACA,KAKZ,oBACExsC,MAAM,uCACNsO,MAAO,CAAEC,MAAOzO,EAAa0vB,aAAcod,UAAW,SAEtC,YAAftB,EAA2Bc,EACT,YAAfd,EAA2Be,EAC3BC,KAIT,CAAChB,EAAYc,EAActsC,EAAcusC,EAAcC,IAIpDO,EAAmBzB,EAAgB,mBAAqB,mBACxD0B,EAA8C,SAAjChtC,EAAaK,gBAA6B,GAAK,oBAE5D4sC,EAAoD,SAAjCjtC,EAAaK,gBAA6B,YAAc,YAEjF,OACE,oBAAKH,MAAM,0EACT,oBACEA,MAAQ,gCAA+B6sC,KAAoBC,IAC3Dx+B,MAAO,CAAE,YAAa88B,EAAgB,OA7PxB,WA+Pd,oBAAKprC,MAAQ,mCAAkC+sC,KAC5CR,GAEH,oBAAKvsC,MAAM,QACRmsC,IAGD,ElC5LKa,OAzEV,EAAG5d,aAAY8b,cAAa3Z,sBAAqB4Z,2BAA2B,QAC/E,MAAO9pC,EAAQ4rC,GAAajoC,gBACrBgmC,EAASkC,GAAcloC,gBACvBiqB,EAAU2b,GAAe5lC,gBACzB8S,EAAOq1B,GAAYnoC,eAEpBc,EAAW0sB,GAmBjB,GAfArnB,cAAU,MAsFZ2+B,iBACE,MAAO,CACLhF,QAAS,CACPD,eAAgBuI,MAAM,6BAA6B3G,MAAM4G,GAAQA,EAAIC,SACrE1I,eAAgBwI,MAAM,6BAA6B3G,MAAM4G,GAAQA,EAAIC,UAEvE1H,MAAO,CACLf,eAAgBuI,MAAM,iCAAiC3G,MAAM4G,GAAQA,EAAIC,SACzE1I,eAAgBwI,MAAM,iCAAiC3G,MAAM4G,GAAQA,EAAIC,UAE3ExH,UAAW,CACTjB,eAAgBuI,MAAM,+BAA+B3G,MAAM4G,GAAQA,EAAIC,SACvE1I,eAAgBwI,MAAM,+BAA+B3G,MAAM4G,GAAQA,EAAIC,UAG7E,EApGIC,GACG9G,KAAKyG,EAAW,GAClB,IAEH/hC,cAAU,MAkGZ2+B,eAAyB1a,GACvB,IAAIjuB,EAEJ,GAA0B,iBAAfiuB,EAAyB,CAClC,MAAMoe,QAAiBJ,MAAMhe,GAC7BjuB,QAAaqsC,EAASC,aACxB,MAEEtsC,QAAaiuB,EAAWqe,cAG1B,MAAMC,EAAO,IAAIC,SAASxsC,GAC1B,OAAO0C,YAASE,WAAW2pC,EAC7B,EA9GIE,CAAUxe,GACPqX,MAAM4G,IACLJ,EAAUI,GA8GlBvD,eACE+D,EACA/nC,EACAgoC,EACAC,GAEA,MAAMC,EAAe,IAAIC,IAEnBC,EAAYr/B,IAChB,IAAK,MAAMgf,KAAahf,EAAK9M,WAAY,CACvC,MAAM0B,EAAcoqB,EAAUpqB,YAE1BuqB,GAAMC,oBAAoBxqB,IAC5BuqC,EAAarnB,IAAIljB,EAErB,CAEA,IAAK,MAAM4M,KAASxB,EAAK5M,SACvBisC,EAAS79B,EACX,EAGF,IAAK,MAAM89B,KAAYN,EAAK7pC,UAC1BkqC,EAASC,GAGX,MAAM9sC,EAAyB,CAAC,EA0DhC,aAxDM+sC,QAAQC,IAAI77B,MAAMkgB,KAAKsb,GAAcj1B,KAAKtV,GACvC,IAAI2qC,SAAc,CAACE,EAASC,KAGjC,GAAoB,MAFpB9qC,EAAcA,EAAY2uB,QAKxB,OAFA/wB,EAAOoC,GAAe,UACtB6qC,IAMF,IAFiBxoC,EAASitB,mBAAmBtvB,GAE9B,CACb,MAAM+qC,EAAmB,GAAE/qC,KAAesqC,IAEpCvR,EAAQ,IAAIiS,MAclB,OAbAjS,EAAM4M,IAAM0E,EAAWU,EAEvBhS,EAAMkS,QAAU,KACd3X,QAAQjf,MAAO,4BAA2B0kB,EAAM4M,OAChD/nC,EAAOoC,GAAe,KACtB6qC,GAAS,OAGX9R,EAAMI,OAAS,KACbv7B,EAAOoC,GAAe,CAAEU,KAAM,OAAQq4B,SACtC8R,GAAS,EAIb,CAEAF,QAAQC,IAAIvoC,EAASgT,QAAQC,KAAK41B,GACzB,IAAIP,SAAeQ,IACxB,MAAMC,EAAkB/oC,EAASotB,gBAAgByb,EAASlrC,GAEpD+qC,EAAmB,GADD1oC,EAASqtB,qBAAqBwb,EAASlrC,MACjBsqC,IAExCvR,EAAQ,IAAIiS,MAClBjS,EAAM4M,IAAM0E,EAAWU,EAEvBhS,EAAMkS,QAAU,KACd3X,QAAQjf,MAAO,4BAA2B0kB,EAAM4M,OAChD/nC,EAAOwtC,GAAmB,KAC1BD,GAAc,EAGhBpS,EAAMI,OAAS,KACbv7B,EAAOwtC,GAAmB,CAAE1qC,KAAM,OAAQq4B,SAC1CoS,GAAc,CACf,OAEDnI,MAAK,IAAM6H,KAAWC,EAAO,OAI9BltC,CACT,CAlMeytC,CAAazB,EAAKvnC,EAAU,sBAAuB,UAE3D2gC,KAAKmE,GACLN,MAAM6C,EAAS,GACjB,CAAC/d,EAAYtpB,SAEFnF,IAAVmX,EACF,OACE,oBACE9X,MAAM,2FAGN,oBAAKA,MAAM,gBAAe,UAC1B,oBAAKA,MAAM,gBAAe,UAC1B,oBAAKA,MAAM,gBAAgByI,KAAKonB,UAAU/X,KAKhD,QAAenX,IAAXU,QAAoCV,IAAZqqC,QAAsCrqC,IAAbsuB,EAAwB,CAC3E,IAAI8f,EAAU,aAMd,OAJI1tC,GAAU2pC,IACZ+D,EAAU,uBAIV,oBAAK/uC,MAAM,gFACT,qBAAMA,MAAM,iBACT+uC,GAIT,CAEA,OACE,aAAC,GAAI,CACHhE,WAAW,QACXrc,cAAertB,EACf2pC,QAASA,EACTxB,gBAAiBva,EACjBgc,mBAAoBxc,GAAeptB,GACnCyE,SAAUA,EACVolC,YAAaA,EACb3Z,oBAAqBA,EACrB4Z,qBAAoB,SACfA,GAAoB,IACvBhlC,SAAsC,QAA9B,EAAE6oB,GAAmBC,UAAS,QAAIkc,EAAqBhlC,SAC/D+S,aAA6C,QAAjC,EAAEiW,GAAoBC,UAAW,QAAI+b,EAAqBjyB,gBAExE,EmCpFS81B,UCKH,KACV,MAAO5f,EAAY6f,GAAiBjqC,gBAE7BkmC,GAAelmC,aAAS2qB,KACxB4B,EAAqBC,GAA0BxsB,gBAC/CmmC,EAAsB+D,GAA2BlqC,eAsBxD,OApBAmG,cAAU,KACR,IAAIrL,EAEJ,IAAI,MACFA,EAAiC,QAArB,EAAGorC,EAAYlb,cAAM,QAAIT,EAKvC,CAJE,MAAO4f,GACPpY,QAAQjf,MAAMq3B,GACdrvC,EAAeyvB,GACf2b,EAAYtb,KAAK9vB,EACnB,CAEA0xB,EAAuB1xB,GAEvBovC,EAAwB,SACnB/e,IAAsB,IACzBhX,iBAAkBrZ,EAAa2vB,wBAC/BrW,iBAAkBtZ,EAAa4vB,0BAC/B,GACD,CAACwb,SAEwBvqC,IAAxB4wB,QAA8D5wB,IAAzBwqC,EAErC,oBAAKnrC,MAAM,iDACT,yBAAM,oBAKOW,IAAfyuB,EAEA,aAAC,GAAW,CACVkC,SAAU2d,EACV1d,oBAAqBA,EACrBC,uBAAyBma,IACvBna,EAAuBma,GACvBT,EAAYtb,KAAK+b,EAAgB,IAOvC,aAAC,GAAM,CACLvc,WAAYA,EACZ8b,YAAaA,EACb3Z,oBAAqBA,EACrB4Z,qBAAsBA,GACtB,C,ukCCjBSiE,IAtCV,EACHxpC,gBACAC,sBAGE,mBAAK7F,MAAM,aAET,uBACE,qBAAOA,MAAM,qBACX,qBACEmE,KAAK,WACLwS,QAAS/Q,EAAc4qB,yBACvBpwB,SAAWC,IACTwF,EAAiB,EAAD,KACXD,GAAa,IAChB4qB,yBAA0BnwB,EAAGC,cAAcqW,UAC3C,IAGN,oBAAM3W,MAAM,QAAO,qBAIvB,uBACE,mBAAKA,MAAM,IAAG,eAId,YAAC,IAAY,CACX4E,MAAOgB,EAAc6qB,WACrB5rB,SAAW4rB,GAAe5qB,EAAiB,EAAD,KAAMD,GAAa,IAAE6qB,mB,mlCC+H1D4e,IAzJV,EACHzpC,gBACAC,mBACAQ,wBACAN,gBAEA,MAAOupC,EAAUC,GAAevqC,YAqJlC,SAAsBsqC,GACpB,MAAiB,UAAbA,GAAqC,UAAbA,GAAqC,gBAAbA,EAC3CA,EAGF,QACT,CA3J2CE,CAAa5pC,EAAcyqB,mBAE9Dof,EAAmB3jC,aAAahN,IACpCywC,EAAYzwC,GAEE,WAAVA,GACF+G,EAAiB,EAAD,KAAMD,GAAa,IAAEyqB,iBAAkBvxB,IACzD,GACC,CAAC8G,EAAeC,IAEb6pC,EAAevqC,aAAQ,IACV,WAAbmqC,EACK,KAIP,qBACEnrC,KAAK,OACLqmC,UAAU,EACVpqC,SAAWC,IACT,MAAM2pC,EAAQ3pC,EAAGC,cAAc0pC,MAE/B,GAAc,OAAVA,GAAmC,IAAjBA,EAAMtiC,OAE1B,YADArH,EAAGC,cAAcxB,MAAQ,IAM3BqrC,IAAQC,YAFKJ,EAAM,IAEOvD,MAAMkJ,IAC9B,MAAMC,EAAY,OAAMD,KACxB9pC,EAAiB,EAAD,KAAMD,GAAa,IAAEyqB,iBAAkBuf,IAAW,GAClE,KAIP,CAACN,EAAU1pC,EAAeC,IAEvBgqC,EAAe1qC,aAAQ,IACV,WAAbmqC,EACK,KAIP,uBACE,uBAAK,mBACL,sBACEtvC,MAAM,SACNlB,MAAO8G,EAAc0qB,qBACrBlwB,SAAWC,IACTwF,EAAiB,EAAD,KAAMD,GAAa,IAAE0qB,qBAAsBjwB,EAAGC,cAAcxB,QAAe,GAG7F,sBAAQA,MAAM,QAAO,QACrB,sBAAQA,MAAM,SAAQ,SACtB,sBAAQA,MAAM,WAAU,cAI7B,CAACwwC,EAAU1pC,IAERkqC,EAAiB3qC,aAAQ,IACZ,WAAbmqC,GAAgE,UAAvC1pC,EAAc0qB,qBAClC,KAIP,uBACE,uBAAK,qBACL,sBACEtwB,MAAM,SACNlB,MAAO8G,EAAc2qB,uBACrBnwB,SAAWC,IACTwF,EAAiB,EAAD,KAAMD,GAAa,IAAE2qB,uBAAwBlwB,EAAGC,cAAcxB,QAAe,GAG/F,sBAAQA,MAAM,UAAS,MACvB,sBAAQA,MAAM,aAAY,UAI/B,CAACwwC,EAAU1pC,IAERmqC,EAAkBjkC,aAAY,KAClC,MAAMqoB,EAASpuB,EAAU6F,QAEzB,QAAejL,IAAXwzB,EACF,OAGF,MAAM6b,EAAU7b,EAAO8b,YACjBC,EAAeloC,SAASgH,cAAc,KACtCmhC,GAAY,IAAIC,MAAOC,UAE7BH,EAAave,KAAOqe,EACpBE,EAAaI,SAAY,OAAMH,QAC/BnoC,SAASE,KAAKkL,YAAY88B,GAC1BA,EAAaK,QACbvoC,SAASE,KAAK6G,YAAYmhC,EAAa,GACtC,CAACnqC,IAEEyqC,EAAkBrrC,aAAQ,IACzBkB,EAKH,mBAAKrG,MAAM,eACT,sBACEA,MAAM,yDACN2Y,QAASo3B,GACV,qBARI,MAaR,CAAC1pC,EAAuB0pC,IAE3B,OACE,mBAAK/vC,MAAM,aACRwwC,EAED,uBAAK,oBAEH,sBACExwC,MAAM,SACNlB,MAAOwwC,EACPlvC,SAAWC,GAAOovC,EAAiBpvC,EAAGC,cAAcxB,QAEpD,sBAAQA,MAAM,eAAc,eAC5B,sBAAQA,MAAM,SAAQ,SACtB,sBAAQA,MAAM,SAAQ,SACtB,sBAAQA,MAAM,UAAS,mBAGzB,mBAAKkB,MAAM,UACR0vC,IAIJG,EAEAC,EACG,C,oCChKV,kCAwCO,MAAM3F,EAAU,CACrBC,YAzCF,SAAqBtY,GACnB,MAAM2e,EAAa,IAAIC,WAEjBC,EAAqB,IAAIvC,SAAgB,CAACE,EAASC,KACvDkC,EAAW7T,OAAS,KAClB,MAAMv7B,EAASovC,EAAWpvC,OAEJ,iBAAXA,EACTitC,EAAQjtC,GAERktC,EAAO,IAAIre,MAAO,wBAAuB4B,EAAK1zB,QAChD,EAGFqyC,EAAW/B,QAAU,KACnBH,EAAO,IAAIre,MAAO,wBAAuB4B,EAAK1zB,QAAQ,CACvD,IAKH,OAFAqyC,EAAWG,cAAc9e,GAElB6e,CACT,EAoBEtG,uBAlBF,SAAgCsF,GAC9B,OAAO,IAAIvB,SAA0B,CAACE,EAASC,KAC7C,MAAM/R,EAAQ,IAAIiS,MAElBjS,EAAMI,OAAS,KACb0R,EAAQ9R,EAAM,EAGhBA,EAAMkS,QAAU,KACdH,EAAO,IAAIre,MAAO,uCAAsCyf,KAAW,EAGrEnT,EAAM4M,IAAMuG,CAAO,GAEvB,E,kCCrCApxC,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,IACtDnB,EAAQwF,sBAAwBxF,EAAQyF,iBAAmBzF,EAAQmF,mBAAqBnF,EAAQoF,cAAgBpF,EAAQkzC,mBAAqBlzC,EAAQgE,mBAAgB,EACrKhE,EAAQgE,cAAgB,CACpB,CAAC,mBAAoB,OACrB,CAAC,mBAAoB,OACrB,CAAC,qBAAsB,OACvB,CAAC,cAAe,OAChB,CAAC,cAAe,OAChB,CAAC,cAAe,OAChB,CAAC,cAAe,OAChB,CAAC,qBAAsB,OACvB,CAAC,WAAY,OACb,CAAC,sBAAuB,OACxB,CAAC,yBAA0B,OAC3B,CAAC,wBAAyB,OAC1B,CAAC,sBAAuB,QAG5BhE,EAAQkzC,mBAAoD,EAA/BlzC,EAAQgE,cAAc+F,OACnD/J,EAAQoF,cAAgB,CACpB,CAAC,IAAK,OACN,CAAC,IAAK,OACN,CAAC,IAAK,QAGVpF,EAAQmF,mBAAoD,EAA/BnF,EAAQoF,cAAc2E,OACnD/J,EAAQyF,iBAAmB,CACvB,CAAC,YAAa,OACd,CAAC,wBAAyB,OAC1B,CAAC,WAAY,OACb,CAAC,2BAA4B,OAC7B,CAAC,sBAAuB,OACxB,CAAC,YAAa,OACd,CAAC,YAAa,OACd,CAAC,YAAa,QAGlBzF,EAAQwF,sBAA0D,EAAlCxF,EAAQyF,iBAAiBsE,M","file":"bundle.5d194.esm.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"https://takingdoms.github.io/3do-viewer-preact-with-textures/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"Pq/i\");\n","import { FunctionComponent, h } from 'preact';\r\nimport { UserSettings } from \"../../lib/types/user-settings\";\r\n\r\nconst OptionsUser: FunctionComponent<{\r\n  userSettings: UserSettings;\r\n  setUserSettings: (s: UserSettings) => void;\r\n}> = ({\r\n  userSettings,\r\n  setUserSettings,\r\n}) => {\r\n  return (\r\n    <div class=\"space-y-4\">\r\n      <div class=\"flex flex-col items-stretch\">\r\n        <label for=\"sidebarPosition\">Sidebar Position</label>\r\n        <select\r\n          id=\"sidebarPosition\"\r\n          value={userSettings.sidebarPosition}\r\n          onChange={(ev) => {\r\n            const sidebarPosition = ev.currentTarget.value === 'left' ? 'left' : 'right';\r\n            setUserSettings({ ...userSettings, sidebarPosition });\r\n          }}\r\n        >\r\n          <option value=\"left\">Left</option>\r\n          <option value=\"right\">Right</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OptionsUser;\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__exportStar(require(\"./src/byte-utils\"), exports);\r\n__exportStar(require(\"./src/object-3do\"), exports);\r\n__exportStar(require(\"./src/parse-3do\"), exports);\r\n","\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n      desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Parse3do = void 0;\r\nconst ByteUtils = __importStar(require(\"./byte-utils\"));\r\nconst structs_1 = require(\"./structs\");\r\nfunction fromBuffer(data) {\r\n    return {\r\n        rootNodes: parseObjects(data, 0),\r\n    };\r\n}\r\nfunction parseObjects(data, offset) {\r\n    const result = [];\r\n    let nextSibling = offset;\r\n    do {\r\n        const struct = ByteUtils.makeStruct(data, nextSibling, structs_1.OBJECT_STRUCT);\r\n        // debugPrintStruct(struct);\r\n        const name = parseName(data, struct['OffsetToObjectName']);\r\n        const vertices = parseVertices(data, struct['OffsetToVertexArray'], struct['NumberOfVertexes']);\r\n        const primitives = parsePrimitives(data, struct['OffsetToPrimitiveArray'], struct['NumberOfPrimitives']);\r\n        const children = struct['OffsetToChildObject'] !== 0\r\n            ? parseObjects(data, struct['OffsetToChildObject'])\r\n            : [];\r\n        const object = {\r\n            name,\r\n            vertices,\r\n            primitives,\r\n            children,\r\n            xOffset: struct['XFromParent'],\r\n            yOffset: struct['YFromParent'],\r\n            zOffset: struct['ZFromParent'],\r\n        };\r\n        result.push(object);\r\n        nextSibling = struct['OffsetToSiblingObject'];\r\n    } while (nextSibling !== 0);\r\n    return result;\r\n}\r\nconst textDecoder = new TextDecoder('ascii');\r\nconst NAME_LIMIT = 256;\r\nfunction parseName(data, offset) {\r\n    let size = 0;\r\n    for (let i = 0; i < NAME_LIMIT; i++) {\r\n        size = i;\r\n        const nextByte = data.getUint8(offset + i);\r\n        if (nextByte === 0)\r\n            break;\r\n    }\r\n    /*if (size === 0) {\r\n      return '';\r\n    }*/\r\n    const slice = new Uint8Array(data.buffer, offset, size);\r\n    return textDecoder.decode(slice);\r\n}\r\nfunction parseVertices(data, offset, count) {\r\n    const result = [];\r\n    for (let i = 0; i < count; i++) {\r\n        const struct = ByteUtils.makeStruct(data, offset + (i * structs_1.VERTEX_STRUCT_SIZE), structs_1.VERTEX_STRUCT);\r\n        result.push({\r\n            x: struct.x,\r\n            y: struct.y,\r\n            z: struct.z,\r\n        });\r\n    }\r\n    return result;\r\n}\r\nfunction parsePrimitives(data, offset, count) {\r\n    const result = [];\r\n    for (let i = 0; i < count; i++) {\r\n        const struct = ByteUtils.makeStruct(data, offset + (i * structs_1.PRIMITIVE_STRUCT_SIZE), structs_1.PRIMITIVE_STRUCT);\r\n        const vertexIndices = [];\r\n        for (let v = 0; v < struct['NumberOfVertexIndexes']; v++) {\r\n            // v * 2 because each vertex index reads 2 bytes (aka Uint16)\r\n            const nextVertexIndex = data.getUint16(struct['OffsetToVertexIndexArray'] + (v * 2), true);\r\n            vertexIndices.push(nextVertexIndex);\r\n        }\r\n        const textureName = parseName(data, struct['OffsetToTextureName']);\r\n        result.push({\r\n            vertexIndices,\r\n            textureName,\r\n        });\r\n    }\r\n    return result;\r\n}\r\nfunction debugPrintStruct(struct) {\r\n    for (const [field, value] of Object.entries(struct)) {\r\n        const hex = '0x' + value.toString(16).toUpperCase().padStart(4, '0');\r\n        console.log(`${field}: ${value} (${hex})`);\r\n    }\r\n    console.log();\r\n}\r\nexports.Parse3do = {\r\n    fromBuffer,\r\n};\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.makeStruct = exports.readInteger = exports.ENDIANNESSES = exports.INTEGER_TYPES = void 0;\r\nexports.INTEGER_TYPES = ['U8', 'I8', 'U16', 'I16', 'U32', 'I32'];\r\nexports.ENDIANNESSES = ['LE', 'BE'];\r\nfunction readInteger(data, pos, type, endianness = 'LE') {\r\n    if (type === 'I8') {\r\n        return data.getInt8(pos);\r\n    }\r\n    if (type === 'U8') {\r\n        return data.getUint8(pos);\r\n    }\r\n    if (type === 'I16') {\r\n        return data.getInt16(pos, endianness === 'LE');\r\n    }\r\n    if (type === 'U16') {\r\n        return data.getUint16(pos, endianness === 'LE');\r\n    }\r\n    return data.getInt32(pos, endianness === 'LE');\r\n}\r\nexports.readInteger = readInteger;\r\nfunction makeStruct(data, offset, structDef, endianness = 'LE') {\r\n    let result = {};\r\n    for (const [name, type] of structDef) {\r\n        result[name] = readInteger(data, offset, type, endianness);\r\n        if (type === 'U8' || type === 'I8') {\r\n            offset += 1;\r\n        }\r\n        else if (type === 'U16' || type === 'I16') {\r\n            offset += 2;\r\n        }\r\n        else if (type === 'U32' || type === 'I32') {\r\n            offset += 4;\r\n        }\r\n    }\r\n    return result;\r\n}\r\nexports.makeStruct = makeStruct;\r\n","import { ReadonlyVec4 } from \"gl-matrix\";\r\nimport { FunctionComponent, h } from 'preact';\r\nimport { useEffect, useMemo, useState } from \"preact/hooks\";\r\nimport SliderControl from \"./SliderControl\";\r\n\r\nconst ColorControl: FunctionComponent<{\r\n  color: ReadonlyVec4;\r\n  setColor: (c: ReadonlyVec4) => void;\r\n}> = ({ color, setColor }) => {\r\n  const [isCustom, setIsCustom] = useState(false);\r\n\r\n  let currentOption = 'custom';\r\n\r\n  if (!isCustom) {\r\n    if (color[0] === 1 && color[1] === 1 && color[2] === 1 && color[3] === 1) {\r\n      currentOption = 'white';\r\n    }\r\n    else if (color[0] === 1 && color[1] === 0 && color[2] === 0 && color[3] === 1) {\r\n      currentOption = 'red';\r\n    }\r\n    else if (color[0] === 0 && color[1] === 1 && color[2] === 0 && color[3] === 1) {\r\n      currentOption = 'green';\r\n    }\r\n    else if (color[0] === 0 && color[1] === 0 && color[2] === 1 && color[3] === 1) {\r\n      currentOption = 'blue';\r\n    }\r\n  }\r\n\r\n  const custom = useMemo(() => {\r\n    if (!isCustom) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div class=\"space-y-2\">\r\n        <SliderControl\r\n          id=\"red\"\r\n          label=\"Red\"\r\n          min={0}\r\n          max={255}\r\n          value={Math.floor(color[0] * 255)}\r\n          setValue={(value) => {\r\n            const newColor = value / 255;\r\n            setColor([newColor, color[1], color[2], color[3]]);\r\n          }}\r\n        />\r\n        <SliderControl\r\n          id=\"green\"\r\n          label=\"Green\"\r\n          min={0}\r\n          max={255}\r\n          value={Math.floor(color[1] * 255)}\r\n          setValue={(value) => {\r\n            const newColor = value / 255;\r\n            setColor([color[0], newColor, color[2], color[3]]);\r\n          }}\r\n        />\r\n        <SliderControl\r\n          id=\"blue\"\r\n          label=\"Blue\"\r\n          min={0}\r\n          max={255}\r\n          value={Math.floor(color[2] * 255)}\r\n          setValue={(value) => {\r\n            const newColor = value / 255;\r\n            setColor([color[0], color[1], newColor, color[3]]);\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }, [isCustom, color, setColor]);\r\n\r\n  return (\r\n    <div class=\"\">\r\n      <select\r\n        value={currentOption}\r\n        onChange={(ev) => {\r\n          const option = ev.currentTarget.value;\r\n\r\n          if (option === 'custom') {\r\n            setIsCustom(true);\r\n            return;\r\n          }\r\n\r\n          setIsCustom(false);\r\n\r\n          const color: ReadonlyVec4\r\n            = option === 'red' ? [1, 0, 0, 1]\r\n            : option === 'green' ? [0, 1, 0, 1]\r\n            : option === 'blue' ? [0, 0, 1, 1]\r\n            : [1, 1, 1, 1,]; // white\r\n\r\n          setColor(color);\r\n        }}\r\n      >\r\n        <option value=\"custom\">(Custom)</option>\r\n        <option value=\"white\">White</option>\r\n        <option value=\"red\">Red</option>\r\n        <option value=\"green\">Green</option>\r\n        <option value=\"blue\">Blue</option>\r\n      </select>\r\n\r\n      {custom}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ColorControl;\r\n","import { FunctionComponent, h, Fragment } from 'preact';\r\nimport { MutableRef, useMemo } from \"preact/hooks\";\r\nimport { TakLogoColorsDefinitions } from \"../../lib/logo-colors\";\r\nimport { ModelControls } from \"../../lib/types/model-controls\";\r\nimport { UserSettings } from \"../../lib/types/user-settings\";\r\nimport OptionsControls from \"./OptionsControls\";\r\nimport OptionsMisc from \"./OptionsMisc\";\r\nimport OptionsUser from \"./OptionsUser\";\r\nimport RegularOptions from \"./view-modes/RegularOptions\";\r\nimport SolidColorOptions from \"./view-modes/SolidColorOptions\";\r\nimport WireframeOptions from \"./view-modes/WireframeOptions\";\r\n\r\ntype OptionsProps = {\r\n  modelControls: ModelControls;\r\n  setModelControls: (m: ModelControls) => void;\r\n  userSettings: UserSettings;\r\n  setUserSettings: (s: UserSettings) => void;\r\n  logoDefs: TakLogoColorsDefinitions;\r\n  canvasRef: MutableRef<HTMLCanvasElement | undefined>;\r\n};\r\n\r\nconst Options: FunctionComponent<OptionsProps> = ({\r\n  modelControls,\r\n  setModelControls,\r\n  userSettings,\r\n  setUserSettings,\r\n  logoDefs,\r\n  canvasRef,\r\n}) => {\r\n  const controls = useMemo(() => (\r\n    <OptionsControls modelControls={modelControls} setModelControls={setModelControls} />\r\n  ), [modelControls, setModelControls]);\r\n\r\n  const user = useMemo(() => (\r\n    <OptionsUser userSettings={userSettings} setUserSettings={setUserSettings} />\r\n  ), [userSettings, setUserSettings]);\r\n\r\n  const viewModeOptions = useMemo(() => {\r\n    const viewMode = modelControls.viewMode;\r\n\r\n    const sub\r\n      = viewMode === 'regular'\r\n        ? <RegularOptions modelControls={modelControls} setModelControls={setModelControls} logoDefs={logoDefs} />\r\n      : viewMode === 'solid_color'\r\n        ? <SolidColorOptions modelControls={modelControls} setModelControls={setModelControls} />\r\n      : viewMode === 'wireframe'\r\n        ? <WireframeOptions modelControls={modelControls} setModelControls={setModelControls} />\r\n      : null;\r\n\r\n    return (<>\r\n      <div class=\"text-center font-bold border-b border-gray-700 mb-2 pb-1 mt-6\">View Mode Settings</div>\r\n      {sub}\r\n    </>);\r\n  }, [modelControls, setModelControls]);\r\n\r\n  return (\r\n    <div class=\"max-h-full overflow-auto px-6\">\r\n      <div class=\"text-center font-bold border-b border-gray-700 mb-2 pb-1\">Controls</div>\r\n      {controls}\r\n\r\n      {viewModeOptions}\r\n\r\n      <div class=\"text-center font-bold border-b border-gray-700 mb-2 pb-1 mt-6\">User Settings</div>\r\n      {user}\r\n\r\n      <div class=\"text-center font-bold border-b border-gray-700 mb-2 pb-1 mt-6\">Misc.</div>\r\n      <OptionsMisc\r\n        modelControls={modelControls}\r\n        setModelControls={setModelControls}\r\n        canvasRef={canvasRef}\r\n        enableSaveImageButton={userSettings.preserveDrawingBuffer}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Options;\r\n","export type ViewMode = 'regular' | 'solid_color' | 'wireframe';\r\nexport type ViewColor = [number, number, number, number];\r\n\r\nexport const VIEW_MODES: ViewMode[] = ['regular', 'solid_color', 'wireframe'];\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { ModelControls } from \"../../lib/types/model-controls\";\r\nimport { VIEW_MODES } from \"../../lib/types/view\";\r\nimport SliderControl from \"../ui/SliderControl\";\r\n\r\nconst OptionsControls: FunctionComponent<{\r\n  modelControls: ModelControls;\r\n  setModelControls: (m: ModelControls) => void;\r\n}> = ({\r\n  modelControls,\r\n  setModelControls,\r\n}) => {\r\n  return (\r\n    <div class=\"space-y-4\">\r\n      <SliderControl\r\n        id=\"zoom\"\r\n        label=\"Zoom\"\r\n        max={1000}\r\n        value={modelControls.zoom}\r\n        setValue={(zoom) => setModelControls({ ...modelControls, zoom })}\r\n      />\r\n      <SliderControl\r\n        id=\"rotationX\"\r\n        label=\"Rotation X\"\r\n        min={-180}\r\n        max={180}\r\n        value={modelControls.rotationX}\r\n        setValue={(rotationX) =>  setModelControls({ ...modelControls, rotationX })}\r\n      />\r\n      <SliderControl\r\n        id=\"rotationY\"\r\n        label=\"Rotation Y\"\r\n        min={-180}\r\n        max={180}\r\n        value={modelControls.rotationY}\r\n        setValue={(rotationY) => setModelControls({ ...modelControls, rotationY })}\r\n      />\r\n      <SliderControl\r\n        id=\"rotationZ\"\r\n        label=\"Rotation Z\"\r\n        min={-180}\r\n        max={180}\r\n        value={modelControls.rotationZ}\r\n        setValue={(rotationZ) => setModelControls({ ...modelControls, rotationZ })}\r\n      />\r\n      <SliderControl\r\n        id=\"panX\"\r\n        label=\"Pan X\"\r\n        value={modelControls.translationX}\r\n        setValue={(translationX) => setModelControls({ ...modelControls, translationX })}\r\n      />\r\n      <SliderControl\r\n        id=\"panY\"\r\n        label=\"Pan Y\"\r\n        value={modelControls.translationY}\r\n        setValue={(translationY) => setModelControls({ ...modelControls, translationY })}\r\n      />\r\n      <div class=\"flex flex-col items-stretch\">\r\n        <label for=\"viewMode\">View Mode</label>\r\n        <select\r\n          id=\"viewMode\"\r\n          value={modelControls.viewMode}\r\n          onChange={(ev) => {\r\n            const viewMode = VIEW_MODES.find((vm) => vm === ev.currentTarget.value);\r\n            if (viewMode) {\r\n              setModelControls({ ...modelControls, viewMode });\r\n            }\r\n          }}\r\n        >\r\n          <option value=\"regular\">Regular</option>\r\n          <option value=\"solid_color\">Solid Color</option>\r\n          <option value=\"wireframe\">Wireframe</option>\r\n        </select>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OptionsControls;\r\n","/* global __webpack_public_path__ */\n\nimport * as Preact from 'preact';\nconst { h, render, hydrate } = Preact;\n\nconst interopDefault = m => (m && m.default ? m.default : m);\n\nconst normalizeURL = url => (url[url.length - 1] === '/' ? url : url + '/');\n\nif (process.env.NODE_ENV === 'development') {\n\t// enable preact devtools\n\trequire('preact/debug');\n\n\t// only add a debug sw if webpack service worker is not requested.\n\tif (process.env.ADD_SW === undefined && 'serviceWorker' in navigator) {\n\t\tnavigator.serviceWorker.register(\n\t\t\tnormalizeURL(__webpack_public_path__) + 'sw-debug.js'\n\t\t);\n\t} else if (process.env.ADD_SW && 'serviceWorker' in navigator) {\n\t\tnavigator.serviceWorker.register(\n\t\t\tnormalizeURL(__webpack_public_path__) +\n\t\t\t\t(process.env.ES_BUILD ? 'sw-esm.js' : 'sw.js')\n\t\t);\n\t}\n} else if (process.env.ADD_SW && 'serviceWorker' in navigator) {\n\tnavigator.serviceWorker.register(\n\t\tnormalizeURL(__webpack_public_path__) +\n\t\t\t(process.env.ES_BUILD ? 'sw-esm.js' : 'sw.js')\n\t);\n}\n\nlet app = interopDefault(require('preact-cli-entrypoint'));\n\nif (typeof app === 'function') {\n\tlet root =\n\t\tdocument.getElementById('preact_root') || document.body.firstElementChild;\n\n\tlet init = () => {\n\t\tlet app = interopDefault(require('preact-cli-entrypoint'));\n\t\tlet preRenderData = {};\n\t\tconst inlineDataElement = document.querySelector(\n\t\t\t'[type=\"__PREACT_CLI_DATA__\"]'\n\t\t);\n\t\tif (inlineDataElement) {\n\t\t\tpreRenderData =\n\t\t\t\tJSON.parse(decodeURI(inlineDataElement.innerHTML)).preRenderData ||\n\t\t\t\tpreRenderData;\n\t\t}\n\t\t/* An object named CLI_DATA is passed as a prop,\n\t\t * this keeps us future proof if in case we decide,\n\t\t * to send other data like at some point in time.\n\t\t */\n\t\tconst CLI_DATA = { preRenderData };\n\t\tconst currentURL = preRenderData.url ? normalizeURL(preRenderData.url) : '';\n\t\tconst canHydrate =\n\t\t\tprocess.env.PRERENDER &&\n\t\t\tprocess.env.NODE_ENV === 'production' &&\n\t\t\thydrate &&\n\t\t\tcurrentURL === normalizeURL(location.pathname);\n\t\tconst doRender = canHydrate ? hydrate : render;\n\t\tdoRender(h(app, { CLI_DATA }), document.body, root);\n\t};\n\n\tif (module.hot) module.hot.accept('preact-cli-entrypoint', init);\n\n\tinit();\n}\n","import { options } from 'preact';\n\n/** @type {number} */\nlet currentIndex;\n\n/** @type {import('./internal').Component} */\nlet currentComponent;\n\n/** @type {import('./internal').Component} */\nlet previousComponent;\n\n/** @type {number} */\nlet currentHook = 0;\n\n/** @type {Array<import('./internal').Component>} */\nlet afterPaintEffects = [];\n\nlet EMPTY = [];\n\nlet oldBeforeDiff = options._diff;\nlet oldBeforeRender = options._render;\nlet oldAfterDiff = options.diffed;\nlet oldCommit = options._commit;\nlet oldBeforeUnmount = options.unmount;\n\nconst RAF_TIMEOUT = 100;\nlet prevRaf;\n\noptions._diff = vnode => {\n\tcurrentComponent = null;\n\tif (oldBeforeDiff) oldBeforeDiff(vnode);\n};\n\noptions._render = vnode => {\n\tif (oldBeforeRender) oldBeforeRender(vnode);\n\n\tcurrentComponent = vnode._component;\n\tcurrentIndex = 0;\n\n\tconst hooks = currentComponent.__hooks;\n\tif (hooks) {\n\t\tif (previousComponent === currentComponent) {\n\t\t\thooks._pendingEffects = [];\n\t\t\tcurrentComponent._renderCallbacks = [];\n\t\t\thooks._list.forEach(hookItem => {\n\t\t\t\tif (hookItem._nextValue) {\n\t\t\t\t\thookItem._value = hookItem._nextValue;\n\t\t\t\t}\n\t\t\t\thookItem._pendingValue = EMPTY;\n\t\t\t\thookItem._nextValue = hookItem._pendingArgs = undefined;\n\t\t\t});\n\t\t} else {\n\t\t\thooks._pendingEffects.forEach(invokeCleanup);\n\t\t\thooks._pendingEffects.forEach(invokeEffect);\n\t\t\thooks._pendingEffects = [];\n\t\t}\n\t}\n\tpreviousComponent = currentComponent;\n};\n\noptions.diffed = vnode => {\n\tif (oldAfterDiff) oldAfterDiff(vnode);\n\n\tconst c = vnode._component;\n\tif (c && c.__hooks) {\n\t\tif (c.__hooks._pendingEffects.length) afterPaint(afterPaintEffects.push(c));\n\t\tc.__hooks._list.forEach(hookItem => {\n\t\t\tif (hookItem._pendingArgs) {\n\t\t\t\thookItem._args = hookItem._pendingArgs;\n\t\t\t}\n\t\t\tif (hookItem._pendingValue !== EMPTY) {\n\t\t\t\thookItem._value = hookItem._pendingValue;\n\t\t\t}\n\t\t\thookItem._pendingArgs = undefined;\n\t\t\thookItem._pendingValue = EMPTY;\n\t\t});\n\t}\n\tpreviousComponent = currentComponent = null;\n};\n\noptions._commit = (vnode, commitQueue) => {\n\tcommitQueue.some(component => {\n\t\ttry {\n\t\t\tcomponent._renderCallbacks.forEach(invokeCleanup);\n\t\t\tcomponent._renderCallbacks = component._renderCallbacks.filter(cb =>\n\t\t\t\tcb._value ? invokeEffect(cb) : true\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tcommitQueue.some(c => {\n\t\t\t\tif (c._renderCallbacks) c._renderCallbacks = [];\n\t\t\t});\n\t\t\tcommitQueue = [];\n\t\t\toptions._catchError(e, component._vnode);\n\t\t}\n\t});\n\n\tif (oldCommit) oldCommit(vnode, commitQueue);\n};\n\noptions.unmount = vnode => {\n\tif (oldBeforeUnmount) oldBeforeUnmount(vnode);\n\n\tconst c = vnode._component;\n\tif (c && c.__hooks) {\n\t\tlet hasErrored;\n\t\tc.__hooks._list.forEach(s => {\n\t\t\ttry {\n\t\t\t\tinvokeCleanup(s);\n\t\t\t} catch (e) {\n\t\t\t\thasErrored = e;\n\t\t\t}\n\t\t});\n\t\tc.__hooks = undefined;\n\t\tif (hasErrored) options._catchError(hasErrored, c._vnode);\n\t}\n};\n\n/**\n * Get a hook's state from the currentComponent\n * @param {number} index The index of the hook to get\n * @param {number} type The index of the hook to get\n * @returns {any}\n */\nfunction getHookState(index, type) {\n\tif (options._hook) {\n\t\toptions._hook(currentComponent, index, currentHook || type);\n\t}\n\tcurrentHook = 0;\n\n\t// Largely inspired by:\n\t// * https://github.com/michael-klein/funcy.js/blob/f6be73468e6ec46b0ff5aa3cc4c9baf72a29025a/src/hooks/core_hooks.mjs\n\t// * https://github.com/michael-klein/funcy.js/blob/650beaa58c43c33a74820a3c98b3c7079cf2e333/src/renderer.mjs\n\t// Other implementations to look at:\n\t// * https://codesandbox.io/s/mnox05qp8\n\tconst hooks =\n\t\tcurrentComponent.__hooks ||\n\t\t(currentComponent.__hooks = {\n\t\t\t_list: [],\n\t\t\t_pendingEffects: []\n\t\t});\n\n\tif (index >= hooks._list.length) {\n\t\thooks._list.push({ _pendingValue: EMPTY });\n\t}\n\treturn hooks._list[index];\n}\n\n/**\n * @param {import('./index').StateUpdater<any>} [initialState]\n */\nexport function useState(initialState) {\n\tcurrentHook = 1;\n\treturn useReducer(invokeOrReturn, initialState);\n}\n\n/**\n * @param {import('./index').Reducer<any, any>} reducer\n * @param {import('./index').StateUpdater<any>} initialState\n * @param {(initialState: any) => void} [init]\n * @returns {[ any, (state: any) => void ]}\n */\nexport function useReducer(reducer, initialState, init) {\n\t/** @type {import('./internal').ReducerHookState} */\n\tconst hookState = getHookState(currentIndex++, 2);\n\thookState._reducer = reducer;\n\tif (!hookState._component) {\n\t\thookState._value = [\n\t\t\t!init ? invokeOrReturn(undefined, initialState) : init(initialState),\n\n\t\t\taction => {\n\t\t\t\tconst currentValue = hookState._nextValue\n\t\t\t\t\t? hookState._nextValue[0]\n\t\t\t\t\t: hookState._value[0];\n\t\t\t\tconst nextValue = hookState._reducer(currentValue, action);\n\n\t\t\t\tif (currentValue !== nextValue) {\n\t\t\t\t\thookState._nextValue = [nextValue, hookState._value[1]];\n\t\t\t\t\thookState._component.setState({});\n\t\t\t\t}\n\t\t\t}\n\t\t];\n\n\t\thookState._component = currentComponent;\n\n\t\tif (!currentComponent._hasScuFromHooks) {\n\t\t\tcurrentComponent._hasScuFromHooks = true;\n\t\t\tconst prevScu = currentComponent.shouldComponentUpdate;\n\n\t\t\t// This SCU has the purpose of bailing out after repeated updates\n\t\t\t// to stateful hooks.\n\t\t\t// we store the next value in _nextValue[0] and keep doing that for all\n\t\t\t// state setters, if we have next states and\n\t\t\t// all next states within a component end up being equal to their original state\n\t\t\t// we are safe to bail out for this specific component.\n\t\t\tcurrentComponent.shouldComponentUpdate = function(p, s, c) {\n\t\t\t\tif (!hookState._component.__hooks) return true;\n\n\t\t\t\tconst stateHooks = hookState._component.__hooks._list.filter(\n\t\t\t\t\tx => x._component\n\t\t\t\t);\n\t\t\t\tconst allHooksEmpty = stateHooks.every(x => !x._nextValue);\n\t\t\t\t// When we have no updated hooks in the component we invoke the previous SCU or\n\t\t\t\t// traverse the VDOM tree further.\n\t\t\t\tif (allHooksEmpty) {\n\t\t\t\t\treturn prevScu ? prevScu.call(this, p, s, c) : true;\n\t\t\t\t}\n\n\t\t\t\t// We check whether we have components with a nextValue set that\n\t\t\t\t// have values that aren't equal to one another this pushes\n\t\t\t\t// us to update further down the tree\n\t\t\t\tlet shouldUpdate = false;\n\t\t\t\tstateHooks.forEach(hookItem => {\n\t\t\t\t\tif (hookItem._nextValue) {\n\t\t\t\t\t\tconst currentValue = hookItem._value[0];\n\t\t\t\t\t\thookItem._value = hookItem._nextValue;\n\t\t\t\t\t\thookItem._nextValue = undefined;\n\t\t\t\t\t\tif (currentValue !== hookItem._value[0]) shouldUpdate = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn shouldUpdate || hookState._component.props !== p\n\t\t\t\t\t? prevScu\n\t\t\t\t\t\t? prevScu.call(this, p, s, c)\n\t\t\t\t\t\t: true\n\t\t\t\t\t: false;\n\t\t\t};\n\t\t}\n\t}\n\n\treturn hookState._nextValue || hookState._value;\n}\n\n/**\n * @param {import('./internal').Effect} callback\n * @param {any[]} args\n */\nexport function useEffect(callback, args) {\n\t/** @type {import('./internal').EffectHookState} */\n\tconst state = getHookState(currentIndex++, 3);\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\n\t\tstate._value = callback;\n\t\tstate._pendingArgs = args;\n\n\t\tcurrentComponent.__hooks._pendingEffects.push(state);\n\t}\n}\n\n/**\n * @param {import('./internal').Effect} callback\n * @param {any[]} args\n */\nexport function useLayoutEffect(callback, args) {\n\t/** @type {import('./internal').EffectHookState} */\n\tconst state = getHookState(currentIndex++, 4);\n\tif (!options._skipEffects && argsChanged(state._args, args)) {\n\t\tstate._value = callback;\n\t\tstate._pendingArgs = args;\n\n\t\tcurrentComponent._renderCallbacks.push(state);\n\t}\n}\n\nexport function useRef(initialValue) {\n\tcurrentHook = 5;\n\treturn useMemo(() => ({ current: initialValue }), []);\n}\n\n/**\n * @param {object} ref\n * @param {() => object} createHandle\n * @param {any[]} args\n */\nexport function useImperativeHandle(ref, createHandle, args) {\n\tcurrentHook = 6;\n\tuseLayoutEffect(\n\t\t() => {\n\t\t\tif (typeof ref == 'function') {\n\t\t\t\tref(createHandle());\n\t\t\t\treturn () => ref(null);\n\t\t\t} else if (ref) {\n\t\t\t\tref.current = createHandle();\n\t\t\t\treturn () => (ref.current = null);\n\t\t\t}\n\t\t},\n\t\targs == null ? args : args.concat(ref)\n\t);\n}\n\n/**\n * @param {() => any} factory\n * @param {any[]} args\n */\nexport function useMemo(factory, args) {\n\t/** @type {import('./internal').MemoHookState} */\n\tconst state = getHookState(currentIndex++, 7);\n\tif (argsChanged(state._args, args)) {\n\t\tstate._pendingValue = factory();\n\t\tstate._pendingArgs = args;\n\t\tstate._factory = factory;\n\t\treturn state._pendingValue;\n\t}\n\n\treturn state._value;\n}\n\n/**\n * @param {() => void} callback\n * @param {any[]} args\n */\nexport function useCallback(callback, args) {\n\tcurrentHook = 8;\n\treturn useMemo(() => callback, args);\n}\n\n/**\n * @param {import('./internal').PreactContext} context\n */\nexport function useContext(context) {\n\tconst provider = currentComponent.context[context._id];\n\t// We could skip this call here, but than we'd not call\n\t// `options._hook`. We need to do that in order to make\n\t// the devtools aware of this hook.\n\t/** @type {import('./internal').ContextHookState} */\n\tconst state = getHookState(currentIndex++, 9);\n\t// The devtools needs access to the context object to\n\t// be able to pull of the default value when no provider\n\t// is present in the tree.\n\tstate._context = context;\n\tif (!provider) return context._defaultValue;\n\t// This is probably not safe to convert to \"!\"\n\tif (state._value == null) {\n\t\tstate._value = true;\n\t\tprovider.sub(currentComponent);\n\t}\n\treturn provider.props.value;\n}\n\n/**\n * Display a custom label for a custom hook for the devtools panel\n * @type {<T>(value: T, cb?: (value: T) => string | number) => void}\n */\nexport function useDebugValue(value, formatter) {\n\tif (options.useDebugValue) {\n\t\toptions.useDebugValue(formatter ? formatter(value) : value);\n\t}\n}\n\n/**\n * @param {(error: any, errorInfo: import('preact').ErrorInfo) => void} cb\n */\nexport function useErrorBoundary(cb) {\n\t/** @type {import('./internal').ErrorBoundaryHookState} */\n\tconst state = getHookState(currentIndex++, 10);\n\tconst errState = useState();\n\tstate._value = cb;\n\tif (!currentComponent.componentDidCatch) {\n\t\tcurrentComponent.componentDidCatch = (err, errorInfo) => {\n\t\t\tif (state._value) state._value(err, errorInfo);\n\t\t\terrState[1](err);\n\t\t};\n\t}\n\treturn [\n\t\terrState[0],\n\t\t() => {\n\t\t\terrState[1](undefined);\n\t\t}\n\t];\n}\n\nexport function useId() {\n\tconst state = getHookState(currentIndex++, 11);\n\tif (!state._value) {\n\t\t// Grab either the root node or the nearest async boundary node.\n\t\t/** @type {import('./internal.d').VNode} */\n\t\tlet root = currentComponent._vnode;\n\t\twhile (root !== null && !root._mask && root._parent !== null) {\n\t\t\troot = root._parent;\n\t\t}\n\n\t\tlet mask = root._mask || (root._mask = [0, 0]);\n\t\tstate._value = 'P' + mask[0] + '-' + mask[1]++;\n\t}\n\n\treturn state._value;\n}\n/**\n * After paint effects consumer.\n */\nfunction flushAfterPaintEffects() {\n\tlet component;\n\twhile ((component = afterPaintEffects.shift())) {\n\t\tif (!component._parentDom || !component.__hooks) continue;\n\t\ttry {\n\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeCleanup);\n\t\t\tcomponent.__hooks._pendingEffects.forEach(invokeEffect);\n\t\t\tcomponent.__hooks._pendingEffects = [];\n\t\t} catch (e) {\n\t\t\tcomponent.__hooks._pendingEffects = [];\n\t\t\toptions._catchError(e, component._vnode);\n\t\t}\n\t}\n}\n\nlet HAS_RAF = typeof requestAnimationFrame == 'function';\n\n/**\n * Schedule a callback to be invoked after the browser has a chance to paint a new frame.\n * Do this by combining requestAnimationFrame (rAF) + setTimeout to invoke a callback after\n * the next browser frame.\n *\n * Also, schedule a timeout in parallel to the the rAF to ensure the callback is invoked\n * even if RAF doesn't fire (for example if the browser tab is not visible)\n *\n * @param {() => void} callback\n */\nfunction afterNextFrame(callback) {\n\tconst done = () => {\n\t\tclearTimeout(timeout);\n\t\tif (HAS_RAF) cancelAnimationFrame(raf);\n\t\tsetTimeout(callback);\n\t};\n\tconst timeout = setTimeout(done, RAF_TIMEOUT);\n\n\tlet raf;\n\tif (HAS_RAF) {\n\t\traf = requestAnimationFrame(done);\n\t}\n}\n\n// Note: if someone used options.debounceRendering = requestAnimationFrame,\n// then effects will ALWAYS run on the NEXT frame instead of the current one, incurring a ~16ms delay.\n// Perhaps this is not such a big deal.\n/**\n * Schedule afterPaintEffects flush after the browser paints\n * @param {number} newQueueLength\n */\nfunction afterPaint(newQueueLength) {\n\tif (newQueueLength === 1 || prevRaf !== options.requestAnimationFrame) {\n\t\tprevRaf = options.requestAnimationFrame;\n\t\t(prevRaf || afterNextFrame)(flushAfterPaintEffects);\n\t}\n}\n\n/**\n * @param {import('./internal').EffectHookState} hook\n */\nfunction invokeCleanup(hook) {\n\t// A hook cleanup can introduce a call to render which creates a new root, this will call options.vnode\n\t// and move the currentComponent away.\n\tconst comp = currentComponent;\n\tlet cleanup = hook._cleanup;\n\tif (typeof cleanup == 'function') {\n\t\thook._cleanup = undefined;\n\t\tcleanup();\n\t}\n\n\tcurrentComponent = comp;\n}\n\n/**\n * Invoke a Hook's effect\n * @param {import('./internal').EffectHookState} hook\n */\nfunction invokeEffect(hook) {\n\t// A hook call can introduce a call to render which creates a new root, this will call options.vnode\n\t// and move the currentComponent away.\n\tconst comp = currentComponent;\n\thook._cleanup = hook._value();\n\tcurrentComponent = comp;\n}\n\n/**\n * @param {any[]} oldArgs\n * @param {any[]} newArgs\n */\nfunction argsChanged(oldArgs, newArgs) {\n\treturn (\n\t\t!oldArgs ||\n\t\toldArgs.length !== newArgs.length ||\n\t\tnewArgs.some((arg, index) => arg !== oldArgs[index])\n\t);\n}\n\nfunction invokeOrReturn(arg, f) {\n\treturn typeof f == 'function' ? f(arg) : f;\n}\n","import { FunctionComponent, h } from 'preact';\r\n\r\nconst SliderControl: FunctionComponent<{\r\n  id: string;\r\n  label: string;\r\n  min?: number;\r\n  max?: number;\r\n  value: number;\r\n  setValue: (value: number) => void;\r\n}> = ({ id, label, min, max, value, setValue }) => {\r\n  // console.log(`Re-rendering SliderControl (${id})`);\r\n\r\n  return (\r\n    <div>\r\n      <div>\r\n        <label for={id}>{label}</label>\r\n      </div>\r\n      <div class=\"flex items-center space-x-2\">\r\n        <input\r\n          type=\"number\"\r\n          style={{ width: '80px' }}\r\n          value={value}\r\n          onChange={(ev) => {\r\n            setValue(+ev.currentTarget.value);\r\n          }}\r\n        />\r\n        <input\r\n          class=\"grow\"\r\n          type=\"range\"\r\n          min={min}\r\n          max={max}\r\n          style={{ width: '120px' }}\r\n          value={value}\r\n          onChange={(ev) => {\r\n            setValue(+ev.currentTarget.value || 0);\r\n          }}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SliderControl;\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { ModelControls } from \"../../../lib/types/model-controls\";\r\nimport ColorControl from \"../../ui/ColorControl\";\r\n\r\nconst WireframeOptions: FunctionComponent<{\r\n  modelControls: ModelControls;\r\n  setModelControls: (m: ModelControls) => void;\r\n}> = ({\r\n  modelControls,\r\n  setModelControls,\r\n}) => {\r\n  return (\r\n    <div class=\"space-y-4\">\r\n      <div>\r\n        <div class=\"\">\r\n          Wireframe Color\r\n        </div>\r\n\r\n        <ColorControl\r\n          color={modelControls.wireframeColor}\r\n          setColor={(wireframeColor) => setModelControls({ ...modelControls, wireframeColor })}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default WireframeOptions;\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n","import { EMPTY_ARR } from \"./constants\";\n\n/**\n * Assign properties from `props` to `obj`\n * @template O, P The obj and props types\n * @param {O} obj The object to copy properties to\n * @param {P} props The object to copy properties from\n * @returns {O & P}\n */\nexport function assign(obj, props) {\n\t// @ts-ignore We change the type of `obj` to be `O & P`\n\tfor (let i in props) obj[i] = props[i];\n\treturn /** @type {O & P} */ (obj);\n}\n\n/**\n * Remove a child node from its parent if attached. This is a workaround for\n * IE11 which doesn't support `Element.prototype.remove()`. Using this function\n * is smaller than including a dedicated polyfill.\n * @param {Node} node The node to remove\n */\nexport function removeNode(node) {\n\tlet parentNode = node.parentNode;\n\tif (parentNode) parentNode.removeChild(node);\n}\n\nexport const slice = EMPTY_ARR.slice;\n","import { slice } from './util';\nimport options from './options';\n\nlet vnodeId = 0;\n\n/**\n * Create an virtual node (used for JSX)\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\n * constructor for this virtual node\n * @param {object | null | undefined} [props] The properties of the virtual node\n * @param {Array<import('.').ComponentChildren>} [children] The children of the virtual node\n * @returns {import('./internal').VNode}\n */\nexport function createElement(type, props, children) {\n\tlet normalizedProps = {},\n\t\tkey,\n\t\tref,\n\t\ti;\n\tfor (i in props) {\n\t\tif (i == 'key') key = props[i];\n\t\telse if (i == 'ref') ref = props[i];\n\t\telse normalizedProps[i] = props[i];\n\t}\n\n\tif (arguments.length > 2) {\n\t\tnormalizedProps.children =\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\n\t}\n\n\t// If a Component VNode, check for and apply defaultProps\n\t// Note: type may be undefined in development, must never error here.\n\tif (typeof type == 'function' && type.defaultProps != null) {\n\t\tfor (i in type.defaultProps) {\n\t\t\tif (normalizedProps[i] === undefined) {\n\t\t\t\tnormalizedProps[i] = type.defaultProps[i];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn createVNode(type, normalizedProps, key, ref, null);\n}\n\n/**\n * Create a VNode (used internally by Preact)\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component\n * Constructor for this virtual node\n * @param {object | string | number | null} props The properties of this virtual node.\n * If this virtual node represents a text node, this is the text of the node (string or number).\n * @param {string | number | null} key The key for this virtual node, used when\n * diffing it against its children\n * @param {import('./internal').VNode[\"ref\"]} ref The ref property that will\n * receive a reference to its created child\n * @returns {import('./internal').VNode}\n */\nexport function createVNode(type, props, key, ref, original) {\n\t// V8 seems to be better at detecting type shapes if the object is allocated from the same call site\n\t// Do not inline into createElement and coerceToVNode!\n\tconst vnode = {\n\t\ttype,\n\t\tprops,\n\t\tkey,\n\t\tref,\n\t\t_children: null,\n\t\t_parent: null,\n\t\t_depth: 0,\n\t\t_dom: null,\n\t\t// _nextDom must be initialized to undefined b/c it will eventually\n\t\t// be set to dom.nextSibling which can return `null` and it is important\n\t\t// to be able to distinguish between an uninitialized _nextDom and\n\t\t// a _nextDom that has been set to `null`\n\t\t_nextDom: undefined,\n\t\t_component: null,\n\t\t_hydrating: null,\n\t\tconstructor: undefined,\n\t\t_original: original == null ? ++vnodeId : original\n\t};\n\n\t// Only invoke the vnode hook if this was *not* a direct copy:\n\tif (original == null && options.vnode != null) options.vnode(vnode);\n\n\treturn vnode;\n}\n\nexport function createRef() {\n\treturn { current: null };\n}\n\nexport function Fragment(props) {\n\treturn props.children;\n}\n\n/**\n * Check if a the argument is a valid Preact VNode.\n * @param {*} vnode\n * @returns {vnode is import('./internal').VNode}\n */\nexport const isValidElement = vnode =>\n\tvnode != null && vnode.constructor === undefined;\n","import { assign } from './util';\nimport { diff, commitRoot } from './diff/index';\nimport options from './options';\nimport { Fragment } from './create-element';\n\n/**\n * Base Component class. Provides `setState()` and `forceUpdate()`, which\n * trigger rendering\n * @param {object} props The initial component props\n * @param {object} context The initial context from parent components'\n * getChildContext\n */\nexport function Component(props, context) {\n\tthis.props = props;\n\tthis.context = context;\n}\n\n/**\n * Update component state and schedule a re-render.\n * @this {import('./internal').Component}\n * @param {object | ((s: object, p: object) => object)} update A hash of state\n * properties to update with new values or a function that given the current\n * state and props returns a new partial state\n * @param {() => void} [callback] A function to be called once component state is\n * updated\n */\nComponent.prototype.setState = function(update, callback) {\n\t// only clone state when copying to nextState the first time.\n\tlet s;\n\tif (this._nextState != null && this._nextState !== this.state) {\n\t\ts = this._nextState;\n\t} else {\n\t\ts = this._nextState = assign({}, this.state);\n\t}\n\n\tif (typeof update == 'function') {\n\t\t// Some libraries like `immer` mark the current state as readonly,\n\t\t// preventing us from mutating it, so we need to clone it. See #2716\n\t\tupdate = update(assign({}, s), this.props);\n\t}\n\n\tif (update) {\n\t\tassign(s, update);\n\t}\n\n\t// Skip update if updater function returned null\n\tif (update == null) return;\n\n\tif (this._vnode) {\n\t\tif (callback) {\n\t\t\tthis._stateCallbacks.push(callback);\n\t\t}\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Immediately perform a synchronous re-render of the component\n * @this {import('./internal').Component}\n * @param {() => void} [callback] A function to be called after component is\n * re-rendered\n */\nComponent.prototype.forceUpdate = function(callback) {\n\tif (this._vnode) {\n\t\t// Set render mode so that we can differentiate where the render request\n\t\t// is coming from. We need this because forceUpdate should never call\n\t\t// shouldComponentUpdate\n\t\tthis._force = true;\n\t\tif (callback) this._renderCallbacks.push(callback);\n\t\tenqueueRender(this);\n\t}\n};\n\n/**\n * Accepts `props` and `state`, and returns a new Virtual DOM tree to build.\n * Virtual DOM is generally constructed via [JSX](http://jasonformat.com/wtf-is-jsx).\n * @param {object} props Props (eg: JSX attributes) received from parent\n * element/component\n * @param {object} state The component's current state\n * @param {object} context Context object, as returned by the nearest\n * ancestor's `getChildContext()`\n * @returns {import('./index').ComponentChildren | void}\n */\nComponent.prototype.render = Fragment;\n\n/**\n * @param {import('./internal').VNode} vnode\n * @param {number | null} [childIndex]\n */\nexport function getDomSibling(vnode, childIndex) {\n\tif (childIndex == null) {\n\t\t// Use childIndex==null as a signal to resume the search from the vnode's sibling\n\t\treturn vnode._parent\n\t\t\t? getDomSibling(vnode._parent, vnode._parent._children.indexOf(vnode) + 1)\n\t\t\t: null;\n\t}\n\n\tlet sibling;\n\tfor (; childIndex < vnode._children.length; childIndex++) {\n\t\tsibling = vnode._children[childIndex];\n\n\t\tif (sibling != null && sibling._dom != null) {\n\t\t\t// Since updateParentDomPointers keeps _dom pointer correct,\n\t\t\t// we can rely on _dom to tell us if this subtree contains a\n\t\t\t// rendered DOM node, and what the first rendered DOM node is\n\t\t\treturn sibling._dom;\n\t\t}\n\t}\n\n\t// If we get here, we have not found a DOM node in this vnode's children.\n\t// We must resume from this vnode's sibling (in it's parent _children array)\n\t// Only climb up and search the parent if we aren't searching through a DOM\n\t// VNode (meaning we reached the DOM parent of the original vnode that began\n\t// the search)\n\treturn typeof vnode.type == 'function' ? getDomSibling(vnode) : null;\n}\n\n/**\n * Trigger in-place re-rendering of a component.\n * @param {import('./internal').Component} component The component to rerender\n */\nfunction renderComponent(component) {\n\tlet vnode = component._vnode,\n\t\toldDom = vnode._dom,\n\t\tparentDom = component._parentDom;\n\n\tif (parentDom) {\n\t\tlet commitQueue = [];\n\t\tconst oldVNode = assign({}, vnode);\n\t\toldVNode._original = vnode._original + 1;\n\n\t\tdiff(\n\t\t\tparentDom,\n\t\t\tvnode,\n\t\t\toldVNode,\n\t\t\tcomponent._globalContext,\n\t\t\tparentDom.ownerSVGElement !== undefined,\n\t\t\tvnode._hydrating != null ? [oldDom] : null,\n\t\t\tcommitQueue,\n\t\t\toldDom == null ? getDomSibling(vnode) : oldDom,\n\t\t\tvnode._hydrating\n\t\t);\n\t\tcommitRoot(commitQueue, vnode);\n\n\t\tif (vnode._dom != oldDom) {\n\t\t\tupdateParentDomPointers(vnode);\n\t\t}\n\t}\n}\n\n/**\n * @param {import('./internal').VNode} vnode\n */\nfunction updateParentDomPointers(vnode) {\n\tif ((vnode = vnode._parent) != null && vnode._component != null) {\n\t\tvnode._dom = vnode._component.base = null;\n\t\tfor (let i = 0; i < vnode._children.length; i++) {\n\t\t\tlet child = vnode._children[i];\n\t\t\tif (child != null && child._dom != null) {\n\t\t\t\tvnode._dom = vnode._component.base = child._dom;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn updateParentDomPointers(vnode);\n\t}\n}\n\n/**\n * The render queue\n * @type {Array<import('./internal').Component>}\n */\nlet rerenderQueue = [];\n\n/*\n * The value of `Component.debounce` must asynchronously invoke the passed in callback. It is\n * important that contributors to Preact can consistently reason about what calls to `setState`, etc.\n * do, and when their effects will be applied. See the links below for some further reading on designing\n * asynchronous APIs.\n * * [Designing APIs for Asynchrony](https://blog.izs.me/2013/08/designing-apis-for-asynchrony)\n * * [Callbacks synchronous and asynchronous](https://blog.ometer.com/2011/07/24/callbacks-synchronous-and-asynchronous/)\n */\n\nlet prevDebounce;\n\n/**\n * Enqueue a rerender of a component\n * @param {import('./internal').Component} c The component to rerender\n */\nexport function enqueueRender(c) {\n\tif (\n\t\t(!c._dirty &&\n\t\t\t(c._dirty = true) &&\n\t\t\trerenderQueue.push(c) &&\n\t\t\t!process._rerenderCount++) ||\n\t\tprevDebounce !== options.debounceRendering\n\t) {\n\t\tprevDebounce = options.debounceRendering;\n\t\t(prevDebounce || setTimeout)(process);\n\t}\n}\n\n/** Flush the render queue by rerendering all queued components */\nfunction process() {\n\tlet queue;\n\twhile ((process._rerenderCount = rerenderQueue.length)) {\n\t\tqueue = rerenderQueue.sort((a, b) => a._vnode._depth - b._vnode._depth);\n\t\trerenderQueue = [];\n\t\t// Don't update `renderCount` yet. Keep its value non-zero to prevent unnecessary\n\t\t// process() calls from getting scheduled while `queue` is still being consumed.\n\t\tqueue.some(c => {\n\t\t\tif (c._dirty) renderComponent(c);\n\t\t});\n\t}\n}\n\nprocess._rerenderCount = 0;\n","import { diff, unmount, applyRef } from './index';\nimport { createVNode, Fragment } from '../create-element';\nimport { EMPTY_OBJ, EMPTY_ARR } from '../constants';\nimport { getDomSibling } from '../component';\n\n/**\n * Diff the children of a virtual node\n * @param {import('../internal').PreactElement} parentDom The DOM element whose\n * children are being diffed\n * @param {import('../internal').ComponentChildren[]} renderResult\n * @param {import('../internal').VNode} newParentVNode The new virtual\n * node whose children should be diff'ed against oldParentVNode\n * @param {import('../internal').VNode} oldParentVNode The old virtual\n * node whose children should be diff'ed against newParentVNode\n * @param {object} globalContext The current context object - modified by getChildContext\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').PreactElement} oldDom The current attached DOM\n * element any new dom elements should be placed around. Likely `null` on first\n * render (except when hydrating). Can be a sibling DOM element when diffing\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} isHydrating Whether or not we are in hydration\n */\nexport function diffChildren(\n\tparentDom,\n\trenderResult,\n\tnewParentVNode,\n\toldParentVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating\n) {\n\tlet i, j, oldVNode, childVNode, newDom, firstChildDom, refs;\n\n\t// This is a compression of oldParentVNode!=null && oldParentVNode != EMPTY_OBJ && oldParentVNode._children || EMPTY_ARR\n\t// as EMPTY_OBJ._children should be `undefined`.\n\tlet oldChildren = (oldParentVNode && oldParentVNode._children) || EMPTY_ARR;\n\n\tlet oldChildrenLength = oldChildren.length;\n\n\tnewParentVNode._children = [];\n\tfor (i = 0; i < renderResult.length; i++) {\n\t\tchildVNode = renderResult[i];\n\n\t\tif (childVNode == null || typeof childVNode == 'boolean') {\n\t\t\tchildVNode = newParentVNode._children[i] = null;\n\t\t}\n\t\t// If this newVNode is being reused (e.g. <div>{reuse}{reuse}</div>) in the same diff,\n\t\t// or we are rendering a component (e.g. setState) copy the oldVNodes so it can have\n\t\t// it's own DOM & etc. pointers\n\t\telse if (\n\t\t\ttypeof childVNode == 'string' ||\n\t\t\ttypeof childVNode == 'number' ||\n\t\t\t// eslint-disable-next-line valid-typeof\n\t\t\ttypeof childVNode == 'bigint'\n\t\t) {\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tnull,\n\t\t\t\tchildVNode,\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tchildVNode\n\t\t\t);\n\t\t} else if (Array.isArray(childVNode)) {\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tFragment,\n\t\t\t\t{ children: childVNode },\n\t\t\t\tnull,\n\t\t\t\tnull,\n\t\t\t\tnull\n\t\t\t);\n\t\t} else if (childVNode._depth > 0) {\n\t\t\t// VNode is already in use, clone it. This can happen in the following\n\t\t\t// scenario:\n\t\t\t//   const reuse = <div />\n\t\t\t//   <div>{reuse}<span />{reuse}</div>\n\t\t\tchildVNode = newParentVNode._children[i] = createVNode(\n\t\t\t\tchildVNode.type,\n\t\t\t\tchildVNode.props,\n\t\t\t\tchildVNode.key,\n\t\t\t\tchildVNode.ref ? childVNode.ref : null,\n\t\t\t\tchildVNode._original\n\t\t\t);\n\t\t} else {\n\t\t\tchildVNode = newParentVNode._children[i] = childVNode;\n\t\t}\n\n\t\t// Terser removes the `continue` here and wraps the loop body\n\t\t// in a `if (childVNode) { ... } condition\n\t\tif (childVNode == null) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tchildVNode._parent = newParentVNode;\n\t\tchildVNode._depth = newParentVNode._depth + 1;\n\n\t\t// Check if we find a corresponding element in oldChildren.\n\t\t// If found, delete the array item by setting to `undefined`.\n\t\t// We use `undefined`, as `null` is reserved for empty placeholders\n\t\t// (holes).\n\t\toldVNode = oldChildren[i];\n\n\t\tif (\n\t\t\toldVNode === null ||\n\t\t\t(oldVNode &&\n\t\t\t\tchildVNode.key == oldVNode.key &&\n\t\t\t\tchildVNode.type === oldVNode.type)\n\t\t) {\n\t\t\toldChildren[i] = undefined;\n\t\t} else {\n\t\t\t// Either oldVNode === undefined or oldChildrenLength > 0,\n\t\t\t// so after this loop oldVNode == null or oldVNode is a valid value.\n\t\t\tfor (j = 0; j < oldChildrenLength; j++) {\n\t\t\t\toldVNode = oldChildren[j];\n\t\t\t\t// If childVNode is unkeyed, we only match similarly unkeyed nodes, otherwise we match by key.\n\t\t\t\t// We always match by type (in either case).\n\t\t\t\tif (\n\t\t\t\t\toldVNode &&\n\t\t\t\t\tchildVNode.key == oldVNode.key &&\n\t\t\t\t\tchildVNode.type === oldVNode.type\n\t\t\t\t) {\n\t\t\t\t\toldChildren[j] = undefined;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\toldVNode = null;\n\t\t\t}\n\t\t}\n\n\t\toldVNode = oldVNode || EMPTY_OBJ;\n\n\t\t// Morph the old element into the new one, but don't append it to the dom yet\n\t\tdiff(\n\t\t\tparentDom,\n\t\t\tchildVNode,\n\t\t\toldVNode,\n\t\t\tglobalContext,\n\t\t\tisSvg,\n\t\t\texcessDomChildren,\n\t\t\tcommitQueue,\n\t\t\toldDom,\n\t\t\tisHydrating\n\t\t);\n\n\t\tnewDom = childVNode._dom;\n\n\t\tif ((j = childVNode.ref) && oldVNode.ref != j) {\n\t\t\tif (!refs) refs = [];\n\t\t\tif (oldVNode.ref) refs.push(oldVNode.ref, null, childVNode);\n\t\t\trefs.push(j, childVNode._component || newDom, childVNode);\n\t\t}\n\n\t\tif (newDom != null) {\n\t\t\tif (firstChildDom == null) {\n\t\t\t\tfirstChildDom = newDom;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ttypeof childVNode.type == 'function' &&\n\t\t\t\tchildVNode._children === oldVNode._children\n\t\t\t) {\n\t\t\t\tchildVNode._nextDom = oldDom = reorderChildren(\n\t\t\t\t\tchildVNode,\n\t\t\t\t\toldDom,\n\t\t\t\t\tparentDom\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\toldDom = placeChild(\n\t\t\t\t\tparentDom,\n\t\t\t\t\tchildVNode,\n\t\t\t\t\toldVNode,\n\t\t\t\t\toldChildren,\n\t\t\t\t\tnewDom,\n\t\t\t\t\toldDom\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (typeof newParentVNode.type == 'function') {\n\t\t\t\t// Because the newParentVNode is Fragment-like, we need to set it's\n\t\t\t\t// _nextDom property to the nextSibling of its last child DOM node.\n\t\t\t\t//\n\t\t\t\t// `oldDom` contains the correct value here because if the last child\n\t\t\t\t// is a Fragment-like, then oldDom has already been set to that child's _nextDom.\n\t\t\t\t// If the last child is a DOM VNode, then oldDom will be set to that DOM\n\t\t\t\t// node's nextSibling.\n\t\t\t\tnewParentVNode._nextDom = oldDom;\n\t\t\t}\n\t\t} else if (\n\t\t\toldDom &&\n\t\t\toldVNode._dom == oldDom &&\n\t\t\toldDom.parentNode != parentDom\n\t\t) {\n\t\t\t// The above condition is to handle null placeholders. See test in placeholder.test.js:\n\t\t\t// `efficiently replace null placeholders in parent rerenders`\n\t\t\toldDom = getDomSibling(oldVNode);\n\t\t}\n\t}\n\n\tnewParentVNode._dom = firstChildDom;\n\n\t// Remove remaining oldChildren if there are any.\n\tfor (i = oldChildrenLength; i--; ) {\n\t\tif (oldChildren[i] != null) {\n\t\t\tunmount(oldChildren[i], oldChildren[i]);\n\t\t}\n\t}\n\n\t// Set refs only after unmount\n\tif (refs) {\n\t\tfor (i = 0; i < refs.length; i++) {\n\t\t\tapplyRef(refs[i], refs[++i], refs[++i]);\n\t\t}\n\t}\n}\n\nfunction reorderChildren(childVNode, oldDom, parentDom) {\n\t// Note: VNodes in nested suspended trees may be missing _children.\n\tlet c = childVNode._children;\n\tlet tmp = 0;\n\tfor (; c && tmp < c.length; tmp++) {\n\t\tlet vnode = c[tmp];\n\t\tif (vnode) {\n\t\t\t// We typically enter this code path on sCU bailout, where we copy\n\t\t\t// oldVNode._children to newVNode._children. If that is the case, we need\n\t\t\t// to update the old children's _parent pointer to point to the newVNode\n\t\t\t// (childVNode here).\n\t\t\tvnode._parent = childVNode;\n\n\t\t\tif (typeof vnode.type == 'function') {\n\t\t\t\toldDom = reorderChildren(vnode, oldDom, parentDom);\n\t\t\t} else {\n\t\t\t\toldDom = placeChild(parentDom, vnode, vnode, c, vnode._dom, oldDom);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn oldDom;\n}\n\n/**\n * Flatten and loop through the children of a virtual node\n * @param {import('../index').ComponentChildren} children The unflattened\n * children of a virtual node\n * @returns {import('../internal').VNode[]}\n */\nexport function toChildArray(children, out) {\n\tout = out || [];\n\tif (children == null || typeof children == 'boolean') {\n\t} else if (Array.isArray(children)) {\n\t\tchildren.some(child => {\n\t\t\ttoChildArray(child, out);\n\t\t});\n\t} else {\n\t\tout.push(children);\n\t}\n\treturn out;\n}\n\nfunction placeChild(\n\tparentDom,\n\tchildVNode,\n\toldVNode,\n\toldChildren,\n\tnewDom,\n\toldDom\n) {\n\tlet nextDom;\n\tif (childVNode._nextDom !== undefined) {\n\t\t// Only Fragments or components that return Fragment like VNodes will\n\t\t// have a non-undefined _nextDom. Continue the diff from the sibling\n\t\t// of last DOM child of this child VNode\n\t\tnextDom = childVNode._nextDom;\n\n\t\t// Eagerly cleanup _nextDom. We don't need to persist the value because\n\t\t// it is only used by `diffChildren` to determine where to resume the diff after\n\t\t// diffing Components and Fragments. Once we store it the nextDOM local var, we\n\t\t// can clean up the property\n\t\tchildVNode._nextDom = undefined;\n\t} else if (\n\t\toldVNode == null ||\n\t\tnewDom != oldDom ||\n\t\tnewDom.parentNode == null\n\t) {\n\t\touter: if (oldDom == null || oldDom.parentNode !== parentDom) {\n\t\t\tparentDom.appendChild(newDom);\n\t\t\tnextDom = null;\n\t\t} else {\n\t\t\t// `j<oldChildrenLength; j+=2` is an alternative to `j++<oldChildrenLength/2`\n\t\t\tfor (\n\t\t\t\tlet sibDom = oldDom, j = 0;\n\t\t\t\t(sibDom = sibDom.nextSibling) && j < oldChildren.length;\n\t\t\t\tj += 1\n\t\t\t) {\n\t\t\t\tif (sibDom == newDom) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t}\n\t\t\tparentDom.insertBefore(newDom, oldDom);\n\t\t\tnextDom = oldDom;\n\t\t}\n\t}\n\n\t// If we have pre-calculated the nextDOM node, use it. Else calculate it now\n\t// Strictly check for `undefined` here cuz `null` is a valid value of `nextDom`.\n\t// See more detail in create-element.js:createVNode\n\tif (nextDom !== undefined) {\n\t\toldDom = nextDom;\n\t} else {\n\t\toldDom = newDom.nextSibling;\n\t}\n\n\treturn oldDom;\n}\n","import { IS_NON_DIMENSIONAL } from '../constants';\nimport options from '../options';\n\n/**\n * Diff the old and new properties of a VNode and apply changes to the DOM node\n * @param {import('../internal').PreactElement} dom The DOM node to apply\n * changes to\n * @param {object} newProps The new props\n * @param {object} oldProps The old props\n * @param {boolean} isSvg Whether or not this node is an SVG node\n * @param {boolean} hydrate Whether or not we are in hydration mode\n */\nexport function diffProps(dom, newProps, oldProps, isSvg, hydrate) {\n\tlet i;\n\n\tfor (i in oldProps) {\n\t\tif (i !== 'children' && i !== 'key' && !(i in newProps)) {\n\t\t\tsetProperty(dom, i, null, oldProps[i], isSvg);\n\t\t}\n\t}\n\n\tfor (i in newProps) {\n\t\tif (\n\t\t\t(!hydrate || typeof newProps[i] == 'function') &&\n\t\t\ti !== 'children' &&\n\t\t\ti !== 'key' &&\n\t\t\ti !== 'value' &&\n\t\t\ti !== 'checked' &&\n\t\t\toldProps[i] !== newProps[i]\n\t\t) {\n\t\t\tsetProperty(dom, i, newProps[i], oldProps[i], isSvg);\n\t\t}\n\t}\n}\n\nfunction setStyle(style, key, value) {\n\tif (key[0] === '-') {\n\t\tstyle.setProperty(key, value);\n\t} else if (value == null) {\n\t\tstyle[key] = '';\n\t} else if (typeof value != 'number' || IS_NON_DIMENSIONAL.test(key)) {\n\t\tstyle[key] = value;\n\t} else {\n\t\tstyle[key] = value + 'px';\n\t}\n}\n\n/**\n * Set a property value on a DOM node\n * @param {import('../internal').PreactElement} dom The DOM node to modify\n * @param {string} name The name of the property to set\n * @param {*} value The value to set the property to\n * @param {*} oldValue The old value the property had\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node or not\n */\nexport function setProperty(dom, name, value, oldValue, isSvg) {\n\tlet useCapture;\n\n\to: if (name === 'style') {\n\t\tif (typeof value == 'string') {\n\t\t\tdom.style.cssText = value;\n\t\t} else {\n\t\t\tif (typeof oldValue == 'string') {\n\t\t\t\tdom.style.cssText = oldValue = '';\n\t\t\t}\n\n\t\t\tif (oldValue) {\n\t\t\t\tfor (name in oldValue) {\n\t\t\t\t\tif (!(value && name in value)) {\n\t\t\t\t\t\tsetStyle(dom.style, name, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (value) {\n\t\t\t\tfor (name in value) {\n\t\t\t\t\tif (!oldValue || value[name] !== oldValue[name]) {\n\t\t\t\t\t\tsetStyle(dom.style, name, value[name]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t// Benchmark for comparison: https://esbench.com/bench/574c954bdb965b9a00965ac6\n\telse if (name[0] === 'o' && name[1] === 'n') {\n\t\tuseCapture = name !== (name = name.replace(/Capture$/, ''));\n\n\t\t// Infer correct casing for DOM built-in events:\n\t\tif (name.toLowerCase() in dom) name = name.toLowerCase().slice(2);\n\t\telse name = name.slice(2);\n\n\t\tif (!dom._listeners) dom._listeners = {};\n\t\tdom._listeners[name + useCapture] = value;\n\n\t\tif (value) {\n\t\t\tif (!oldValue) {\n\t\t\t\tconst handler = useCapture ? eventProxyCapture : eventProxy;\n\t\t\t\tdom.addEventListener(name, handler, useCapture);\n\t\t\t}\n\t\t} else {\n\t\t\tconst handler = useCapture ? eventProxyCapture : eventProxy;\n\t\t\tdom.removeEventListener(name, handler, useCapture);\n\t\t}\n\t} else if (name !== 'dangerouslySetInnerHTML') {\n\t\tif (isSvg) {\n\t\t\t// Normalize incorrect prop usage for SVG:\n\t\t\t// - xlink:href / xlinkHref --> href (xlink:href was removed from SVG and isn't needed)\n\t\t\t// - className --> class\n\t\t\tname = name.replace(/xlink(H|:h)/, 'h').replace(/sName$/, 's');\n\t\t} else if (\n\t\t\tname !== 'href' &&\n\t\t\tname !== 'list' &&\n\t\t\tname !== 'form' &&\n\t\t\t// Default value in browsers is `-1` and an empty string is\n\t\t\t// cast to `0` instead\n\t\t\tname !== 'tabIndex' &&\n\t\t\tname !== 'download' &&\n\t\t\tname in dom\n\t\t) {\n\t\t\ttry {\n\t\t\t\tdom[name] = value == null ? '' : value;\n\t\t\t\t// labelled break is 1b smaller here than a return statement (sorry)\n\t\t\t\tbreak o;\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\t// ARIA-attributes have a different notion of boolean values.\n\t\t// The value `false` is different from the attribute not\n\t\t// existing on the DOM, so we can't remove it. For non-boolean\n\t\t// ARIA-attributes we could treat false as a removal, but the\n\t\t// amount of exceptions would cost us too many bytes. On top of\n\t\t// that other VDOM frameworks also always stringify `false`.\n\n\t\tif (typeof value === 'function') {\n\t\t\t// never serialize functions as attribute values\n\t\t} else if (value != null && (value !== false || name.indexOf('-') != -1)) {\n\t\t\tdom.setAttribute(name, value);\n\t\t} else {\n\t\t\tdom.removeAttribute(name);\n\t\t}\n\t}\n}\n\n/**\n * Proxy an event to hooked event handlers\n * @param {Event} e The event object from the browser\n * @private\n */\nfunction eventProxy(e) {\n\tthis._listeners[e.type + false](options.event ? options.event(e) : e);\n}\n\nfunction eventProxyCapture(e) {\n\tthis._listeners[e.type + true](options.event ? options.event(e) : e);\n}\n","import { EMPTY_OBJ } from '../constants';\nimport { Component, getDomSibling } from '../component';\nimport { Fragment } from '../create-element';\nimport { diffChildren } from './children';\nimport { diffProps, setProperty } from './props';\nimport { assign, removeNode, slice } from '../util';\nimport options from '../options';\n\n/**\n * Diff two virtual nodes and apply proper changes to the DOM\n * @param {import('../internal').PreactElement} parentDom The parent of the DOM element\n * @param {import('../internal').VNode} newVNode The new virtual node\n * @param {import('../internal').VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object. Modified by getChildContext\n * @param {boolean} isSvg Whether or not this element is an SVG node\n * @param {Array<import('../internal').PreactElement>} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').PreactElement} oldDom The current attached DOM\n * element any new dom elements should be placed around. Likely `null` on first\n * render (except when hydrating). Can be a sibling DOM element when diffing\n * Fragments that have siblings. In most cases, it starts out as `oldChildren[0]._dom`.\n * @param {boolean} [isHydrating] Whether or not we are in hydration\n */\nexport function diff(\n\tparentDom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\toldDom,\n\tisHydrating\n) {\n\tlet tmp,\n\t\tnewType = newVNode.type;\n\n\t// When passing through createElement it assigns the object\n\t// constructor as undefined. This to prevent JSON-injection.\n\tif (newVNode.constructor !== undefined) return null;\n\n\t// If the previous diff bailed out, resume creating/hydrating.\n\tif (oldVNode._hydrating != null) {\n\t\tisHydrating = oldVNode._hydrating;\n\t\toldDom = newVNode._dom = oldVNode._dom;\n\t\t// if we resume, we want the tree to be \"unlocked\"\n\t\tnewVNode._hydrating = null;\n\t\texcessDomChildren = [oldDom];\n\t}\n\n\tif ((tmp = options._diff)) tmp(newVNode);\n\n\ttry {\n\t\touter: if (typeof newType == 'function') {\n\t\t\tlet c, isNew, oldProps, oldState, snapshot, clearProcessingException;\n\t\t\tlet newProps = newVNode.props;\n\n\t\t\t// Necessary for createContext api. Setting this property will pass\n\t\t\t// the context value as `this.context` just for this component.\n\t\t\ttmp = newType.contextType;\n\t\t\tlet provider = tmp && globalContext[tmp._id];\n\t\t\tlet componentContext = tmp\n\t\t\t\t? provider\n\t\t\t\t\t? provider.props.value\n\t\t\t\t\t: tmp._defaultValue\n\t\t\t\t: globalContext;\n\n\t\t\t// Get component and set it to `c`\n\t\t\tif (oldVNode._component) {\n\t\t\t\tc = newVNode._component = oldVNode._component;\n\t\t\t\tclearProcessingException = c._processingException = c._pendingError;\n\t\t\t} else {\n\t\t\t\t// Instantiate the new component\n\t\t\t\tif ('prototype' in newType && newType.prototype.render) {\n\t\t\t\t\t// @ts-ignore The check above verifies that newType is suppose to be constructed\n\t\t\t\t\tnewVNode._component = c = new newType(newProps, componentContext); // eslint-disable-line new-cap\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-ignore Trust me, Component implements the interface we want\n\t\t\t\t\tnewVNode._component = c = new Component(newProps, componentContext);\n\t\t\t\t\tc.constructor = newType;\n\t\t\t\t\tc.render = doRender;\n\t\t\t\t}\n\t\t\t\tif (provider) provider.sub(c);\n\n\t\t\t\tc.props = newProps;\n\t\t\t\tif (!c.state) c.state = {};\n\t\t\t\tc.context = componentContext;\n\t\t\t\tc._globalContext = globalContext;\n\t\t\t\tisNew = c._dirty = true;\n\t\t\t\tc._renderCallbacks = [];\n\t\t\t\tc._stateCallbacks = [];\n\t\t\t}\n\n\t\t\t// Invoke getDerivedStateFromProps\n\t\t\tif (c._nextState == null) {\n\t\t\t\tc._nextState = c.state;\n\t\t\t}\n\n\t\t\tif (newType.getDerivedStateFromProps != null) {\n\t\t\t\tif (c._nextState == c.state) {\n\t\t\t\t\tc._nextState = assign({}, c._nextState);\n\t\t\t\t}\n\n\t\t\t\tassign(\n\t\t\t\t\tc._nextState,\n\t\t\t\t\tnewType.getDerivedStateFromProps(newProps, c._nextState)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\toldProps = c.props;\n\t\t\toldState = c.state;\n\n\t\t\t// Invoke pre-render lifecycle methods\n\t\t\tif (isNew) {\n\t\t\t\tif (\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tc.componentWillMount != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillMount();\n\t\t\t\t}\n\n\t\t\t\tif (c.componentDidMount != null) {\n\t\t\t\t\tc._renderCallbacks.push(c.componentDidMount);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (\n\t\t\t\t\tnewType.getDerivedStateFromProps == null &&\n\t\t\t\t\tnewProps !== oldProps &&\n\t\t\t\t\tc.componentWillReceiveProps != null\n\t\t\t\t) {\n\t\t\t\t\tc.componentWillReceiveProps(newProps, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t(!c._force &&\n\t\t\t\t\t\tc.shouldComponentUpdate != null &&\n\t\t\t\t\t\tc.shouldComponentUpdate(\n\t\t\t\t\t\t\tnewProps,\n\t\t\t\t\t\t\tc._nextState,\n\t\t\t\t\t\t\tcomponentContext\n\t\t\t\t\t\t) === false) ||\n\t\t\t\t\tnewVNode._original === oldVNode._original\n\t\t\t\t) {\n\t\t\t\t\tc.props = newProps;\n\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t\t// More info about this here: https://gist.github.com/JoviDeCroock/bec5f2ce93544d2e6070ef8e0036e4e8\n\t\t\t\t\tif (newVNode._original !== oldVNode._original) c._dirty = false;\n\t\t\t\t\tc._vnode = newVNode;\n\t\t\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t\t\t\tnewVNode._children = oldVNode._children;\n\t\t\t\t\tnewVNode._children.forEach(vnode => {\n\t\t\t\t\t\tif (vnode) vnode._parent = newVNode;\n\t\t\t\t\t});\n\n\t\t\t\t\tfor (let i = 0; i < c._stateCallbacks.length; i++) {\n\t\t\t\t\t\tc._renderCallbacks.push(c._stateCallbacks[i]);\n\t\t\t\t\t}\n\t\t\t\t\tc._stateCallbacks = [];\n\n\t\t\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\t\t\tcommitQueue.push(c);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\n\t\t\t\tif (c.componentWillUpdate != null) {\n\t\t\t\t\tc.componentWillUpdate(newProps, c._nextState, componentContext);\n\t\t\t\t}\n\n\t\t\t\tif (c.componentDidUpdate != null) {\n\t\t\t\t\tc._renderCallbacks.push(() => {\n\t\t\t\t\t\tc.componentDidUpdate(oldProps, oldState, snapshot);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tc.context = componentContext;\n\t\t\tc.props = newProps;\n\t\t\tc._vnode = newVNode;\n\t\t\tc._parentDom = parentDom;\n\n\t\t\tlet renderHook = options._render,\n\t\t\t\tcount = 0;\n\t\t\tif ('prototype' in newType && newType.prototype.render) {\n\t\t\t\tc.state = c._nextState;\n\t\t\t\tc._dirty = false;\n\n\t\t\t\tif (renderHook) renderHook(newVNode);\n\n\t\t\t\ttmp = c.render(c.props, c.state, c.context);\n\n\t\t\t\tfor (let i = 0; i < c._stateCallbacks.length; i++) {\n\t\t\t\t\tc._renderCallbacks.push(c._stateCallbacks[i]);\n\t\t\t\t}\n\t\t\t\tc._stateCallbacks = [];\n\t\t\t} else {\n\t\t\t\tdo {\n\t\t\t\t\tc._dirty = false;\n\t\t\t\t\tif (renderHook) renderHook(newVNode);\n\n\t\t\t\t\ttmp = c.render(c.props, c.state, c.context);\n\n\t\t\t\t\t// Handle setState called in render, see #2553\n\t\t\t\t\tc.state = c._nextState;\n\t\t\t\t} while (c._dirty && ++count < 25);\n\t\t\t}\n\n\t\t\t// Handle setState called in render, see #2553\n\t\t\tc.state = c._nextState;\n\n\t\t\tif (c.getChildContext != null) {\n\t\t\t\tglobalContext = assign(assign({}, globalContext), c.getChildContext());\n\t\t\t}\n\n\t\t\tif (!isNew && c.getSnapshotBeforeUpdate != null) {\n\t\t\t\tsnapshot = c.getSnapshotBeforeUpdate(oldProps, oldState);\n\t\t\t}\n\n\t\t\tlet isTopLevelFragment =\n\t\t\t\ttmp != null && tmp.type === Fragment && tmp.key == null;\n\t\t\tlet renderResult = isTopLevelFragment ? tmp.props.children : tmp;\n\n\t\t\tdiffChildren(\n\t\t\t\tparentDom,\n\t\t\t\tArray.isArray(renderResult) ? renderResult : [renderResult],\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\toldDom,\n\t\t\t\tisHydrating\n\t\t\t);\n\n\t\t\tc.base = newVNode._dom;\n\n\t\t\t// We successfully rendered this VNode, unset any stored hydration/bailout state:\n\t\t\tnewVNode._hydrating = null;\n\n\t\t\tif (c._renderCallbacks.length) {\n\t\t\t\tcommitQueue.push(c);\n\t\t\t}\n\n\t\t\tif (clearProcessingException) {\n\t\t\t\tc._pendingError = c._processingException = null;\n\t\t\t}\n\n\t\t\tc._force = false;\n\t\t} else if (\n\t\t\texcessDomChildren == null &&\n\t\t\tnewVNode._original === oldVNode._original\n\t\t) {\n\t\t\tnewVNode._children = oldVNode._children;\n\t\t\tnewVNode._dom = oldVNode._dom;\n\t\t} else {\n\t\t\tnewVNode._dom = diffElementNodes(\n\t\t\t\toldVNode._dom,\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg,\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\tisHydrating\n\t\t\t);\n\t\t}\n\n\t\tif ((tmp = options.diffed)) tmp(newVNode);\n\t} catch (e) {\n\t\tnewVNode._original = null;\n\t\t// if hydrating or creating initial tree, bailout preserves DOM:\n\t\tif (isHydrating || excessDomChildren != null) {\n\t\t\tnewVNode._dom = oldDom;\n\t\t\tnewVNode._hydrating = !!isHydrating;\n\t\t\texcessDomChildren[excessDomChildren.indexOf(oldDom)] = null;\n\t\t\t// ^ could possibly be simplified to:\n\t\t\t// excessDomChildren.length = 0;\n\t\t}\n\t\toptions._catchError(e, newVNode, oldVNode);\n\t}\n}\n\n/**\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {import('../internal').VNode} root\n */\nexport function commitRoot(commitQueue, root) {\n\tif (options._commit) options._commit(root, commitQueue);\n\n\tcommitQueue.some(c => {\n\t\ttry {\n\t\t\t// @ts-ignore Reuse the commitQueue variable here so the type changes\n\t\t\tcommitQueue = c._renderCallbacks;\n\t\t\tc._renderCallbacks = [];\n\t\t\tcommitQueue.some(cb => {\n\t\t\t\t// @ts-ignore See above ts-ignore on commitQueue\n\t\t\t\tcb.call(c);\n\t\t\t});\n\t\t} catch (e) {\n\t\t\toptions._catchError(e, c._vnode);\n\t\t}\n\t});\n}\n\n/**\n * Diff two virtual nodes representing DOM element\n * @param {import('../internal').PreactElement} dom The DOM element representing\n * the virtual nodes being diffed\n * @param {import('../internal').VNode} newVNode The new virtual node\n * @param {import('../internal').VNode} oldVNode The old virtual node\n * @param {object} globalContext The current context object\n * @param {boolean} isSvg Whether or not this DOM node is an SVG node\n * @param {*} excessDomChildren\n * @param {Array<import('../internal').Component>} commitQueue List of components\n * which have callbacks to invoke in commitRoot\n * @param {boolean} isHydrating Whether or not we are in hydration\n * @returns {import('../internal').PreactElement}\n */\nfunction diffElementNodes(\n\tdom,\n\tnewVNode,\n\toldVNode,\n\tglobalContext,\n\tisSvg,\n\texcessDomChildren,\n\tcommitQueue,\n\tisHydrating\n) {\n\tlet oldProps = oldVNode.props;\n\tlet newProps = newVNode.props;\n\tlet nodeType = newVNode.type;\n\tlet i = 0;\n\n\t// Tracks entering and exiting SVG namespace when descending through the tree.\n\tif (nodeType === 'svg') isSvg = true;\n\n\tif (excessDomChildren != null) {\n\t\tfor (; i < excessDomChildren.length; i++) {\n\t\t\tconst child = excessDomChildren[i];\n\n\t\t\t// if newVNode matches an element in excessDomChildren or the `dom`\n\t\t\t// argument matches an element in excessDomChildren, remove it from\n\t\t\t// excessDomChildren so it isn't later removed in diffChildren\n\t\t\tif (\n\t\t\t\tchild &&\n\t\t\t\t'setAttribute' in child === !!nodeType &&\n\t\t\t\t(nodeType ? child.localName === nodeType : child.nodeType === 3)\n\t\t\t) {\n\t\t\t\tdom = child;\n\t\t\t\texcessDomChildren[i] = null;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (dom == null) {\n\t\tif (nodeType === null) {\n\t\t\t// @ts-ignore createTextNode returns Text, we expect PreactElement\n\t\t\treturn document.createTextNode(newProps);\n\t\t}\n\n\t\tif (isSvg) {\n\t\t\tdom = document.createElementNS(\n\t\t\t\t'http://www.w3.org/2000/svg',\n\t\t\t\t// @ts-ignore We know `newVNode.type` is a string\n\t\t\t\tnodeType\n\t\t\t);\n\t\t} else {\n\t\t\tdom = document.createElement(\n\t\t\t\t// @ts-ignore We know `newVNode.type` is a string\n\t\t\t\tnodeType,\n\t\t\t\tnewProps.is && newProps\n\t\t\t);\n\t\t}\n\n\t\t// we created a new parent, so none of the previously attached children can be reused:\n\t\texcessDomChildren = null;\n\t\t// we are creating a new node, so we can assume this is a new subtree (in case we are hydrating), this deopts the hydrate\n\t\tisHydrating = false;\n\t}\n\n\tif (nodeType === null) {\n\t\t// During hydration, we still have to split merged text from SSR'd HTML.\n\t\tif (oldProps !== newProps && (!isHydrating || dom.data !== newProps)) {\n\t\t\tdom.data = newProps;\n\t\t}\n\t} else {\n\t\t// If excessDomChildren was not null, repopulate it with the current element's children:\n\t\texcessDomChildren = excessDomChildren && slice.call(dom.childNodes);\n\n\t\toldProps = oldVNode.props || EMPTY_OBJ;\n\n\t\tlet oldHtml = oldProps.dangerouslySetInnerHTML;\n\t\tlet newHtml = newProps.dangerouslySetInnerHTML;\n\n\t\t// During hydration, props are not diffed at all (including dangerouslySetInnerHTML)\n\t\t// @TODO we should warn in debug mode when props don't match here.\n\t\tif (!isHydrating) {\n\t\t\t// But, if we are in a situation where we are using existing DOM (e.g. replaceNode)\n\t\t\t// we should read the existing DOM attributes to diff them\n\t\t\tif (excessDomChildren != null) {\n\t\t\t\toldProps = {};\n\t\t\t\tfor (i = 0; i < dom.attributes.length; i++) {\n\t\t\t\t\toldProps[dom.attributes[i].name] = dom.attributes[i].value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (newHtml || oldHtml) {\n\t\t\t\t// Avoid re-applying the same '__html' if it did not changed between re-render\n\t\t\t\tif (\n\t\t\t\t\t!newHtml ||\n\t\t\t\t\t((!oldHtml || newHtml.__html != oldHtml.__html) &&\n\t\t\t\t\t\tnewHtml.__html !== dom.innerHTML)\n\t\t\t\t) {\n\t\t\t\t\tdom.innerHTML = (newHtml && newHtml.__html) || '';\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdiffProps(dom, newProps, oldProps, isSvg, isHydrating);\n\n\t\t// If the new vnode didn't have dangerouslySetInnerHTML, diff its children\n\t\tif (newHtml) {\n\t\t\tnewVNode._children = [];\n\t\t} else {\n\t\t\ti = newVNode.props.children;\n\t\t\tdiffChildren(\n\t\t\t\tdom,\n\t\t\t\tArray.isArray(i) ? i : [i],\n\t\t\t\tnewVNode,\n\t\t\t\toldVNode,\n\t\t\t\tglobalContext,\n\t\t\t\tisSvg && nodeType !== 'foreignObject',\n\t\t\t\texcessDomChildren,\n\t\t\t\tcommitQueue,\n\t\t\t\texcessDomChildren\n\t\t\t\t\t? excessDomChildren[0]\n\t\t\t\t\t: oldVNode._children && getDomSibling(oldVNode, 0),\n\t\t\t\tisHydrating\n\t\t\t);\n\n\t\t\t// Remove children that are not part of any vnode.\n\t\t\tif (excessDomChildren != null) {\n\t\t\t\tfor (i = excessDomChildren.length; i--; ) {\n\t\t\t\t\tif (excessDomChildren[i] != null) removeNode(excessDomChildren[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (as above, don't diff props during hydration)\n\t\tif (!isHydrating) {\n\t\t\tif (\n\t\t\t\t'value' in newProps &&\n\t\t\t\t(i = newProps.value) !== undefined &&\n\t\t\t\t// #2756 For the <progress>-element the initial value is 0,\n\t\t\t\t// despite the attribute not being present. When the attribute\n\t\t\t\t// is missing the progress bar is treated as indeterminate.\n\t\t\t\t// To fix that we'll always update it when it is 0 for progress elements\n\t\t\t\t(i !== dom.value ||\n\t\t\t\t\t(nodeType === 'progress' && !i) ||\n\t\t\t\t\t// This is only for IE 11 to fix <select> value not being updated.\n\t\t\t\t\t// To avoid a stale select value we need to set the option.value\n\t\t\t\t\t// again, which triggers IE11 to re-evaluate the select value\n\t\t\t\t\t(nodeType === 'option' && i !== oldProps.value))\n\t\t\t) {\n\t\t\t\tsetProperty(dom, 'value', i, oldProps.value, false);\n\t\t\t}\n\t\t\tif (\n\t\t\t\t'checked' in newProps &&\n\t\t\t\t(i = newProps.checked) !== undefined &&\n\t\t\t\ti !== dom.checked\n\t\t\t) {\n\t\t\t\tsetProperty(dom, 'checked', i, oldProps.checked, false);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn dom;\n}\n\n/**\n * Invoke or update a ref, depending on whether it is a function or object ref.\n * @param {object|function} ref\n * @param {any} value\n * @param {import('../internal').VNode} vnode\n */\nexport function applyRef(ref, value, vnode) {\n\ttry {\n\t\tif (typeof ref == 'function') ref(value);\n\t\telse ref.current = value;\n\t} catch (e) {\n\t\toptions._catchError(e, vnode);\n\t}\n}\n\n/**\n * Unmount a virtual node from the tree and apply DOM changes\n * @param {import('../internal').VNode} vnode The virtual node to unmount\n * @param {import('../internal').VNode} parentVNode The parent of the VNode that\n * initiated the unmount\n * @param {boolean} [skipRemove] Flag that indicates that a parent node of the\n * current element is already detached from the DOM.\n */\nexport function unmount(vnode, parentVNode, skipRemove) {\n\tlet r;\n\tif (options.unmount) options.unmount(vnode);\n\n\tif ((r = vnode.ref)) {\n\t\tif (!r.current || r.current === vnode._dom) {\n\t\t\tapplyRef(r, null, parentVNode);\n\t\t}\n\t}\n\n\tif ((r = vnode._component) != null) {\n\t\tif (r.componentWillUnmount) {\n\t\t\ttry {\n\t\t\t\tr.componentWillUnmount();\n\t\t\t} catch (e) {\n\t\t\t\toptions._catchError(e, parentVNode);\n\t\t\t}\n\t\t}\n\n\t\tr.base = r._parentDom = null;\n\t\tvnode._component = undefined;\n\t}\n\n\tif ((r = vnode._children)) {\n\t\tfor (let i = 0; i < r.length; i++) {\n\t\t\tif (r[i]) {\n\t\t\t\tunmount(\n\t\t\t\t\tr[i],\n\t\t\t\t\tparentVNode,\n\t\t\t\t\tskipRemove || typeof vnode.type !== 'function'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!skipRemove && vnode._dom != null) {\n\t\tremoveNode(vnode._dom);\n\t}\n\n\t// Must be set to `undefined` to properly clean up `_nextDom`\n\t// for which `null` is a valid value. See comment in `create-element.js`\n\tvnode._parent = vnode._dom = vnode._nextDom = undefined;\n}\n\n/** The `.render()` method for a PFC backing instance. */\nfunction doRender(props, state, context) {\n\treturn this.constructor(props, context);\n}\n","import { EMPTY_OBJ } from './constants';\nimport { commitRoot, diff } from './diff/index';\nimport { createElement, Fragment } from './create-element';\nimport options from './options';\nimport { slice } from './util';\n\n/**\n * Render a Preact virtual node into a DOM element\n * @param {import('./internal').ComponentChild} vnode The virtual node to render\n * @param {import('./internal').PreactElement} parentDom The DOM element to\n * render into\n * @param {import('./internal').PreactElement | object} [replaceNode] Optional: Attempt to re-use an\n * existing DOM tree rooted at `replaceNode`\n */\nexport function render(vnode, parentDom, replaceNode) {\n\tif (options._root) options._root(vnode, parentDom);\n\n\t// We abuse the `replaceNode` parameter in `hydrate()` to signal if we are in\n\t// hydration mode or not by passing the `hydrate` function instead of a DOM\n\t// element..\n\tlet isHydrating = typeof replaceNode === 'function';\n\n\t// To be able to support calling `render()` multiple times on the same\n\t// DOM node, we need to obtain a reference to the previous tree. We do\n\t// this by assigning a new `_children` property to DOM nodes which points\n\t// to the last rendered tree. By default this property is not present, which\n\t// means that we are mounting a new tree for the first time.\n\tlet oldVNode = isHydrating\n\t\t? null\n\t\t: (replaceNode && replaceNode._children) || parentDom._children;\n\n\tvnode = (\n\t\t(!isHydrating && replaceNode) ||\n\t\tparentDom\n\t)._children = createElement(Fragment, null, [vnode]);\n\n\t// List of effects that need to be called after diffing.\n\tlet commitQueue = [];\n\tdiff(\n\t\tparentDom,\n\t\t// Determine the new vnode tree and store it on the DOM element on\n\t\t// our custom `_children` property.\n\t\tvnode,\n\t\toldVNode || EMPTY_OBJ,\n\t\tEMPTY_OBJ,\n\t\tparentDom.ownerSVGElement !== undefined,\n\t\t!isHydrating && replaceNode\n\t\t\t? [replaceNode]\n\t\t\t: oldVNode\n\t\t\t? null\n\t\t\t: parentDom.firstChild\n\t\t\t? slice.call(parentDom.childNodes)\n\t\t\t: null,\n\t\tcommitQueue,\n\t\t!isHydrating && replaceNode\n\t\t\t? replaceNode\n\t\t\t: oldVNode\n\t\t\t? oldVNode._dom\n\t\t\t: parentDom.firstChild,\n\t\tisHydrating\n\t);\n\n\t// Flush all queued effects\n\tcommitRoot(commitQueue, vnode);\n}\n\n/**\n * Update an existing DOM element with data from a Preact virtual node\n * @param {import('./internal').ComponentChild} vnode The virtual node to render\n * @param {import('./internal').PreactElement} parentDom The DOM element to\n * update\n */\nexport function hydrate(vnode, parentDom) {\n\trender(vnode, parentDom, hydrate);\n}\n","import { assign, slice } from './util';\nimport { createVNode } from './create-element';\n\n/**\n * Clones the given VNode, optionally adding attributes/props and replacing its children.\n * @param {import('./internal').VNode} vnode The virtual DOM element to clone\n * @param {object} props Attributes/props to add when cloning\n * @param {Array<import('./internal').ComponentChildren>} rest Any additional arguments will be used as replacement children.\n * @returns {import('./internal').VNode}\n */\nexport function cloneElement(vnode, props, children) {\n\tlet normalizedProps = assign({}, vnode.props),\n\t\tkey,\n\t\tref,\n\t\ti;\n\tfor (i in props) {\n\t\tif (i == 'key') key = props[i];\n\t\telse if (i == 'ref') ref = props[i];\n\t\telse normalizedProps[i] = props[i];\n\t}\n\n\tif (arguments.length > 2) {\n\t\tnormalizedProps.children =\n\t\t\targuments.length > 3 ? slice.call(arguments, 2) : children;\n\t}\n\n\treturn createVNode(\n\t\tvnode.type,\n\t\tnormalizedProps,\n\t\tkey || vnode.key,\n\t\tref || vnode.ref,\n\t\tnull\n\t);\n}\n","import { enqueueRender } from './component';\n\nexport let i = 0;\n\nexport function createContext(defaultValue, contextId) {\n\tcontextId = '__cC' + i++;\n\n\tconst context = {\n\t\t_id: contextId,\n\t\t_defaultValue: defaultValue,\n\t\t/** @type {import('./internal').FunctionComponent} */\n\t\tConsumer(props, contextValue) {\n\t\t\t// return props.children(\n\t\t\t// \tcontext[contextId] ? context[contextId].props.value : defaultValue\n\t\t\t// );\n\t\t\treturn props.children(contextValue);\n\t\t},\n\t\t/** @type {import('./internal').FunctionComponent} */\n\t\tProvider(props) {\n\t\t\tif (!this.getChildContext) {\n\t\t\t\tlet subs = [];\n\t\t\t\tlet ctx = {};\n\t\t\t\tctx[contextId] = this;\n\n\t\t\t\tthis.getChildContext = () => ctx;\n\n\t\t\t\tthis.shouldComponentUpdate = function(_props) {\n\t\t\t\t\tif (this.props.value !== _props.value) {\n\t\t\t\t\t\t// I think the forced value propagation here was only needed when `options.debounceRendering` was being bypassed:\n\t\t\t\t\t\t// https://github.com/preactjs/preact/commit/4d339fb803bea09e9f198abf38ca1bf8ea4b7771#diff-54682ce380935a717e41b8bfc54737f6R358\n\t\t\t\t\t\t// In those cases though, even with the value corrected, we're double-rendering all nodes.\n\t\t\t\t\t\t// It might be better to just tell folks not to use force-sync mode.\n\t\t\t\t\t\t// Currently, using `useContext()` in a class component will overwrite its `this.context` value.\n\t\t\t\t\t\t// subs.some(c => {\n\t\t\t\t\t\t// \tc.context = _props.value;\n\t\t\t\t\t\t// \tenqueueRender(c);\n\t\t\t\t\t\t// });\n\n\t\t\t\t\t\t// subs.some(c => {\n\t\t\t\t\t\t// \tc.context[contextId] = _props.value;\n\t\t\t\t\t\t// \tenqueueRender(c);\n\t\t\t\t\t\t// });\n\t\t\t\t\t\tsubs.some(enqueueRender);\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.sub = c => {\n\t\t\t\t\tsubs.push(c);\n\t\t\t\t\tlet old = c.componentWillUnmount;\n\t\t\t\t\tc.componentWillUnmount = () => {\n\t\t\t\t\t\tsubs.splice(subs.indexOf(c), 1);\n\t\t\t\t\t\tif (old) old.call(c);\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn props.children;\n\t\t}\n\t};\n\n\t// Devtools needs access to the context object when it\n\t// encounters a Provider. This is necessary to support\n\t// setting `displayName` on the context object instead\n\t// of on the component itself. See:\n\t// https://reactjs.org/docs/context.html#contextdisplayname\n\n\treturn (context.Provider._contextRef = context.Consumer.contextType = context);\n}\n","import { _catchError } from './diff/catch-error';\n\n/**\n * The `option` object can potentially contain callback functions\n * that are called during various stages of our renderer. This is the\n * foundation on which all our addons like `preact/debug`, `preact/compat`,\n * and `preact/hooks` are based on. See the `Options` type in `internal.d.ts`\n * for a full list of available option hooks (most editors/IDEs allow you to\n * ctrl+click or cmd+click on mac the type definition below).\n * @type {import('./internal').Options}\n */\nconst options = {\n\t_catchError\n};\n\nexport default options;\n","export const EMPTY_OBJ = {};\nexport const EMPTY_ARR = [];\nexport const IS_NON_DIMENSIONAL = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;\n","/**\n * Find the closest error boundary to a thrown error and call it\n * @param {object} error The thrown value\n * @param {import('../internal').VNode} vnode The vnode that threw\n * the error that was caught (except for unmounting when this parameter\n * is the highest parent that was being unmounted)\n * @param {import('../internal').VNode} [oldVNode]\n * @param {import('../internal').ErrorInfo} [errorInfo]\n */\nexport function _catchError(error, vnode, oldVNode, errorInfo) {\n\t/** @type {import('../internal').Component} */\n\tlet component, ctor, handled;\n\n\tfor (; (vnode = vnode._parent); ) {\n\t\tif ((component = vnode._component) && !component._processingException) {\n\t\t\ttry {\n\t\t\t\tctor = component.constructor;\n\n\t\t\t\tif (ctor && ctor.getDerivedStateFromError != null) {\n\t\t\t\t\tcomponent.setState(ctor.getDerivedStateFromError(error));\n\t\t\t\t\thandled = component._dirty;\n\t\t\t\t}\n\n\t\t\t\tif (component.componentDidCatch != null) {\n\t\t\t\t\tcomponent.componentDidCatch(error, errorInfo || {});\n\t\t\t\t\thandled = component._dirty;\n\t\t\t\t}\n\n\t\t\t\t// This is an error boundary. Mark it as having bailed out, and whether it was mid-hydration.\n\t\t\t\tif (handled) {\n\t\t\t\t\treturn (component._pendingError = component);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\terror = e;\n\t\t\t}\n\t\t}\n\t}\n\n\tthrow error;\n}\n","import { FunctionComponent, h } from 'preact';\r\nimport { TakLogoColorsDefinitions } from \"../../../lib/logo-colors\";\r\nimport { ModelControls } from \"../../../lib/types/model-controls\";\r\n\r\nconst RegularOptions: FunctionComponent<{\r\n  modelControls: ModelControls;\r\n  setModelControls: (m: ModelControls) => void;\r\n  logoDefs: TakLogoColorsDefinitions;\r\n}> = ({\r\n  modelControls,\r\n  setModelControls,\r\n  logoDefs,\r\n}) => {\r\n  return (\r\n    <div class=\"space-y-4\">\r\n\r\n      <div>\r\n        <div>Team Color</div>\r\n        <div\r\n          class=\"flex flex-wrap -m-1 p-1\"\r\n          // style={{ background: '#333', border: '1px solid #222' }}\r\n        >\r\n          {logoDefs.idxList.map((idx) => (\r\n            <div key={idx} class=\"m-1\">\r\n              <LogoButton\r\n                htmlColor={logoDefs.idxToHtmlColor(idx)}\r\n                isSelected={modelControls.logoColorIdx === idx}\r\n                onSelect={() => setModelControls({ ...modelControls, logoColorIdx: idx })}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"space-y-2\">\r\n        <div>\r\n          <div>Texture Filter (Min.)</div>\r\n          <select\r\n            value={modelControls.textureFilterMin}\r\n            onChange={(ev) => {\r\n              const value = ev.currentTarget.value as 'linear' | 'nearest';\r\n              setModelControls({ ...modelControls, textureFilterMin: value });\r\n            }}\r\n          >\r\n            <option value=\"nearest\">Nearest</option>\r\n            <option value=\"linear\">Linear</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div>\r\n          <div>Texture Filter (Mag.)</div>\r\n          <select\r\n            value={modelControls.textureFilterMag}\r\n            onChange={(ev) => {\r\n              const value = ev.currentTarget.value as 'linear' | 'nearest';\r\n              setModelControls({ ...modelControls, textureFilterMag: value });\r\n            }}\r\n          >\r\n            <option value=\"nearest\">Nearest</option>\r\n            <option value=\"linear\">Linear</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <label class=\"flex items-center\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={modelControls.enableLightingRegular}\r\n            onChange={(ev) => {\r\n              setModelControls({\r\n                ...modelControls,\r\n                enableLightingRegular: ev.currentTarget.checked,\r\n              });\r\n            }}\r\n          />\r\n          <span class=\"pl-1\">Enable Lighting</span>\r\n        </label>\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nconst LogoButton: FunctionComponent<{\r\n  htmlColor: string;\r\n  isSelected: boolean;\r\n  onSelect: () => void;\r\n}> = ({ htmlColor, isSelected, onSelect }) => {\r\n  return (\r\n    <button\r\n      class=\"w-8 h-8 border border-2 p-1 rounded-full flex justify-center items-center\"\r\n      style={{ borderColor: htmlColor }}\r\n      onClick={() => {\r\n        if (!isSelected)\r\n          onSelect();\r\n      }}\r\n    >\r\n      <span\r\n        class=\"w-full h-full rounded-full leading-none\"\r\n        style={{ backgroundColor: isSelected ? htmlColor : '' }}\r\n      />\r\n    </button>\r\n  );\r\n};\r\n\r\nexport default RegularOptions;\r\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== 'undefined' ? Float32Array : Array;\nexport var RANDOM = Math.random;\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 4x4 Matrix<br>Format: column-major, when typed out it looks like row-major<br>The matrices are being post multiplied.\n * @module mat4\n */\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(16);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n  }\n\n  out[0] = 1;\n  out[5] = 1;\n  out[10] = 1;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  out[9] = a[9];\n  out[10] = a[10];\n  out[11] = a[11];\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\n\nexport function fromValues(m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  var out = new glMatrix.ARRAY_TYPE(16);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m03;\n  out[4] = m10;\n  out[5] = m11;\n  out[6] = m12;\n  out[7] = m13;\n  out[8] = m20;\n  out[9] = m21;\n  out[10] = m22;\n  out[11] = m23;\n  out[12] = m30;\n  out[13] = m31;\n  out[14] = m32;\n  out[15] = m33;\n  return out;\n}\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a03 = a[3];\n    var a12 = a[6],\n        a13 = a[7];\n    var a23 = a[11];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a01;\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a02;\n    out[9] = a12;\n    out[11] = a[14];\n    out[12] = a03;\n    out[13] = a13;\n    out[14] = a23;\n  } else {\n    out[0] = a[0];\n    out[1] = a[4];\n    out[2] = a[8];\n    out[3] = a[12];\n    out[4] = a[1];\n    out[5] = a[5];\n    out[6] = a[9];\n    out[7] = a[13];\n    out[8] = a[2];\n    out[9] = a[6];\n    out[10] = a[10];\n    out[11] = a[14];\n    out[12] = a[3];\n    out[13] = a[7];\n    out[14] = a[11];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the source matrix\n * @returns {mat4} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  out[0] = a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22);\n  out[1] = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n  out[2] = a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12);\n  out[3] = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n  out[4] = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n  out[5] = a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22);\n  out[6] = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n  out[7] = a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12);\n  out[8] = a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21);\n  out[9] = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n  out[10] = a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11);\n  out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n  out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n  out[13] = a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21);\n  out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n  out[15] = a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11);\n  return out;\n}\n/**\n * Calculates the determinant of a mat4\n *\n * @param {ReadonlyMat4} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n/**\n * Multiplies two mat4s\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15]; // Cache only the current line of the second matrix\n\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[4];\n  b1 = b[5];\n  b2 = b[6];\n  b3 = b[7];\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[8];\n  b1 = b[9];\n  b2 = b[10];\n  b3 = b[11];\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  b0 = b[12];\n  b1 = b[13];\n  b2 = b[14];\n  b3 = b[15];\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n  return out;\n}\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to translate\n * @param {ReadonlyVec3} v vector to translate by\n * @returns {mat4} out\n */\n\nexport function translate(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n\n  if (a === out) {\n    out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n    out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n    out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n    out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n  } else {\n    a00 = a[0];\n    a01 = a[1];\n    a02 = a[2];\n    a03 = a[3];\n    a10 = a[4];\n    a11 = a[5];\n    a12 = a[6];\n    a13 = a[7];\n    a20 = a[8];\n    a21 = a[9];\n    a22 = a[10];\n    a23 = a[11];\n    out[0] = a00;\n    out[1] = a01;\n    out[2] = a02;\n    out[3] = a03;\n    out[4] = a10;\n    out[5] = a11;\n    out[6] = a12;\n    out[7] = a13;\n    out[8] = a20;\n    out[9] = a21;\n    out[10] = a22;\n    out[11] = a23;\n    out[12] = a00 * x + a10 * y + a20 * z + a[12];\n    out[13] = a01 * x + a11 * y + a21 * z + a[13];\n    out[14] = a02 * x + a12 * y + a22 * z + a[14];\n    out[15] = a03 * x + a13 * y + a23 * z + a[15];\n  }\n\n  return out;\n}\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {ReadonlyVec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1],\n      z = v[2];\n  out[0] = a[0] * x;\n  out[1] = a[1] * x;\n  out[2] = a[2] * x;\n  out[3] = a[3] * x;\n  out[4] = a[4] * y;\n  out[5] = a[5] * y;\n  out[6] = a[6] * y;\n  out[7] = a[7] * y;\n  out[8] = a[8] * z;\n  out[9] = a[9] * z;\n  out[10] = a[10] * z;\n  out[11] = a[11] * z;\n  out[12] = a[12];\n  out[13] = a[13];\n  out[14] = a[14];\n  out[15] = a[15];\n  return out;\n}\n/**\n * Rotates a mat4 by the given angle around the given axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function rotate(out, a, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n  var a00, a01, a02, a03;\n  var a10, a11, a12, a13;\n  var a20, a21, a22, a23;\n  var b00, b01, b02;\n  var b10, b11, b12;\n  var b20, b21, b22;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c;\n  a00 = a[0];\n  a01 = a[1];\n  a02 = a[2];\n  a03 = a[3];\n  a10 = a[4];\n  a11 = a[5];\n  a12 = a[6];\n  a13 = a[7];\n  a20 = a[8];\n  a21 = a[9];\n  a22 = a[10];\n  a23 = a[11]; // Construct the elements of the rotation matrix\n\n  b00 = x * x * t + c;\n  b01 = y * x * t + z * s;\n  b02 = z * x * t - y * s;\n  b10 = x * y * t - z * s;\n  b11 = y * y * t + c;\n  b12 = z * y * t + x * s;\n  b20 = x * z * t + y * s;\n  b21 = y * z * t - x * s;\n  b22 = z * z * t + c; // Perform rotation-specific matrix multiplication\n\n  out[0] = a00 * b00 + a10 * b01 + a20 * b02;\n  out[1] = a01 * b00 + a11 * b01 + a21 * b02;\n  out[2] = a02 * b00 + a12 * b01 + a22 * b02;\n  out[3] = a03 * b00 + a13 * b01 + a23 * b02;\n  out[4] = a00 * b10 + a10 * b11 + a20 * b12;\n  out[5] = a01 * b10 + a11 * b11 + a21 * b12;\n  out[6] = a02 * b10 + a12 * b11 + a22 * b12;\n  out[7] = a03 * b10 + a13 * b11 + a23 * b12;\n  out[8] = a00 * b20 + a10 * b21 + a20 * b22;\n  out[9] = a01 * b20 + a11 * b21 + a21 * b22;\n  out[10] = a02 * b20 + a12 * b21 + a22 * b22;\n  out[11] = a03 * b20 + a13 * b21 + a23 * b22;\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  }\n\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the X axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateX(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[4] = a10 * c + a20 * s;\n  out[5] = a11 * c + a21 * s;\n  out[6] = a12 * c + a22 * s;\n  out[7] = a13 * c + a23 * s;\n  out[8] = a20 * c - a10 * s;\n  out[9] = a21 * c - a11 * s;\n  out[10] = a22 * c - a12 * s;\n  out[11] = a23 * c - a13 * s;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Y axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateY(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a20 = a[8];\n  var a21 = a[9];\n  var a22 = a[10];\n  var a23 = a[11];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged rows\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c - a20 * s;\n  out[1] = a01 * c - a21 * s;\n  out[2] = a02 * c - a22 * s;\n  out[3] = a03 * c - a23 * s;\n  out[8] = a00 * s + a20 * c;\n  out[9] = a01 * s + a21 * c;\n  out[10] = a02 * s + a22 * c;\n  out[11] = a03 * s + a23 * c;\n  return out;\n}\n/**\n * Rotates a matrix by the given angle around the Z axis\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function rotateZ(out, a, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad);\n  var a00 = a[0];\n  var a01 = a[1];\n  var a02 = a[2];\n  var a03 = a[3];\n  var a10 = a[4];\n  var a11 = a[5];\n  var a12 = a[6];\n  var a13 = a[7];\n\n  if (a !== out) {\n    // If the source and destination differ, copy the unchanged last row\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n  } // Perform axis-specific matrix multiplication\n\n\n  out[0] = a00 * c + a10 * s;\n  out[1] = a01 * c + a11 * s;\n  out[2] = a02 * c + a12 * s;\n  out[3] = a03 * c + a13 * s;\n  out[4] = a10 * c - a00 * s;\n  out[5] = a11 * c - a01 * s;\n  out[6] = a12 * c - a02 * s;\n  out[7] = a13 * c - a03 * s;\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.scale(dest, dest, vec);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyVec3} v Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = v[1];\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = v[2];\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle around a given axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotate(dest, dest, rad, axis);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @param {ReadonlyVec3} axis the axis to rotate around\n * @returns {mat4} out\n */\n\nexport function fromRotation(out, rad, axis) {\n  var x = axis[0],\n      y = axis[1],\n      z = axis[2];\n  var len = Math.hypot(x, y, z);\n  var s, c, t;\n\n  if (len < glMatrix.EPSILON) {\n    return null;\n  }\n\n  len = 1 / len;\n  x *= len;\n  y *= len;\n  z *= len;\n  s = Math.sin(rad);\n  c = Math.cos(rad);\n  t = 1 - c; // Perform rotation-specific matrix multiplication\n\n  out[0] = x * x * t + c;\n  out[1] = y * x * t + z * s;\n  out[2] = z * x * t - y * s;\n  out[3] = 0;\n  out[4] = x * y * t - z * s;\n  out[5] = y * y * t + c;\n  out[6] = z * y * t + x * s;\n  out[7] = 0;\n  out[8] = x * z * t + y * s;\n  out[9] = y * z * t - x * s;\n  out[10] = z * z * t + c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the X axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateX(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromXRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = c;\n  out[6] = s;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = -s;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Y axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateY(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromYRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = 0;\n  out[2] = -s;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = 1;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = s;\n  out[9] = 0;\n  out[10] = c;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from the given angle around the Z axis\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.rotateZ(dest, dest, rad);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat4} out\n */\n\nexport function fromZRotation(out, rad) {\n  var s = Math.sin(rad);\n  var c = Math.cos(rad); // Perform axis-specific matrix multiplication\n\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -s;\n  out[5] = c;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 1;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation and vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslation(out, q, v) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - (yy + zz);\n  out[1] = xy + wz;\n  out[2] = xz - wy;\n  out[3] = 0;\n  out[4] = xy - wz;\n  out[5] = 1 - (xx + zz);\n  out[6] = yz + wx;\n  out[7] = 0;\n  out[8] = xz + wy;\n  out[9] = yz - wx;\n  out[10] = 1 - (xx + yy);\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a new mat4 from a dual quat.\n *\n * @param {mat4} out Matrix\n * @param {ReadonlyQuat2} a Dual Quaternion\n * @returns {mat4} mat4 receiving operation result\n */\n\nexport function fromQuat2(out, a) {\n  var translation = new glMatrix.ARRAY_TYPE(3);\n  var bx = -a[0],\n      by = -a[1],\n      bz = -a[2],\n      bw = a[3],\n      ax = a[4],\n      ay = a[5],\n      az = a[6],\n      aw = a[7];\n  var magnitude = bx * bx + by * by + bz * bz + bw * bw; //Only scale if it makes sense\n\n  if (magnitude > 0) {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2 / magnitude;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2 / magnitude;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2 / magnitude;\n  } else {\n    translation[0] = (ax * bw + aw * bx + ay * bz - az * by) * 2;\n    translation[1] = (ay * bw + aw * by + az * bx - ax * bz) * 2;\n    translation[2] = (az * bw + aw * bz + ax * by - ay * bx) * 2;\n  }\n\n  fromRotationTranslation(out, a, translation);\n  return out;\n}\n/**\n * Returns the translation vector component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslation,\n *  the returned vector will be the same as the translation vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive translation component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getTranslation(out, mat) {\n  out[0] = mat[12];\n  out[1] = mat[13];\n  out[2] = mat[14];\n  return out;\n}\n/**\n * Returns the scaling factor component of a transformation\n *  matrix. If a matrix is built with fromRotationTranslationScale\n *  with a normalized Quaternion paramter, the returned vector will be\n *  the same as the scaling vector\n *  originally supplied.\n * @param  {vec3} out Vector to receive scaling factor component\n * @param  {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {vec3} out\n */\n\nexport function getScaling(out, mat) {\n  var m11 = mat[0];\n  var m12 = mat[1];\n  var m13 = mat[2];\n  var m21 = mat[4];\n  var m22 = mat[5];\n  var m23 = mat[6];\n  var m31 = mat[8];\n  var m32 = mat[9];\n  var m33 = mat[10];\n  out[0] = Math.hypot(m11, m12, m13);\n  out[1] = Math.hypot(m21, m22, m23);\n  out[2] = Math.hypot(m31, m32, m33);\n  return out;\n}\n/**\n * Returns a quaternion representing the rotational component\n *  of a transformation matrix. If a matrix is built with\n *  fromRotationTranslation, the returned quaternion will be the\n *  same as the quaternion originally supplied.\n * @param {quat} out Quaternion to receive the rotation component\n * @param {ReadonlyMat4} mat Matrix to be decomposed (input)\n * @return {quat} out\n */\n\nexport function getRotation(out, mat) {\n  var scaling = new glMatrix.ARRAY_TYPE(3);\n  getScaling(scaling, mat);\n  var is1 = 1 / scaling[0];\n  var is2 = 1 / scaling[1];\n  var is3 = 1 / scaling[2];\n  var sm11 = mat[0] * is1;\n  var sm12 = mat[1] * is2;\n  var sm13 = mat[2] * is3;\n  var sm21 = mat[4] * is1;\n  var sm22 = mat[5] * is2;\n  var sm23 = mat[6] * is3;\n  var sm31 = mat[8] * is1;\n  var sm32 = mat[9] * is2;\n  var sm33 = mat[10] * is3;\n  var trace = sm11 + sm22 + sm33;\n  var S = 0;\n\n  if (trace > 0) {\n    S = Math.sqrt(trace + 1.0) * 2;\n    out[3] = 0.25 * S;\n    out[0] = (sm23 - sm32) / S;\n    out[1] = (sm31 - sm13) / S;\n    out[2] = (sm12 - sm21) / S;\n  } else if (sm11 > sm22 && sm11 > sm33) {\n    S = Math.sqrt(1.0 + sm11 - sm22 - sm33) * 2;\n    out[3] = (sm23 - sm32) / S;\n    out[0] = 0.25 * S;\n    out[1] = (sm12 + sm21) / S;\n    out[2] = (sm31 + sm13) / S;\n  } else if (sm22 > sm33) {\n    S = Math.sqrt(1.0 + sm22 - sm11 - sm33) * 2;\n    out[3] = (sm31 - sm13) / S;\n    out[0] = (sm12 + sm21) / S;\n    out[1] = 0.25 * S;\n    out[2] = (sm23 + sm32) / S;\n  } else {\n    S = Math.sqrt(1.0 + sm33 - sm11 - sm22) * 2;\n    out[3] = (sm12 - sm21) / S;\n    out[0] = (sm31 + sm13) / S;\n    out[1] = (sm23 + sm32) / S;\n    out[2] = 0.25 * S;\n  }\n\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScale(out, q, v, s) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  out[0] = (1 - (yy + zz)) * sx;\n  out[1] = (xy + wz) * sx;\n  out[2] = (xz - wy) * sx;\n  out[3] = 0;\n  out[4] = (xy - wz) * sy;\n  out[5] = (1 - (xx + zz)) * sy;\n  out[6] = (yz + wx) * sy;\n  out[7] = 0;\n  out[8] = (xz + wy) * sz;\n  out[9] = (yz - wx) * sz;\n  out[10] = (1 - (xx + yy)) * sz;\n  out[11] = 0;\n  out[12] = v[0];\n  out[13] = v[1];\n  out[14] = v[2];\n  out[15] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a quaternion rotation, vector translation and vector scale, rotating and scaling around the given origin\n * This is equivalent to (but much faster than):\n *\n *     mat4.identity(dest);\n *     mat4.translate(dest, vec);\n *     mat4.translate(dest, origin);\n *     let quatMat = mat4.create();\n *     quat4.toMat4(quat, quatMat);\n *     mat4.multiply(dest, quatMat);\n *     mat4.scale(dest, scale)\n *     mat4.translate(dest, negativeOrigin);\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {quat4} q Rotation quaternion\n * @param {ReadonlyVec3} v Translation vector\n * @param {ReadonlyVec3} s Scaling vector\n * @param {ReadonlyVec3} o The origin vector around which to scale and rotate\n * @returns {mat4} out\n */\n\nexport function fromRotationTranslationScaleOrigin(out, q, v, s, o) {\n  // Quaternion math\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var xy = x * y2;\n  var xz = x * z2;\n  var yy = y * y2;\n  var yz = y * z2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  var sx = s[0];\n  var sy = s[1];\n  var sz = s[2];\n  var ox = o[0];\n  var oy = o[1];\n  var oz = o[2];\n  var out0 = (1 - (yy + zz)) * sx;\n  var out1 = (xy + wz) * sx;\n  var out2 = (xz - wy) * sx;\n  var out4 = (xy - wz) * sy;\n  var out5 = (1 - (xx + zz)) * sy;\n  var out6 = (yz + wx) * sy;\n  var out8 = (xz + wy) * sz;\n  var out9 = (yz - wx) * sz;\n  var out10 = (1 - (xx + yy)) * sz;\n  out[0] = out0;\n  out[1] = out1;\n  out[2] = out2;\n  out[3] = 0;\n  out[4] = out4;\n  out[5] = out5;\n  out[6] = out6;\n  out[7] = 0;\n  out[8] = out8;\n  out[9] = out9;\n  out[10] = out10;\n  out[11] = 0;\n  out[12] = v[0] + ox - (out0 * ox + out4 * oy + out8 * oz);\n  out[13] = v[1] + oy - (out1 * ox + out5 * oy + out9 * oz);\n  out[14] = v[2] + oz - (out2 * ox + out6 * oy + out10 * oz);\n  out[15] = 1;\n  return out;\n}\n/**\n * Calculates a 4x4 matrix from the given quaternion\n *\n * @param {mat4} out mat4 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat4} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[1] = yx + wz;\n  out[2] = zx - wy;\n  out[3] = 0;\n  out[4] = yx - wz;\n  out[5] = 1 - xx - zz;\n  out[6] = zy + wx;\n  out[7] = 0;\n  out[8] = zx + wy;\n  out[9] = zy - wx;\n  out[10] = 1 - xx - yy;\n  out[11] = 0;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = 0;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a frustum matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Number} left Left bound of the frustum\n * @param {Number} right Right bound of the frustum\n * @param {Number} bottom Bottom bound of the frustum\n * @param {Number} top Top bound of the frustum\n * @param {Number} near Near bound of the frustum\n * @param {Number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function frustum(out, left, right, bottom, top, near, far) {\n  var rl = 1 / (right - left);\n  var tb = 1 / (top - bottom);\n  var nf = 1 / (near - far);\n  out[0] = near * 2 * rl;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = near * 2 * tb;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = (right + left) * rl;\n  out[9] = (top + bottom) * tb;\n  out[10] = (far + near) * nf;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = far * near * 2 * nf;\n  out[15] = 0;\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveNO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = (far + near) * nf;\n    out[14] = 2 * far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -2 * near;\n  }\n\n  return out;\n}\n/**\n * Alias for {@link mat4.perspectiveNO}\n * @function\n */\n\nexport var perspective = perspectiveNO;\n/**\n * Generates a perspective projection matrix suitable for WebGPU with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n * Passing null/undefined/no value for far will generate infinite projection matrix.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum, can be null or Infinity\n * @returns {mat4} out\n */\n\nexport function perspectiveZO(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n      nf;\n  out[0] = f / aspect;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = f;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[15] = 0;\n\n  if (far != null && far !== Infinity) {\n    nf = 1 / (near - far);\n    out[10] = far * nf;\n    out[14] = far * near * nf;\n  } else {\n    out[10] = -1;\n    out[14] = -near;\n  }\n\n  return out;\n}\n/**\n * Generates a perspective projection matrix with the given field of view.\n * This is primarily useful for generating projection matrices to be used\n * with the still experiemental WebVR API.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function perspectiveFromFieldOfView(out, fov, near, far) {\n  var upTan = Math.tan(fov.upDegrees * Math.PI / 180.0);\n  var downTan = Math.tan(fov.downDegrees * Math.PI / 180.0);\n  var leftTan = Math.tan(fov.leftDegrees * Math.PI / 180.0);\n  var rightTan = Math.tan(fov.rightDegrees * Math.PI / 180.0);\n  var xScale = 2.0 / (leftTan + rightTan);\n  var yScale = 2.0 / (upTan + downTan);\n  out[0] = xScale;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  out[4] = 0.0;\n  out[5] = yScale;\n  out[6] = 0.0;\n  out[7] = 0.0;\n  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n  out[9] = (upTan - downTan) * yScale * 0.5;\n  out[10] = far / (near - far);\n  out[11] = -1.0;\n  out[12] = 0.0;\n  out[13] = 0.0;\n  out[14] = far * near / (near - far);\n  out[15] = 0.0;\n  return out;\n}\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [-1, 1],\n * which matches WebGL/OpenGL's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoNO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = 2 * nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = (far + near) * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Alias for {@link mat4.orthoNO}\n * @function\n */\n\nexport var ortho = orthoNO;\n/**\n * Generates a orthogonal projection matrix with the given bounds.\n * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n * which matches WebGPU/Vulkan/DirectX/Metal's clip volume.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\n\nexport function orthoZO(out, left, right, bottom, top, near, far) {\n  var lr = 1 / (left - right);\n  var bt = 1 / (bottom - top);\n  var nf = 1 / (near - far);\n  out[0] = -2 * lr;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = -2 * bt;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 0;\n  out[9] = 0;\n  out[10] = nf;\n  out[11] = 0;\n  out[12] = (left + right) * lr;\n  out[13] = (top + bottom) * bt;\n  out[14] = near * nf;\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis.\n * If you want a matrix that actually makes an object look at another object, you should use targetTo instead.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function lookAt(out, eye, center, up) {\n  var x0, x1, x2, y0, y1, y2, z0, z1, z2, len;\n  var eyex = eye[0];\n  var eyey = eye[1];\n  var eyez = eye[2];\n  var upx = up[0];\n  var upy = up[1];\n  var upz = up[2];\n  var centerx = center[0];\n  var centery = center[1];\n  var centerz = center[2];\n\n  if (Math.abs(eyex - centerx) < glMatrix.EPSILON && Math.abs(eyey - centery) < glMatrix.EPSILON && Math.abs(eyez - centerz) < glMatrix.EPSILON) {\n    return identity(out);\n  }\n\n  z0 = eyex - centerx;\n  z1 = eyey - centery;\n  z2 = eyez - centerz;\n  len = 1 / Math.hypot(z0, z1, z2);\n  z0 *= len;\n  z1 *= len;\n  z2 *= len;\n  x0 = upy * z2 - upz * z1;\n  x1 = upz * z0 - upx * z2;\n  x2 = upx * z1 - upy * z0;\n  len = Math.hypot(x0, x1, x2);\n\n  if (!len) {\n    x0 = 0;\n    x1 = 0;\n    x2 = 0;\n  } else {\n    len = 1 / len;\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  y0 = z1 * x2 - z2 * x1;\n  y1 = z2 * x0 - z0 * x2;\n  y2 = z0 * x1 - z1 * x0;\n  len = Math.hypot(y0, y1, y2);\n\n  if (!len) {\n    y0 = 0;\n    y1 = 0;\n    y2 = 0;\n  } else {\n    len = 1 / len;\n    y0 *= len;\n    y1 *= len;\n    y2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = y0;\n  out[2] = z0;\n  out[3] = 0;\n  out[4] = x1;\n  out[5] = y1;\n  out[6] = z1;\n  out[7] = 0;\n  out[8] = x2;\n  out[9] = y2;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez);\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez);\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez);\n  out[15] = 1;\n  return out;\n}\n/**\n * Generates a matrix that makes something look at something else.\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {ReadonlyVec3} eye Position of the viewer\n * @param {ReadonlyVec3} center Point the viewer is looking at\n * @param {ReadonlyVec3} up vec3 pointing up\n * @returns {mat4} out\n */\n\nexport function targetTo(out, eye, target, up) {\n  var eyex = eye[0],\n      eyey = eye[1],\n      eyez = eye[2],\n      upx = up[0],\n      upy = up[1],\n      upz = up[2];\n  var z0 = eyex - target[0],\n      z1 = eyey - target[1],\n      z2 = eyez - target[2];\n  var len = z0 * z0 + z1 * z1 + z2 * z2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    z0 *= len;\n    z1 *= len;\n    z2 *= len;\n  }\n\n  var x0 = upy * z2 - upz * z1,\n      x1 = upz * z0 - upx * z2,\n      x2 = upx * z1 - upy * z0;\n  len = x0 * x0 + x1 * x1 + x2 * x2;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n    x0 *= len;\n    x1 *= len;\n    x2 *= len;\n  }\n\n  out[0] = x0;\n  out[1] = x1;\n  out[2] = x2;\n  out[3] = 0;\n  out[4] = z1 * x2 - z2 * x1;\n  out[5] = z2 * x0 - z0 * x2;\n  out[6] = z0 * x1 - z1 * x0;\n  out[7] = 0;\n  out[8] = z0;\n  out[9] = z1;\n  out[10] = z2;\n  out[11] = 0;\n  out[12] = eyex;\n  out[13] = eyey;\n  out[14] = eyez;\n  out[15] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat4\n *\n * @param {ReadonlyMat4} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \", \" + a[9] + \", \" + a[10] + \", \" + a[11] + \", \" + a[12] + \", \" + a[13] + \", \" + a[14] + \", \" + a[15] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat4\n *\n * @param {ReadonlyMat4} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8], a[9], a[10], a[11], a[12], a[13], a[14], a[15]);\n}\n/**\n * Adds two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  out[9] = a[9] + b[9];\n  out[10] = a[10] + b[10];\n  out[11] = a[11] + b[11];\n  out[12] = a[12] + b[12];\n  out[13] = a[13] + b[13];\n  out[14] = a[14] + b[14];\n  out[15] = a[15] + b[15];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @returns {mat4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  out[9] = a[9] - b[9];\n  out[10] = a[10] - b[10];\n  out[11] = a[11] - b[11];\n  out[12] = a[12] - b[12];\n  out[13] = a[13] - b[13];\n  out[14] = a[14] - b[14];\n  out[15] = a[15] - b[15];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat4} out the receiving matrix\n * @param {ReadonlyMat4} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat4} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  out[9] = a[9] * b;\n  out[10] = a[10] * b;\n  out[11] = a[11] * b;\n  out[12] = a[12] * b;\n  out[13] = a[13] * b;\n  out[14] = a[14] * b;\n  out[15] = a[15] * b;\n  return out;\n}\n/**\n * Adds two mat4's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat4} out the receiving vector\n * @param {ReadonlyMat4} a the first operand\n * @param {ReadonlyMat4} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat4} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  out[9] = a[9] + b[9] * scale;\n  out[10] = a[10] + b[10] * scale;\n  out[11] = a[11] + b[11] * scale;\n  out[12] = a[12] + b[12] * scale;\n  out[13] = a[13] + b[13] * scale;\n  out[14] = a[14] + b[14] * scale;\n  out[15] = a[15] + b[15] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8] && a[9] === b[9] && a[10] === b[10] && a[11] === b[11] && a[12] === b[12] && a[13] === b[13] && a[14] === b[14] && a[15] === b[15];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat4} a The first matrix.\n * @param {ReadonlyMat4} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7];\n  var a8 = a[8],\n      a9 = a[9],\n      a10 = a[10],\n      a11 = a[11];\n  var a12 = a[12],\n      a13 = a[13],\n      a14 = a[14],\n      a15 = a[15];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  var b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7];\n  var b8 = b[8],\n      b9 = b[9],\n      b10 = b[10],\n      b11 = b[11];\n  var b12 = b[12],\n      b13 = b[13],\n      b14 = b[14],\n      b15 = b[15];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8)) && Math.abs(a9 - b9) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a9), Math.abs(b9)) && Math.abs(a10 - b10) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a10), Math.abs(b10)) && Math.abs(a11 - b11) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a11), Math.abs(b11)) && Math.abs(a12 - b12) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a12), Math.abs(b12)) && Math.abs(a13 - b13) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a13), Math.abs(b13)) && Math.abs(a14 - b14) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a14), Math.abs(b14)) && Math.abs(a15 - b15) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a15), Math.abs(b15));\n}\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat4.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If ommitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale || 1.0;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag1 = Math.sqrt(ax * ax + ay * ay + az * az),\n      mag2 = Math.sqrt(bx * bx + by * by + bz * bz),\n      mag = mag1 * mag2,\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","export class GlTexture {\r\n  protected readonly gl: WebGLRenderingContext;\r\n  private handle: WebGLTexture;\r\n  private deleted = false;\r\n  private ok = false; // has a valid texture\r\n\r\n  constructor(gl: WebGLRenderingContext) {\r\n    this.gl = gl;\r\n    const handle = gl.createTexture();\r\n\r\n    if (handle === null) {\r\n      throw new Error(`Failed to create texture.`);\r\n    }\r\n\r\n    this.handle = handle;\r\n  }\r\n\r\n  use(sampler: WebGLUniformLocation, minFilter: number, maxFilter: number): boolean {\r\n    if (this.deleted) {\r\n      throw `Trying to use a texture that has already been deleted.`;\r\n    }\r\n\r\n    if (!this.ok) {\r\n      return false;\r\n    }\r\n\r\n    this.gl.activeTexture(this.gl.TEXTURE0);\r\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.handle);\r\n    this.gl.uniform1i(sampler, 0);\r\n\r\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, minFilter);\r\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, maxFilter);\r\n\r\n    return true;\r\n  }\r\n\r\n  loadDataFromPixels(width: number, height: number, data: Uint8Array) {\r\n    if (this.deleted) {\r\n      throw `Trying to use a texture that has already been deleted.`;\r\n    }\r\n\r\n    const level = 0;\r\n    const internalFormat = this.gl.RGBA;\r\n    const border = 0;\r\n    const srcFormat = this.gl.RGBA;\r\n    const srcType = this.gl.UNSIGNED_BYTE;\r\n\r\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.handle);\r\n    this.gl.texImage2D(\r\n      this.gl.TEXTURE_2D,\r\n      level,\r\n      internalFormat,\r\n      width,\r\n      height,\r\n      border,\r\n      srcFormat,\r\n      srcType,\r\n      data,\r\n    );\r\n\r\n    this.ok = true;\r\n  }\r\n\r\n  loadDataFromImage(image: HTMLImageElement) {\r\n    if (this.deleted) {\r\n      throw `Trying to use a texture that has already been deleted.`;\r\n    }\r\n\r\n    if (!image.complete || image.naturalWidth === 0) {\r\n      console.error(`Trying to load data from an image that hasn't yet loaded!`);\r\n\r\n      const fallbackPixel = new Uint8Array([255, 255, 255, 255]); // opaque white\r\n      this.loadDataFromPixels(1, 1, fallbackPixel);\r\n\r\n      image.onload = () => {\r\n        if (image.complete && image.naturalWidth !== 0) {\r\n          this.loadDataFromImage(image);\r\n        }\r\n      };\r\n\r\n      return;\r\n    }\r\n\r\n    const level = 0;\r\n    const internalFormat = this.gl.RGBA;\r\n    const srcFormat = this.gl.RGBA;\r\n    const srcType = this.gl.UNSIGNED_BYTE;\r\n\r\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.handle);\r\n    this.gl.texImage2D(\r\n      this.gl.TEXTURE_2D,\r\n      level,\r\n      internalFormat,\r\n      srcFormat,\r\n      srcType,\r\n      image,\r\n    );\r\n\r\n    if (isPowerOf2(image.width) && isPowerOf2(image.height)) {\r\n      this.gl.generateMipmap(this.gl.TEXTURE_2D);\r\n    }\r\n\r\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\r\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\r\n\r\n    this.ok = true;\r\n  }\r\n\r\n  delete() {\r\n    this.gl.deleteTexture(this.handle);\r\n    this.deleted = true;\r\n  }\r\n}\r\n\r\nfunction isPowerOf2(value: number) {\r\n  return (value & (value - 1)) === 0;\r\n}\r\n","import { vec3 } from \"gl-matrix\";\r\nimport { GlIndexBuffer } from \"./buffer/gl-index-buffer\";\r\nimport { GlNormalBuffer } from \"./buffer/gl-normal-buffer\";\r\nimport { GlPositionBuffer } from \"./buffer/gl-position-buffer\";\r\nimport { GlTextureCoordBuffer } from \"./buffer/gl-texture-coord-buffer\";\r\nimport { GlContext } from \"./gl-context\";\r\nimport { GlEntity } from \"./gl-entity\";\r\nimport { GlModel } from \"./gl-model\";\r\nimport { ProgramInfo } from \"./program-info\";\r\nimport { Vector3 } from \"./types\";\r\n\r\ntype IndexedVerticesData = {\r\n  vertices: Vector3[];\r\n  indices: number[]; // indexes into the above /\\\r\n  texCoords: number[] | null;\r\n};\r\n\r\nfunction createModelFromIndexedVertices(\r\n  ctx: GlContext,\r\n  data: IndexedVerticesData,\r\n  computeNormals: boolean,\r\n): GlModel {\r\n  const positionData = data.vertices.flatMap((vertex) => {\r\n    return vertex;\r\n  });\r\n\r\n  const position = new GlPositionBuffer(ctx.getGl(), ctx.getProgramInfo().attribLocations.vertexPosition!);\r\n  position.bufferData(GlPositionBuffer.createBufferSourceFromPositions(positionData));\r\n\r\n  const indicesData = data.indices.map((index) => {\r\n    if (index < 0 || index > data.vertices.length - 1)\r\n      throw `Index out of bounds: ${index}`;\r\n\r\n    return index;\r\n  });\r\n\r\n  const indices = new GlIndexBuffer(ctx.getGl());\r\n  indices.bufferData(GlIndexBuffer.createBufferSourceFromIndices(indicesData));\r\n\r\n  let normals: GlNormalBuffer | undefined;\r\n\r\n  if (computeNormals) {\r\n    const normalList: vec3[] = [];\r\n\r\n    for (let i = 0; i < data.vertices.length; i++) {\r\n      normalList[i] = vec3.create();\r\n    }\r\n\r\n    for (let i = 0; i < indicesData.length; i += 3) {\r\n      const indexA = indicesData[i + 0]!;\r\n      const indexB = indicesData[i + 1]!;\r\n      const indexC = indicesData[i + 2]!;\r\n\r\n      const posA = vec3.fromValues(...data.vertices[indexA]!);\r\n      const posB = vec3.fromValues(...data.vertices[indexB]!);\r\n      const posC = vec3.fromValues(...data.vertices[indexC]!);\r\n\r\n      const edgeAB = vec3.sub(vec3.create(), posB, posA);\r\n      const edgeAC = vec3.sub(vec3.create(), posC, posA);\r\n\r\n      const areaWeightedNormal = vec3.cross(vec3.create(), edgeAB, edgeAC);\r\n\r\n      vec3.add(normalList[indexA]!, normalList[indexA]!, areaWeightedNormal);\r\n      vec3.add(normalList[indexB]!, normalList[indexB]!, areaWeightedNormal);\r\n      vec3.add(normalList[indexC]!, normalList[indexC]!, areaWeightedNormal);\r\n    }\r\n\r\n    for (let i = 0; i < data.vertices.length; i++) {\r\n      vec3.normalize(normalList[i]!, normalList[i]!);\r\n    }\r\n\r\n    normals = new GlNormalBuffer(ctx.getGl(), ctx.getProgramInfo().attribLocations.vertexNormal!);\r\n    normals.bufferData(GlNormalBuffer.createBufferSourceFromPositions(\r\n      normalList.flatMap((normals) => [normals[0], normals[1], normals[2]]),\r\n    ));\r\n  }\r\n\r\n  let texCoords: GlTextureCoordBuffer | undefined;\r\n\r\n  if (data.texCoords) {\r\n    texCoords = new GlTextureCoordBuffer(ctx.getGl(), ctx.getProgramInfo().attribLocations.textureCoord!);\r\n    texCoords.bufferData(GlTextureCoordBuffer.createBufferSourceFromCoords(data.texCoords));\r\n  }\r\n\r\n  return new GlModel(position, indices, normals, texCoords);\r\n}\r\n\r\n/**\r\n * Similar to createModelFromIndexedColoredVertices but you can simply pass only the vertex+color\r\n * information and the function will automatically remove redundant (identical vertex) items\r\n * and automatically generate indices. DOESN'T YET SUPPORT TEXCOORDS\r\n */\r\nfunction createModelFromSmartVertices(\r\n  ctx: GlContext,\r\n  data: Vector3[],\r\n  computeNormals: boolean,\r\n): GlModel {\r\n  const uniqueData: Vector3[] = []; // data but without redundant (identical) items\r\n  const uniqueDataIndices: number[] = []; // indexes data's items into the uniqueData items\r\n\r\n  outer:for (let i = 0; i < data.length; i++) {\r\n    const item = data[i]!;\r\n\r\n    for (let j = 0; j < uniqueData.length; j++) {\r\n      const normItem = uniqueData[j]!;\r\n\r\n      if (isVertexEqual(item, normItem)) {\r\n        uniqueDataIndices.push(j);\r\n        continue outer;\r\n      }\r\n    }\r\n\r\n    uniqueData.push(item);\r\n    uniqueDataIndices.push(uniqueData.length - 1);\r\n  }\r\n\r\n  return createModelFromIndexedVertices(ctx, {\r\n    vertices: uniqueData,\r\n    indices: uniqueDataIndices,\r\n    texCoords: null,\r\n  }, computeNormals);\r\n}\r\n\r\nfunction isVertexEqual(v1: Vector3, v2: Vector3): boolean {\r\n  return v1[0] === v2[0] &&\r\n         v1[1] === v2[1] &&\r\n         v1[2] === v2[2];\r\n}\r\n\r\nfunction makeCube(gl: WebGLRenderingContext, programInfo: ProgramInfo<any, any>): GlEntity {\r\n  const size = 1.0; // actually radius (because the real size will be * 2)\r\n\r\n  const positions = new GlPositionBuffer(gl, programInfo.attribLocations.vertexPosition!);\r\n    positions.bufferData(GlPositionBuffer.createBufferSourceFromPositions([\r\n      // Front face\r\n      -size, -size, size, size, -size, size, size, size, size, -size, size, size,\r\n\r\n      // Back face\r\n      -size, -size, -size, -size, size, -size, size, size, -size, size, -size, -size,\r\n\r\n      // Top face\r\n      -size, size, -size, -size, size, size, size, size, size, size, size, -size,\r\n\r\n      // Bottom face\r\n      -size, -size, -size, size, -size, -size, size, -size, size, -size, -size, size,\r\n\r\n      // Right face\r\n      size, -size, -size, size, size, -size, size, size, size, size, -size, size,\r\n\r\n      // Left face\r\n      -size, -size, -size, -size, -size, size, -size, size, size, -size, size, -size,\r\n    ]));\r\n\r\n    const indices = new GlIndexBuffer(gl);\r\n    indices.bufferData(GlIndexBuffer.createBufferSourceFromIndices([\r\n      0,\r\n      1,\r\n      2,\r\n      0,\r\n      2,\r\n      3, // front\r\n      4,\r\n      5,\r\n      6,\r\n      4,\r\n      6,\r\n      7, // back\r\n      8,\r\n      9,\r\n      10,\r\n      8,\r\n      10,\r\n      11, // top\r\n      12,\r\n      13,\r\n      14,\r\n      12,\r\n      14,\r\n      15, // bottom\r\n      16,\r\n      17,\r\n      18,\r\n      16,\r\n      18,\r\n      19, // right\r\n      20,\r\n      21,\r\n      22,\r\n      20,\r\n      22,\r\n      23, // left\r\n    ]));\r\n\r\n    const normals = new GlNormalBuffer(gl, programInfo.attribLocations.vertexNormal!);\r\n    normals.bufferData(GlNormalBuffer.createBufferSourceFromPositions([\r\n      // Front\r\n      0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0,\r\n\r\n      // Back\r\n      0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0,\r\n\r\n      // Top\r\n      0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0,\r\n\r\n      // Bottom\r\n      0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0,\r\n\r\n      // Right\r\n      1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0,\r\n\r\n      // Left\r\n      -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0, -1.0, 0.0, 0.0,\r\n    ]));\r\n\r\n    const texCoords = new GlTextureCoordBuffer(gl, programInfo.attribLocations.textureCoord!);\r\n    texCoords.bufferData(GlTextureCoordBuffer.createBufferSourceFromCoords([\r\n      // Front\r\n      0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\r\n      // Back\r\n      0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\r\n      // Top\r\n      0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\r\n      // Bottom\r\n      0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\r\n      // Right\r\n      0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\r\n      // Left\r\n      0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 1.0,\r\n    ]));\r\n\r\n    const rootModel = new GlModel(positions, indices, normals, texCoords);\r\n    const rootEntity = new GlEntity(rootModel, 'cube');\r\n\r\n    // rootEntity.setTextureKey('jugwingL');\r\n\r\n    return rootEntity;\r\n}\r\n\r\nexport const GlModelHelpers = {\r\n  createModelFromIndexedVertices,\r\n  createModelFromSmartVertices,\r\n  makeCube,\r\n};\r\n","import { Object3do, Primitive3do, Vertex3do } from \"@takingdoms/lib-3do\";\r\nimport { Utils } from \"../../utils\";\r\nimport { ObjectEntityMap } from \"../webgl-sub-renderers/webgl-sub-renderer\";\r\nimport { GlContext } from \"./gl-context\";\r\nimport { GlEntity } from \"./gl-entity\";\r\nimport { GlModel } from \"./gl-model\";\r\nimport { GlModelHelpers } from \"./gl-model-helpers\";\r\nimport { Vector3 } from \"./types\";\r\n\r\nconst SCALE = 0.000001;\r\n\r\nexport function addGlEntityFrom3do(\r\n  ctx: GlContext,\r\n  child: Object3do,\r\n  parent: GlEntity,\r\n  inputObjectEntityMap: ObjectEntityMap,\r\n  triangulateQuads: boolean,\r\n  computeNormals: boolean,\r\n  useTextures: boolean,\r\n) {\r\n  // the wrapper exists to isolate the offsets transformations from \"user\" transformations\r\n  // so for example, if the user calls entity.resetTransformations() the offsets won't be lost\r\n  // provided that the entity being referenced isn't a wrapper (which it should never be)\r\n  // TODO find a better solution (maybe store two matrices? one for parent offset and one for user transforms)\r\n  const wrapper = new GlEntity(null, 'WRAPPER:' + child.name);\r\n  wrapper.translate(child.xOffset * SCALE, child.yOffset * SCALE, child.zOffset * SCALE);\r\n\r\n  const modelParts: GlModel[] = [];\r\n\r\n  for (const primitive of child.primitives) {\r\n    const model = glModelFrom3do(\r\n      ctx,\r\n      child.vertices,\r\n      primitive,\r\n      triangulateQuads,\r\n      computeNormals,\r\n      useTextures,\r\n    );\r\n\r\n    if (model === null) {\r\n      continue;\r\n    }\r\n\r\n    if (useTextures && Utils.validateTextureName(primitive.textureName)) {\r\n      model.setTextureKey(primitive.textureName);\r\n    }\r\n\r\n    modelParts.push(model);\r\n  }\r\n\r\n  const objectEntity = new GlEntity(modelParts, child.name);\r\n  wrapper.addChild(objectEntity);\r\n  inputObjectEntityMap.set(child, objectEntity);\r\n\r\n  for (const subChild of child.children) {\r\n    addGlEntityFrom3do(\r\n      ctx,\r\n      subChild,\r\n      objectEntity,\r\n      inputObjectEntityMap,\r\n      triangulateQuads,\r\n      computeNormals,\r\n      useTextures,\r\n    );\r\n  }\r\n\r\n  parent.addChild(wrapper);\r\n}\r\n\r\nfunction glModelFrom3do(\r\n  ctx: GlContext,\r\n  vertices: Vertex3do[],\r\n  primitive: Primitive3do,\r\n  triangulateQuads: boolean,\r\n  computeNormals: boolean,\r\n  useTextures: boolean,\r\n): GlModel | null {\r\n  // pre-ordered and pre-scaled\r\n  const preOrderedVertices: Vector3[] = primitive.vertexIndices.map((index) => {\r\n    const nextVertex = vertices[index]!;\r\n    return [\r\n      nextVertex.x * SCALE,\r\n      nextVertex.y * SCALE,\r\n      nextVertex.z * SCALE,\r\n    ];\r\n  });\r\n\r\n  if (primitive.vertexIndices.length === 3) {\r\n    const texCoords = useTextures\r\n      ? [\r\n        0, 0,\r\n        0, 1,\r\n        1, 1,\r\n      ]\r\n      : null;\r\n\r\n    return GlModelHelpers.createModelFromIndexedVertices(ctx, {\r\n      vertices: preOrderedVertices,\r\n      indices: [0, 1, 2],\r\n      texCoords,\r\n    }, computeNormals);\r\n  }\r\n\r\n  if (primitive.vertexIndices.length === 4) {\r\n    // when using textures the quads should be triangulated\r\n    const texCoords = useTextures && triangulateQuads\r\n      ? [\r\n        0, 0,\r\n        1, 0,\r\n        1, 1,\r\n        0, 1,\r\n      ]\r\n      : null;\r\n\r\n    return GlModelHelpers.createModelFromIndexedVertices(ctx, {\r\n      vertices: preOrderedVertices,\r\n      indices: triangulateQuads\r\n        ? [\r\n          0, 1, 2,\r\n          0, 2, 3,\r\n        ]\r\n        : [0, 1, 2, 3],\r\n      texCoords,\r\n    }, computeNormals);\r\n  }\r\n\r\n  return null;\r\n}\r\n","import { Object3do, Object3doTree, Parse3do } from \"@takingdoms/lib-3do\";\r\nimport { FunctionComponent,h  } from \"preact\";\r\nimport { useEffect, useMemo, useState } from \"preact/hooks\";\r\nimport { WebglEngineShaderSources } from \"../../lib/engines/webgl-engine\";\r\nimport { defaultLogoColorsDefinitions, TakLogoColorsDefinitions, TakLogoIndex } from \"../../lib/logo-colors\";\r\nimport { UserService } from \"../../lib/services/user-service\";\r\nimport { TextureMapping } from \"../../lib/texture-mapping\";\r\nimport { ModelControls } from \"../../lib/types/model-controls\";\r\nimport { UserSettings } from \"../../lib/types/user-settings\";\r\nimport { ViewMode } from \"../../lib/types/view\";\r\nimport { Utils } from \"../../lib/utils\";\r\nimport Main, { ObjectStateMap } from \"../Main\";\r\n\r\nconst Loader: FunctionComponent<{\r\n  dataSource: File | string; // string = url\r\n  userService: UserService;\r\n  defaultUserSettings: UserSettings;\r\n  defaultModelControls: ModelControls;\r\n}> = ({ dataSource, userService, defaultUserSettings, defaultModelControls }) => {\r\n  const [result, setResult] = useState<Object3doTree>();\r\n  const [shaders, setShaders] = useState<WebglEngineShaderSources>();\r\n  const [textures, setTextures] = useState<TextureMapping>();\r\n  const [error, setError] = useState<any>();\r\n\r\n  const logoDefs = defaultLogoColorsDefinitions;\r\n\r\n  // TODO move this up in the component tree since shaders can be loaded BEFORE the user selects a\r\n  // dataSource\r\n  useEffect(() => {\r\n    loadShaders()\r\n      .then(setShaders);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    loadModel(dataSource)\r\n      .then((res) => {\r\n        setResult(res);\r\n        return loadTextures(res, logoDefs, 'assets/custom/pngs/', 'png');\r\n      })\r\n      .then(setTextures)\r\n      .catch(setError);\r\n  }, [dataSource, logoDefs]);\r\n\r\n  if (error !== undefined) {\r\n    return (\r\n      <div\r\n        class=\"min-w-screen min-h-screen flex flex-col justify-center items-center text-3xl\r\n          bg-black\"\r\n      >\r\n        <div class=\"text-red-300\">Error!</div>\r\n        <div class=\"text-red-600\">(TODO)</div>\r\n        <div class=\"text-red-600\">{JSON.stringify(error)}</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (result === undefined || shaders === undefined || textures === undefined) {\r\n    let message = 'Loading...';\r\n\r\n    if (result && shaders) {\r\n      message = 'Loading textures...';\r\n    }\r\n\r\n    return (\r\n      <div class=\"min-w-screen min-h-screen flex justify-center items-center text-3xl bg-black\">\r\n        <span class=\"text-gray-400\">\r\n          {message}\r\n        </span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Main\r\n      engineName=\"webgl\"\r\n      object3doTree={result}\r\n      shaders={shaders}\r\n      regularTextures={textures}\r\n      defaultObjStateMap={createStateMap(result)}\r\n      logoDefs={logoDefs}\r\n      userService={userService}\r\n      defaultUserSettings={defaultUserSettings}\r\n      defaultModelControls={{\r\n        ...defaultModelControls,\r\n        viewMode: getDefaultViewMode(textures) ?? defaultModelControls.viewMode,\r\n        logoColorIdx: getDefaultLogoColor(dataSource) ?? defaultModelControls.logoColorIdx,\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nexport default Loader;\r\n\r\nfunction createStateMap(object3doTree: Object3doTree): ObjectStateMap {\r\n  const result: ObjectStateMap = new Map();\r\n\r\n  const next = (node: Object3do) => {\r\n    result.set(node, {\r\n      highlight: false,\r\n      hide: false,\r\n    });\r\n\r\n    for (const child of node.children) {\r\n      next(child);\r\n    }\r\n  };\r\n\r\n  for (const rootChild of object3doTree.rootNodes) {\r\n    next(rootChild);\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nasync function loadShaders(): Promise<WebglEngineShaderSources> {\r\n  return {\r\n    regular: {\r\n      fsSource: await fetch('assets/shaders/regular.fs').then((res) => res.text()),\r\n      vsSource: await fetch('assets/shaders/regular.vs').then((res) => res.text()),\r\n    },\r\n    solid: {\r\n      fsSource: await fetch('assets/shaders/solid_color.fs').then((res) => res.text()),\r\n      vsSource: await fetch('assets/shaders/solid_color.vs').then((res) => res.text()),\r\n    },\r\n    wireframe: {\r\n      fsSource: await fetch('assets/shaders/wireframe.fs').then((res) => res.text()),\r\n      vsSource: await fetch('assets/shaders/wireframe.vs').then((res) => res.text()),\r\n    },\r\n  };\r\n}\r\n\r\nasync function loadModel(dataSource: File | string): Promise<Object3doTree> {\r\n  let data: ArrayBuffer;\r\n\r\n  if (typeof dataSource === 'string') {\r\n    const response = await fetch(dataSource);\r\n    data = await response.arrayBuffer();\r\n  }\r\n  else {\r\n    data = await dataSource.arrayBuffer();\r\n  }\r\n\r\n  const view = new DataView(data);\r\n  return Parse3do.fromBuffer(view);\r\n}\r\n\r\nasync function loadTextures(\r\n  tree: Object3doTree,\r\n  logoDefs: TakLogoColorsDefinitions,\r\n  basePath: string,\r\n  fileExtension: string,\r\n): Promise<TextureMapping> {\r\n  const textureNames = new Set<string>();\r\n\r\n  const loadNext = (node: Object3do) => {\r\n    for (const primitive of node.primitives) {\r\n      const textureName = primitive.textureName;\r\n\r\n      if (Utils.validateTextureName(textureName)) {\r\n        textureNames.add(textureName);\r\n      }\r\n    }\r\n\r\n    for (const child of node.children) {\r\n      loadNext(child);\r\n    }\r\n  };\r\n\r\n  for (const rootNode of tree.rootNodes) {\r\n    loadNext(rootNode);\r\n  }\r\n\r\n  const result: TextureMapping = {};\r\n\r\n  await Promise.all(Array.from(textureNames).map((textureName) => {\r\n    return new Promise<void>((resolve, reject) => {\r\n      textureName = textureName.trim();\r\n\r\n      if (textureName === '') {\r\n        result[textureName] = null;\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      const usesLogo = logoDefs.textureKeyUsesLogo(textureName);\r\n\r\n      if (!usesLogo) {\r\n        const textureFilePath = `${textureName}.${fileExtension}`;\r\n\r\n        const image = new Image();\r\n        image.src = basePath + textureFilePath;\r\n\r\n        image.onerror = () => {\r\n          console.error(`Failed to load image at: ${image.src}`);\r\n          result[textureName] = null;\r\n          resolve();\r\n        };\r\n\r\n        image.onload = () => {\r\n          result[textureName] = { type: 'html', image };\r\n          resolve();\r\n        };\r\n\r\n        return;\r\n      }\r\n\r\n      Promise.all(logoDefs.idxList.map((nextIdx) => {\r\n        return new Promise<void>((resolveInner, _rejectInner) => {\r\n          const logoTextureName = logoDefs.idxToTextureKey(nextIdx, textureName);\r\n          const textureFileName = logoDefs.idxToTextureFilename(nextIdx, textureName);\r\n          const textureFilePath = `${textureFileName}.${fileExtension}`;\r\n\r\n          const image = new Image();\r\n          image.src = basePath + textureFilePath;\r\n\r\n          image.onerror = () => {\r\n            console.error(`Failed to load image at: ${image.src}`);\r\n            result[logoTextureName] = null;\r\n            resolveInner();\r\n          };\r\n\r\n          image.onload = () => {\r\n            result[logoTextureName] = { type: 'html', image };\r\n            resolveInner();\r\n          };\r\n        });\r\n      })).then(() => resolve(), reject);\r\n    });\r\n  }));\r\n\r\n  return result;\r\n}\r\n\r\nfunction getDefaultViewMode(textures: TextureMapping): ViewMode | undefined {\r\n  const allTexturesFailed = Object.values(textures).every((value) => value === null);\r\n  return allTexturesFailed ? 'wireframe' : undefined;\r\n}\r\n\r\nfunction getDefaultLogoColor(dataSource: File | string): TakLogoIndex | undefined {\r\n  const fileName = typeof dataSource === 'string'\r\n    ? dataSource.replace(/^.*[\\\\\\/]/, '')\r\n    : dataSource.name; // File type\r\n\r\n  if (fileName.startsWith('ara')) return 3;\r\n  if (fileName.startsWith('tar')) return 1;\r\n  if (fileName.startsWith('ver')) return 0;\r\n  if (fileName.startsWith('zon')) return 7;\r\n  if (fileName.startsWith('cre')) return 6;\r\n\r\n  return undefined;\r\n}\r\n","export type UserSettings = {\r\n  sidebarPosition: 'left' | 'right';\r\n  sidebarWidth: number;\r\n  defaultTextureFilterMin: 'linear' | 'nearest';\r\n  defaultTextureFilterMag: 'linear' | 'nearest';\r\n  preserveDrawingBuffer: boolean;\r\n};\r\n\r\nexport const DEFAULT_USER_SETTINGS: UserSettings = {\r\n  sidebarPosition: 'right',\r\n  sidebarWidth: 300,\r\n  defaultTextureFilterMin: 'nearest',\r\n  defaultTextureFilterMag: 'nearest',\r\n  preserveDrawingBuffer: true,\r\n};\r\n","import { UserSettings, DEFAULT_USER_SETTINGS } from \"../types/user-settings\";\r\n\r\nexport type UserService = {\r\n  save: (userSettings: UserSettings) => void;\r\n  load: () => UserSettings | undefined;\r\n};\r\n\r\nexport const localStorageUserService: UserService = {\r\n  save: (userSettings: UserSettings) => {\r\n    const str = JSON.stringify(userSettings);\r\n    localStorage.setItem('user', str);\r\n  },\r\n  load: (): UserSettings | undefined => {\r\n    const str = localStorage.getItem('user');\r\n\r\n    if (str === null) {\r\n      return undefined;\r\n    }\r\n\r\n    const obj = JSON.parse(str);\r\n\r\n    if (typeof obj !== 'object') {\r\n      throw new Error(`User settings is not an object`);\r\n    }\r\n\r\n    const sidebarPosition = obj['sidebarPosition'];\r\n\r\n    if (sidebarPosition !== 'left' && sidebarPosition !== 'right') {\r\n      throw new Error(`Invalid sidebarPosition`);\r\n    }\r\n\r\n    const sidebarWidth = obj['sidebarWidth'];\r\n\r\n    if (typeof sidebarWidth !== 'number') {\r\n      throw new Error(`Invalid sidebarWidth`);\r\n    }\r\n\r\n    const defaultTextureFilterMin = obj['defaultTextureFilterMin'];\r\n\r\n    if (defaultTextureFilterMin !== 'nearest' && defaultTextureFilterMin !== 'linear') {\r\n      throw new Error(`Invalid defaultTextureFilterMin`);\r\n    }\r\n\r\n    const defaultTextureFilterMag = obj['defaultTextureFilterMag'];\r\n\r\n    if (defaultTextureFilterMag !== 'nearest' && defaultTextureFilterMag !== 'linear') {\r\n      throw new Error(`Invalid defaultTextureFilterMag`);\r\n    }\r\n\r\n    let preserveDrawingBuffer = obj['preserveDrawingBuffer'];\r\n\r\n    if (typeof preserveDrawingBuffer !== 'boolean') {\r\n      preserveDrawingBuffer = DEFAULT_USER_SETTINGS.preserveDrawingBuffer;\r\n    }\r\n\r\n    return {\r\n      sidebarPosition,\r\n      sidebarWidth,\r\n      defaultTextureFilterMin,\r\n      defaultTextureFilterMag,\r\n      preserveDrawingBuffer,\r\n    };\r\n  },\r\n};\r\n","import { ReadonlyVec4 } from \"gl-matrix\";\r\nimport { TakLogoIndex } from \"../logo-colors\";\r\nimport { ViewMode, ViewColor } from \"./view\";\r\n\r\nexport type ModelControls = {\r\n  rotationX: number;\r\n  rotationY: number;\r\n  rotationZ: number;\r\n  translationX: number;\r\n  translationY: number;\r\n  zoom: number;\r\n  viewMode: ViewMode;\r\n  viewColor?: ViewColor;\r\n  canvasBackground: string;\r\n  canvasBackgroundSize: 'auto' | 'cover' | 'contain';\r\n  canvasBackgroundRepeat: 'repeat' | 'no-repeat';\r\n\r\n  //:: Regular mode options\r\n  enableLightingRegular: boolean;\r\n  logoColorIdx: TakLogoIndex;\r\n  textureFilterMin: 'linear' | 'nearest';\r\n  textureFilterMag: 'linear' | 'nearest';\r\n\r\n  //:: Solid color mode options\r\n  enableLightingSolidColor: boolean;\r\n  solidColor: ReadonlyVec4;\r\n\r\n  //:: Wireframe mode options\r\n  wireframeColor: ReadonlyVec4;\r\n};\r\n\r\nexport const DEFAULT_MODEL_CONTROLS: ModelControls = {\r\n  rotationX: 50,\r\n  rotationY: -150,\r\n  rotationZ: 0,\r\n  translationX: 0,\r\n  translationY: 0,\r\n  zoom: 900,\r\n  viewMode: 'regular',\r\n  viewColor: [1.0, 1.0, 1.0, 1.0], // mixes multiplicatively\r\n  canvasBackground: 'black',\r\n  canvasBackgroundSize: 'auto',\r\n  canvasBackgroundRepeat: 'repeat',\r\n\r\n  enableLightingRegular: false,\r\n  logoColorIdx: 0,\r\n  textureFilterMin: 'linear',\r\n  textureFilterMag: 'linear',\r\n\r\n  enableLightingSolidColor: true,\r\n  solidColor: [1.0, 1.0, 1.0, 1.0],\r\n\r\n  wireframeColor: [1.0, 1.0, 1.0, 1.0],\r\n};\r\n","import { ComponentChildren, FunctionComponent, h } from 'preact';\r\nimport { useState } from \"preact/hooks\";\r\n\r\nconst Spoiler: FunctionComponent<{\r\n  title: string;\r\n  children: ComponentChildren;\r\n  showByDefault?: boolean;\r\n}> = ({ title, children, showByDefault }) => {\r\n  const [show, setShow] = useState(showByDefault ?? false);\r\n\r\n  const content = show ? (\r\n    <div>{children}</div>\r\n  ) : null;\r\n\r\n  const showHide = (\r\n    <button\r\n      onClick={() => setShow(!show)}\r\n    >\r\n      {show ? '[Hide]' : '[Show]'}\r\n    </button>\r\n  );\r\n\r\n  return (\r\n    <div>\r\n      <div class=\"flex justify-between space-x-2\">\r\n        <span>{title}</span>\r\n        {showHide}\r\n      </div>\r\n\r\n      {content}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Spoiler;\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { useMemo, useState } from \"preact/hooks\";\r\nimport { UserService } from \"../../lib/services/user-service\";\r\nimport { UserSettings } from \"../../lib/types/user-settings\";\r\nimport Spoiler from \"../ui/Spoiler\";\r\n\r\nconst SAMPLES: Array<{ path: string; name: string }> = [\r\n  'aradrag.3do',\r\n  'tardrag.3do',\r\n  'verdrag.3do',\r\n  'zondrag.3do',\r\n  'creaeri.3do',\r\n  'aralode.3do',\r\n  'araking.3do',\r\n  'cresage.3do',\r\n  'tarnecro.3do',\r\n  'vermage.3do',\r\n  'zonhunt.3do',\r\n].map((name) => ({\r\n  name,\r\n  path: 'assets/3do-samples/' + name,\r\n}));\r\n\r\nconst ISSUES_URL = 'https://github.com/takingdoms/3do-viewer-preact/issues';\r\n\r\nconst submitButtonCss = 'border border-gray-700 px-2 py-0.5 hover:text-yellow-500 '\r\n  + 'focus:text-yellow-500';\r\n\r\nconst anchorCss = 'text-sky-500 hover:text-sky-700 focus:text-sky-700 hover:underline focus:underline';\r\n\r\nconst FileChooser: FunctionComponent<{\r\n  onSubmit: (dataSource: File | string) => void;\r\n  defaultUserSettings: UserSettings;\r\n  setDefaultUserSettings: (userSettings: UserSettings) => void;\r\n}> = ({ onSubmit, defaultUserSettings, setDefaultUserSettings }) => {\r\n  const controlsInfo = useMemo(() => (\r\n    <div class=\"text-sm\">\r\n      <h3 class=\"text-base font-bold\">Controls:</h3>\r\n      <p><u>Left mouse button:</u> hold and drag to rotate the model.</p>\r\n      <p><u>Middle mouse button:</u> hold and drag to move the model.</p>\r\n      <p><u>Mouse wheel:</u> zoom in or out.</p>\r\n    </div>\r\n  ), []);\r\n\r\n  const miscInfo = useMemo(() => (\r\n    <div class=\"text-sm\">\r\n      <h3 class=\"text-base font-bold\">About:</h3>\r\n      {/* <p>Nothing is uploaded anywhere, everything is done locally on the browser.</p> */}\r\n      <p>Submit suggestions or problems at: <a class={anchorCss} href={ISSUES_URL} target=\"_blank\">{ISSUES_URL}</a></p>\r\n      <p>...or message spagg#2962 on Discord.</p>\r\n    </div>\r\n  ), []);\r\n\r\n  const option1 = useMemo(() => (\r\n    <form\r\n      class=\"px-4 py-2 border border-4 border-gray-600 rounded h-full\"\r\n      onSubmit={(ev) => {\r\n        ev.preventDefault();\r\n        const formData = new FormData(ev.currentTarget);\r\n        const file = formData.get('file') as File;\r\n\r\n        if (file && file.size && file.name) {\r\n          onSubmit(file);\r\n        }\r\n      }}\r\n    >\r\n      <div class=\"text-3xl text-center mb-4\">Option 1</div>\r\n      <div class=\"text-xl text-gray-400 mb-2\">Load your own file</div>\r\n      <div className=\"flex items-stretch space-x-2\">\r\n        <input name=\"file\" type=\"file\" class=\"grow border border-gray-700\" />\r\n        <button class={submitButtonCss} type=\"submit\">GO</button>\r\n      </div>\r\n    </form>\r\n  ), [onSubmit]);\r\n\r\n  const option2 = useMemo(() => (\r\n    <form\r\n      class=\"px-4 py-2 border border-4 border-gray-600 rounded h-full\"\r\n      onSubmit={(ev) => {\r\n        ev.preventDefault();\r\n        const formData = new FormData(ev.currentTarget);\r\n        const sample = formData.get('sample')?.toString().trim();\r\n\r\n        if (sample) {\r\n          onSubmit(sample);\r\n        }\r\n      }}\r\n    >\r\n      <div class=\"text-3xl text-center mb-4\">Option 2</div>\r\n      <div class=\"text-xl text-gray-400 mb-2\">Pick a sample file</div>\r\n      <div className=\"flex items-stretch space-x-2\">\r\n        <select name=\"sample\" class=\"grow border border-gray-700\">\r\n          <option value=\"\"></option>\r\n          {SAMPLES.map((sample, idx) => (\r\n            <option value={sample.path} key={idx}>{sample.name}</option>\r\n          ))}\r\n        </select>\r\n        <button class={submitButtonCss} type=\"submit\">GO</button>\r\n      </div>\r\n    </form>\r\n  ), [onSubmit]);\r\n\r\n  const advanced = useMemo(() => (\r\n    <Spoiler title=\"Advanced\">\r\n      <div class=\"space-y-2\">\r\n        <div>\r\n          <label class=\"flex items-center\">\r\n            <input\r\n              type=\"checkbox\"\r\n              checked={defaultUserSettings.preserveDrawingBuffer}\r\n              onChange={(ev) => {\r\n                setDefaultUserSettings({\r\n                  ...defaultUserSettings,\r\n                  preserveDrawingBuffer: ev.currentTarget.checked,\r\n                });\r\n              }}\r\n            />\r\n            <span class=\"font-bold ml-2\">WebGL / Preserve Drawing Buffer</span>\r\n          </label>\r\n          <span class=\"text-gray-300 text-sm\">\r\n            {`Disable this only if the model rendering is lagging (might not even change anything).\r\n            Disabling this will also disable the \"Save Model Image\" button and the ability to\r\n            \"Right click > Save Image As\"`}\r\n          </span>\r\n        </div>\r\n      </div>\r\n    </Spoiler>\r\n  ), [defaultUserSettings, setDefaultUserSettings]);\r\n\r\n  return (\r\n    <div class=\"min-w-screen min-h-screen bg-gray-800 flex flex-col justify-center items-center\">\r\n      <div\r\n        style={{ maxWidth: 800 }}\r\n        class=\"container flex justify-center items-stretch\r\n          flex-col-reverse md:flex-col\"\r\n      >\r\n        <div class=\"flex flex-wrap items-stretch\">\r\n          <div class=\"flex-1 p-4\" style={{ minWidth: 300 }}>{controlsInfo}</div>\r\n          <div class=\"flex-1 p-4\" style={{ minWidth: 300 }}>{miscInfo}</div>\r\n        </div>\r\n\r\n        <div class=\"flex flex-wrap items-stretch\">\r\n          <div class=\"flex-1 p-4\">{option1}</div>\r\n          <div class=\"flex-1 p-4\">{option2}</div>\r\n        </div>\r\n\r\n        <div class=\"mt-8 self-center\">\r\n          {advanced}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default FileChooser;\r\n","export interface LogoColorsDefinitions<TNumber extends number = number> {\r\n  defaultIdx: TNumber;\r\n  idxList: TNumber[];\r\n  idxCount: number;\r\n  idxToName: (idx: TNumber) => string;\r\n  idxToHtmlColor: (idx: TNumber) => string;\r\n  textureKeyUsesLogo: (textureKey: string) => boolean;\r\n  idxToTextureKey: (idx: TNumber, textureKey: string) => string;\r\n  idxToTextureFilename: (idx: TNumber, fileName: string) => string;\r\n}\r\n\r\n// TAK ---------------------------------------------------------------------------------------------\r\n\r\nexport type TakLogoIndex = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\r\n\r\nexport type TakLogoColorsDefinitions = LogoColorsDefinitions<TakLogoIndex>;\r\n\r\nexport const defaultLogoColorsDefinitions: Readonly<TakLogoColorsDefinitions> = {\r\n  defaultIdx: 0,\r\n  idxList: Array.from({ length: 10 }).map((_, idx) => idx) as TakLogoIndex[],\r\n  idxCount: 10,\r\n  idxToName: (idx) => idx.toString(),\r\n  idxToHtmlColor: (idx) => htmlColors[idx],\r\n  textureKeyUsesLogo: (textureKey) => textureKey.toLowerCase().includes('logo'),\r\n  idxToTextureKey: (idx, textureKey) => {\r\n    if (idx === 0)\r\n      return textureKey;\r\n\r\n    return `${textureKey}/color:${idx}`;\r\n  },\r\n  idxToTextureFilename: (idx, fileName) => {\r\n    if (idx === 0) {\r\n      return fileName;\r\n    }\r\n\r\n    return `${fileName}.${idx}`;\r\n  },\r\n};\r\n\r\nconst htmlColors: Record<TakLogoIndex, string> = {\r\n  0: 'lightblue',\r\n  1: 'red',\r\n  2: 'white',\r\n  3: 'green',\r\n  4: 'darkblue',\r\n  5: 'purple',\r\n  6: 'yellow',\r\n  7: 'black',\r\n  8: 'orange',\r\n  9: 'brown',\r\n};\r\n","function compareObjectsShallow(obj1: any, obj2: any): boolean {\r\n  const entries1 = Object.entries(obj1);\r\n  const entries2 = Object.keys(obj2);\r\n\r\n  return entries1.length === entries2.length && entries1.every(([key1, value1]) => {\r\n    return key1 in obj2 && obj2[key1] === value1;\r\n  });\r\n}\r\n\r\nfunction createUpdatedMap<K, V>(map: Map<K, V>, key: K, value: V): Map<K, V> {\r\n  const newMap = new Map(map);\r\n  newMap.set(key, value);\r\n  return newMap;\r\n}\r\n\r\nfunction validateTextureName(textureName: string) {\r\n  // return /^[a-zA-Z0-9]+$/.test(textureName);\r\n  return /^(?!^(?:COM|PRN|AUX|NUL|CON|CLOCK\\$)(?:\\..+)?$)[^\\s\\\\/:\\*\\?\\\"<>\\|\\x00-\\x1F\\x7F]{1,254}$/\r\n    .test(textureName);\r\n}\r\n\r\nexport const Utils = {\r\n  compareObjectsShallow,\r\n  createUpdatedMap,\r\n  validateTextureName,\r\n};\r\n","import { ObjectStateMap } from \"../../components/Main\";\r\nimport { TextureMapping } from \"../texture-mapping\";\r\nimport { ModelControls } from \"../types/model-controls\";\r\n\r\nexport type EngineListener = {\r\n  onModelControlsChanged: (modelControls: ModelControls) => void;\r\n};\r\n\r\nexport type EngineConfig = {\r\n  mode:\r\n    | 'static'      // only re-renders when the camera or viewport is updated\r\n    | 'continuous'  // re-renders continuously (usually at 60 FPS)\r\n  ;\r\n  canvas: HTMLCanvasElement;\r\n  modelControls: ModelControls;\r\n  textureMapping: TextureMapping;\r\n  objStateMap: ObjectStateMap;\r\n  listener: EngineListener;\r\n  preserveDrawingBuffer: boolean; // needs to be true for \"Right Click > Save Image\" to work\r\n};\r\n\r\nexport abstract class Engine {\r\n  protected readonly config: EngineConfig;\r\n  private resizeObserver: ResizeObserver | undefined;\r\n  private cleanupEvents?: () => void;\r\n\r\n  constructor(config: EngineConfig) {\r\n    this.config = config;\r\n  }\r\n\r\n  protected setupEvents() {\r\n    const { listener, canvas, mode } = this.config;\r\n\r\n    //:: Handle mouse events\r\n\r\n    let mouseAction: 'rotate' | 'pan' | undefined;\r\n    let mouseStartX: number | undefined;\r\n    let mouseStartY: number | undefined;\r\n    let controlStartX: number | undefined;\r\n    let controlStartY: number | undefined;\r\n    let didChange = false;\r\n\r\n    const onMouseDown = (ev: MouseEvent) => {\r\n      if (mouseAction !== undefined) {\r\n        // stop if another button was already being processed\r\n        return;\r\n      }\r\n\r\n      if (ev.button === 0) {\r\n        mouseAction = 'rotate';\r\n      }\r\n      else if (ev.button === 1) {\r\n        mouseAction = 'pan';\r\n      }\r\n      else {\r\n        // only button 0 (left-click) and button 1 (middle-click) are used\r\n        return;\r\n      }\r\n\r\n      mouseStartX = ev.clientX;\r\n      mouseStartY = ev.clientY;\r\n\r\n      controlStartX = mouseAction === 'rotate'\r\n        ? this.config.modelControls.rotationX\r\n        : this.config.modelControls.translationX;\r\n\r\n      controlStartY = mouseAction === 'rotate'\r\n        ? this.config.modelControls.rotationY\r\n        : this.config.modelControls.translationY;\r\n    };\r\n\r\n    const onMouseMove = (ev: MouseEvent) => {\r\n      if (mouseStartX === undefined || mouseStartY === undefined || controlStartX === undefined ||\r\n          controlStartY === undefined)\r\n      {\r\n        return;\r\n      }\r\n\r\n      const deltaX = Math.round((ev.clientX - mouseStartX) * 0.75);\r\n      const deltaY = Math.round((ev.clientY - mouseStartY) * 0.75);\r\n\r\n      if (deltaX === 0 && deltaY === 0) {\r\n        return;\r\n      }\r\n\r\n      if (deltaX !== 0) {\r\n        if (mouseAction === 'rotate') {\r\n          let newRotation = controlStartY + deltaX;\r\n          while (newRotation > 180) {\r\n            newRotation -= 360;\r\n          }\r\n          while (newRotation < -180) {\r\n            newRotation += 360;\r\n          }\r\n\r\n          this.config.modelControls.rotationY = newRotation;\r\n        } else {\r\n          this.config.modelControls.translationX = controlStartX + deltaX;\r\n        }\r\n      }\r\n\r\n      if (deltaY !== 0) {\r\n        if (mouseAction === 'rotate') {\r\n          let newRotation = controlStartX + deltaY;\r\n          while (newRotation > 180) {\r\n            newRotation -= 360;\r\n          }\r\n          while (newRotation < -180) {\r\n            newRotation += 360;\r\n          }\r\n\r\n          this.config.modelControls.rotationX = newRotation;\r\n        } else {\r\n          this.config.modelControls.translationY = controlStartY + deltaY;\r\n        }\r\n      }\r\n\r\n      didChange = true;\r\n\r\n      if (mode === 'static') {\r\n        this.render();\r\n      }\r\n    };\r\n\r\n    const onMouseUp = () => {\r\n      mouseAction = mouseStartX = mouseStartY = controlStartX = controlStartY = undefined;\r\n\r\n      if (didChange) {\r\n        listener.onModelControlsChanged({ ...this.config.modelControls });\r\n        didChange = false;\r\n      }\r\n    };\r\n\r\n    const onVisibilityChange = () => {\r\n      if (document.visibilityState === 'hidden') {\r\n        onMouseUp();\r\n      }\r\n    };\r\n\r\n    const onWheel = (ev: WheelEvent) => {\r\n      if (ev.deltaY === 0)\r\n        return;\r\n\r\n      this.config.modelControls.zoom += ev.deltaY;\r\n\r\n      if (this.config.mode === 'static') {\r\n        this.render();\r\n      }\r\n\r\n      listener.onModelControlsChanged({ ...this.config.modelControls }); // TODO DEBOUNCE! (or not?)\r\n    };\r\n\r\n    canvas.addEventListener('mousedown', onMouseDown);\r\n    canvas.addEventListener('mousemove', onMouseMove);\r\n    window.addEventListener('mouseup', onMouseUp);\r\n    document.addEventListener('visibilitychange', onVisibilityChange);\r\n    canvas.addEventListener('wheel', onWheel);\r\n\r\n    this.cleanupEvents = () => {\r\n      canvas.removeEventListener('mousedown', onMouseDown);\r\n      canvas.removeEventListener('mousedown', onMouseMove);\r\n      window.removeEventListener('mouseup', onMouseUp);\r\n      document.removeEventListener('visibilitychange', onVisibilityChange);\r\n      canvas.removeEventListener('wheel', onWheel);\r\n    };\r\n\r\n    //:: Handle resizing\r\n\r\n    const onResized = () => {\r\n      const canvasParent = canvas.parentElement;\r\n\r\n      if (!canvasParent) {\r\n        throw new Error(`Canvas has no parent!!`);\r\n      }\r\n\r\n      const newWidth = canvasParent.clientWidth;\r\n      const newHeight = canvasParent.clientHeight;\r\n\r\n      let didResize = false;\r\n\r\n      if (canvas.width !== newWidth) {\r\n        canvas.width = newWidth;\r\n        didResize = true;\r\n      }\r\n\r\n      if (canvas.height !== newHeight) {\r\n        canvas.height = newHeight;\r\n        didResize = true;\r\n      }\r\n\r\n      if (didResize) {\r\n        this.onResized();\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n    this.resizeObserver = new ResizeObserver(onResized);\r\n    const canvasParent = canvas.parentElement;\r\n\r\n    if (!canvasParent) {\r\n      window.alert('Failed to create canvas');\r\n      throw new Error(`Canvas has no parent!! (Can't listen to resizing...)`);\r\n    }\r\n\r\n    this.resizeObserver.observe(canvasParent);\r\n\r\n    // manually call onResized and also call this.onResized if onResized didn't already call it\r\n    if (!onResized()) {\r\n      this.onResized();\r\n    }\r\n  }\r\n\r\n  setModelControls(modelControls: ModelControls) {\r\n    this.config.modelControls = modelControls;\r\n\r\n    if (this.config.mode === 'static') {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  setTextureMapping(textureMapping: TextureMapping) {\r\n    this.config.textureMapping = textureMapping;\r\n\r\n    if (this.config.mode === 'static') {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  setObjectStateMap(objStateMap: ObjectStateMap) {\r\n    this.config.objStateMap = objStateMap;\r\n\r\n    if (this.config.mode === 'static') {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    if (this.resizeObserver) {\r\n      this.resizeObserver.disconnect();\r\n    }\r\n\r\n    this.cleanupEvents?.();\r\n    // TODO\r\n  }\r\n\r\n  protected abstract onResized(): void;\r\n\r\n  // delta is only used when this.config.mode === 'continuous'\r\n  protected abstract render(delta?: number): void;\r\n\r\n  protected get width() {\r\n    return this.config.canvas.width;\r\n  }\r\n\r\n  protected get height() {\r\n    return this.config.canvas.height;\r\n  }\r\n}\r\n","import { Engine, EngineConfig } from \"./engine\";\r\n\r\nexport class UiDebugEngine extends Engine {\r\n  private ctx: CanvasRenderingContext2D;\r\n  private renderCount = 0;\r\n\r\n  constructor(config: EngineConfig) {\r\n    super(config);\r\n\r\n    const ctx = config.canvas.getContext('2d');\r\n\r\n    if (ctx === null) {\r\n      window.alert('Canvas not supported in this browser.');\r\n      throw new Error(`Failed to create context`);\r\n    }\r\n\r\n    this.ctx = ctx;\r\n    this.setupEvents();\r\n  }\r\n\r\n  protected onResized(): void {\r\n    this.render();\r\n  }\r\n\r\n  protected render(): void {\r\n    const { modelControls } = this.config;\r\n\r\n    console.log(`Rendering next  (#${this.renderCount})`);\r\n    const startTime = performance.now();\r\n\r\n    const viewWidth = this.width;\r\n    const viewHeight = this.height;\r\n\r\n    // this.ctx.clearRect(0, 0, viewWidth, viewHeight); // redundant with the fillRect below \\/\r\n\r\n    this.ctx.fillStyle = `rgb(4, 16, 22)`;\r\n    this.ctx.fillRect(0, 0, viewWidth, viewHeight);\r\n\r\n    this.ctx.strokeStyle = `rgb(0, 0, 200)`;\r\n    this.ctx.lineWidth = 1;\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, viewHeight / 2);\r\n    this.ctx.lineTo(viewWidth, viewHeight / 2);\r\n    this.ctx.stroke();\r\n    this.ctx.moveTo(viewWidth / 2, 0);\r\n    this.ctx.lineTo(viewWidth / 2, viewHeight);\r\n    this.ctx.stroke();\r\n\r\n    const textLines = [\r\n      `renderCount: ${this.renderCount}`,\r\n      `viewWidth: ${viewWidth}`,\r\n      `viewHeight: ${viewHeight}`,\r\n      `zoom: ${modelControls.zoom}`,\r\n      `rotationX: ${modelControls.rotationX}`,\r\n      `rotationY: ${modelControls.rotationY}`,\r\n      `rotationZ: ${modelControls.rotationZ}`,\r\n      `translationX: ${modelControls.translationX}`,\r\n      `translationY: ${modelControls.translationY}`,\r\n      `viewMode: ${modelControls.viewMode}`,\r\n    ];\r\n\r\n    const textSize = 18;\r\n    const textPadding = 4;\r\n    const showDebugRects = false;\r\n\r\n    this.ctx.textAlign = 'left';\r\n    this.ctx.textBaseline = 'middle';\r\n    this.ctx.fillStyle = 'white';\r\n    this.ctx.font = `${textSize}px monospace`;\r\n\r\n    this.ctx.strokeStyle = 'red';\r\n\r\n    const largestLineWidth = this.ctx.measureText(\r\n      // \\/ only works when using a monospaced font!!!\r\n      textLines.reduce((l1, l2) => l1.length > l2.length ? l1 : l2)\r\n    ).width;\r\n\r\n    const totalWidth = largestLineWidth;\r\n    const totalHeight = (textSize * textLines.length) + (textLines.length * textPadding * 2);\r\n\r\n    for (let i = 0; i < textLines.length; i++) {\r\n      const lineHeight = textSize + textPadding * 2;\r\n\r\n      if (showDebugRects) {\r\n        this.ctx.strokeRect(\r\n          viewWidth / 2 - totalWidth / 2,\r\n          viewHeight / 2 - totalHeight / 2 + i * (lineHeight),\r\n          totalWidth,\r\n          textSize + textPadding * 2,\r\n        );\r\n      }\r\n\r\n      this.ctx.fillText(\r\n        textLines[i]!,\r\n        viewWidth / 2 - totalWidth / 2,\r\n        (viewHeight / 2) - (totalHeight / 2) + (i * lineHeight + lineHeight / 2),\r\n      );\r\n    }\r\n\r\n    const endTime = performance.now();\r\n    const delta = endTime - startTime;\r\n    console.log(`Finished rendering  in ${delta}ms`);\r\n    this.renderCount++;\r\n  }\r\n}\r\n","// Credits to most of these: https://webglfundamentals.org/webgl/lessons/webgl-boilerplate.html\r\n\r\nfunction compileShader(gl: WebGLRenderingContext, shaderSource: string, shaderType: number) {\r\n  const shader = gl.createShader(shaderType);\r\n\r\n  if (shader === null) {\r\n    throw `Failed to create shader of type \"${shaderType}\"`;\r\n  }\r\n\r\n  gl.shaderSource(shader, shaderSource);\r\n  gl.compileShader(shader);\r\n\r\n  const success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n\r\n  if (!success) {\r\n    throw `Could not compile shader: ${gl.getShaderInfoLog(shader)}`;\r\n  }\r\n\r\n  return shader;\r\n}\r\n\r\nfunction createProgram(\r\n  gl: WebGLRenderingContext,\r\n  vertexShader: WebGLShader,\r\n  fragmentShader: WebGLShader,\r\n) {\r\n  const program = gl.createProgram();\r\n\r\n  if (program === null) {\r\n    throw `Failed to create program`;\r\n  }\r\n\r\n  gl.attachShader(program, vertexShader);\r\n  gl.attachShader(program, fragmentShader);\r\n  gl.linkProgram(program);\r\n\r\n  const success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n  if (!success) {\r\n    throw `Program failed to link: ${gl.getProgramInfoLog(program)}`;\r\n  }\r\n\r\n  return program;\r\n};\r\n\r\nfunction resizeCanvasToDisplaySize(canvas: HTMLCanvasElement) {\r\n  const displayWidth  = canvas.clientWidth;\r\n  const displayHeight = canvas.clientHeight;\r\n\r\n  const needResize = canvas.width !== displayWidth || canvas.height !== displayHeight;\r\n\r\n  if (needResize) {\r\n    canvas.width = displayWidth;\r\n    canvas.height = displayHeight;\r\n  }\r\n\r\n  return needResize;\r\n}\r\n\r\nexport const WebGlHelper = {\r\n  compileShader,\r\n  createProgram,\r\n  resizeCanvasToDisplaySize,\r\n};\r\n","import { mat4, ReadonlyVec4 } from \"gl-matrix\";\r\nimport { TakLogoColorsDefinitions, TakLogoIndex } from \"../../logo-colors\";\r\nimport { LoadableTexture, TextureMapping } from \"../../texture-mapping\";\r\nimport { GlTexture } from \"./gl-texture\";\r\nimport { ProgramInfo } from \"./program-info\";\r\n\r\nexport class GlContext {\r\n  protected gl: WebGLRenderingContext;\r\n  protected programInfo: ProgramInfo<any, any>;\r\n  private logoDefs: TakLogoColorsDefinitions;\r\n\r\n  private currentLogoIdx: TakLogoIndex;\r\n  private textureDatabase: Record<string, GlTexture | null> = {};\r\n  private lastTexture?: GlTexture | null; // undefined = not initialized; null = no texture\r\n\r\n  private baseEntityColor: ReadonlyVec4 = new Float32Array([1.0, 1.0, 1.0, 1.0]); // WHITE\r\n\r\n  private textureMinFilter: number;\r\n  private textureMagFilter: number;\r\n\r\n  constructor(\r\n    gl: WebGLRenderingContext,\r\n    programInfo: ProgramInfo<any, any>,\r\n    logoDefs: TakLogoColorsDefinitions,\r\n  ) {\r\n    this.gl = gl;\r\n    this.programInfo = programInfo;\r\n    this.logoDefs = logoDefs;\r\n\r\n    this.currentLogoIdx = logoDefs.defaultIdx;\r\n\r\n    this.textureMinFilter = gl.NEAREST;\r\n    this.textureMagFilter = gl.NEAREST;\r\n  }\r\n\r\n  /// Warning: Use this only when REALLY needed\r\n  getGl() {\r\n    return this.gl;\r\n  }\r\n\r\n  getProgramInfo(): Readonly<ProgramInfo<any, any>> {\r\n    return this.programInfo;\r\n  }\r\n\r\n  getBaseEntityColor(): ReadonlyVec4 {\r\n    return this.baseEntityColor;\r\n  }\r\n\r\n  setBaseEntityColor(color: ReadonlyVec4) {\r\n    this.baseEntityColor = color;\r\n  }\r\n\r\n  setUniformMatrix4(uniform: string, matrix: mat4) {\r\n    const location = this.programInfo.uniformLocations[uniform];\r\n\r\n    if (location) {\r\n      this.gl.uniformMatrix4fv(location, false, matrix);\r\n    }\r\n  }\r\n\r\n  setUniformFloat4(uniform: string, data: Readonly<Float32List>) {\r\n    if (data.length !== 4) {\r\n      throw new Error(`data.length is not 4: ${data.length}`);\r\n    }\r\n\r\n    const location = this.programInfo.uniformLocations[uniform];\r\n\r\n    if (location) {\r\n      this.gl.uniform4fv(location, data);\r\n    }\r\n  }\r\n\r\n  setUniformBool(uniform: string, bool: boolean) {\r\n    const location = this.programInfo.uniformLocations[uniform];\r\n\r\n    if (location) {\r\n      this.gl.uniform1i(location, bool ? 1 : 0);\r\n    }\r\n  }\r\n\r\n  setTextureMinFilter(filter: number) {\r\n    this.textureMinFilter = filter;\r\n  }\r\n\r\n  setTextureMagFilter(filter: number) {\r\n    this.textureMagFilter = filter;\r\n  }\r\n\r\n  drawElements(length: number) {\r\n    this.gl.drawElements(this.gl.TRIANGLES, length, this.gl.UNSIGNED_SHORT, 0);\r\n  }\r\n\r\n  useTexture(textureKey: string | null): boolean {\r\n    let texture: GlTexture | null;\r\n\r\n    if (textureKey === null) {\r\n      texture = null;\r\n    }\r\n    else {\r\n      const actualTextureKey = this.logoDefs.textureKeyUsesLogo(textureKey)\r\n        ? this.logoDefs.idxToTextureKey(this.currentLogoIdx, textureKey)\r\n        : textureKey;\r\n\r\n      const fromDb = this.textureDatabase[actualTextureKey];\r\n\r\n      if (fromDb === undefined) {\r\n        console.error(`Missing texture for: ${actualTextureKey}`);\r\n        texture = null;\r\n      }\r\n      else {\r\n        texture = fromDb;\r\n      }\r\n    }\r\n\r\n    if (this.lastTexture === texture) {\r\n      // already using this texture\r\n      return texture !== null;\r\n    }\r\n\r\n    this.lastTexture = texture;\r\n\r\n    if (texture === null) {\r\n      // TODO unbind texture? or use fallback (all white) texture maybe?\r\n      return false;\r\n    }\r\n\r\n    texture.use(this.programInfo.uniformLocations['sampler']!, this.textureMinFilter, this.textureMagFilter);\r\n    return true;\r\n  }\r\n\r\n  changeTextureMapping(textureMapping: Readonly<TextureMapping>) {\r\n    for (const [key, value] of Object.entries(textureMapping)) {\r\n      const existing = this.textureDatabase[key];\r\n      const didChange = existing !== value;\r\n\r\n      if (!didChange) {\r\n        continue;\r\n      }\r\n\r\n      if (existing !== undefined && existing !== null) {\r\n        existing.delete();\r\n      }\r\n\r\n      this.textureDatabase[key] = value === null\r\n        ? null\r\n        : this.setupTexture(value);\r\n    }\r\n  }\r\n\r\n  setCurrentLogoIdx(idx: TakLogoIndex) {\r\n    this.currentLogoIdx = idx;\r\n  }\r\n\r\n  private setupTexture(loadableTexture: LoadableTexture): GlTexture {\r\n    const texture = new GlTexture(this.gl);\r\n\r\n    if (loadableTexture.type === 'html') {\r\n      texture.loadDataFromImage(loadableTexture.image);\r\n    }\r\n    else {\r\n      const { width, height, data } = loadableTexture;\r\n      texture.loadDataFromPixels(width, height, data);\r\n    }\r\n\r\n    return texture;\r\n  }\r\n}\r\n","import { GlContext } from \"./gl-context\";\r\nimport { ProgramInfo } from \"./program-info\";\r\nimport { TakLogoColorsDefinitions } from \"../../logo-colors\";\r\nimport { ViewMode } from \"../../types/view\";\r\n\r\nexport class GlCustomContext extends GlContext {\r\n  private viewMode: ViewMode;\r\n\r\n  constructor(\r\n    gl: WebGLRenderingContext,\r\n    programInfo: ProgramInfo<any, any>,\r\n    logoDefs: TakLogoColorsDefinitions,\r\n    viewMode: ViewMode,\r\n  ) {\r\n    super(gl, programInfo, logoDefs);\r\n    this.viewMode = viewMode;\r\n  }\r\n\r\n  override drawElements(length: number): void {\r\n    if (this.viewMode === 'wireframe') {\r\n      this.gl.drawElements(this.gl.LINE_LOOP, length, this.gl.UNSIGNED_SHORT, 0);\r\n    }\r\n    else {\r\n      this.gl.drawElements(this.gl.TRIANGLES, length, this.gl.UNSIGNED_SHORT, 0);\r\n    }\r\n  }\r\n\r\n  override useTexture(textureKey: string | null): boolean {\r\n    if (this.viewMode === 'regular')\r\n      return super.useTexture(textureKey);\r\n\r\n    return true;\r\n  }\r\n}\r\n","import { mat4, ReadonlyVec4 } from \"gl-matrix\";\r\nimport { GlContext } from \"./gl-context\";\r\nimport { GlModel } from \"./gl-model\";\r\nimport { GlTexture } from \"./gl-texture\";\r\nimport { Vector3 } from \"./types\";\r\n\r\nconst HIGHLIGHT = new Float32Array([1.0, 1.0, 0.0, 1.0]); // yellow\r\n\r\ntype GlEntityStateOptions = Readonly<{\r\n  visibile: boolean;\r\n  highlighted: boolean;\r\n  // rotate... translate... etc...\r\n}>;\r\n\r\nexport class GlEntity {\r\n  protected model: GlModel | GlModel[] | null;\r\n  protected name: string | null;\r\n  protected children: GlEntity[];\r\n  protected parent: GlEntity | null;\r\n\r\n  protected modelViewMatrix: mat4; // this is what receives transformation operations\r\n  protected relativeModelViewMatrix: mat4; // this inherits transformations from the parent tree\r\n\r\n  protected stateOptions: GlEntityStateOptions;\r\n\r\n  constructor(model: GlModel | GlModel[] | null, name?: string) {\r\n    this.model = model;\r\n    this.name = name ?? null;\r\n\r\n    this.children = [];\r\n    this.parent = null;\r\n    this.modelViewMatrix = mat4.create();\r\n    this.relativeModelViewMatrix = mat4.create();\r\n\r\n    this.stateOptions = {\r\n      visibile: true,\r\n      highlighted: false,\r\n    };\r\n  }\r\n\r\n  addChild(child: GlEntity) {\r\n    if (child.parent !== null) {\r\n      throw new Error(`Can't add a child that already has a parent.`);\r\n    }\r\n\r\n    this.children.push(child);\r\n    child.parent = this;\r\n  }\r\n\r\n  render(ctx: GlContext) {\r\n    // TODO go back to passing the parentViewMatrix during the renderChild function!\r\n    this.recalculateMatrices(mat4.create());\r\n    this.renderChild(ctx);\r\n  }\r\n\r\n  protected recalculateMatrices(parentViewMatrix: mat4) {\r\n    this.relativeModelViewMatrix = mat4.mul(mat4.create(), parentViewMatrix, this.modelViewMatrix);\r\n\r\n    for (const child of this.children) {\r\n      child.recalculateMatrices(this.relativeModelViewMatrix);\r\n    }\r\n  }\r\n\r\n  protected renderChild(ctx: GlContext) {\r\n    const nextColor = this.color ?? ctx.getBaseEntityColor();\r\n\r\n    if (this.model !== null && this.stateOptions.visibile) {\r\n      ctx.setUniformFloat4('entityColor', nextColor);\r\n      ctx.setUniformMatrix4('modelViewMatrix', this.relativeModelViewMatrix);\r\n\r\n      if (Array.isArray(this.model)) {\r\n        for (const subModel of this.model) {\r\n          this.renderModel(ctx, subModel);\r\n        }\r\n      }\r\n      else {\r\n        this.renderModel(ctx, this.model);\r\n      }\r\n    }\r\n\r\n    for (const child of this.children) {\r\n      child.renderChild(ctx);\r\n    }\r\n  }\r\n\r\n  findChild(name: string, recursive: boolean): GlEntity | undefined {\r\n    for (const child of this.children) {\r\n      if (child.name === name) {\r\n        return child;\r\n      }\r\n\r\n      if (recursive) {\r\n        const result = child.findChild(name, recursive);\r\n        if (result !== undefined) {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  renderModel(ctx: GlContext, model: GlModel) {\r\n    if (model.usesNormals()) {\r\n      const normalMatrix = mat4.create();\r\n      mat4.invert(normalMatrix, this.relativeModelViewMatrix);\r\n      mat4.transpose(normalMatrix, normalMatrix);\r\n      ctx.setUniformMatrix4('normalMatrix', normalMatrix);\r\n    }\r\n\r\n    model.draw(ctx);\r\n  }\r\n\r\n  translate(x: number, y: number, z: number) {\r\n    mat4.translate(this.modelViewMatrix, this.modelViewMatrix, [x, y, z]);\r\n  }\r\n\r\n  scale(x: number, y: number, z: number) {\r\n    mat4.scale(this.modelViewMatrix, this.modelViewMatrix, [x, y, z]);\r\n  }\r\n\r\n  rotate(rad: number, x: boolean, y: boolean, z: boolean) {\r\n    const axis: Vector3 = [x ? 1 : 0, y ? 1 : 0, z ? 1: 0];\r\n    mat4.rotate(this.modelViewMatrix, this.modelViewMatrix, rad, axis);\r\n  }\r\n\r\n  rotateX(rad: number) {\r\n    mat4.rotateX(this.modelViewMatrix, this.modelViewMatrix, rad);\r\n  }\r\n\r\n  rotateY(rad: number) {\r\n    mat4.rotateY(this.modelViewMatrix, this.modelViewMatrix, rad);\r\n  }\r\n\r\n  rotateZ(rad: number) {\r\n    mat4.rotateZ(this.modelViewMatrix, this.modelViewMatrix, rad);\r\n  }\r\n\r\n  resetTransformations() {\r\n    this.modelViewMatrix = mat4.create();\r\n  }\r\n\r\n  private get color(): ReadonlyVec4 | undefined {\r\n    if (this.stateOptions.highlighted) {\r\n      return HIGHLIGHT;\r\n    }\r\n\r\n    return undefined;\r\n  }\r\n\r\n  getStateOptions() {\r\n    return this.stateOptions;\r\n  }\r\n\r\n  setStateOptions(stateOptions: GlEntityStateOptions) {\r\n    this.stateOptions = stateOptions;\r\n  }\r\n}\r\n","import { GlContext } from \"../gl-context\";\r\n\r\nexport abstract class GlBuffer {\r\n  protected readonly gl: WebGLRenderingContext;\r\n  private readonly _handle: WebGLBuffer;\r\n  private deleted = false;\r\n\r\n  constructor(gl: WebGLRenderingContext) {\r\n    this.gl = gl;\r\n\r\n    const handle = gl.createBuffer();\r\n\r\n    if (handle === null) {\r\n      throw `Failed to create buffer!`;\r\n    }\r\n\r\n    this._handle = handle;\r\n  }\r\n\r\n  protected get handle() {\r\n    return this._handle;\r\n  }\r\n\r\n  bufferData(data: BufferSource): void {\r\n    if (this.deleted) {\r\n      throw `Trying to use a buffer that has already been deleted.`;\r\n    }\r\n\r\n    this.doBufferData(data);\r\n  }\r\n\r\n  protected abstract doBufferData(data: BufferSource): void;\r\n\r\n  use() {\r\n    if (this.deleted) {\r\n      throw `Trying to use a buffer that has already been deleted.`;\r\n    }\r\n\r\n    this.doUse();\r\n  }\r\n\r\n  protected abstract doUse(): void;\r\n\r\n  delete() {\r\n    if (this.deleted) {\r\n      throw `Trying to delete a buffer that has already been deleted.`;\r\n    }\r\n\r\n    this.gl.deleteBuffer(this._handle);\r\n    this.deleted = true;\r\n  }\r\n}\r\n","import { GlBuffer } from \"./gl-buffer\";\r\n\r\nexport class GlIndexBuffer extends GlBuffer {\r\n  private length = 0;\r\n\r\n  getLength(): number {\r\n    return this.length;\r\n  }\r\n\r\n  protected override doBufferData(data: BufferSource) {\r\n    this.length = data.byteLength / 2; // because it's an array of uint16 (this is pretty bs TODO do smth better)\r\n    this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.handle);\r\n    this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER, data, this.gl.STATIC_DRAW);\r\n  }\r\n\r\n  protected override doUse(): void {\r\n    this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER, this.handle);\r\n  }\r\n\r\n  static createBufferSourceFromIndices(indices: number[]): BufferSource {\r\n    return new Uint16Array(indices);\r\n  }\r\n}\r\n","import { GlBuffer } from \"./gl-buffer\";\r\n\r\nexport abstract class GlArrayBuffer extends GlBuffer {\r\n  protected readonly attribLocation: number;\r\n\r\n  constructor(gl: WebGLRenderingContext, attribLocation: number) {\r\n    super(gl);\r\n    this.attribLocation = attribLocation;\r\n  }\r\n}\r\n","import { GlArrayBuffer } from \"./gl-array-buffer\";\r\n\r\nexport class GlNormalBuffer extends GlArrayBuffer {\r\n  protected override doBufferData(data: BufferSource) {\r\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.handle);\r\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, data, this.gl.STATIC_DRAW);\r\n  }\r\n\r\n  protected override doUse(): void {\r\n    const numComponents = 3; // X, Y, Z\r\n    const type = this.gl.FLOAT;\r\n    const normalize = false;\r\n    const stride = 0;\r\n    const offset = 0;\r\n\r\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.handle);\r\n\r\n    this.gl.vertexAttribPointer(\r\n      this.attribLocation,\r\n      numComponents,\r\n      type,\r\n      normalize,\r\n      stride,\r\n      offset,\r\n    );\r\n\r\n    this.gl.enableVertexAttribArray(this.attribLocation);\r\n  }\r\n\r\n  static createBufferSourceFromPositions(positions: number[]): BufferSource {\r\n    // console.log(positions);\r\n    return new Float32Array(positions);\r\n  }\r\n}\r\n","import { GlArrayBuffer } from \"./gl-array-buffer\";\r\n\r\nexport class GlPositionBuffer extends GlArrayBuffer {\r\n  protected override doBufferData(data: BufferSource) {\r\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.handle);\r\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, data, this.gl.STATIC_DRAW);\r\n  }\r\n\r\n  protected override doUse(): void {\r\n    const numComponents = 3; // X, Y, Z\r\n    const type = this.gl.FLOAT;\r\n    const normalize = false;\r\n    const stride = 0;\r\n    const offset = 0;\r\n\r\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.handle);\r\n\r\n    this.gl.vertexAttribPointer(\r\n      this.attribLocation,\r\n      numComponents,\r\n      type,\r\n      normalize,\r\n      stride,\r\n      offset,\r\n    );\r\n\r\n    this.gl.enableVertexAttribArray(this.attribLocation);\r\n  }\r\n\r\n  static createBufferSourceFromPositions(positions: number[]): BufferSource {\r\n    return new Float32Array(positions);\r\n  }\r\n}\r\n","import { GlArrayBuffer } from \"./gl-array-buffer\";\r\n\r\nexport class GlTextureCoordBuffer extends GlArrayBuffer {\r\n  protected override doBufferData(data: BufferSource): void {\r\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.handle);\r\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, data, this.gl.STATIC_DRAW);\r\n  }\r\n\r\n  protected override doUse(): void {\r\n    const num = 2; // U, V\r\n    const type = this.gl.FLOAT;\r\n    const normalize = false;\r\n    const stride = 0;\r\n    const offset = 0;\r\n\r\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.handle);\r\n\r\n    this.gl.vertexAttribPointer(\r\n      this.attribLocation,\r\n      num,\r\n      type,\r\n      normalize,\r\n      stride,\r\n      offset,\r\n    );\r\n\r\n    this.gl.enableVertexAttribArray(this.attribLocation);\r\n  }\r\n\r\n  static createBufferSourceFromCoords(coords: number[]): BufferSource {\r\n    return new Float32Array(coords);\r\n  }\r\n}\r\n","import { GlIndexBuffer } from \"./buffer/gl-index-buffer\";\r\nimport { GlNormalBuffer } from \"./buffer/gl-normal-buffer\";\r\nimport { GlPositionBuffer } from \"./buffer/gl-position-buffer\";\r\nimport { GlTextureCoordBuffer } from \"./buffer/gl-texture-coord-buffer\";\r\nimport { GlContext } from \"./gl-context\";\r\n\r\nexport class GlModel {\r\n  private positionBuffer: GlPositionBuffer;\r\n  private indexBuffer: GlIndexBuffer;\r\n  private normalBuffer?: GlNormalBuffer;\r\n  private textureCoordsBuffer?: GlTextureCoordBuffer;\r\n  private textureKey: string | null = null;\r\n\r\n  constructor(\r\n    positionBuffer: GlPositionBuffer,\r\n    indexBuffer: GlIndexBuffer,\r\n    normalBuffer?: GlNormalBuffer,\r\n    textureCoordsBuffer?: GlTextureCoordBuffer,\r\n  ) {\r\n    this.positionBuffer = positionBuffer;\r\n    this.indexBuffer = indexBuffer;\r\n    this.normalBuffer = normalBuffer;\r\n    this.textureCoordsBuffer = textureCoordsBuffer;\r\n  }\r\n\r\n  setTextureKey(textureKey: string) {\r\n    this.textureKey = textureKey;\r\n  }\r\n\r\n  getTextureKey() {\r\n    return this.textureKey;\r\n  }\r\n\r\n  usesNormals() {\r\n    return this.normalBuffer !== undefined;\r\n  }\r\n\r\n  draw(ctx: GlContext) {\r\n    const textureOk = ctx.useTexture(this.textureKey);\r\n\r\n    if (!textureOk) {\r\n      return;\r\n    }\r\n\r\n    this.positionBuffer.use();\r\n    this.indexBuffer.use();\r\n\r\n    if (this.normalBuffer !== undefined) {\r\n      this.normalBuffer.use();\r\n    }\r\n\r\n    if (this.textureCoordsBuffer !== undefined) {\r\n      this.textureCoordsBuffer.use();\r\n    }\r\n\r\n    ctx.drawElements(this.indexBuffer.getLength());\r\n  }\r\n}\r\n","import { Object3do, Object3doTree } from \"@takingdoms/lib-3do\";\r\nimport { glMatrix, mat4, vec3 } from \"gl-matrix\";\r\nimport { ObjectStateMap } from \"../../../components/Main\";\r\nimport { TakLogoColorsDefinitions } from \"../../logo-colors\";\r\nimport { TextureMapping } from \"../../texture-mapping\";\r\nimport { ModelControls } from \"../../types/model-controls\";\r\nimport { ViewColor, ViewMode } from \"../../types/view\";\r\nimport { GlContext } from \"../gl/gl-context\";\r\nimport { GlCustomContext } from \"../gl/gl-custom-context\";\r\nimport { GlEntity } from \"../gl/gl-entity\";\r\nimport { addGlEntityFrom3do } from \"../gl/gl-from-3do\";\r\nimport { ProgramInfo } from \"../gl/program-info\";\r\nimport { WebglEngineShaderSources } from \"../webgl-engine\";\r\n\r\n// TODO make these configurable(?)\r\nconst BASE_CAMERA_OFFSET = 8;\r\nconst ZOOM_MODIFIER = 0.01;\r\nconst TRANSLATION_MODIFIER = 0.02;\r\nconst DEFAULT_BASE_COLOR: ViewColor = [1.0, 1.0, 1.0, 1.0];\r\n\r\ntype AnyProgramInfo = ProgramInfo<string, string>;\r\n\r\nexport type ObjectEntityMap = Map<Object3do, GlEntity>;\r\n\r\nexport abstract class WebglSubRenderer<TProgramInfo extends AnyProgramInfo> {\r\n  protected readonly programInfo: TProgramInfo;\r\n  protected readonly ctx: GlContext;\r\n  protected readonly rootEntity: GlEntity;\r\n\r\n  protected objEntityMap: ObjectEntityMap = new Map();\r\n\r\n  constructor(\r\n    protected readonly gl: WebGLRenderingContext,\r\n    protected readonly shaderSources: WebglEngineShaderSources,\r\n    protected readonly object3doTree: Object3doTree,\r\n    protected readonly logoDefs: TakLogoColorsDefinitions,\r\n  ) {\r\n    this.programInfo = this.initProgram();\r\n    this.ctx = this.initContext();\r\n    this.rootEntity = this.initRootEntity();\r\n  }\r\n\r\n  protected abstract getViewMode(): ViewMode;\r\n\r\n  protected abstract initProgram(): TProgramInfo;\r\n\r\n  protected initContext(): GlContext {\r\n    return new GlCustomContext(this.gl, this.programInfo, this.logoDefs, this.getViewMode());\r\n  }\r\n\r\n  protected initRootEntity(): GlEntity {\r\n    const viewMode = this.getViewMode();\r\n    const rootEntity = new GlEntity(null);\r\n\r\n    for (const object3do of this.object3doTree.rootNodes) {\r\n      addGlEntityFrom3do(\r\n        this.ctx,\r\n        object3do,\r\n        rootEntity,\r\n        this.objEntityMap,\r\n        viewMode !== 'wireframe',\r\n        viewMode !== 'wireframe',\r\n        viewMode === 'regular',\r\n      );\r\n    }\r\n\r\n    return rootEntity;\r\n  }\r\n\r\n  changeTextureMapping(textureMapping: TextureMapping) {\r\n    // nothing\r\n  }\r\n\r\n  changeModelControls(modelControls: ModelControls) {\r\n    // nothing\r\n  }\r\n\r\n  changeObjectStateMap(objStateMap: ObjectStateMap) {\r\n    for (const [object, state] of objStateMap) {\r\n      const entity = this.objEntityMap.get(object);\r\n\r\n      if (entity === undefined) {\r\n        throw new Error(`Couldn't find an entity for the object: ${object}`);\r\n      }\r\n\r\n      entity.setStateOptions({\r\n        visibile: !state.hide,\r\n        highlighted: state.highlight,\r\n      });\r\n    }\r\n  }\r\n\r\n  protected inBeforeTheRootRender(gl: WebGLRenderingContext, modelControls: ModelControls) {\r\n    // nothing\r\n  }\r\n\r\n  render(gl: WebGLRenderingContext, modelControls: ModelControls, delta?: number) {\r\n    const viewWidth = gl.drawingBufferWidth;\r\n    const viewHeight = gl.drawingBufferHeight;\r\n\r\n    gl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n    gl.clearDepth(1.0);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.depthFunc(gl.LEQUAL);\r\n\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n    const fieldOfView = (45 * Math.PI) / 180;\r\n    const aspect = viewWidth / viewHeight;\r\n    const zNear = 0.1;\r\n    const zFar = 100.0;\r\n    const projectionMatrix = mat4.create();\r\n\r\n    gl.useProgram(this.programInfo.program);\r\n\r\n    this.ctx.setUniformFloat4('baseColor', modelControls.viewColor ?? DEFAULT_BASE_COLOR);\r\n\r\n    mat4.perspective(projectionMatrix, fieldOfView, aspect, zNear, zFar);\r\n    this.ctx.setUniformMatrix4('projectionMatrix', projectionMatrix);\r\n\r\n    const xOffset = modelControls.translationX * TRANSLATION_MODIFIER;\r\n    const yOffset = modelControls.translationY * TRANSLATION_MODIFIER * -1;\r\n    const zOffset = (BASE_CAMERA_OFFSET + modelControls.zoom * ZOOM_MODIFIER) * -1;\r\n\r\n    // TODO \\/ stop reseting and recreating transformations for no reason. these should only happen\r\n    // when the user actually rotates/pans the camera\r\n    this.rootEntity.resetTransformations();\r\n    this.rootEntity.translate(xOffset, yOffset, zOffset);\r\n    this.rootEntity.rotateX(glMatrix.toRadian(modelControls.rotationX));\r\n    this.rootEntity.rotateY(glMatrix.toRadian(modelControls.rotationY));\r\n    this.rootEntity.rotateZ(glMatrix.toRadian(modelControls.rotationZ));\r\n\r\n    this.inBeforeTheRootRender(gl, modelControls);\r\n\r\n    this.rootEntity.render(this.ctx);\r\n  }\r\n\r\n  update(delta: number) {\r\n    /*const wing1a = this.rootEntity.findChild('wing1a', true)!;\r\n    const wing2a = this.rootEntity.findChild('wing2a', true)!;\r\n\r\n    const rotation = 0;\r\n\r\n    wing1a.resetTransformations();\r\n    wing1a.rotateZ(glMatrix.toRadian(rotation));\r\n\r\n    wing2a.resetTransformations();\r\n    wing2a.rotateZ(glMatrix.toRadian(-rotation));\r\n\r\n    wing1a.setColor([1.0, 0.0, 0.0, 1.0]);\r\n    wing2a.setColor([0.0, 0.0, 1.0, 1.0]);*/\r\n  }\r\n}\r\n","import { TextureMapping } from \"../../texture-mapping\";\r\nimport { ModelControls } from \"../../types/model-controls\";\r\nimport { ViewMode } from \"../../types/view\";\r\nimport { ProgramInfo } from \"../gl/program-info\";\r\nimport { WebGlHelper } from \"../gl/webgl-helper\";\r\nimport { WebglSubRenderer } from \"./webgl-sub-renderer\";\r\n\r\ntype RegularProgramInfo = ProgramInfo<\r\n  'vertexPosition' | 'vertexNormal' | 'textureCoord',\r\n  'modelViewMatrix' | 'projectionMatrix' | 'baseColor' | 'entityColor' | 'normalMatrix' | 'sampler'\r\n    | 'useLights'\r\n>;\r\n\r\nexport class RegularRenderer extends WebglSubRenderer<RegularProgramInfo> {\r\n  override changeTextureMapping(textureMapping: TextureMapping) {\r\n    this.ctx.changeTextureMapping(textureMapping);\r\n  }\r\n\r\n  override changeModelControls(modelControls: ModelControls): void {\r\n    this.ctx.setCurrentLogoIdx(modelControls.logoColorIdx);\r\n    super.changeModelControls(modelControls);\r\n  }\r\n\r\n  protected override getViewMode(): ViewMode {\r\n    return 'regular';\r\n  }\r\n\r\n  protected override initProgram(): RegularProgramInfo {\r\n    const { vsSource, fsSource } = this.shaderSources.regular;\r\n\r\n    const vsShader = WebGlHelper.compileShader(this.gl, vsSource, this.gl.VERTEX_SHADER);\r\n    const fsShader = WebGlHelper.compileShader(this.gl, fsSource, this.gl.FRAGMENT_SHADER);\r\n    const shaderProgram = WebGlHelper.createProgram(this.gl, vsShader, fsShader);\r\n\r\n    return {\r\n      program: shaderProgram,\r\n      attribLocations: {\r\n        vertexPosition: this.gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\r\n        vertexNormal: this.gl.getAttribLocation(shaderProgram, 'aVertexNormal'),\r\n        textureCoord: this.gl.getAttribLocation(shaderProgram, 'aTextureCoord'),\r\n      },\r\n      uniformLocations: {\r\n        modelViewMatrix: this.gl.getUniformLocation(shaderProgram, 'uModelViewMatrix')!,\r\n        projectionMatrix: this.gl.getUniformLocation(shaderProgram, 'uProjectionMatrix')!,\r\n        baseColor: this.gl.getUniformLocation(shaderProgram, 'baseColor')!,\r\n        entityColor: this.gl.getUniformLocation(shaderProgram, 'entityColor')!,\r\n        normalMatrix: this.gl.getUniformLocation(shaderProgram, 'uNormalMatrix')!,\r\n        sampler: this.gl.getUniformLocation(shaderProgram, 'uSampler')!,\r\n        useLights: this.gl.getUniformLocation(shaderProgram, 'useLights')!,\r\n      },\r\n    };\r\n  }\r\n\r\n  protected override inBeforeTheRootRender(gl: WebGLRenderingContext, modelControls: ModelControls): void {\r\n    this.ctx.setUniformBool('useLights', modelControls.enableLightingRegular);\r\n\r\n    const minFilter = modelControls.textureFilterMin === 'linear' ? gl.LINEAR : gl.NEAREST;\r\n    const magFilter = modelControls.textureFilterMag === 'linear' ? gl.LINEAR : gl.NEAREST;\r\n\r\n    this.ctx.setTextureMinFilter(minFilter);\r\n    this.ctx.setTextureMagFilter(magFilter);\r\n  }\r\n}\r\n","import { ModelControls } from \"../../types/model-controls\";\r\nimport { ViewMode } from \"../../types/view\";\r\nimport { ProgramInfo } from \"../gl/program-info\";\r\nimport { WebGlHelper } from \"../gl/webgl-helper\";\r\nimport { WebglSubRenderer } from \"./webgl-sub-renderer\";\r\n\r\ntype SolidColorProgramInfo = ProgramInfo<\r\n  'vertexPosition' | 'vertexNormal',\r\n  'modelViewMatrix' | 'projectionMatrix' | 'baseColor' | 'entityColor' | 'normalMatrix' | 'useLights'\r\n>;\r\n\r\nexport class SolidColorRenderer extends WebglSubRenderer<SolidColorProgramInfo> {\r\n  protected override getViewMode(): ViewMode {\r\n    return 'solid_color';\r\n  }\r\n\r\n  override changeModelControls(modelControls: ModelControls): void {\r\n    this.ctx.setBaseEntityColor(modelControls.solidColor);\r\n  }\r\n\r\n  protected override initProgram(): SolidColorProgramInfo {\r\n    const { vsSource, fsSource } = this.shaderSources.solid;\r\n\r\n    const vsShader = WebGlHelper.compileShader(this.gl, vsSource, this.gl.VERTEX_SHADER);\r\n    const fsShader = WebGlHelper.compileShader(this.gl, fsSource, this.gl.FRAGMENT_SHADER);\r\n    const shaderProgram = WebGlHelper.createProgram(this.gl, vsShader, fsShader);\r\n\r\n    return {\r\n      program: shaderProgram,\r\n      attribLocations: {\r\n        vertexPosition: this.gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\r\n        vertexNormal: this.gl.getAttribLocation(shaderProgram, 'aVertexNormal'),\r\n      },\r\n      uniformLocations: {\r\n        modelViewMatrix: this.gl.getUniformLocation(shaderProgram, 'uModelViewMatrix')!,\r\n        projectionMatrix: this.gl.getUniformLocation(shaderProgram, 'uProjectionMatrix')!,\r\n        baseColor: this.gl.getUniformLocation(shaderProgram, 'baseColor')!,\r\n        entityColor: this.gl.getUniformLocation(shaderProgram, 'entityColor')!,\r\n        normalMatrix: this.gl.getUniformLocation(shaderProgram, 'uNormalMatrix')!,\r\n        useLights: this.gl.getUniformLocation(shaderProgram, 'useLights')!,\r\n      },\r\n    };\r\n  }\r\n\r\n  protected override inBeforeTheRootRender(gl: WebGLRenderingContext, modelControls: ModelControls): void {\r\n    this.ctx.setUniformBool('useLights', modelControls.enableLightingSolidColor);\r\n  }\r\n}\r\n","import { ModelControls } from \"../../types/model-controls\";\r\nimport { ViewMode } from \"../../types/view\";\r\nimport { ProgramInfo } from \"../gl/program-info\";\r\nimport { WebGlHelper } from \"../gl/webgl-helper\";\r\nimport { WebglSubRenderer } from \"./webgl-sub-renderer\";\r\n\r\nexport type WireframeProgramInfo = ProgramInfo<\r\n  'vertexPosition',\r\n  'modelViewMatrix' | 'projectionMatrix' | 'baseColor' | 'entityColor'\r\n>;\r\n\r\nexport class WireframeRenderer extends WebglSubRenderer<WireframeProgramInfo> {\r\n  protected override getViewMode(): ViewMode {\r\n    return 'wireframe';\r\n  }\r\n\r\n  override changeModelControls(modelControls: ModelControls): void {\r\n    this.ctx.setBaseEntityColor(modelControls.wireframeColor);\r\n  }\r\n\r\n  protected override initProgram(): WireframeProgramInfo {\r\n    const { vsSource, fsSource } = this.shaderSources.wireframe;\r\n\r\n    const vsShader = WebGlHelper.compileShader(this.gl, vsSource, this.gl.VERTEX_SHADER);\r\n    const fsShader = WebGlHelper.compileShader(this.gl, fsSource, this.gl.FRAGMENT_SHADER);\r\n    const shaderProgram = WebGlHelper.createProgram(this.gl, vsShader, fsShader);\r\n\r\n    return {\r\n      program: shaderProgram,\r\n      attribLocations: {\r\n        vertexPosition: this.gl.getAttribLocation(shaderProgram, 'aVertexPosition'),\r\n      },\r\n      uniformLocations: {\r\n        modelViewMatrix: this.gl.getUniformLocation(shaderProgram, 'uModelViewMatrix')!,\r\n        projectionMatrix: this.gl.getUniformLocation(shaderProgram, 'uProjectionMatrix')!,\r\n        baseColor: this.gl.getUniformLocation(shaderProgram, 'baseColor')!,\r\n        entityColor: this.gl.getUniformLocation(shaderProgram, 'entityColor')!,\r\n      },\r\n    };\r\n  }\r\n}\r\n","import { Object3doTree } from \"@takingdoms/lib-3do\";\r\nimport { ObjectStateMap } from \"../../components/Main\";\r\nimport { TakLogoColorsDefinitions } from \"../logo-colors\";\r\nimport { TextureMapping } from \"../texture-mapping\";\r\nimport { ModelControls } from \"../types/model-controls\";\r\nimport { ViewMode } from \"../types/view\";\r\nimport { Engine, EngineConfig } from \"./engine\";\r\nimport { RegularRenderer } from \"./webgl-sub-renderers/regular-renderer\";\r\nimport { SolidColorRenderer } from \"./webgl-sub-renderers/solid-color-renderer\";\r\nimport { WebglSubRenderer } from \"./webgl-sub-renderers/webgl-sub-renderer\";\r\nimport { WireframeRenderer } from \"./webgl-sub-renderers/wireframe-renderer\";\r\n\r\nexport type ShaderSources = {\r\n  fsSource: string;\r\n  vsSource: string;\r\n};\r\n\r\nexport type WebglEngineShaderSources = {\r\n  regular: ShaderSources;\r\n  solid: ShaderSources;\r\n  wireframe: ShaderSources;\r\n};\r\n\r\nexport class WebglEngine extends Engine {\r\n  private gl: WebGLRenderingContext;\r\n  private subRenderers: Record<ViewMode, WebglSubRenderer<any>>;\r\n\r\n  constructor(\r\n    config: EngineConfig,\r\n    shaderSources: WebglEngineShaderSources,\r\n    object3doTree: Object3doTree,\r\n    logoDefs: TakLogoColorsDefinitions,\r\n  ) {\r\n    super(config);\r\n\r\n    const gl = config.canvas.getContext('webgl', {\r\n      preserveDrawingBuffer: config.preserveDrawingBuffer,\r\n    });\r\n\r\n    if (gl === null) {\r\n      throw `Couldn't get WebGL rendering context!`;\r\n    }\r\n\r\n    this.gl = gl;\r\n\r\n    gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n    gl.enable(gl.BLEND);\r\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n\r\n    //:: Setup subRenderers\r\n\r\n    this.subRenderers = {\r\n      regular: new RegularRenderer(gl, shaderSources, object3doTree, logoDefs),\r\n      solid_color: new SolidColorRenderer(gl, shaderSources, object3doTree, logoDefs),\r\n      wireframe: new WireframeRenderer(gl, shaderSources, object3doTree, logoDefs),\r\n    };\r\n\r\n    for (const subRenderer of Object.values(this.subRenderers)) {\r\n      subRenderer.changeTextureMapping(config.textureMapping);\r\n    }\r\n\r\n    //:: Setup resizing handler and then render\r\n\r\n    this.setupEvents();\r\n\r\n    if (config.mode === 'continuous') {\r\n      let then = 0;\r\n\r\n      const render = (now: DOMHighResTimeStamp) => {\r\n        now *= 0.001; // convert to seconds\r\n        const deltaTime = now - then;\r\n        then = now;\r\n\r\n        this.update(deltaTime);\r\n        this.render(deltaTime);\r\n\r\n        requestAnimationFrame(render);\r\n      };\r\n\r\n      requestAnimationFrame(render);\r\n    }\r\n  }\r\n\r\n  protected override onResized(): void {\r\n    console.log(`Resized! (${this.width} x ${this.height})`);\r\n    this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\r\n    if (this.config.mode === 'static') {\r\n      this.render();\r\n    }\r\n  }\r\n\r\n  protected override render(delta?: number): void {\r\n    const currentViewMode = this.config.modelControls.viewMode;\r\n    const currentSubRenderer = this.subRenderers[currentViewMode];\r\n\r\n    currentSubRenderer.render(this.gl, this.config.modelControls, delta);\r\n  }\r\n\r\n  override setTextureMapping(textureMapping: TextureMapping) {\r\n    for (const subRenderer of Object.values(this.subRenderers)) {\r\n      subRenderer.changeTextureMapping(textureMapping);\r\n    }\r\n\r\n    super.setTextureMapping(textureMapping);\r\n  }\r\n\r\n  override setModelControls(modelControls: ModelControls): void {\r\n    for (const subRenderer of Object.values(this.subRenderers)) {\r\n      subRenderer.changeModelControls(modelControls);\r\n    }\r\n\r\n    super.setModelControls(modelControls);\r\n  }\r\n\r\n  override setObjectStateMap(objStateMap: ObjectStateMap): void {\r\n    for (const subRenderer of Object.values(this.subRenderers)) {\r\n      subRenderer.changeObjectStateMap(objStateMap);\r\n    }\r\n\r\n    super.setObjectStateMap(objStateMap);\r\n  }\r\n\r\n  private update(delta: number) {\r\n    const currentViewMode = this.config.modelControls.viewMode;\r\n    const currentSubRenderer = this.subRenderers[currentViewMode];\r\n\r\n    currentSubRenderer.update(delta);\r\n  }\r\n}\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { MutableRef } from \"preact/hooks\";\r\n\r\ntype CanvasWrapperProps = {\r\n  canvasRef: MutableRef<HTMLCanvasElement | undefined>;\r\n};\r\n\r\nconst CanvasWrapper: FunctionComponent<CanvasWrapperProps> = ({ canvasRef }) => {\r\n  console.log('Re-rendering CanvasWrapper');\r\n\r\n  const canvas = (\r\n    // don't touch this div \\/ because the engine listen to resize events on it\r\n    <div class=\"absolute inset-0\">\r\n      <canvas ref={canvasRef as MutableRef<HTMLCanvasElement>} />\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div class=\"w-full h-full max-w-full max-h-full relative\">\r\n      {canvas}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CanvasWrapper;\r\n","// extracted by mini-css-extract-plugin\nexport default {\"NameWrapper\":\"NameWrapper__lk4ti\",\"LeftBorder\":\"LeftBorder__WZG0Y\",\"MiddleBorder\":\"MiddleBorder__FcOEe\",\"Root\":\"Root__0piuG\"};","import { FunctionComponent, h } from 'preact';\r\nimport { ObjectState } from \"../../lib/object-state\";\r\n\r\nconst ObjectSideControls: FunctionComponent<{\r\n  state: ObjectState;\r\n  setState: (newState: ObjectState) => void;\r\n}> = ({ state, setState }) => {\r\n  return (\r\n    <div class=\"flex pr-1\">\r\n      <div\r\n        class={'flex items-center px-1 cursor-pointer'\r\n          + (state.highlight ? ' text-yellow-500' : '')}\r\n        onClick={() => setState({ ...state, highlight: !state.highlight })}\r\n      >H</div>\r\n      <div\r\n        class={'flex items-center px-1 cursor-pointer'\r\n          + (state.hide ? '' : ' text-yellow-500')}\r\n        onClick={() => setState({ ...state, hide: !state.hide })}\r\n      >V</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ObjectSideControls;\r\n","import { Object3do } from \"@takingdoms/lib-3do\";\r\nimport { FunctionComponent, h } from 'preact';\r\nimport { useState } from \"preact/hooks\";\r\nimport { Utils } from \"../../lib/utils\";\r\nimport { ObjectStateMap } from \"../Main\";\r\nimport Styles from './ObjectListTree.module.css';\r\nimport ObjectSideControls from \"./ObjectSideControls\";\r\n\r\nconst INDENT = '1.50rem';\r\nconst ROW_HEIGHT = '34px';\r\nconst SPACING_Y = '0.50rem';\r\n\r\nconst ObjectListTree: FunctionComponent<{\r\n  current: Object3do | null; // null = root\r\n  nodes: Object3do[];\r\n  onChangeNodeStack: (stack: Object3do[]) => void;\r\n  nodeStack: Object3do[]; // used exclusively for the onChangeNodeStack callback\r\n\r\n  objStateMap: ObjectStateMap; // TODO: in the future, maybe combine the stateMap WITH The Tree... HELL YEAH and it should be called Stateful3doObjectTree and StatefulObject3do. now JUST DO IT\r\n  setObjStateMap: (newObjectStateMap: ObjectStateMap) => void;\r\n}> = ({\r\n  current,\r\n  nodes,\r\n  onChangeNodeStack,\r\n  nodeStack,\r\n  objStateMap,\r\n  setObjStateMap,\r\n}) => {\r\n  const [showChildren, setShowChildren] = useState(true);\r\n\r\n  const hasChildren = nodes.length > 0;\r\n\r\n  const objState = current && objStateMap.get(current);\r\n\r\n  return (\r\n    <div class={Styles.Root + ' w-full overflow-hidden text-sm'}>\r\n      {current !== null && (\r\n        <div\r\n          style={{ height: ROW_HEIGHT }}\r\n          class={Styles.NameWrapper + ' flex py-1 bg-cyan-900 box-border'}\r\n        >\r\n          <div\r\n            onClick={hasChildren ? () => setShowChildren(!showChildren) : undefined}\r\n            class={`flex items-center px-1 pl-2 ${hasChildren ? 'cursor-pointer hover:text-yellow-400' : 'invisible'}`}\r\n          >\r\n            {showChildren ? '' : ''}\r\n          </div>\r\n\r\n          <div\r\n            class=\"min-w-0 flex items-center grow hover:text-yellow-400 cursor-pointer\"\r\n            onClick={() => onChangeNodeStack(nodeStack)}\r\n          >\r\n            <div class=\"truncate px-1\" title={current.name}>\r\n              {current.name ?? <span class=\"text-gray-300\">{'<empty name>'}</span>}\r\n            </div>\r\n          </div>\r\n\r\n          {objState && (\r\n            <ObjectSideControls\r\n              state={objState}\r\n              setState={(newObjState) => {\r\n                const newMap = Utils.createUpdatedMap(objStateMap, current, newObjState);\r\n                setObjStateMap(newMap);\r\n              }}\r\n            />\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      {nodes.length > 0 && (\r\n        <div class={showChildren ? 'block' : 'hidden'}>\r\n          {nodes.map((subNode, index) => (\r\n            <div key={index} class=\"flex\">\r\n              <div\r\n                class={Styles.LeftBorder}\r\n                style={{\r\n                  marginLeft: `calc(${INDENT} / 2)`,\r\n                  height: index === nodes.length - 1\r\n                    ? `calc(${ROW_HEIGHT} / 2 + ${SPACING_Y})`\r\n                    : 'auto',\r\n                }}\r\n              />\r\n\r\n              <div\r\n                class={Styles.MiddleBorder + ' self-start'}\r\n                style={{\r\n                  width: `calc(${INDENT} / 2)`,\r\n                  height: `calc(${ROW_HEIGHT} / 2 + ${SPACING_Y})`,\r\n                }}\r\n              />\r\n\r\n              <div\r\n                class=\"grow max-w-full overflow-hidden\"\r\n                style={{ paddingTop: SPACING_Y }}\r\n              >\r\n                <ObjectListTree\r\n                  current={subNode}\r\n                  nodes={subNode.children}\r\n                  onChangeNodeStack={onChangeNodeStack}\r\n                  nodeStack={[...nodeStack, subNode]}\r\n                  objStateMap={objStateMap}\r\n                  setObjStateMap={setObjStateMap}\r\n                />\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ObjectListTree;\r\n","import { Primitive3do } from \"@takingdoms/lib-3do\";\r\nimport { FunctionComponent, h } from 'preact';\r\n\r\nconst cellCss = 'px-1.5 py-1 align-top text-left';\r\nconst thCss = `${cellCss} whitespace-nowrap`;\r\nconst tdCss = `${cellCss} break-all`;\r\n\r\nconst PrimitivesTable: FunctionComponent<{\r\n  primitives: Primitive3do[];\r\n}> = ({ primitives }) => {\r\n  return (\r\n    <table class=\"w-full overflow-hidden\">\r\n      <thead>\r\n        <tr>\r\n          <th class={thCss}>#</th>\r\n          <th class={thCss} title=\"Vertex Indices\">V.Indices</th>\r\n          <th class={thCss}>Texture</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {primitives.map((primitive, index) => {\r\n          return (\r\n            <tr key={index}>\r\n              <td class={tdCss}>{index}</td>\r\n              <td class={tdCss}>[{primitive.vertexIndices.join(', ')}]</td>\r\n              <td class={`${tdCss}`}>{primitive.textureName}</td>\r\n            </tr>\r\n          );\r\n        })}\r\n      </tbody>\r\n    </table>\r\n  );\r\n};\r\n\r\nexport default PrimitivesTable;\r\n","import { Object3do, Object3doTree } from \"@takingdoms/lib-3do\";\r\nimport { FunctionComponent, h, Fragment } from 'preact';\r\nimport { useMemo, useState } from \"preact/hooks\";\r\nimport { Utils } from \"../../lib/utils\";\r\nimport { ObjectStateMap } from \"../Main\";\r\nimport Spoiler from \"../ui/Spoiler\";\r\nimport ObjectListTree from \"./ObjectListTree\";\r\nimport ObjectSideControls from \"./ObjectSideControls\";\r\nimport PrimitivesTable from \"./PrimitivesTable\";\r\n\r\nconst ObjectList: FunctionComponent<{\r\n  object3doTree: Object3doTree;\r\n  objStateMap: ObjectStateMap; // TODO: in the future, maybe combine the stateMap WITH The Tree... HELL YEAH and it should be called Stateful3doObjectTree and StatefulObject3do. now JUST DO IT\r\n  setObjStateMap: (newObjectStateMap: ObjectStateMap) => void;\r\n}> = ({\r\n  object3doTree,\r\n  objStateMap,\r\n  setObjStateMap,\r\n}) => {\r\n  const [nodeStack, setNodeStack] = useState<Object3do[]>([]);\r\n\r\n  const currentParent: Object3do | null = nodeStack.length === 0\r\n    ? null // (aka root)\r\n    : nodeStack[nodeStack.length - 1]!; // top of the stack\r\n\r\n  const currentChildren: Object3do[] = currentParent === null\r\n    ? object3doTree.rootNodes\r\n    : currentParent.children;\r\n\r\n  const currentObjState = currentParent && objStateMap.get(currentParent);\r\n\r\n  const pathing = useMemo(() => {\r\n    const sep = <div class=\"mx-1 text-pink-600\">&raquo;</div>;\r\n    const selCss = 'font-bold';\r\n    const unselCss = 'cursor-pointer text-gray-400 hover:text-white';\r\n\r\n    return (\r\n      <div class=\"flex flex-wrap bg-gray-900 px-1 py-0.5\">\r\n        <div\r\n          class={currentParent === null ? selCss : unselCss}\r\n          onClick={() => setNodeStack([])}\r\n        >\r\n          <span class=\"italic\">(ROOT)</span>\r\n        </div>\r\n        {currentParent !== null && sep}\r\n        {nodeStack.map((node, index) => (\r\n          <Fragment key={index}>\r\n            <div\r\n              onClick={() => setNodeStack(nodeStack.slice(0, index + 1))}\r\n              class={index === nodeStack.length - 1 ? selCss : unselCss}\r\n            >\r\n              {node.name}\r\n            </div>\r\n            {index < nodeStack.length - 1 && sep}\r\n          </Fragment>\r\n        ))}\r\n      </div>\r\n    );\r\n  }, [nodeStack, currentParent]);\r\n\r\n  const currentParentInfo = useMemo(() => (\r\n    <div\r\n      class={'flex py-1 bg-cyan-900 border border-yellow-500 text-sm'}\r\n    >\r\n      <div class=\"min-w-0 grow px-1 pl-2\">\r\n        {currentParent === null\r\n          ? <span class=\"italic\">(ROOT)</span>\r\n          : (currentParent.name ?? <span class=\"text-gray-300\">{'<empty name>'}</span>)}\r\n      </div>\r\n\r\n      {currentObjState && (\r\n        <ObjectSideControls\r\n          state={currentObjState}\r\n          setState={(newObjState) => {\r\n            const newMap = Utils.createUpdatedMap(objStateMap, currentParent, newObjState);\r\n            setObjStateMap(newMap);\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  ), [currentParent, currentObjState, objStateMap, setObjStateMap]);\r\n\r\n  const currentParentPositions = useMemo(() => {\r\n    if (currentParent === null || currentParent.primitives.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div class=\"border border-dashed border-gray-500 px-2 py-1 mt-2 mb-1 text-sm text-gray-300\">\r\n        <Spoiler title=\"Vertices\">\r\n          <div class=\"border-t border-gray-700 mt-1 pt-1 text-xs\">\r\n            <span class=\"break-all\">\r\n              [{currentParent.vertices.map((v) => `[${v.x}, ${v.y}, ${v.z}]`).join(', ')}]\r\n            </span>\r\n          </div>\r\n        </Spoiler>\r\n      </div>\r\n    );\r\n  }, [currentParent]);\r\n\r\n  const currentParentPrimitives = useMemo(() => {\r\n    if (currentParent === null || currentParent.primitives.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div class=\"border border-dashed border-gray-500 px-2 py-1 mt-2 mb-1 text-sm text-gray-300\">\r\n        <Spoiler title=\"Primitives\">\r\n          <div class=\"border-t border-gray-700 mt-1 pt-1 text-xs\">\r\n            <PrimitivesTable primitives={currentParent.primitives} />\r\n          </div>\r\n        </Spoiler>\r\n      </div>\r\n    );\r\n  }, [currentParent]);\r\n\r\n  return (\r\n    <div class=\"flex flex-col h-full overflow-hidden\">\r\n      <div className=\"px-6\">\r\n        <div class=\"mb-4\">\r\n          {pathing}\r\n        </div>\r\n\r\n        <div class=\"mb-2 font-bold\">Current:</div>\r\n\r\n        {currentParentInfo}\r\n        <div class=\"pl-4\">\r\n          {currentParentPositions}\r\n          {currentParentPrimitives}\r\n        </div>\r\n\r\n        {currentChildren.length > 0 && (\r\n          <div class=\"mt-6 mb-2 font-bold flex justify-between\">\r\n            <span>Children:</span>\r\n            <span>({currentChildren.length})</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* <ul class=\"grow overflow-auto list-disc pl-6 pr-4 text-sm\"></ul> */}\r\n      <div class=\"grow overflow-auto px-6\">\r\n        <ObjectListTree\r\n          current={null}\r\n          nodes={currentChildren}\r\n          onChangeNodeStack={setNodeStack}\r\n          nodeStack={nodeStack}\r\n          objStateMap={objStateMap}\r\n          setObjStateMap={setObjStateMap}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ObjectList;\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { TextureMapping } from \"../../lib/texture-mapping\";\r\n\r\ntype TextureListProps = {\r\n  textures: TextureMapping;\r\n  setTextures?: (t: TextureMapping) => void;\r\n};\r\n\r\nconst TextureList: FunctionComponent<TextureListProps> = ({\r\n  textures,\r\n  setTextures,\r\n}) => {\r\n  return (\r\n    <div class=\"flex flex-col space-y-2\">\r\n      {Object.entries(textures).map(([key, value], index) => {\r\n        let isOk = value !== null;\r\n\r\n        if (value !== null && value.type === 'html') {\r\n          isOk = value.image.complete && value.image.naturalWidth !== 0;\r\n        }\r\n\r\n        const msg = isOk ? 'OK' : 'ERROR';\r\n\r\n        return (\r\n          <div\r\n            key={index}\r\n            class={'flex items-center group'\r\n              + (isOk ? ' text-green-600 hover:text-green-500' : ' text-red-600 hover:text-red-500')}\r\n          >\r\n            <div class=\"break-all\">{key}</div>\r\n\r\n            <div\r\n              class=\"grow border-b border-dashed border-gray-600 group-hover:border-gray-500 mx-1\r\n                text-transparent text-center\"\r\n              style={{ minWidth: '24px', marginBottom: '6px' }}\r\n            >\r\n              -\r\n            </div>\r\n\r\n            {value?.type === 'html' ? (\r\n              <a href={value.image.src} target=\"_blank\" rel=\"noreferrer\">{msg}</a>\r\n            ) : (\r\n              <div>{msg}</div>\r\n            )}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TextureList;\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { useCallback, useState } from \"preact/hooks\";\r\nimport { IoUtils } from \"../../lib/io-utils\";\r\nimport { TextureMapping } from \"../../lib/texture-mapping\";\r\nimport TextureList from \"./TextureList\";\r\n\r\ntype TextureManagerProps = {\r\n  regularTextures: TextureMapping;\r\n  customTextures: TextureMapping;\r\n  setCustomTextures: (t: TextureMapping) => void;\r\n};\r\n\r\nconst validFormats = ['image/png', 'image/gif', 'image/jpeg'];\r\n\r\nconst TextureManager: FunctionComponent<TextureManagerProps> = ({\r\n  regularTextures,\r\n  customTextures,\r\n  setCustomTextures,\r\n}) => {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const loadFiles = useCallback(async (files: FileList) => {\r\n    const newMapping: TextureMapping = {};\r\n\r\n    for (const file of files) {\r\n      if (!validFormats.includes(file.type)) {\r\n        continue;\r\n      }\r\n\r\n      const updateMapping = (image: HTMLImageElement) => {\r\n        const fileBasename = file.name\r\n          .replace(/^.*[\\\\\\/]/, '')   // get filename (remove parent directories)\r\n          .replace(/\\.[^/.]+$/, '');  // get basename (remove extension)\r\n\r\n        newMapping[fileBasename] = { type: 'html', image };\r\n      };\r\n\r\n      await IoUtils.loadDataUrl(file)\r\n        .then(IoUtils.createImageFromDataUrl)\r\n        .then(updateMapping)\r\n        .catch(console.error);\r\n    }\r\n\r\n    setCustomTextures({\r\n      ...customTextures,\r\n      ...newMapping,\r\n    });\r\n  }, [customTextures, setCustomTextures]);\r\n\r\n  const fileInput = (\r\n    <input\r\n      type=\"file\"\r\n      multiple={true}\r\n      accept={validFormats.join(', ')}\r\n      disabled={isLoading}\r\n      onChange={(ev) => {\r\n        if (isLoading) {\r\n          ev.currentTarget.value = '';\r\n          return;\r\n        }\r\n\r\n        const files = ev.currentTarget.files;\r\n\r\n        if (files !== null) {\r\n          setIsLoading(true);\r\n\r\n          loadFiles(files).finally(() => {\r\n            setIsLoading(false);\r\n          });\r\n        }\r\n\r\n        ev.currentTarget.value = '';\r\n      }}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <div class=\"flex flex-col max-h-full overflow-hidden\">\r\n\r\n      <div class=\"text-center font-bold mb-2\">Custom Textures</div>\r\n      <div class=\"grow overflow-auto px-6\">\r\n        <TextureList textures={customTextures} setTextures={setCustomTextures} />\r\n      </div>\r\n      <div className=\"px-6 mt-2\">{fileInput}</div>\r\n      <div class=\"mb-6\" />\r\n\r\n      <div class=\"text-center font-bold mb-2\">TAK Textures</div>\r\n      <div class=\"grow overflow-auto px-6\">\r\n        <TextureList textures={regularTextures} />\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TextureManager;\r\n","import { Object3do, Object3doTree } from \"@takingdoms/lib-3do\";\r\nimport { FunctionComponent, h } from 'preact';\r\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"preact/hooks\";\r\nimport { Engine, EngineConfig, EngineListener } from \"../lib/engines/engine\";\r\nimport { UiDebugEngine } from \"../lib/engines/ui-debug-engine\";\r\nimport { WebglEngine, WebglEngineShaderSources } from \"../lib/engines/webgl-engine\";\r\nimport { TakLogoColorsDefinitions } from \"../lib/logo-colors\";\r\nimport { ObjectState } from \"../lib/object-state\";\r\nimport { UserService } from \"../lib/services/user-service\";\r\nimport { TextureMapping } from \"../lib/texture-mapping\";\r\nimport { ModelControls } from \"../lib/types/model-controls\";\r\nimport { UserSettings } from \"../lib/types/user-settings\";\r\nimport CanvasWrapper from \"./canvas/CanvasWrapper\";\r\nimport ObjectList from \"./object-list/ObjectList\";\r\nimport Options from \"./options/Options\";\r\nimport TextureManager from \"./textures/TextureManager\";\r\n\r\nconst CONTENT_WIDTH = '1600px';\r\n\r\ntype SidebarTab = 'options' | 'objects' | 'textures';\r\nconst SIDEBAR_TABS = ['options', 'objects', 'textures'] as const;\r\n\r\nexport type ObjectStateMap = Map<Object3do, ObjectState>;\r\n\r\nconst Main: FunctionComponent<{\r\n  engineName: 'webgl' | 'ui-debug';\r\n  shaders: WebglEngineShaderSources;\r\n  object3doTree: Object3doTree;\r\n  regularTextures: TextureMapping;\r\n  defaultObjStateMap: ObjectStateMap;\r\n  logoDefs: TakLogoColorsDefinitions;\r\n  userService: UserService;\r\n  defaultUserSettings: UserSettings;\r\n  defaultModelControls: ModelControls;\r\n}> = ({\r\n  engineName,\r\n  shaders,\r\n  object3doTree,\r\n  regularTextures,\r\n  defaultObjStateMap,\r\n  logoDefs,\r\n  userService,\r\n  defaultUserSettings,\r\n  defaultModelControls,\r\n}) => {\r\n  console.log('Re-rendering App');\r\n\r\n  //:: States & Refs\r\n\r\n  const [expandContent, setExpandContent] = useState(false);\r\n  const [sidebarTab, setSidebarTab] = useState<SidebarTab>('options');\r\n  const [modelControls, setModelControls] = useState(defaultModelControls);\r\n  const [objStateMap, setObjStateMap] = useState<ObjectStateMap>(defaultObjStateMap);\r\n  const [engine, setEngine] = useState<Engine>();\r\n\r\n  const [userSettings, _setUserSettings] = useState(defaultUserSettings);\r\n  const setUserSettings = useCallback((newUserSettings: UserSettings) => {\r\n    _setUserSettings(newUserSettings);\r\n    userService.save(newUserSettings);\r\n  }, [userService]);\r\n\r\n  const [customTextures, setCustomTextures] = useState<TextureMapping>({});\r\n\r\n  const canvasRef = useRef<HTMLCanvasElement>();\r\n\r\n  //:: Effects\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n\r\n    canvas.width = canvas.clientWidth;\r\n    canvas.height = canvas.clientHeight;\r\n\r\n    console.log('Creating the Engine');\r\n\r\n    const engineListener: EngineListener = {\r\n      onModelControlsChanged: setModelControls,\r\n    };\r\n\r\n    const engineConfig: EngineConfig = {\r\n      mode: 'static',\r\n      canvas: canvas,\r\n      modelControls: defaultModelControls,\r\n      listener: engineListener,\r\n      textureMapping: { ...regularTextures },\r\n      objStateMap: defaultObjStateMap,\r\n      preserveDrawingBuffer: defaultUserSettings.preserveDrawingBuffer,\r\n    };\r\n\r\n    const actualLogoDefs: TakLogoColorsDefinitions = {\r\n      ...logoDefs,\r\n      defaultIdx: defaultModelControls.logoColorIdx,\r\n    };\r\n\r\n    const engine = engineName === 'webgl'\r\n      ? new WebglEngine(engineConfig, shaders, object3doTree, actualLogoDefs)\r\n      : new UiDebugEngine(engineConfig);\r\n\r\n    setEngine(engine);\r\n\r\n    return () => {\r\n      engine.destroy();\r\n      setEngine(undefined);\r\n      alert(`Unmounting the engine. This should probably not be happening normally!!!`);\r\n    };\r\n    // \\/ important: all dependencies should come from non-stateful values: AKA never change\r\n  }, [canvasRef, shaders, defaultObjStateMap, engineName, object3doTree, regularTextures, logoDefs,\r\n      defaultModelControls, defaultUserSettings]);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n\r\n    if (!canvas) {\r\n      return;\r\n    }\r\n\r\n    canvas.style.background = modelControls.canvasBackground;\r\n    canvas.style.backgroundSize = modelControls.canvasBackgroundSize;\r\n    canvas.style.backgroundRepeat = modelControls.canvasBackgroundRepeat;\r\n    canvas.style.backgroundPosition = 'center';\r\n  }, [canvasRef, modelControls]);\r\n\r\n  useEffect(() => {\r\n    if (engine) {\r\n      engine.setModelControls(modelControls);\r\n    }\r\n  }, [engine, modelControls]);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      modelControls.textureFilterMin !== userSettings.defaultTextureFilterMin ||\r\n      modelControls.textureFilterMag !== userSettings.defaultTextureFilterMag\r\n    ) {\r\n      setUserSettings({\r\n        ...userSettings,\r\n        defaultTextureFilterMin: modelControls.textureFilterMin,\r\n        defaultTextureFilterMag: modelControls.textureFilterMag,\r\n      });\r\n    }\r\n  }, [engine, modelControls, userSettings, setUserSettings]);\r\n\r\n  useEffect(() => {\r\n    if (engine) {\r\n      engine.setObjectStateMap(objStateMap);\r\n    }\r\n  }, [engine, objStateMap]);\r\n\r\n  useEffect(() => {\r\n    if (engine) {\r\n      engine.setTextureMapping({ ...regularTextures, ...customTextures });\r\n    }\r\n  }, [engine, regularTextures, customTextures]);\r\n\r\n  //:: Memos\r\n\r\n  const canvasWrapper = useMemo(() => (\r\n    <CanvasWrapper canvasRef={canvasRef} />\r\n  ), [canvasRef]);\r\n\r\n  const canvasPanel = useMemo(() => (\r\n    <div class=\"h-full flex flex-col\">\r\n      <div class=\"flex text-white border-b border-gray-700\">\r\n        <div class=\"grow px-4 py-4 text-center\">\r\n          Canvas\r\n        </div>\r\n        <div\r\n          class=\"px-4 py-4 cursor-pointer hover:bg-blue-700 font-mono\"\r\n          onClick={() => setExpandContent(!expandContent)}\r\n        >\r\n          {expandContent ? '>[ ]<' : '<[ ]>'}\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"grow p-6\">\r\n        {canvasWrapper}\r\n      </div>\r\n    </div>\r\n  ), [canvasWrapper, expandContent]);\r\n\r\n  const optionsPanel = useMemo(() => (\r\n    <Options\r\n      modelControls={modelControls}\r\n      setModelControls={setModelControls}\r\n      userSettings={userSettings}\r\n      setUserSettings={setUserSettings}\r\n      logoDefs={logoDefs}\r\n      canvasRef={canvasRef}\r\n    />\r\n  ), [modelControls, userSettings, setUserSettings, logoDefs, canvasRef]);\r\n\r\n  const objectsPanel = useMemo(() => {\r\n    return (\r\n      <ObjectList\r\n        object3doTree={object3doTree}\r\n        objStateMap={objStateMap}\r\n        setObjStateMap={setObjStateMap}\r\n      />\r\n    );\r\n  }, [object3doTree, objStateMap]);\r\n\r\n  const texturesPanel = useMemo(() => {\r\n    return (\r\n      <TextureManager\r\n        regularTextures={regularTextures}\r\n        customTextures={customTextures}\r\n        setCustomTextures={setCustomTextures}\r\n      />\r\n    );\r\n  }, [customTextures, regularTextures]);\r\n\r\n  const sidebar = useMemo(() => {\r\n    return (\r\n      <div class=\"h-full flex flex-col\">\r\n        <div class=\"flex text-white border-b border-gray-700\">\r\n          {SIDEBAR_TABS.map((tab, index, arr) => {\r\n            const isSelected = tab === sidebarTab;\r\n\r\n            const seletedCss = isSelected\r\n              ? 'font-bold'\r\n              : 'cursor-pointer text-gray-400 hover:text-white';\r\n\r\n            const borderCss = index !== arr.length - 1\r\n              ? 'border-r border-gray-700'\r\n              : '';\r\n\r\n            return (\r\n              <div\r\n                key={index}\r\n                class={`grow basis-0 px-2 py-4 text-center ${seletedCss} ${borderCss}`}\r\n                onClick={() => {\r\n                  if (!isSelected) {\r\n                    setSidebarTab(tab as SidebarTab);\r\n                  }\r\n                }}\r\n              >\r\n                {tab === 'options' ? 'Options'\r\n                  : tab === 'objects' ? 'Objects'\r\n                  : 'Textures'}\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n\r\n        <div\r\n          class=\"grow max-h-full overflow-hidden py-6\"\r\n          style={{ width: userSettings.sidebarWidth, overflowX: 'auto' }}\r\n        >\r\n          {sidebarTab === 'options' ? optionsPanel\r\n            : sidebarTab === 'objects' ? objectsPanel\r\n            : texturesPanel}\r\n        </div>\r\n      </div>\r\n    );\r\n  }, [sidebarTab, optionsPanel, userSettings, objectsPanel, texturesPanel]);\r\n\r\n  //:: Final result\r\n\r\n  const contentBorderCss = expandContent ? ' border-gray-800' : ' border-gray-700';\r\n  const flexDirCss = userSettings.sidebarPosition === 'left' ? '' : ' flex-row-reverse';\r\n\r\n  const sidebarBorderCss = userSettings.sidebarPosition === 'left' ? ' border-r' : ' border-l';\r\n\r\n  return (\r\n    <div class=\"flex justify-center items-stretch h-screen overflow-hidden bg-gray-900\">\r\n      <div\r\n        class={`grow flex bg-gray-800 border ${contentBorderCss} ${flexDirCss}`}\r\n        style={{ \"max-width\": expandContent ? '100%' : CONTENT_WIDTH }}\r\n      >\r\n        <div class={`hidden lg:block border-gray-700 ${sidebarBorderCss}`}>\r\n          {sidebar}\r\n        </div>\r\n        <div class=\"grow\">\r\n          {canvasPanel}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Main;\r\n","import './style/index.css';\r\nimport App from './components/App';\r\n\r\nexport default App;\r\n\r\n/*\r\n  Components will load like this:\r\n  App -> FileChooser -> Loader -> Main\r\n*/\r\n","import { h } from 'preact';\r\nimport { useEffect, useState } from \"preact/hooks\";\r\nimport { localStorageUserService } from \"../lib/services/user-service\";\r\nimport { DEFAULT_MODEL_CONTROLS, ModelControls } from \"../lib/types/model-controls\";\r\nimport { UserSettings, DEFAULT_USER_SETTINGS } from \"../lib/types/user-settings\";\r\nimport FileChooser from \"./loader/FileChooser\";\r\nimport Loader from \"./loader/Loader\";\r\n\r\nconst App = () => {\r\n  const [dataSource, setDataSource] = useState<File | string>(); // string = url\r\n\r\n  const [userService] = useState(localStorageUserService);\r\n  const [defaultUserSettings, setDefaultUserSettings] = useState<UserSettings>();\r\n  const [defaultModelControls, setDefaultModelControls] = useState<ModelControls>();\r\n\r\n  useEffect(() => {\r\n    let userSettings: UserSettings;\r\n\r\n    try {\r\n      userSettings = userService.load() ?? DEFAULT_USER_SETTINGS;\r\n    } catch (err) {\r\n      console.error(err);\r\n      userSettings = DEFAULT_USER_SETTINGS;\r\n      userService.save(userSettings);\r\n    }\r\n\r\n    setDefaultUserSettings(userSettings);\r\n\r\n    setDefaultModelControls({\r\n      ...DEFAULT_MODEL_CONTROLS,\r\n      textureFilterMin: userSettings.defaultTextureFilterMin,\r\n      textureFilterMag: userSettings.defaultTextureFilterMag,\r\n    });\r\n  }, [userService]);\r\n\r\n  if (defaultUserSettings === undefined || defaultModelControls === undefined) {\r\n    return (\r\n      <div class=\"min-h-screen flex justify-center items-center\">\r\n        <span>Loading...</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (dataSource === undefined) {\r\n    return (\r\n      <FileChooser\r\n        onSubmit={setDataSource}\r\n        defaultUserSettings={defaultUserSettings}\r\n        setDefaultUserSettings={(newUserSettings) => {\r\n          setDefaultUserSettings(newUserSettings);\r\n          userService.save(newUserSettings);\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Loader\r\n      dataSource={dataSource}\r\n      userService={userService}\r\n      defaultUserSettings={defaultUserSettings}\r\n      defaultModelControls={defaultModelControls}\r\n    />\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { ModelControls } from \"../../../lib/types/model-controls\";\r\nimport ColorControl from \"../../ui/ColorControl\";\r\n\r\nconst SolidColorOptions: FunctionComponent<{\r\n  modelControls: ModelControls;\r\n  setModelControls: (m: ModelControls) => void;\r\n}> = ({\r\n  modelControls,\r\n  setModelControls,\r\n}) => {\r\n  return (\r\n    <div class=\"space-y-4\">\r\n\r\n      <div>\r\n        <label class=\"flex items-center\">\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={modelControls.enableLightingSolidColor}\r\n            onChange={(ev) => {\r\n              setModelControls({\r\n                ...modelControls,\r\n                enableLightingSolidColor: ev.currentTarget.checked,\r\n              });\r\n            }}\r\n          />\r\n          <span class=\"pl-1\">Enable Lighting</span>\r\n        </label>\r\n      </div>\r\n\r\n      <div>\r\n        <div class=\"\">\r\n          Solid Color\r\n        </div>\r\n\r\n        <ColorControl\r\n          color={modelControls.solidColor}\r\n          setColor={(solidColor) => setModelControls({ ...modelControls, solidColor })}\r\n        />\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default SolidColorOptions;\r\n","import { FunctionComponent, h } from 'preact';\r\nimport { MutableRef, useCallback, useEffect, useMemo, useState } from \"preact/hooks\";\r\nimport { IoUtils } from \"../../lib/io-utils\";\r\nimport { ModelControls } from \"../../lib/types/model-controls\";\r\nimport { UserSettings } from \"../../lib/types/user-settings\";\r\n\r\nconst OptionsMisc: FunctionComponent<{\r\n  modelControls: ModelControls;\r\n  setModelControls: (m: ModelControls) => void;\r\n  canvasRef: MutableRef<HTMLCanvasElement | undefined>;\r\n  enableSaveImageButton: boolean;\r\n}> = ({\r\n  modelControls,\r\n  setModelControls,\r\n  enableSaveImageButton,\r\n  canvasRef,\r\n}) => {\r\n  const [canvasBg, setCanvasBg] = useState(getInitialBg(modelControls.canvasBackground));\r\n\r\n  const onChangeCanvasBg = useCallback((value: string) => {\r\n    setCanvasBg(value);\r\n\r\n    if (value !== 'custom') {\r\n      setModelControls({ ...modelControls, canvasBackground: value });\r\n    }\r\n  }, [modelControls, setModelControls]);\r\n\r\n  const customBgFile = useMemo(() => {\r\n    if (canvasBg !== 'custom') {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <input\r\n        type=\"file\"\r\n        multiple={false}\r\n        onChange={(ev) => {\r\n          const files = ev.currentTarget.files;\r\n\r\n          if (files === null || files.length === 0) {\r\n            ev.currentTarget.value = '';\r\n            return;\r\n          }\r\n\r\n          const file = files[0]!;\r\n\r\n          IoUtils.loadDataUrl(file).then((dataUrl) => {\r\n            const imageUrl = `url(${dataUrl})`;\r\n            setModelControls({ ...modelControls, canvasBackground: imageUrl });\r\n          });\r\n        }}\r\n      />\r\n    );\r\n  }, [canvasBg, modelControls, setModelControls]);\r\n\r\n  const selectBgSize = useMemo(() => {\r\n    if (canvasBg !== 'custom') {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <div>Background Size</div>\r\n        <select\r\n          class=\"w-full\"\r\n          value={modelControls.canvasBackgroundSize}\r\n          onChange={(ev) => {\r\n            setModelControls({ ...modelControls, canvasBackgroundSize: ev.currentTarget.value as any })\r\n          }}\r\n        >\r\n          <option value=\"auto\">Auto</option>\r\n          <option value=\"cover\">Cover</option>\r\n          <option value=\"contain\">Contain</option>\r\n        </select>\r\n      </div>\r\n    );\r\n  }, [canvasBg, modelControls]);\r\n\r\n  const selectBgRepeat = useMemo(() => {\r\n    if (canvasBg !== 'custom' || modelControls.canvasBackgroundSize === 'cover') {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div>\r\n        <div>Background Repeat</div>\r\n        <select\r\n          class=\"w-full\"\r\n          value={modelControls.canvasBackgroundRepeat}\r\n          onChange={(ev) => {\r\n            setModelControls({ ...modelControls, canvasBackgroundRepeat: ev.currentTarget.value as any })\r\n          }}\r\n        >\r\n          <option value=\"repeat\">On</option>\r\n          <option value=\"no-repeat\">Off</option>\r\n        </select>\r\n      </div>\r\n    );\r\n  }, [canvasBg, modelControls]);\r\n\r\n  const saveCanvasImage = useCallback(() => {\r\n    const canvas = canvasRef.current;\r\n\r\n    if (canvas === undefined) {\r\n      return;\r\n    }\r\n\r\n    const dataURL = canvas.toDataURL();\r\n    const downloadLink = document.createElement('a');\r\n    const timestamp = new Date().getTime();\r\n\r\n    downloadLink.href = dataURL;\r\n    downloadLink.download = `3do-${timestamp}.png`;\r\n    document.body.appendChild(downloadLink);\r\n    downloadLink.click();\r\n    document.body.removeChild(downloadLink);\r\n  }, [canvasRef]);\r\n\r\n  const saveImageButton = useMemo(() => {\r\n    if (!enableSaveImageButton) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div class=\"text-center\">\r\n        <button\r\n          class=\"text-white hover:text-yellow-500 focus:text-yellow-500\"\r\n          onClick={saveCanvasImage}\r\n        >\r\n          Save Model Image\r\n        </button>\r\n      </div>\r\n    );\r\n  }, [enableSaveImageButton, saveCanvasImage]);\r\n\r\n  return (\r\n    <div class=\"space-y-4\">\r\n      {saveImageButton}\r\n\r\n      <div>\r\n        Canvas Background\r\n        <select\r\n          class=\"w-full\"\r\n          value={canvasBg}\r\n          onChange={(ev) => onChangeCanvasBg(ev.currentTarget.value)}\r\n        >\r\n          <option value=\"transparent\">Transparent</option>\r\n          <option value=\"black\">Black</option>\r\n          <option value=\"white\">White</option>\r\n          <option value=\"custom\">(Custom Image)</option>\r\n        </select>\r\n\r\n        <div class=\"mt-0.5\">\r\n          {customBgFile}\r\n        </div>\r\n      </div>\r\n\r\n      {selectBgSize}\r\n\r\n      {selectBgRepeat}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default OptionsMisc;\r\n\r\nfunction getInitialBg(canvasBg: string): string {\r\n  if (canvasBg === 'black' || canvasBg === 'white' || canvasBg === 'transparent') {\r\n    return canvasBg;\r\n  }\r\n\r\n  return 'custom';\r\n}\r\n","function loadDataUrl(file: File) {\r\n  const fileReader = new FileReader();\r\n\r\n  const loadDataUrlPromise = new Promise<string>((resolve, reject) => {\r\n    fileReader.onload = () => {\r\n      const result = fileReader.result;\r\n\r\n      if (typeof result === 'string') {\r\n        resolve(result);\r\n      } else {\r\n        reject(new Error(`Failed to read file: ${file.name}`));\r\n      }\r\n    };\r\n\r\n    fileReader.onerror = () => {\r\n      reject(new Error(`Failed to read file: ${file.name}`));\r\n    };\r\n  });\r\n\r\n  fileReader.readAsDataURL(file);\r\n\r\n  return loadDataUrlPromise;\r\n}\r\n\r\nfunction createImageFromDataUrl(dataUrl: string) {\r\n  return new Promise<HTMLImageElement>((resolve, reject) => {\r\n    const image = new Image();\r\n\r\n    image.onload = () => {\r\n      resolve(image);\r\n    };\r\n\r\n    image.onerror = () => {\r\n      reject(new Error(`Failed to create image for dataUrl: ${dataUrl}`));\r\n    };\r\n\r\n    image.src = dataUrl;\r\n  });\r\n}\r\n\r\nexport const IoUtils = {\r\n  loadDataUrl,\r\n  createImageFromDataUrl,\r\n};\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.PRIMITIVE_STRUCT_SIZE = exports.PRIMITIVE_STRUCT = exports.VERTEX_STRUCT_SIZE = exports.VERTEX_STRUCT = exports.OBJECT_STRUCT_SIZE = exports.OBJECT_STRUCT = void 0;\r\nexports.OBJECT_STRUCT = [\r\n    ['VersionSignature', 'U32'],\r\n    ['NumberOfVertexes', 'U32'],\r\n    ['NumberOfPrimitives', 'U32'],\r\n    ['UnknownFlag', 'U32'],\r\n    ['XFromParent', 'U32'],\r\n    ['YFromParent', 'U32'],\r\n    ['ZFromParent', 'U32'],\r\n    ['OffsetToObjectName', 'U32'],\r\n    ['Always_0', 'U32'],\r\n    ['OffsetToVertexArray', 'U32'],\r\n    ['OffsetToPrimitiveArray', 'U32'],\r\n    ['OffsetToSiblingObject', 'U32'],\r\n    ['OffsetToChildObject', 'U32'],\r\n];\r\n// IMPORTANT: * 4 only because coincidentally every field is an U32 (4 bytes)\r\nexports.OBJECT_STRUCT_SIZE = exports.OBJECT_STRUCT.length * 4;\r\nexports.VERTEX_STRUCT = [\r\n    ['x', 'U32'],\r\n    ['y', 'U32'],\r\n    ['z', 'U32'],\r\n];\r\n// IMPORTANT: * 4 only because coincidentally every field is an U32 (4 bytes)\r\nexports.VERTEX_STRUCT_SIZE = exports.VERTEX_STRUCT.length * 4;\r\nexports.PRIMITIVE_STRUCT = [\r\n    ['Unknown_0', 'U32'],\r\n    ['NumberOfVertexIndexes', 'U32'],\r\n    ['Always_0', 'U32'],\r\n    ['OffsetToVertexIndexArray', 'U32'],\r\n    ['OffsetToTextureName', 'U32'],\r\n    ['Unknown_1', 'U32'],\r\n    ['Unknown_2', 'U32'],\r\n    ['Unknown_3', 'U32'],\r\n];\r\n// IMPORTANT: * 4 only because coincidentally every field is an U32 (4 bytes)\r\nexports.PRIMITIVE_STRUCT_SIZE = exports.PRIMITIVE_STRUCT.length * 4;\r\n"],"sourceRoot":""}